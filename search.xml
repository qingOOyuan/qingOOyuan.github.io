<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>内核kobject分析</title>
      <link href="/2024/05/20/%E5%86%85%E6%A0%B8kobject%E5%88%86%E6%9E%90/"/>
      <url>/2024/05/20/%E5%86%85%E6%A0%B8kobject%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="一、设备驱动模型基本元素"><a href="#一、设备驱动模型基本元素" class="headerlink" title="一、设备驱动模型基本元素"></a>一、设备驱动模型基本元素</h1><h2 id="1-1-kobject结构体"><a href="#1-1-kobject结构体" class="headerlink" title="1.1 kobject结构体"></a>1.1 kobject结构体</h2><p>sysfs的一个目录，常用来表示基本驱动对象，不允许发送消息到用户空间。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">kobject</span> &#123;</span></span><br><span class="line">        <span class="type">const</span> <span class="type">char</span>              *name;        <span class="comment">//kobject的名称，同时也是sysfs下的目录名字</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">list_head</span>        <span class="title">entry</span>;</span>        <span class="comment">//链表节点，用于将kobject加入到kset的list_head</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">kobject</span>          *<span class="title">parent</span>;</span>      <span class="comment">//该kobject的上层节点，构建kobject间的层次关系（在sysfs体现为目录结构）</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">kset</span>             *<span class="title">kset</span>;</span>        <span class="comment">//该kobject所属的kset对象（可以为NULL），用于批量管理kobject对象</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">kobj_type</span>        *<span class="title">ktype</span>;</span>       <span class="comment">//该kobject的sysfs文件系统相关的操作和属性</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">kernfs_node</span>      *<span class="title">sd</span>;</span>          <span class="comment">//该kobject在sysfs文件系统中对应目录项</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">kref</span>             <span class="title">kref</span>;</span>         <span class="comment">//该kobject的引用次数</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_DEBUG_KOBJECT_RELEASE</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">delayed_work</span>     <span class="title">release</span>;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span> state_initialized:<span class="number">1</span>;            <span class="comment">//记录内核对象的初始化状态</span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span> state_in_sysfs:<span class="number">1</span>;               <span class="comment">//表示该kobject所代表的内核对象是否在sysfs建立目录</span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span> state_add_uevent_sent:<span class="number">1</span>;        <span class="comment">//记录是否已经向用户空间发送ADD uevent事件</span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span> state_remove_uevent_sent:<span class="number">1</span>;     <span class="comment">//记录是否已经向用户空间发送REMOVE uevent事件</span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">int</span> uevent_suppress:<span class="number">1</span>;              <span class="comment">//如果为1，则忽略所有上报的uevent事件</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>由于kobject添加到内核时，需要根据名字注册到sysfs虚拟文件系统中，之后就不能再直接修改该名字。如果想改，需要调用kobject_rename接口，该接口会主动处理sysfs的相关事宜。kset如果没有指定的parent，则会把kset作为parent（kset是一个特殊的kobject）。uevent提供了“用空空间通知”的功能实现，当内核中有kobject的增删改等操作时，会通知用户空间。</p><h2 id="1-2-kset结构体"><a href="#1-2-kset结构体" class="headerlink" title="1.2 kset结构体"></a>1.2 kset结构体</h2><p>sysfs的一个目录，常用来管理kobject，允许发送消息到用户空间。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">kset</span> &#123;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">list</span>;</span>                        <span class="comment">//指向该kset下所有的kobject组成的链表</span></span><br><span class="line">        <span class="type">spinlock_t</span> list_lock;                         <span class="comment">//避免操作链表时产生竞态的自旋锁</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">kobject</span> <span class="title">kobj</span>;</span>                          <span class="comment">//该kset自己的kobject（kset是一个特殊的kobject，也会在sysfs中以目录的形式体现）</span></span><br><span class="line">        <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">kset_uevent_ops</span> *<span class="title">uevent_ops</span>;</span>    </span><br><span class="line">&#125; __randomize_layout;</span><br></pre></td></tr></table></figure><p>uevent_ops为该kset的uevent操作函数集（函数指针）。当kset的某些kobject对象发生状态变化需要通知用户空间时，调用其中对应的函数来完成。当任一kobject需要上报uevent时，都要调用它所属的kset的uevent_ops，添加环境变量，或者过滤uevent（kset可以决定哪些uevent可以上报）。因此一个kobject不属于任一kset时，是不允许发生uevent的。</p><h2 id="1-3-kobj-type结构体"><a href="#1-3-kobj-type结构体" class="headerlink" title="1.3 kobj_type结构体"></a>1.3 kobj_type结构体</h2><p>目录下属性文件的操作接口。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">kobj_type</span> &#123;</span></span><br><span class="line">        <span class="comment">/* 销毁kobject对象时调用 */</span></span><br><span class="line">        <span class="type">void</span> (*release)(<span class="keyword">struct</span> kobject *kobj);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 该类型的kobject的sysfs虚拟文件系统操作接口（读属性接口show和写属性接口store） */</span></span><br><span class="line">        <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">sysfs_ops</span> *<span class="title">sysfs_ops</span>;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* 该类型的kobject的attribute表（sysfs的一个文件）。将会在kobject添加到内核时，一并注册到sysfs中 */</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">attribute</span> **<span class="title">default_attrs</span>;</span></span><br><span class="line">        </span><br><span class="line">        <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">kobj_ns_type_operations</span> *(*<span class="title">child_ns_type</span>)(<span class="keyword">struct</span> <span class="title">kobject</span> *<span class="title">kobj</span>);</span></span><br><span class="line">        <span class="type">const</span> <span class="type">void</span> *(*namespace)(<span class="keyword">struct</span> kobject *kobj);</span><br><span class="line">        <span class="type">void</span> (*get_ownership)(<span class="keyword">struct</span> kobject *kobj, <span class="type">kuid_t</span> *uid, <span class="type">kgid_t</span> *gid);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="1-4-kobject机制的理解"><a href="#1-4-kobject机制的理解" class="headerlink" title="1.4 kobject机制的理解"></a>1.4 kobject机制的理解</h2><p>kobject的核心功能是：保持一个引用计数，当该引用计数减为0时，自动释放kobject所占的内存空间（这决定了kobject必须是动态分配）。kobject的常见使用场景：内嵌在大型的数据结构中（如kset、device_driver等），因此这些大型的数据结构也必须是动态分配、动态释放。ktype的release回调函数负责释放kobject的内存空间。</p><ol><li>通过parent指针，可以将所有kobject以层次结构的形式组合起来。</li><li>使用一个引用计数，来记录kobject被引用的次数，并在引用计数为0时释放kobject对象（这是kobject诞生时的唯一功能）。</li><li>和sysfs虚拟文件系统配合，将每一个kobject及其特性以文件形式显示到用户空间。</li><li>在Linux中，kobject几乎不会单独存在。它的主要功能就是内嵌在一个大型的数据结构中，为这个数据结构提供一些底层的功能实现。</li><li>Linux驱动开发者很少会直接使用kobject以及它提供的接口，而是使用构建在kobject之上的设备模型接口。</li></ol><h1 id="二、kobject流程分析"><a href="#二、kobject流程分析" class="headerlink" title="二、kobject流程分析"></a>二、kobject流程分析</h1><h2 id="2-1-kobject使用流程"><a href="#2-1-kobject使用流程" class="headerlink" title="2.1 kobject使用流程"></a>2.1 kobject使用流程</h2><p>kobject大多数情况下（有一例外）会嵌在其它数据结构中使用，使用流程如下：</p><ol><li>定义一个struct kset类型的指针，并在初始化时为它分配空间，添加到内核中。</li><li>根据实际情况，定义内嵌有kobject的自己所需的数据结构原型。</li><li>定义一个适合自己的ktype，并实现其中回调函数release。</li><li>在需要使用到包含kobject的数据结构时，动态分配该数据结构，并分配kobject空间，添加到内核中。</li><li>每一次引用数据结构时，调用kobject_get接口增加引用计数；引用结束时，调用kobject_put接口，减少引用次数。</li><li>当引用计数为0时，kobject模块会自动调用ktype所提供的release接口，释放上层数据结构以及kobject的内存空间。</li></ol><p>　　<strong>例外：</strong>开发者只需在sysfs中创建一个目录，而不需要其它的kset、ktype的操作。这是可以直接调用kobject_create_and_add接口，分配一个kobject结构并把它添加到内核中。（以他为例分析）</p><h2 id="2-2-kobject-create-and-add"><a href="#2-2-kobject-create-and-add" class="headerlink" title="2.2 kobject_create_and_add"></a>2.2 kobject_create_and_add</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * kobject_create_and_add - 动态创建一个struct kobject并将其注册到sysfs</span></span><br><span class="line"><span class="comment"> * @name: 对象的名称</span></span><br><span class="line"><span class="comment"> * @parent: 这个kobject的父kobject(如果有的话)。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">struct</span> kobject *<span class="title function_">kobject_create_and_add</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *name, <span class="keyword">struct</span> kobject *parent)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">kobject</span> *<span class="title">kobj</span>;</span></span><br><span class="line">        <span class="type">int</span> retval;</span><br><span class="line">        <span class="comment">//创建并初始化一个kobject对象  </span></span><br><span class="line">        kobj = kobject_create();          </span><br><span class="line">        <span class="keyword">if</span> (!kobj)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        <span class="comment">//sysfs创建一个目录项并与kobject对象关联</span></span><br><span class="line">        retval = kobject_add(kobj, parent, <span class="string">&quot;%s&quot;</span>, name);    </span><br><span class="line">        <span class="keyword">if</span> (retval) &#123;</span><br><span class="line">                pr_warn(<span class="string">&quot;%s: kobject_add error: %d\n&quot;</span>, __func__, retval);</span><br><span class="line">                kobject_put(kobj);</span><br><span class="line">                kobj = <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> kobj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>kobject_create_and_add()函数是kobject_create函数和kobject_add函数的组合。整体功能是创建一个名字为“name”的kobject对象，并将其添加到指定的父kobject对象下。其流程如下：</p><p><img src="kobject_create_add_add1.png" alt="kobject_create_add_add1"></p><p><img src="kobject_create_add_add2.png" alt="kobject_create_add_add2"></p><p><img src="kobject_create_add_add3.png" alt="kobject_create_add_add3"></p><p><img src="kobject_create_add_add4.png" alt="kobject_create_add_add4"></p><p><img src="kobject_create_add_add5.png" alt="kobject_create_add_add5"></p><h2 id="2-3-sysfs-create-group"><a href="#2-3-sysfs-create-group" class="headerlink" title="2.3 sysfs_create_group"></a>2.3 sysfs_create_group</h2><p>上一节分析到：</p><p>kobject_create() → kobject_init(kobj, &amp;dymic_kobj_ktype) → dymic_kobj_ktype.sysfs_ops &#x3D; &amp;kobj_sysfs_ops。</p><p>kobj_sysfs_ops中存放着统一的操作接口show和store。调用统一的操作接口时，会在内部进一步调用具体的操作接口。</p><p>sysfs_create_group会在&#x2F;sys下创建相关的attribute文件，并让其与具体的操作接口关联起来。</p><p><img src="sysfs_create_group1.png" alt="sysfs_create_group1"></p><p><img src="sysfs_create_group2.png" alt="sysfs_create_group2"></p><p><img src="sysfs_create_group3.png" alt="sysfs_create_group3"></p><h1 id="三、kobject点灯测试"><a href="#三、kobject点灯测试" class="headerlink" title="三、kobject点灯测试"></a>三、kobject点灯测试</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kobject.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/sysfs.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/fs.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/uaccess.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;asm/io.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/* GPIO虚拟地址映射 */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __iomem *IMX6U_CCM_CCGR1;</span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __iomem *SW_MUX_GPIO1_IO04;</span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __iomem *SW_PAD_GPIO1_IO04;</span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __iomem *GPIO1_GDIR;</span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __iomem *GPIO1_DR;</span><br><span class="line"> </span><br><span class="line"><span class="type">static</span> <span class="type">int</span> foo;</span><br><span class="line"><span class="type">static</span> <span class="type">ssize_t</span> <span class="title function_">foo_show</span><span class="params">(<span class="keyword">struct</span> kobject *kobj, <span class="keyword">struct</span> kobj_attribute *attr, <span class="type">char</span> *buf)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="comment">/* buf 将会被自动拷贝到用户空间 */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sprintf</span>(buf, <span class="string">&quot;%d\n&quot;</span>, foo);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">static</span> <span class="type">ssize_t</span> <span class="title function_">foo_store</span><span class="params">(<span class="keyword">struct</span> kobject *kobj, <span class="keyword">struct</span> kobj_attribute *attr, <span class="type">const</span> <span class="type">char</span> *buf, <span class="type">size_t</span> count)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="comment">/* buf内容来自用户空间，由内核自动完成了。kstrtoint 是将子串buf以十进制的格式输出到foo */</span></span><br><span class="line">        <span class="type">int</span> ret = kstrtoint(buf, <span class="number">10</span>, &amp;foo);</span><br><span class="line">        <span class="keyword">if</span>(ret &lt; <span class="number">0</span>)     <span class="keyword">return</span> ret;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">static</span> <span class="type">ssize_t</span> <span class="title function_">led_show</span><span class="params">(<span class="keyword">struct</span> kobject *kobj, <span class="keyword">struct</span> kobj_attribute *attr, <span class="type">char</span> *buf)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="type">int</span> var;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">strcmp</span>(attr-&gt;attr.name, <span class="string">&quot;led&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">                var = <span class="number">123</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sprintf</span>(buf, <span class="string">&quot;%d\n&quot;</span>, var);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">static</span> <span class="type">ssize_t</span> <span class="title function_">led_store</span><span class="params">(<span class="keyword">struct</span> kobject *kobj, <span class="keyword">struct</span> kobj_attribute *attr, <span class="type">const</span> <span class="type">char</span> *buf, <span class="type">size_t</span> count)</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">strcmp</span>(attr-&gt;attr.name, <span class="string">&quot;led&quot;</span>) == <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(!<span class="built_in">memcmp</span>(buf, <span class="string">&quot;on&quot;</span>, <span class="number">2</span>))&#123;</span><br><span class="line">                        iowrite32(<span class="number">0</span>&lt;&lt;<span class="number">4</span>, GPIO1_DR);</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(!<span class="built_in">memcmp</span>(buf, <span class="string">&quot;off&quot;</span>, <span class="number">3</span>))&#123;</span><br><span class="line">                        iowrite32(<span class="number">1</span>&lt;&lt;<span class="number">4</span>, GPIO1_DR);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* __ATTR 定义在 include/linux/sysfs.h。foo 对应属性文件名。</span></span><br><span class="line"><span class="comment"> * show成员 和 store成员 最终分别会被 kobject-&gt;ktype 下的 kobj_sys_ops 下的 kobj_attr_show 和 kobj_attr_store 调用。</span></span><br><span class="line"><span class="comment"> #define __ATTR(_name, _mode, _show, _store) &#123;                          \</span></span><br><span class="line"><span class="comment">        .attr = &#123;.name = __stringify(_name),                            \</span></span><br><span class="line"><span class="comment">                 .mode = VERIFY_OCTAL_PERMISSIONS(_mode) &#125;,             \</span></span><br><span class="line"><span class="comment">        .show   = _show,                                                \</span></span><br><span class="line"><span class="comment">        .store  = _store,                                               \</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">kobj_attribute</span> <span class="title">foo_attribute</span> =</span> __ATTR(foo, <span class="number">0664</span>, foo_show, foo_store);</span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">kobj_attribute</span> <span class="title">led_attribute</span> =</span> __ATTR(led, <span class="number">0664</span>, led_show, led_store);</span><br><span class="line"> </span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">attribute</span> *<span class="title">attrs</span>[] =</span> &#123;</span><br><span class="line">        &amp;foo_attribute.attr,</span><br><span class="line">        &amp;led_attribute.attr,</span><br><span class="line">        <span class="literal">NULL</span>, <span class="comment">/* need to NULL terminate the list of attributes */</span></span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">attribute_group</span> <span class="title">attr_group</span> =</span> &#123;</span><br><span class="line">        .attrs = attrs,</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">kobject</span> *<span class="title">led_kobj</span>;</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">led_init</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">        <span class="type">int</span> retval;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">/* GPIO相关寄存器操作 */</span></span><br><span class="line">        IMX6U_CCM_CCGR1 = ioremap(<span class="number">0x20c406c</span>, <span class="number">4</span>);</span><br><span class="line">        SW_MUX_GPIO1_IO04 = ioremap(<span class="number">0x20e006c</span>, <span class="number">4</span>);</span><br><span class="line">        SW_PAD_GPIO1_IO04 = ioremap(<span class="number">0x20e02f8</span>, <span class="number">4</span>);</span><br><span class="line">        GPIO1_GDIR = ioremap(<span class="number">0x0209c004</span>, <span class="number">4</span>);</span><br><span class="line">        GPIO1_DR = ioremap(<span class="number">0x0209c000</span>, <span class="number">4</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">/* 使能GPIO1时钟 */</span></span><br><span class="line">        iowrite32(<span class="number">0xffffffff</span>, IMX6U_CCM_CCGR1);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">/* 设置GPIO1_IO04复用为普通GPIO */</span></span><br><span class="line">        iowrite32(<span class="number">5</span>, SW_MUX_GPIO1_IO04);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">/* 设置GPIO属性 */</span></span><br><span class="line">        iowrite32(<span class="number">0x10b0</span>, SW_PAD_GPIO1_IO04);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">/* 设置GPIO1_IO04为输出功能 */</span></span><br><span class="line">        iowrite32(<span class="number">1</span>&lt;&lt;<span class="number">4</span>, GPIO1_GDIR);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">/* LED输出高电平 */</span></span><br><span class="line">        iowrite32(<span class="number">1</span>&lt;&lt;<span class="number">4</span>, GPIO1_DR);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">/* 创建一个kobject对象，上一层节点设置为 NULL，此kobject对象在 sysfs 下的根目录。</span></span><br><span class="line"><span class="comment">         * 此函数执行完会在 /sys 目录下生成一个名为&quot;led_kobject&quot;的目录。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        led_kobj = kobject_create_and_add(<span class="string">&quot;led_kobject&quot;</span>, <span class="literal">NULL</span>);</span><br><span class="line">        <span class="keyword">if</span>(!led_kobj)   <span class="keyword">return</span> -ENOMEM;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">/* 为kobject设置属性文件，并且将属性文件和操作接口绑定起来 */</span></span><br><span class="line">        retval = sysfs_create_group(led_kobj, &amp;attr_group);</span><br><span class="line">        <span class="keyword">if</span>(retval)</span><br><span class="line">                kobject_put(led_kobj);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __exit <span class="title function_">led_exit</span><span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">        <span class="comment">/* 取消映射 */</span></span><br><span class="line">        iounmap(IMX6U_CCM_CCGR1);</span><br><span class="line">        iounmap(SW_MUX_GPIO1_IO04);</span><br><span class="line">        iounmap(SW_PAD_GPIO1_IO04);</span><br><span class="line">        iounmap(GPIO1_GDIR);</span><br><span class="line">        iounmap(GPIO1_DR);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">/* 注销字符设备驱动 */</span></span><br><span class="line">        kobject_put(led_kobj);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">module_init(led_init);</span><br><span class="line">module_exit(led_exit);</span><br><span class="line"> </span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br><span class="line">MODULE_AUTHOR(<span class="string">&quot;couvrir&quot;</span>);</span><br><span class="line">MODULE_DESCRIPTION(<span class="string">&quot;led module&quot;</span>);</span><br><span class="line">MODULE_ALIAS(<span class="string">&quot;led module&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>测试流程：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">insmod kobject_led.ko</span><br><span class="line"></span><br><span class="line">查看/sys/文件夹，存在led_kobject的目录项。 </span><br><span class="line"></span><br><span class="line">查看/sys/led_kobject的属性文件。</span><br><span class="line"></span><br><span class="line">然后就是echo和cat命令的使用。</span><br><span class="line"></span><br><span class="line">rmmod kobject_led</span><br></pre></td></tr></table></figure><p><img src="test.png" alt="test"></p>]]></content>
      
      
      <categories>
          
          <category> Linux驱动 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux驱动 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>i2c驱动分析</title>
      <link href="/2024/04/28/i2c%E9%A9%B1%E5%8A%A8%E5%88%86%E6%9E%90/"/>
      <url>/2024/04/28/i2c%E9%A9%B1%E5%8A%A8%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="一、-早期版本框架"><a href="#一、-早期版本框架" class="headerlink" title="一、 早期版本框架"></a>一、 早期版本框架</h1><h2 id="1-attach-adapter方法"><a href="#1-attach-adapter方法" class="headerlink" title="1. attach_adapter方法"></a>1. attach_adapter方法</h2><p><code>attach_adapter</code>方法是早期的一种方式，这种方法通常适用于i2c 设备驱动程序不知道其设备将会连接到哪个I2C adapter的情况下。</p><p><img src="attach_adapter%E6%96%B9%E6%B3%95.png" alt="attach_adapter方法"></p><h3 id="attach-adapter例程"><a href="#attach-adapter例程" class="headerlink" title="attach_adapter例程"></a>attach_adapter例程</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/slab.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/jiffies.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/i2c.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/mutex.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/fs.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;asm/uaccess.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">short</span> ignore[]      = &#123; I2C_CLIENT_END &#125;;</span><br><span class="line"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">short</span> normal_addr[] = &#123; <span class="number">0x50</span>, I2C_CLIENT_END &#125;; </span><br><span class="line"><span class="comment">/* 改为0x60的话, 由于不存在设备地址为0x60的设备, 所以at24cxx_detect不被调用 */</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">short</span> force_addr[] = &#123;ANY_I2C_BUS, <span class="number">0x60</span>, I2C_CLIENT_END&#125;;</span><br><span class="line"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">short</span> * forces[] = &#123;force_addr, <span class="literal">NULL</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">i2c_client_address_data</span> <span class="title">addr_data</span> =</span> &#123;</span><br><span class="line">.normal_i2c= normal_addr,  <span class="comment">/* 要发出S信号和设备地址并得到ACK信号,才能确定存在这个设备 */</span></span><br><span class="line">.probe= ignore,</span><br><span class="line">.ignore= ignore,</span><br><span class="line"><span class="comment">//.forces     = forces, /* 强制认为存在这个设备 */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> major;</span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="keyword">class</span> *<span class="title">cls</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">i2c_client</span> *<span class="title">at24cxx_client</span>;</span></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">i2c_driver</span> <span class="title">at24cxx_driver</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">ssize_t</span> <span class="title function_">at24cxx_read</span><span class="params">(<span class="keyword">struct</span> file *file, <span class="type">char</span> __user *buf, <span class="type">size_t</span> size, <span class="type">loff_t</span> * offset)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> address;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> data;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">i2c_msg</span> <span class="title">msg</span>[2];</span></span><br><span class="line"><span class="type">int</span> ret;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* address = buf[0] </span></span><br><span class="line"><span class="comment"> * data    = buf[1]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">if</span> (size != <span class="number">1</span>)</span><br><span class="line"><span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">copy_from_user(&amp;address, buf, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 数据传输三要素: 源,目的,长度 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 读AT24CXX时,要先把要读的存储空间的地址发给它 */</span></span><br><span class="line">msg[<span class="number">0</span>].addr  = at24cxx_client-&gt;addr;  <span class="comment">/* 目的 */</span></span><br><span class="line">msg[<span class="number">0</span>].buf   = &amp;address;              <span class="comment">/* 源 */</span></span><br><span class="line">msg[<span class="number">0</span>].len   = <span class="number">1</span>;                     <span class="comment">/* 地址=1 byte */</span></span><br><span class="line">msg[<span class="number">0</span>].flags = <span class="number">0</span>;                     <span class="comment">/* 表示写 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 然后启动读操作 */</span></span><br><span class="line">msg[<span class="number">1</span>].addr  = at24cxx_client-&gt;addr;  <span class="comment">/* 源 */</span></span><br><span class="line">msg[<span class="number">1</span>].buf   = &amp;data;                 <span class="comment">/* 目的 */</span></span><br><span class="line">msg[<span class="number">1</span>].len   = <span class="number">1</span>;                     <span class="comment">/* 数据=1 byte */</span></span><br><span class="line">msg[<span class="number">1</span>].flags = I2C_M_RD;                     <span class="comment">/* 表示读 */</span></span><br><span class="line"></span><br><span class="line">ret = i2c_transfer(at24cxx_client-&gt;adapter, msg, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">if</span> (ret == <span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line">copy_to_user(buf, &amp;data, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">return</span> -EIO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">ssize_t</span> <span class="title function_">at24cxx_write</span><span class="params">(<span class="keyword">struct</span> file *file, <span class="type">const</span> <span class="type">char</span> __user *buf, <span class="type">size_t</span> size, <span class="type">loff_t</span> *offset)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> val[<span class="number">2</span>];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">i2c_msg</span> <span class="title">msg</span>[1];</span></span><br><span class="line"><span class="type">int</span> ret;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* address = buf[0] </span></span><br><span class="line"><span class="comment"> * data    = buf[1]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">if</span> (size != <span class="number">2</span>)</span><br><span class="line"><span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">copy_from_user(val, buf, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 数据传输三要素: 源,目的,长度 */</span></span><br><span class="line">msg[<span class="number">0</span>].addr  = at24cxx_client-&gt;addr;  <span class="comment">/* 目的 */</span></span><br><span class="line">msg[<span class="number">0</span>].buf   = val;                   <span class="comment">/* 源 */</span></span><br><span class="line">msg[<span class="number">0</span>].len   = <span class="number">2</span>;                     <span class="comment">/* 地址+数据=2 byte */</span></span><br><span class="line">msg[<span class="number">0</span>].flags = <span class="number">0</span>;                     <span class="comment">/* 表示写 */</span></span><br><span class="line"></span><br><span class="line">ret = i2c_transfer(at24cxx_client-&gt;adapter, msg, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span> (ret == <span class="number">1</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">return</span> -EIO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">file_operations</span> <span class="title">at24cxx_fops</span> =</span> &#123;</span><br><span class="line">.owner = THIS_MODULE,</span><br><span class="line">.read  = at24cxx_read,</span><br><span class="line">.write = at24cxx_write,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">at24cxx_detect</span><span class="params">(<span class="keyword">struct</span> i2c_adapter *adapter, <span class="type">int</span> address, <span class="type">int</span> kind)</span></span><br><span class="line">&#123;</span><br><span class="line">printk(<span class="string">&quot;at24cxx_detect\n&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 构构一个i2c_client结构体: 以后收改数据时会用到它 */</span></span><br><span class="line">at24cxx_client = kzalloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> i2c_client), GFP_KERNEL);</span><br><span class="line">at24cxx_client-&gt;addr    = address;</span><br><span class="line">at24cxx_client-&gt;adapter = adapter;</span><br><span class="line">at24cxx_client-&gt;driver  = &amp;at24cxx_driver;</span><br><span class="line"><span class="built_in">strcpy</span>(at24cxx_client-&gt;name, <span class="string">&quot;at24cxx&quot;</span>);</span><br><span class="line">i2c_attach_client(at24cxx_client);</span><br><span class="line"></span><br><span class="line">major = register_chrdev(<span class="number">0</span>, <span class="string">&quot;at24cxx&quot;</span>, &amp;at24cxx_fops);</span><br><span class="line"></span><br><span class="line">cls = class_create(THIS_MODULE, <span class="string">&quot;at24cxx&quot;</span>);</span><br><span class="line">class_device_create(cls, <span class="literal">NULL</span>, MKDEV(major, <span class="number">0</span>), <span class="literal">NULL</span>, <span class="string">&quot;at24cxx&quot;</span>); <span class="comment">/* /dev/at24cxx */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">at24cxx_attach</span><span class="params">(<span class="keyword">struct</span> i2c_adapter *adapter)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> i2c_probe(adapter, &amp;addr_data, at24cxx_detect);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">at24cxx_detach</span><span class="params">(<span class="keyword">struct</span> i2c_client *client)</span></span><br><span class="line">&#123;</span><br><span class="line">printk(<span class="string">&quot;at24cxx_detach\n&quot;</span>);</span><br><span class="line">class_device_destroy(cls, MKDEV(major, <span class="number">0</span>));</span><br><span class="line">class_destroy(cls);</span><br><span class="line">unregister_chrdev(major, <span class="string">&quot;at24cxx&quot;</span>);</span><br><span class="line"></span><br><span class="line">i2c_detach_client(client);</span><br><span class="line">kfree(i2c_get_clientdata(client));</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 1. 分配一个i2c_driver结构体 */</span></span><br><span class="line"><span class="comment">/* 2. 设置i2c_driver结构体 */</span></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">i2c_driver</span> <span class="title">at24cxx_driver</span> =</span> &#123;</span><br><span class="line">.driver = &#123;</span><br><span class="line">.name= <span class="string">&quot;at24cxx&quot;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">.attach_adapter = at24cxx_attach,</span><br><span class="line">.detach_client  = at24cxx_detach,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">at24cxx_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">i2c_add_driver(&amp;at24cxx_driver);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">at24cxx_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">i2c_del_driver(&amp;at24cxx_driver);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(at24cxx_init);</span><br><span class="line">module_exit(at24cxx_exit);</span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="Test代码"><a href="#Test代码" class="headerlink" title="Test代码"></a>Test代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* i2c_test r addr</span></span><br><span class="line"><span class="comment"> * i2c_test w addr val</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">print_usage</span><span class="params">(<span class="type">char</span> *file)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s r addr\n&quot;</span>, file);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s w addr val\n&quot;</span>, file);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> fd;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> buf[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ((argc != <span class="number">3</span>) &amp;&amp; (argc != <span class="number">4</span>))</span><br><span class="line">&#123;</span><br><span class="line">print_usage(argv[<span class="number">0</span>]);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fd = open(<span class="string">&quot;/dev/at24cxx&quot;</span>, O_RDWR);</span><br><span class="line"><span class="keyword">if</span> (fd &lt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;can&#x27;t open /dev/at24cxx\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;r&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">buf[<span class="number">0</span>] = strtoul(argv[<span class="number">2</span>], <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">read(fd, buf, <span class="number">1</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;data: %c, %d, 0x%2x\n&quot;</span>, buf[<span class="number">0</span>], buf[<span class="number">0</span>], buf[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;w&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">buf[<span class="number">0</span>] = strtoul(argv[<span class="number">2</span>], <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">buf[<span class="number">1</span>] = strtoul(argv[<span class="number">3</span>], <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">write(fd, buf, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">print_usage(argv[<span class="number">0</span>]);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-i2c-new-device方法"><a href="#2-i2c-new-device方法" class="headerlink" title="2.  i2c_new_device方法"></a>2.  i2c_new_device方法</h2><p>对于已经知道i2c设备挂接于哪个i2c adapter时，可以直接使用i2c_new_device接口注册i2c client设备。实际上注册i2c client设备最后会注册一个i2c_bus_type类型的device ，注册i2c_driver最后会注册一个i2c_bus_type类型的driver。</p><p>与platform总线类似，一旦有device或driver注册到i2c_bus_type上，便会调用i2c_bus_type的match函数尝试匹配，若匹配则执行i2c_driver的probe函数。不同版本的内核的匹配机制都大同小异，这里以2.6内核，注册i2c_client做分析：</p><p><img src="i2c_new_device%E6%96%B9%E6%B3%951.png" alt="i2c_new_device方法1"></p><p><img src="i2c_new_device%E6%96%B9%E6%B3%952.png" alt="i2c_new_device方法2"></p><h3 id="device代码"><a href="#device代码" class="headerlink" title="device代码"></a>device代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/platform_device.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/i2c.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/err.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/regmap.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/slab.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">i2c_board_info</span> <span class="title">at24cxx_info</span> =</span> &#123;</span><br><span class="line">I2C_BOARD_INFO(<span class="string">&quot;at24c08&quot;</span>, <span class="number">0x50</span>),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">i2c_client</span> *<span class="title">at24cxx_client</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">at24cxx_dev_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">i2c_adapter</span> *<span class="title">i2c_adap</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 已经知道当前i2c设备挂接于i2c adapter 0 */</span></span><br><span class="line">i2c_adap = i2c_get_adapter(<span class="number">0</span>);</span><br><span class="line">at24cxx_client = i2c_new_device(i2c_adap, &amp;at24cxx_info);</span><br><span class="line">i2c_put_adapter(i2c_adap);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">at24cxx_dev_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">i2c_unregister_device(at24cxx_client);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(at24cxx_dev_init);</span><br><span class="line">module_exit(at24cxx_dev_exit);</span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="driver代码"><a href="#driver代码" class="headerlink" title="driver代码"></a>driver代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/platform_device.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/i2c.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/err.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/regmap.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/slab.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/fs.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;asm/uaccess.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> major;</span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="keyword">class</span> *<span class="keyword">class</span>;</span></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">i2c_client</span> *<span class="title">at24cxx_client</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 传入: buf[0] : addr</span></span><br><span class="line"><span class="comment"> * 输出: buf[0] : data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">ssize_t</span> <span class="title function_">at24cxx_read</span><span class="params">(<span class="keyword">struct</span> file * file, <span class="type">char</span> __user *buf, <span class="type">size_t</span> count, <span class="type">loff_t</span> *off)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> addr, data;</span><br><span class="line"></span><br><span class="line">copy_from_user(&amp;addr, buf, <span class="number">1</span>);</span><br><span class="line">data = i2c_smbus_read_byte_data(at24cxx_client, addr);</span><br><span class="line">copy_to_user(buf, &amp;data, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* buf[0] : addr</span></span><br><span class="line"><span class="comment"> * buf[1] : data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">ssize_t</span> <span class="title function_">at24cxx_write</span><span class="params">(<span class="keyword">struct</span> file *file, <span class="type">const</span> <span class="type">char</span> __user *buf, <span class="type">size_t</span> count, <span class="type">loff_t</span> *off)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> ker_buf[<span class="number">2</span>];</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> addr, data;</span><br><span class="line"></span><br><span class="line">copy_from_user(ker_buf, buf, <span class="number">2</span>);</span><br><span class="line">addr = ker_buf[<span class="number">0</span>];</span><br><span class="line">data = ker_buf[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">printk(<span class="string">&quot;addr = 0x%02x, data = 0x%02x\n&quot;</span>, addr, data);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!i2c_smbus_write_byte_data(at24cxx_client, addr, data))</span><br><span class="line"><span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">return</span> -EIO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">file_operations</span> <span class="title">at24cxx_fops</span> =</span> &#123;</span><br><span class="line">.owner = THIS_MODULE,</span><br><span class="line">.read  = at24cxx_read,</span><br><span class="line">.write = at24cxx_write,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __devinit <span class="title function_">at24cxx_probe</span><span class="params">(<span class="keyword">struct</span> i2c_client *client,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> <span class="keyword">struct</span> i2c_device_id *id)</span></span><br><span class="line">&#123;</span><br><span class="line">at24cxx_client = client;</span><br><span class="line"></span><br><span class="line">major = register_chrdev(<span class="number">0</span>, <span class="string">&quot;at24cxx&quot;</span>, &amp;at24cxx_fops);</span><br><span class="line"><span class="class"><span class="keyword">class</span> =</span> class_create(THIS_MODULE, <span class="string">&quot;at24cxx&quot;</span>);</span><br><span class="line">device_create(class, <span class="literal">NULL</span>, MKDEV(major, <span class="number">0</span>), <span class="literal">NULL</span>, <span class="string">&quot;at24cxx&quot;</span>); <span class="comment">/* /dev/at24cxx */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __devexit <span class="title function_">at24cxx_remove</span><span class="params">(<span class="keyword">struct</span> i2c_client *client)</span></span><br><span class="line">&#123;</span><br><span class="line">device_destroy(class, MKDEV(major, <span class="number">0</span>));</span><br><span class="line">class_destroy(class);</span><br><span class="line">unregister_chrdev(major, <span class="string">&quot;at24cxx&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">i2c_device_id</span> <span class="title">at24cxx_id_table</span>[] =</span> &#123;</span><br><span class="line">&#123; <span class="string">&quot;at24c08&quot;</span>, <span class="number">0</span> &#125;,</span><br><span class="line">&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 1. 分配/设置i2c_driver */</span></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">i2c_driver</span> <span class="title">at24cxx_driver</span> =</span> &#123;</span><br><span class="line">.driver= &#123;</span><br><span class="line">.name= <span class="string">&quot;100ask&quot;</span>,</span><br><span class="line">.owner= THIS_MODULE,</span><br><span class="line">&#125;,</span><br><span class="line">.probe= at24cxx_probe,</span><br><span class="line">.remove= __devexit_p(at24cxx_remove),</span><br><span class="line">.id_table= at24cxx_id_table,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">at24cxx_drv_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* 2. 注册i2c_driver */</span></span><br><span class="line">i2c_add_driver(&amp;at24cxx_driver);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">at24cxx_drv_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">i2c_del_driver(&amp;at24cxx_driver);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(at24cxx_drv_init);</span><br><span class="line">module_exit(at24cxx_drv_exit);</span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="Test代码-1"><a href="#Test代码-1" class="headerlink" title="Test代码"></a>Test代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* i2c_test r addr</span></span><br><span class="line"><span class="comment"> * i2c_test w addr val</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">print_usage</span><span class="params">(<span class="type">char</span> *file)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s r addr\n&quot;</span>, file);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s w addr val\n&quot;</span>, file);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> fd;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> buf[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ((argc != <span class="number">3</span>) &amp;&amp; (argc != <span class="number">4</span>))</span><br><span class="line">&#123;</span><br><span class="line">print_usage(argv[<span class="number">0</span>]);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fd = open(<span class="string">&quot;/dev/at24cxx&quot;</span>, O_RDWR);</span><br><span class="line"><span class="keyword">if</span> (fd &lt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;can&#x27;t open /dev/at24cxx\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;r&quot;</span>) == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">buf[<span class="number">0</span>] = strtoul(argv[<span class="number">2</span>], <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">read(fd, buf, <span class="number">1</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;data: %c, %d, 0x%2x\n&quot;</span>, buf[<span class="number">0</span>], buf[<span class="number">0</span>], buf[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> ((<span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;w&quot;</span>) == <span class="number">0</span>) &amp;&amp; (argc == <span class="number">4</span>))</span><br><span class="line">&#123;</span><br><span class="line">buf[<span class="number">0</span>] = strtoul(argv[<span class="number">2</span>], <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">buf[<span class="number">1</span>] = strtoul(argv[<span class="number">3</span>], <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (write(fd, buf, <span class="number">2</span>) != <span class="number">2</span>)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;write err, addr = 0x%02x, data = 0x%02x\n&quot;</span>, buf[<span class="number">0</span>], buf[<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">print_usage(argv[<span class="number">0</span>]);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h3><p><strong>Note 1：</strong>i2c_new_device方法与adapter_attach方法不能同时存在，即i2c_driver中不能同时有probe和adapter_attach成员，i2c框架在注册i2c_driver时做了判断：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> is_newstyle_driver(d) ((d)-&gt;probe || (d)-&gt;remove)</span></span><br><span class="line">i2c_add_driver</span><br><span class="line">i2c_register_driver</span><br><span class="line"><span class="comment">/* new style driver methods can&#x27;t mix with legacy ones */</span></span><br><span class="line"><span class="keyword">if</span> (is_newstyle_driver(driver)) &#123;</span><br><span class="line"><span class="keyword">if</span> (driver-&gt;attach_adapter || driver-&gt;detach_adapter || driver-&gt;detach_client) &#123;</span><br><span class="line">printk(KERN_WARNING <span class="string">&quot;i2c-core: driver [%s] is confused\n&quot;</span>, driver-&gt;driver.name);</span><br><span class="line"><span class="keyword">return</span> -EINVAL;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>i2c_bus_type的match函数里也做了判断，确保i2c_driver端注册i2c_bus_type类型的driver时，不会与i2c_bus_type类型的device匹配成功。is_newstyle_driver判断没有probe成员，就返回0，表示没有匹配成功；有probe成员才真正去匹配：</p><p><img src="i2c_device_match.png" alt="i2c_device_match"></p><p>通过注释，如果是旧式驱动（legacy driver）也就是adapter_attach方法，它会自行扫描每个I2C适配器&#x2F;总线，而不是使用内核的驱动模型probe探测机制。</p><p><strong>Note 2：i2c_new_probed_device</strong></p><p>i2c_new_device方法不会判断I2C_BOARD_INFO(“at24c08”, 0x50)中指定的地址是不是真的存在设备，他只管利用给他的I2C_BOARD_INFO信息去注册i2c_client，最后会注册一个i2c_bus_type类型的device。</p><p>要注意，I2C_BOARD_INFO中的字符串”at24c08”要和i2c_driver中的id_table数组匹配，因为i2c_driver最后会注册一个i2c_bus_type类型的driver，他们之间是利用这个字符串来匹配，才会执行i2c_driver的probe函数。</p><p>若要在地址真实存在设备时才注册i2c_client，使用：i2c_new_probed_device。它会在创建i2c_client设备前调用adapter的传输函数对指定的地址进行探测，看是否能收到该地址的ACK回应信号，以验证设备是否真实存在于总线上。</p><p>只需更改device侧代码如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/platform_device.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/i2c.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/err.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/regmap.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/slab.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">i2c_client</span> *<span class="title">at24cxx_client</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">short</span> addr_list[] = &#123; <span class="number">0x60</span>, <span class="number">0x50</span>, I2C_CLIENT_END &#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">at24cxx_dev_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">i2c_adapter</span> *<span class="title">i2c_adap</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">i2c_board_info</span> <span class="title">at24cxx_info</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">memset</span>(&amp;at24cxx_info, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> i2c_board_info));</span><br><span class="line">strlcpy(at24cxx_info.type, <span class="string">&quot;at24c08&quot;</span>, I2C_NAME_SIZE);</span><br><span class="line"></span><br><span class="line">i2c_adap = i2c_get_adapter(<span class="number">0</span>);</span><br><span class="line">at24cxx_client = i2c_new_probed_device(i2c_adap, &amp;at24cxx_info, addr_list, <span class="literal">NULL</span>);</span><br><span class="line">i2c_put_adapter(i2c_adap);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (at24cxx_client)</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">return</span> -ENODEV;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">at24cxx_dev_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">i2c_unregister_device(at24cxx_client);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(at24cxx_dev_init);</span><br><span class="line">module_exit(at24cxx_dev_exit);</span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>Note 3：i2c_new_device与i2c_attach_client关系</strong></p><p>i2c_new_device需要依据i2c_board_info的信息先分配、设置i2c_client，再调用i2c_attach_client注册i2c_client，最终注册一个i2c_bus_type类型的device。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> i2c_client *<span class="title function_">i2c_new_device</span><span class="params">(<span class="keyword">struct</span> i2c_adapter *adap, <span class="keyword">struct</span> i2c_board_info <span class="type">const</span> *info)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">i2c_client</span>*<span class="title">client</span>;</span></span><br><span class="line"></span><br><span class="line">client = kzalloc(<span class="keyword">sizeof</span> *client, GFP_KERNEL);</span><br><span class="line">client-&gt;adapter = adap;</span><br><span class="line">client-&gt;dev.platform_data = info-&gt;platform_data;</span><br><span class="line">client-&gt;addr = info-&gt;addr;</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">strlcpy(client-&gt;driver_name, info-&gt;driver_name,<span class="keyword">sizeof</span>(client-&gt;driver_name));</span><br><span class="line"></span><br><span class="line">i2c_attach_client(client);</span><br><span class="line"><span class="comment">/* 这里相当于注册i2c_client */</span></span><br><span class="line">list_add_tail(&amp;client-&gt;<span class="built_in">list</span>,&amp;adapter-&gt;clients);</span><br><span class="line"><span class="comment">/* 注册i2c_bus_type类型的device */</span></span><br><span class="line">client-&gt;dev.bus = &amp;i2c_bus_type;</span><br><span class="line">device_register(&amp;client-&gt;dev);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> client;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="二、近期版本框架"><a href="#二、近期版本框架" class="headerlink" title="二、近期版本框架"></a>二、近期版本框架</h1><h2 id="1-detect方法"><a href="#1-detect方法" class="headerlink" title="1. detect方法"></a>1. detect方法</h2><p>随着linux内核版本的更新，早期的attach_adapter方法已经不推荐了，新增了一个detect方法，我理解成是attach_adapter方法的增强版。也是适用于i2c 设备驱动程序不知道其设备将会连接到哪个I2C adapter的情况下。以4.14内核为例分析。</p><p>怎么理解增强呢？在attach_adapter方法中，i2c_driver中不能同时有probe和adapter_attach成员，所以在它的回调函数中需要做很多事情，比如：</p><p>① 虽然adapter收到了指定地址返回的ACK信号，但是这只是确定了有i2c设备挂接在这个adapter控制器上，但i2c设备的地址可能相同，是at24c02还是iic oled呢？所以在回调函数里需要读取一下i2c设备信息，分辨是哪款i2c设备。</p><p>②  attach_adapter方法收到了指定地址返回的ACK信号后，不会帮我们调用i2c_new_device，即分配、设置、注册i2c_client，所以需要在回调函数中完成。</p><p>③ 我们可能还需要在回调函数中注册字符设备驱动、input输入设备。</p><h3 id="流程分析"><a href="#流程分析" class="headerlink" title="流程分析"></a>流程分析</h3><p>detect方法的整体流程和早期版本的attach_adapter方法类似，不管是注册一个i2c_adapter还是注册一个i2c_driver，最终都会调用到i2c_detect(adap, driver);</p><p>① 注册i2c_adapter时，取出存放i2c_driver的链表调用i2c_detect(adap, driver);</p><p>② 注册i2c_driver时，取出存放i2c_adapter的链表调用i2c_detect(adap, driver);</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 注册i2c_adapter */</span></span><br><span class="line">i2c_add_adapter(adap);</span><br><span class="line">__i2c_add_numbered_adapter(adapter);</span><br><span class="line">i2c_register_adapter(adap);</span><br><span class="line"><span class="comment">/* Notify drivers */</span></span><br><span class="line">bus_for_each_drv(&amp;i2c_bus_type, <span class="literal">NULL</span>, adap, __process_new_adapter);</span><br><span class="line">__process_new_adapter</span><br><span class="line"><span class="title function_">i2c_do_add_adapter</span><span class="params">(to_i2c_driver(d), data)</span>;</span><br><span class="line">i2c_detect(adap, driver);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 注册i2c_driver */</span></span><br><span class="line">i2c_add_driver(driver)</span><br><span class="line">i2c_register_driver(THIS_MODULE, driver)</span><br><span class="line"><span class="comment">/* Walk the adapters that are already present */</span></span><br><span class="line">i2c_for_each_dev(driver, __process_new_driver);</span><br><span class="line">__process_new_driver</span><br><span class="line"><span class="title function_">i2c_do_add_adapter</span><span class="params">(data, to_i2c_adapter(dev))</span>;</span><br><span class="line">i2c_detect(adap, driver);</span><br></pre></td></tr></table></figure><p>分析i2c_detect：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Detect supported devices on that bus, and instantiate them */</span></span><br><span class="line">i2c_detect(<span class="keyword">struct</span> i2c_adapter *adapter, <span class="keyword">struct</span> i2c_driver *driver)</span><br><span class="line"><span class="comment">/* 取出i2c_driver中的设备地址数组 */</span></span><br><span class="line">address_list = driver-&gt;address_list;</span><br><span class="line"><span class="comment">/* 判断是否使用detect方法，如果i2c_driver没有设置对应成员就是不使用 */</span></span><br><span class="line"><span class="keyword">if</span> (!driver-&gt;detect || !address_list)</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; address_list[i] != I2C_CLIENT_END; i += <span class="number">1</span>)</span><br><span class="line">temp_client-&gt;addr = address_list[i];</span><br><span class="line">temp_client-&gt;adapter = adapter;</span><br><span class="line"><span class="comment">/* 对每个地址都去访问，看看能否收到ACK回应 */</span></span><br><span class="line">i2c_detect_address(temp_client, driver);</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">i2c_board_info</span> <span class="title">info</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">i2c_adapter</span> *<span class="title">adapter</span> =</span> temp_client-&gt;adapter;</span><br><span class="line"><span class="type">int</span> addr = temp_client-&gt;addr;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 判断这个设备是否存在：简单的发出S信号确定有ACK */</span></span><br><span class="line"><span class="keyword">if</span> (!i2c_default_probe(adapter, addr))</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 调用我们i2c_driver设置的detect函数成员，分辨具体芯片，设置info-&gt;type */</span></span><br><span class="line"><span class="built_in">memset</span>(&amp;info, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> i2c_board_info));</span><br><span class="line">info.addr = addr;</span><br><span class="line"><span class="comment">/* 后面的i2c_new_device需要利用i2c_board_info的信息来设置i2c_client和注册一个i2c_bus_type类型的device</span></span><br><span class="line"><span class="comment"> * 为了让i2c_driver的probe函数被调用，就需要在driver-&gt;detect中设置info-&gt;type与i2c_driver中id_table某项匹配 </span></span><br><span class="line"><span class="comment"> * 4.14版本与上面的2.6版本不同，4.14版本用info-&gt;type代替了2.6版本的info-&gt;driver_name，但其实都大同小异。*/</span></span><br><span class="line">err = driver-&gt;detect(temp_client, &amp;info);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 分配、设置、注册i2c_client，最终会注册一个i2c_bus_type类型的device */</span></span><br><span class="line">client = i2c_new_device(adapter, &amp;info);</span><br></pre></td></tr></table></figure><p>可以看到，i2c_driver中可以同时有detect和probe成员，detect方法在收到了指定地址返回的ACK信号后，会调用我们i2c_driver中设置的detect函数成员。</p><p>同时帮我们调用i2c_new_device来分配、设置、注册i2c_client，最终会注册一个i2c_bus_type类型的device，与i2c_driver注册的i2c_bus_type类型的driver匹配后，调用i2c_driver的probe函数。这样我们就可以将工作分开，避免糅杂在一起：</p><p>① 在i2c_driver中设置的detect函数成员里，分辨是哪款i2c设备。</p><p>② 在i2c_driver中设置的probe函数成员里，注册字符设备驱动、input输入设备。</p><h3 id="detect代码"><a href="#detect代码" class="headerlink" title="detect代码"></a>detect代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/platform_device.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/i2c.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/err.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/regmap.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/slab.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __devinit <span class="title function_">at24cxx_probe</span><span class="params">(<span class="keyword">struct</span> i2c_client *client,</span></span><br><span class="line"><span class="params">  <span class="type">const</span> <span class="keyword">struct</span> i2c_device_id *id)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* 4. 注册字符设备驱动、input输入设备... */</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __devexit <span class="title function_">at24cxx_remove</span><span class="params">(<span class="keyword">struct</span> i2c_client *client)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">i2c_device_id</span> <span class="title">at24cxx_id_table</span>[] =</span> &#123;</span><br><span class="line">&#123; <span class="string">&quot;at24c08&quot;</span>, <span class="number">0</span> &#125;,</span><br><span class="line">&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">at24cxx_detect</span><span class="params">(<span class="keyword">struct</span> i2c_client *client,</span></span><br><span class="line"><span class="params">       <span class="keyword">struct</span> i2c_board_info *info)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* 3. 能运行到这里, 表示该addr的设备是存在的</span></span><br><span class="line"><span class="comment"> * 但是有些设备单凭地址无法分辨(A芯片的地址是0x50, B芯片的地址也是0x50)</span></span><br><span class="line"><span class="comment"> * 还需要进一步读写I2C设备来分辨是哪款芯片</span></span><br><span class="line"><span class="comment"> * detect就是用来进一步分辨这个芯片是哪一款，并且设置info-&gt;type</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">printk(<span class="string">&quot;at24cxx_detect : addr = 0x%x\n&quot;</span>, client-&gt;addr);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 进一步判断是哪一款i2c设备 */</span></span><br><span class="line"><span class="comment">/* ...... */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 设置info-&gt;type，i2c_driver-&gt;detect执行后便执行i2c_new_device</span></span><br><span class="line"><span class="comment"> * 他需要利用i2c_board_info的信息来设置i2c_client和注册一个i2c_bus_type类型的device */</span></span><br><span class="line">strlcpy(info-&gt;type, <span class="string">&quot;at24c08&quot;</span>, I2C_NAME_SIZE);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">unsigned</span> <span class="type">short</span> addr_list[] = &#123; <span class="number">0x60</span>, <span class="number">0x50</span>, I2C_CLIENT_END &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 1. 分配/设置i2c_driver */</span></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">i2c_driver</span> <span class="title">at24cxx_driver</span> =</span> &#123;</span><br><span class="line">.class  = I2C_CLASS_HWMON, <span class="comment">/* 表示去哪些适配器上找设备 */</span></span><br><span class="line">.driver= &#123;</span><br><span class="line">.name= <span class="string">&quot;100ask&quot;</span>,</span><br><span class="line">.owner= THIS_MODULE,</span><br><span class="line">&#125;,</span><br><span class="line">.probe= at24cxx_probe,</span><br><span class="line">.remove= __devexit_p(at24cxx_remove),</span><br><span class="line">.id_table= at24cxx_id_table,</span><br><span class="line">.detect     = at24cxx_detect,  <span class="comment">/* 用这个函数来检测具体是什么i2c设备 */</span></span><br><span class="line">.address_list= addr_list,   <span class="comment">/* 这些设备的地址 */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">at24cxx_drv_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* 2. 注册i2c_driver */</span></span><br><span class="line">i2c_add_driver(&amp;at24cxx_driver);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">at24cxx_drv_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">i2c_del_driver(&amp;at24cxx_driver);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(at24cxx_drv_init);</span><br><span class="line">module_exit(at24cxx_drv_exit);</span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="Test代码-2"><a href="#Test代码-2" class="headerlink" title="Test代码"></a>Test代码</h3><p>略略略……</p><h2 id="2-设备树方法"><a href="#2-设备树方法" class="headerlink" title="2. 设备树方法"></a>2. 设备树方法</h2><p><img src="%E8%AE%BE%E5%A4%87%E6%A0%91%E6%96%B9%E6%B3%95.png" alt="设备树方法"></p><p>通常我们都是知道i2c设备挂载于哪个i2c控制器下，所以不用detect这么复杂的方法，在使用设备树方法时，i2c_driver中不要设置detect和address_list成员即可，如果没有这两项成员，便直接跳过detect方法。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 注册i2c_adapter */</span></span><br><span class="line">i2c_add_adapter(adap);</span><br><span class="line">__i2c_add_numbered_adapter(adapter);</span><br><span class="line">i2c_register_adapter(adap);</span><br><span class="line"><span class="comment">/* Notify drivers */</span></span><br><span class="line">bus_for_each_drv(&amp;i2c_bus_type, <span class="literal">NULL</span>, adap, __process_new_adapter);</span><br><span class="line">__process_new_adapter</span><br><span class="line"><span class="title function_">i2c_do_add_adapter</span><span class="params">(to_i2c_driver(d), data)</span>;</span><br><span class="line">i2c_detect(adap, driver);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 注册i2c_driver */</span></span><br><span class="line">i2c_add_driver(driver)</span><br><span class="line">i2c_register_driver(THIS_MODULE, driver)</span><br><span class="line"><span class="comment">/* Walk the adapters that are already present */</span></span><br><span class="line">i2c_for_each_dev(driver, __process_new_driver);</span><br><span class="line">__process_new_driver</span><br><span class="line"><span class="title function_">i2c_do_add_adapter</span><span class="params">(data, to_i2c_adapter(dev))</span>;</span><br><span class="line">i2c_detect(adap, driver);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* detect方法 */</span></span><br><span class="line">i2c_detect(<span class="keyword">struct</span> i2c_adapter *adapter, <span class="keyword">struct</span> i2c_driver *driver)</span><br><span class="line"><span class="comment">/* 取出i2c_driver中的设备地址数组 */</span></span><br><span class="line">address_list = driver-&gt;address_list;</span><br><span class="line"><span class="comment">/* 判断是否使用detect方法，如果i2c_driver没有设置对应成员就是不使用 */</span></span><br><span class="line"><span class="keyword">if</span> (!driver-&gt;detect || !address_list)</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>设备树方法其实就是早期版本的i2c_new_probed_device升级版。因为我们只需要在设备树的i2c控制器节点下，定义好我们的i2c设备节点，设备树框架会解析i2c设备节点，分配、设置、注册i2c_client，最后注册一个i2c_bus_type类型的device。</p><p><img src="iic%E8%AE%BE%E5%A4%87%E6%A0%91.png" alt="iic设备树"></p><p>首先，i2c0设备树节点对应一个i2c_adapter，gt911设备节点放在i2c0节点下，在解析设备树时，会用i2c0对应的i2c_adapter去访问gt911节点中的reg&#x3D;&lt;0x50&gt;地址。如果收到ACK回应，便会为gt911节点分配、设置、注册一个i2c_client，并使这个i2c_adapter与i2c_client绑定，最终会注册一个i2c_bus_type类型的device，如果与i2c_driver注册的i2c_bus_type类型的driver匹配，便调用i2c_driver的probe函数。</p><p><img src="iic%E8%AE%BE%E5%A4%87%E6%A0%912.png" alt="iic设备树2"></p><h3 id="driver代码-1"><a href="#driver代码-1" class="headerlink" title="driver代码"></a>driver代码</h3><p>这里就放一个at24c02的代码吧：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/i2c.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/cdev.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/uaccess.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/fs.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/delay.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> AT24CXX_CNT   1</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">cdev</span> <span class="title">at24cxx_cdev</span>;</span></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="keyword">class</span> *<span class="title">at24cxx_cls</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">at24cxx_dev</span> &#123;</span></span><br><span class="line"><span class="type">int</span> major;</span><br><span class="line"><span class="type">int</span> irqnum;</span><br><span class="line"><span class="type">int</span> irqtype;</span><br><span class="line"><span class="type">void</span> *private_data;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">gpio_desc</span>   *<span class="title">reset_pin</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">gpio_desc</span>   *<span class="title">irq_pin</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">i2c_client</span> *<span class="title">client</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">at24cxx_dev</span> <span class="title">at24cxx</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">at24cxx_open</span><span class="params">(<span class="keyword">struct</span> inode *inode, <span class="keyword">struct</span> file *file)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">ssize_t</span> <span class="title function_">at24cxx_read</span><span class="params">(<span class="keyword">struct</span> file *file, <span class="type">char</span> __user *buf, <span class="type">size_t</span> size, <span class="type">loff_t</span> *loff)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> ret, i;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span> offset;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> offset_msg[<span class="number">2</span>];</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> *data;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">i2c_msg</span> <span class="title">msg</span>[2];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* offset = buf[0] | buf[1]</span></span><br><span class="line"><span class="comment"> * data  -&gt; buf[0] ~ buf[size-1]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">ret = copy_from_user(offset_msg, buf, <span class="number">2</span>);</span><br><span class="line">offset = offset_msg[<span class="number">0</span>] &lt;&lt; <span class="number">8</span> | offset_msg[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">if</span> (size &lt; <span class="number">1</span> || size &gt; <span class="number">0xffff</span> || (size + offset) &gt; <span class="number">0x40000</span>)</span><br><span class="line"><span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">data = (<span class="type">unsigned</span> <span class="type">char</span> *)kmalloc(size, GFP_KERNEL);</span><br><span class="line"><span class="keyword">if</span>(data == <span class="literal">NULL</span> ) &#123;</span><br><span class="line">        printk(<span class="string">&quot;kmalloc failed\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> -EIO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* at24cm02 reg addr is 2 Bytes, A15 - A8 | A7 - A0 */</span></span><br><span class="line">msg[<span class="number">0</span>].addr  = at24cxx.client-&gt;addr;<span class="comment">/* at24cxx dev addr */</span></span><br><span class="line">msg[<span class="number">0</span>].buf   = offset_msg;<span class="comment">/* eeprom offset */</span></span><br><span class="line">msg[<span class="number">0</span>].flags = !I2C_M_RD;<span class="comment">/* i2c write */</span></span><br><span class="line">msg[<span class="number">0</span>].len   = <span class="number">2</span>;<span class="comment">/* data len */</span></span><br><span class="line"></span><br><span class="line">msg[<span class="number">1</span>].addr  = at24cxx.client-&gt;addr;<span class="comment">/* at24cxx dev addr */</span></span><br><span class="line">msg[<span class="number">1</span>].flags = I2C_M_RD;<span class="comment">/* i2c read */</span></span><br><span class="line">msg[<span class="number">1</span>].len   = <span class="number">1</span>;<span class="comment">/* data len */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* msg[1] read data */</span></span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">msg[<span class="number">1</span>].buf = &amp;data[i];<span class="comment">/* data buffer */</span></span><br><span class="line">ret = i2c_transfer(at24cxx.client-&gt;adapter, msg, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">if</span> (ret != <span class="number">2</span>) &#123;</span><br><span class="line">printk(<span class="string">&quot;at24cxx_read i2c_transfer error = %d\n&quot;</span>, ret);</span><br><span class="line">kfree(data);</span><br><span class="line"><span class="keyword">return</span> -EIO;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* update offset */</span></span><br><span class="line">offset++;</span><br><span class="line">offset_msg[<span class="number">0</span>] = offset &gt;&gt; <span class="number">8</span>;</span><br><span class="line">offset_msg[<span class="number">1</span>] = offset;</span><br><span class="line">&#125;</span><br><span class="line">ret = copy_to_user(buf, data, size);</span><br><span class="line"><span class="comment">/* free memory */</span></span><br><span class="line">kfree(data);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">ssize_t</span> <span class="title function_">at24cxx_write</span><span class="params">(<span class="keyword">struct</span> file *file, <span class="type">const</span> <span class="type">char</span> __user *buf, <span class="type">size_t</span> size, <span class="type">loff_t</span> *loff)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> ret, i;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span> offset;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> offset_msg[<span class="number">3</span>];</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> *data;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">i2c_msg</span> <span class="title">msg</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* offset = buf[0] | buf[1]</span></span><br><span class="line"><span class="comment"> * data  -&gt; buf[0] ~ buf[size-1]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">ret = copy_from_user(offset_msg, buf, <span class="number">2</span>);</span><br><span class="line">offset = offset_msg[<span class="number">0</span>] &lt;&lt; <span class="number">8</span> | offset_msg[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">if</span> (size &lt; <span class="number">1</span> || size &gt; <span class="number">0xffff</span> || (size + offset) &gt; <span class="number">0x40000</span>)</span><br><span class="line"><span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">data = (<span class="type">unsigned</span> <span class="type">char</span> *)kmalloc(size, GFP_KERNEL);</span><br><span class="line">    <span class="keyword">if</span>(data == <span class="literal">NULL</span> ) &#123;</span><br><span class="line">        printk(<span class="string">&quot;kmalloc failed\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> -EIO;</span><br><span class="line">&#125;</span><br><span class="line">ret = copy_from_user(data, buf + <span class="number">2</span>, size);</span><br><span class="line"></span><br><span class="line">msg.addr   = at24cxx.client-&gt;addr;<span class="comment">/* at24cxx dev addr */</span></span><br><span class="line">msg.buf    = offset_msg;<span class="comment">/* eeprom offset &amp; write data */</span></span><br><span class="line">msg.flags  = !I2C_M_RD;<span class="comment">/* i2c write */</span></span><br><span class="line">msg.len    = <span class="number">2</span> + <span class="number">1</span>;<span class="comment">/* data len */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">offset_msg[<span class="number">2</span>] = data[i];<span class="comment">/* data buffer */</span></span><br><span class="line">ret = i2c_transfer(at24cxx.client-&gt;adapter, &amp;msg, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">if</span> (ret != <span class="number">1</span>) &#123;</span><br><span class="line">printk(<span class="string">&quot;at24cxx_write i2c_transfer error = %d\n&quot;</span>, ret);</span><br><span class="line">kfree(data);</span><br><span class="line"><span class="keyword">return</span> -EIO;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* wait Twr, it&#x27;s write duration */</span></span><br><span class="line">mdelay(<span class="number">5</span>);</span><br><span class="line"><span class="comment">/* update offset */</span></span><br><span class="line">offset++;</span><br><span class="line">offset_msg[<span class="number">0</span>] = offset &gt;&gt; <span class="number">8</span>;</span><br><span class="line">offset_msg[<span class="number">1</span>] = offset;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* free memory */</span></span><br><span class="line">kfree(data);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">file_operations</span> <span class="title">at24cxx_fops</span> =</span> &#123;</span><br><span class="line">.owner = THIS_MODULE,</span><br><span class="line">.open  = at24cxx_open,</span><br><span class="line">.read  = at24cxx_read,</span><br><span class="line">.write = at24cxx_write,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">at24cxx_probe</span><span class="params">(<span class="keyword">struct</span> i2c_client *client, <span class="type">const</span> <span class="keyword">struct</span> i2c_device_id *id)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">dev_t</span> devid;</span><br><span class="line">at24cxx.client = client;</span><br><span class="line"></span><br><span class="line">printk(<span class="string">&quot;at24cxx_probe\n&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (at24cxx.major) &#123;</span><br><span class="line">devid = MKDEV(at24cxx.major, <span class="number">0</span>);</span><br><span class="line">register_chrdev_region(devid, AT24CXX_CNT, <span class="string">&quot;at24cxx&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">alloc_chrdev_region(&amp;devid, <span class="number">0</span>, AT24CXX_CNT, <span class="string">&quot;at24cxx&quot;</span>);</span><br><span class="line">at24cxx.major = MAJOR(devid);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cdev_init(&amp;at24cxx_cdev, &amp;at24cxx_fops);</span><br><span class="line">cdev_add(&amp;at24cxx_cdev, devid, AT24CXX_CNT);</span><br><span class="line"></span><br><span class="line">at24cxx_cls = class_create(THIS_MODULE, <span class="string">&quot;at24cxx&quot;</span>);</span><br><span class="line">device_create(at24cxx_cls, <span class="literal">NULL</span>, MKDEV(at24cxx.major, <span class="number">0</span>), <span class="literal">NULL</span>, <span class="string">&quot;at24cxx&quot;</span>); <span class="comment">/* /dev/at24cxx */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">at24cxx_remove</span><span class="params">(<span class="keyword">struct</span> i2c_client *client)</span></span><br><span class="line">&#123;</span><br><span class="line">device_destroy(at24cxx_cls, MKDEV(at24cxx.major, <span class="number">0</span>));</span><br><span class="line">class_destroy(at24cxx_cls);</span><br><span class="line">unregister_chrdev(at24cxx.major, <span class="string">&quot;at24cxx&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">of_device_id</span> <span class="title">of_match_ids_at24cxx</span>[] =</span> &#123;</span><br><span class="line">&#123; .compatible = <span class="string">&quot;Anlogic,eeprom24cm02&quot;</span>,.data = <span class="literal">NULL</span> &#125;,</span><br><span class="line">&#123; <span class="comment">/* END OF LIST */</span> &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">i2c_device_id</span> <span class="title">at24cxx_ids</span>[] =</span> &#123;</span><br><span class="line">&#123; <span class="string">&quot;Anlogic,eeprom24cm02&quot;</span>,(<span class="type">kernel_ulong_t</span>)<span class="literal">NULL</span> &#125;,</span><br><span class="line">&#123; <span class="comment">/* END OF LIST */</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">i2c_driver</span> <span class="title">at24cxx_driver</span> =</span> &#123;</span><br><span class="line">.driver = &#123;</span><br><span class="line">.name = <span class="string">&quot;at24cxx&quot;</span>,</span><br><span class="line">.of_match_table = of_match_ids_at24cxx,</span><br><span class="line">&#125;,</span><br><span class="line">.probe    = at24cxx_probe,</span><br><span class="line">.remove   = at24cxx_remove,</span><br><span class="line">.id_table = at24cxx_ids,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">at24cxx_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> i2c_add_driver(&amp;at24cxx_driver);</span><br><span class="line">&#125;</span><br><span class="line">module_init(at24cxx_init);</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __exit <span class="title function_">at24cxx_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">i2c_del_driver(&amp;at24cxx_driver);</span><br><span class="line">&#125;</span><br><span class="line">module_exit(at24cxx_exit);</span><br><span class="line"></span><br><span class="line">MODULE_AUTHOR(<span class="string">&quot;Anlogic: quenaiyuan&quot;</span>);</span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="Test代码-3"><a href="#Test代码-3" class="headerlink" title="Test代码"></a>Test代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* i2c_test r addr</span></span><br><span class="line"><span class="comment"> * i2c_test w addr val</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">print_usage</span><span class="params">(<span class="type">char</span> *file)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s r addr\n&quot;</span>, file);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s w addr val\n&quot;</span>, file);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> fd;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span> addr;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> buf[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ((argc != <span class="number">3</span>) &amp;&amp; (argc != <span class="number">4</span>)) &#123;</span><br><span class="line">print_usage(argv[<span class="number">0</span>]);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fd = open(<span class="string">&quot;/dev/at24cxx&quot;</span>, O_RDWR);</span><br><span class="line"><span class="keyword">if</span> (fd &lt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;can&#x27;t open /dev/at24cxx\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;r&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">addr = strtoul(argv[<span class="number">2</span>], <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">buf[<span class="number">0</span>] = addr &gt;&gt; <span class="number">8</span>;</span><br><span class="line">buf[<span class="number">1</span>] = addr;</span><br><span class="line">read(fd, buf, <span class="number">1</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%04x: 0x%2x\n&quot;</span>, addr, buf[<span class="number">0</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(argv[<span class="number">1</span>], <span class="string">&quot;w&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">addr = strtoul(argv[<span class="number">2</span>], <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">buf[<span class="number">0</span>] = addr &gt;&gt; <span class="number">8</span>;</span><br><span class="line">buf[<span class="number">1</span>] = addr;</span><br><span class="line">buf[<span class="number">2</span>] = strtoul(argv[<span class="number">3</span>], <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">write(fd, buf, <span class="number">1</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">print_usage(argv[<span class="number">0</span>]);</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Notes-1"><a href="#Notes-1" class="headerlink" title="Notes"></a>Notes</h3><p>设备树方法和detect方法不要一起使用。因为设备树会解析i2c设备节点，然后注册i2c_client。再使用detect方法，i2c_detect中又会注册i2c_client，可能会有冲突。</p><p>在使用设备树方法时，i2c_driver中不要设置detect和address_list成员；</p><p>在使用detect方法时，不要在设备树的i2c控制器节点下定义这个i2c设备节点；</p>]]></content>
      
      
      <categories>
          
          <category> Linux驱动 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux驱动 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络设备驱动</title>
      <link href="/2024/04/26/%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/"/>
      <url>/2024/04/26/%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="想白嫖，没门！" data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="5600a526be59f59338ff815d21cdb7b46a44329faea98d852891f5f997a29e8e">571d5de1f5a053f5c86199ac456cb1a43eb166bd6254c6c81e96bfa55ef337b3c98deb0075c7d2ebd9162b0d327c53b8a754f590084426675bd8a16468a7d488842a206efa22d4b03cf50d7ddf87c86e1c136f3eaec037a579f31ab106256c803b13f304eff4df9296d6d1d38af0d0b4e020c976499ca90d8f8c477c24f533bf6da8891db03cd7c78a08b060ebe3cc0a6444049a3d7b826653abbffc60b28168b664c723c2c14bb46ea4480c20986d8967dabbfa807ce4b464efaedfb7bc7c5f13aa913ad52e776a93c678fab19a4c4bdf29242309236912891455390f2c6e7436432f4b83b27e93e1a251401cd34ae1ec231c46c62b24eae4e674c5ed57c7757ba176773ac7cdefd4872c3814244b9f32d77075b872ea9dfe226e3564807ff87a1c0c416190f3d12b45b34a5e74235053ae5b56f97ab4b93eb62773631af983d6e2a1bdcf0f83a3edfe1f7a5ec975e6d0e2133582ede9356efade28edfd3077efacff844d1b1375252c2c084db1148bfa7b45fea17381bb75022e0377273eb2a56ecc531d7dea27b986dea95a626756f36917e28bc8c075d9c9c3d7d1fc06a154e9f05481757e12629c2df4317d60c3c4c85c3e66dfdd094deaa92a0900a7806619eb55c5a0a72e4df2311a0e90137ec211f503f1d50f0ddce1b88651632451061a60e9f00abc1589155648c45f977114414794db2609bebc90599ac2426fe77eb62a90f26cb1328f7f46c57854858f40b103d2f37010d6f03348cd38b8c1517156d74e044492586dc19382586311cdb3f334151b9bd8e9401c5ca53cd8198847e7a6fc691328c01ad7880eead5a8573357a04b2eb931abf4b367f5ea7edde16426edc3f77fc07fcc4905a00d8ca40086302431c84b9bc405ecc46d4edb7248429a44d7e8640e6826a3e18f126e71a05343e99cffd180711f87a0f6900c98294bd06d662fbdf064e02878a210b171cedd8551fb3d799c9e7420907cd3b7ea8d2cd52c222fb7aa753a4afd20b0fe7f8bec18e1c09859a9cbc0f1b6d949354ea19ea8341e079689ffb7673b5b3c3d99c08abc60c90347e89bf25189c52c38860ab67a40dad4dae558816412db3032c500ed760ace8f6f5503b053f9d0ae44d94118dbc37d26eeae80940fe0c2934edf1479daebd2d6292bbf1799cb57a73fc731dadeb0be19ae3398f41df87b5fc205731bca523f741ff540c4513c725660881cbce32b0d4163f4874aa23e8a3a26cc44b44df04e602a3036f862f129d35bb41a17f2540e4e68cdc2182ea615c5e14fb453b386d143310294640639bdafed7368f122e5bdfe59e79f66dcb2b282572fa4135e0fc7393deead1107a4841979b73e66f6acbdee477545706b75632adf92587839aef69b20fd8a531e9c475f6d7fad46c7aae627511f73dfef5a86a31e16abf85242c82883848cb237b85a35b91cf4595541bb8b051fdbbb812bff4525533b3dbc1b5f6bc2cf83d97aaa390b1ba0b62327238f9d71e46d280b9d33ce8ebb72ab70ffe266bbd2c6a3f3feca5b33340173092a77c16df2c1d00c60230dbe5a3158635b7351e39a4e4d1592670bb0e6d4030f95dce35844c22442f25a09598d1c8e03c52f49d86ecf3f12f7ba114701ef864996f0fe4dfe0180e2f8ae7fe2e129ab9840aba351d02f010e60a801d3a24435348ad482179bb253a7c7e026d60c6e8fcd303cdd837fc5b4b7034b9a997e214e2e21e02715ab15abbaf0ed0e018f2324857b238d73edda8fce5c4846b421a46e40bbd9cf6d7d49a0540c221b451a1a2c89f91ca7ecbf2530def1d7c72e24f810336f97869da9b147e3cbeab7b086bea383536d382525fe443068d6be247be505e729bce11c49b608cfbb5234a22a80a066be6efbdb6a4ef1f9b05771d1c4583a3bc66f0dd0fa16cc41ec9f57d55f11bcdc3ac9b77242843b93bb1b2d7f2f9c1b27b9c85b71c657a7dba0fb04ffaee9520467cb100da2210720ce5d6fb5949fbef4b88222b147d703427b07de5ebf80fc4e9a79765253d484393376b8539991285f8ddc4d3653632a064c2af18ea7118958a82599b43380d0d38b419917db8c8e036b06b8b15a8b1cfa173d5e3d6f9a33a244a755cb389982f3880608d2a52a3bb1a3f3ca8ed2300fe61dd16807eae8f64e260663a8373ce5c766f6c0b53138d27b7811498ea0069baab7cd3864b3918a73b4f28635da0bf3a3695525c30a94ba5d47821850574f2ee5d10b54f35862763974d4666e1a0be5fc64ec7cc3dbaf481015e9891594064215c46262dd4c38f53fda494c6fab98c88edee8e8e40478807f93b860e5cd023a16f7ad2e9401715b4b4739415253e255525a2ac87587d2b6718bf95047bb74b726e91b3c582fb880504dd4cf35ed2b60727a9499a3a19415f88dfc0d45e793d29c1188bdf7ac1fe282ba9b0d233fec87c122b7501bd88b857d9b09b531e6069ef1567138079be3af97ad1d577b408f3cd6cb091bcea10131de91358ba531fd8f62cc13da0daff52228d8d470be4a6012b98af67225378f1a4eb91dcb0de790dc5b300534934b3702203f7c6a291283e6ef5947420d8d7ffd44d642902197059c02ec1624cd64b76d4ab94d9660318fc696135f277ac7d7bb4c75e7a3a0a8b8e2e8e647362aedb6680763e7e1dae3747142cd322baad66308b1d7404fb48f5f59dbc88c31664c7e034bc30946c1f9c94f937e1bd64ef437c923e42995fdc31cf18fd676e24c55b8a753ef4588dae554e18545eadc2997eddd664f4e9e45a17790c5c3ed6cf7dd84c58c128df2bda9378943c0a28d5a56840d0c7341d7124d93a3655faf4fffb56667448fce1e29d7907c9da4972f42be5caf92fe557d1622746754120b06e3fa334f5a6849933549f12ec3f3aedb12017595d43698fdc6d867947ff2a275428ac9de94128df0700db2461f0b19916090af4314bc29ad6bc3f998e2220ec2e45d0d02472c797675ead6b62817253b2dffa7b39b9a9d5e751cef49ad0825f7f024429d8c7da647203dddfafe4e99596f103e59ea9956fd55e8684c3307f313b0ea027c92cee578c4915dc3eacf40cd312ce3d16fb3165d58a7f55d4c7f1a192603586561d3a1361b8783e48ae9d179405add4f8b69870c27203116633bab27b87f572478b91c7c5dd496a533390e2e7fec94b2fd6092c9a638e4e17dfd7eb8a35631d72db89b5475fb9df4cb30e3af01e5d4b23d950475726f4b9699d1e5dab524d312a9587afa4142bcb27e5a9c36d4c3d36bee1f8380f05edf2c270bbb8f0a3f4153309d957abccbde06bf87f7ac5de22e26e411010f766b2e923839fa847217a955ced482fd48bcf1ce4a1fbbecb73262e7f7c19925b038a72a55940598f79c960ee222f912eadf1de1543949403c9a6c3cdd2e849c90718cd5c22be89083ca527d70aa966dabcdf004242b8ade38996e53cb611a57a8727d1e0e98c13c763d0b6319ebd7d1a5922fa8a06747cc34100dbce277d5290e43ac25d18f3c73f11c88dc35a568c29b8cb5a057cc5ae334e7d88787ce086d4f8cbf98ce3267dc94c932983f1390bc7371b3f1dcd8b81156596a2616514216c62d8f4d0ac1bfc7b85f547018fd63d46d13c65b37071099b73c4860fa56e3589e565daaf6e30edb00e50d054da824b2fae9f9867b39f367b14dab2a3dc601777cec2f94bea0eb00b68fe107168191f65c4f60a652b35358b004aaefdd4940cb157c5bbe9d6486c9e0729813299717b0617b9ee0b2aebce2813aacdae7b7980f85c447c9349df1fc3f187c9fa346297489b795c92437387dc957377d8e84535b39e7a3570fca1738492ff887ae53e016c6591b6922e72b20354883ff5d015a610056b3f22f49f930cda0b5eb4ebb4f66c51d401f9aac0ce9e66bc86fa8594973d72ab72bba689b82b49fa50ff5218c5020a0b68afde6cd4049e8465d32224435efa7d706f1b735a7828723e2a1d012d4d794230f92121aff17169f1306cc0fee9b24c2a46bc31dfb7be988cc99d0fb2e67f61cd0d37719d453622e4a3a5e170ef6ee9d0c2c9ba8dc42cb84b7d8413c3d506d4ca399a2943c18a8d369e9c3ab1d94ec1303f8878709c00ac492e354a0c3820e98ee98dda486cd20b20af7a76478ad835bef82f0f8999b4c6af6b0b1c26e69422dd5c794e20a1b44d66e577f6471908131a0455ecce19a0b5add0906b831578c26a836563c9e4f25d8db30e26900159b5e30d4b0f2461ae6111fa2c31f7f5eeb9d7248357f4d60d2cee95dd94d0f2c7c1469a5331c047471eb043be4c69a498b12efa6db545fff540f083e02fffcbb266fcf5bcaff8e2585dfb9e366bbc0b249f88a14652654378c6ab0a29dadf34130ce1055b5c6cea0e6e3487fe36622b5e9048c0936e7248632d3c3e750d3f4d894eca7306af8234dda3a9e127a5a8d98f30e883ce4f3d187ab2a3ff17201ec033e6d4f35b3836c5e0c8458a002e878ac86b97e4ff00a755aa7d32148f7b829eb0b8e3dd1cc6a681474f2ab975cdd1afde781878bc71625ed802cb2aa2d9934e917e32f4c872d2899700e8bb30c609974ee42da8e6ec0daeac9d3124ca29ca4f3d6f1c11512400b740e4c714641c09dd4b04f8c380a64901ddea5c4ce288c250db2bf88afea23311949e3ea53db4b84811a53a7bded72c290c68d761660b25e21b16e1ada582ec63e529fa848772a3ed31a4fdc9e7f3c4285168b0ef7ad09666c743ba1a9f7f7a8e426eda9846fe26f29d1a24827b74bb138f3224eba3c9a60f1ad5c8e3fb6bbd116a06dd6c67956db261cd58d38157d4cbea0e17a112957bada910e69dc2cfcae2c038cbe6d8edda91eb20d4f0061bd172cee9f63c033d15b51cfd30c010d199809fc1db2a6b205baac5e81702893f7f22745996093f0451759b45657cc862937e343fcb2b65aa595f4dd920d347314b22fd2e2de98474137e63bedafd237f9ca34e55b5ada7af94729e37bf0f70b2df55514e7f3d4120e5fdaad837cfd1fbe11ae193ac53da0ec1809f82fcd865fc9a8e4654749b0f2ad723872b9b42c82756f83c786e7756c1459fc54458582fca39a98f68cada5ea6e22e55df0e004fd5ab1a92368d8caed292bc7438a72500ad2f04ffece0928a536b47304c279b933ebde5851deea6262ed1c95a403b46f4edc501c7048e6ae5e97e6a95c9a914594f5463c34230c9d8eeb574e031b3defbed43dfcfd865be951c68a8229ac0bdfe3cf269b6e19bc0e0aba002a409d7a3fe8e77e6416165f33b9b355840f47c7ad837a851047227f07fa24d581efb8d6f26829140d2087b689b8b49c8c0d95b630dec4a1e17a2a4cb366aa8355fe92fe6394978b6f457d9e05dc893be9b9f672261706317ec5df5fefd953a1dc1266630d56fc9afb633218e50eddb496602813fd4ea4cda32d86320062dd19cd2af79b9e7619a0d749f1f6f2897fdfc28623d9dade2d1a9bf15a8b440b0031b4ad92ef407831872cdc3b6badc5f2267898dc39b1d965ec9e43dde330fc84bfac748750a694393add74a191e563ebb10e583c678da769711d25c377412fa6f352d64abee6973c95f854083f6927e827dc45cac372fb58ed2c7bf8ff1df8b57fd9217ada50ff550c42779f8dadd9f5e7c859ad72ca7d2ef7644a0dc9c46d4cd8a35886eef1b7c34259898b99874e4c3b4875df0a175b57973dec8bdb0857c5d280e25f81de73fcb756d6d3cbd644840302fd3002ed15e4e7c2a0b072a64ea62c269becc84cc84bc7da89b14a80188ce315ede6d81fd399a93b4c193d68d33193adfa4ac26f284a8508b063b3cf454707a282939c030a4417d66140baf3b6557ae73799ff627f0eb593bb674b9d20503dcd1fe2724ec78b1aa44cf14cfc55e3b1a5109b10ee4bfc5413e2f43210dd8fb5a1570e31ac4c7f807e3f8f70c2b01a7c904a51576eaf10cd9f170adfe4d2cf6e1a20af01deaef42636ded09bfb764efdfc894559de02ccc5cdee5fcddff46f43e2756bb7e5562a2912ade57a689a2fb1909762295754a79809485177089afe03bf9b6f34a5f3c9dc281f53c24de4bae070ead562a39716370621fd80446040721febc021a52ad3eefe9b3ac41bd42c5fbf29c686d73f7e4da1b028055cbda182f0a992c0298787ede1dc80b1f69500038e87db4967ef260396c8555a6208980a0390fa29a81469a38aad6baf362a190a398daa67a824e1608726cccaa200661e0f1e90dd6cef5e09cf12633b5b56b143b053e44c59558fc8f1fc3c963d4e3404f9cdf0b2814a9ccb93166a709791ffeccd42201f2a8479d7bdd2bf4b380e046fd3ac9c7f636f73cb5066c4e59a88b8c9989adedcfdf5fb2e68fe11f506dcadc17c6415e450493422006582bb834b191a7475d91f49ebb4b6617f3aa03b14ce27b87d8194d3a227f6ffc7c017a9212c2dc113311dbef0ba0472b1d1f7516b8cb503f6dceb438a3a52bc614d33df7e8255b411066f70b85fd4f48bf676867fd869e62b25f139d7c28acaa7afa3d6d4355a1c41dab52bc52bdb47d6f7b358cbee4dc2992436fbc5f9b1ca757952409c301b6908120657cdc7dfeee95294d9a249b5d9c0ec9397223747bbbdc70152803cb2cea33ecb953fee47c136776968fb81cf4290bc72b9a1609c3217776a057be312850e4e0921d6cf336dfbd2dc81118a67899cae3139ca6390b87c7ed5ad2b251b8a488356a05481e62fe47ae60588a5cf8306dbd8e78b2e942e62e94353c4023da2e86264f2484380879a99967e69d88e73436502715ad2341cfa2422155997029ba85cc4fdd596629747e15620355459d00319c78cfffafd1d03ce385953267f67e2ee44ccad5dfe5494d2a3e5b833eb6631ab926ed78c885efacd175e248e65dcaa749f892d786e58d9e691185ad6d3b4ea6d968e87aa71c7414ab03cab607d91cff55c62745963d3f138a9f9fd9340af594209a2ac881663ad460d5b2475c656b3d88eb936468b3d6145374743d1280e074f3d9c785f1d7e9a202a348b9d98d9dea3c6e7db5200d68fb072b051ffa1f78bb431ad17ff8d6a39916e6317ccd14dbc898ae755104dea0bea0ad444748676a1d5ea4b471196e5d9aace7a2f54c98eee3607c6fee4b779748e6ad06bef072c6e06cd5591f7c4756d1abe0a8dfe16e32f7d34240b4bf2a12daca9cf65873ee7bfaa184afaa6237f8b46d8849651afdbf6ec4758fb5769668040a3dab46cd851cb18ea6a8e3d414c21365456ef9aa5c33ad2bf2c16833c2c5c81dc4c51fa215f272f4bf9b1427a1283164657efb00d615e31742a1bf9dff4ec2ca2b0a2eb6926e07dba1a5ffbb21e24b64b6d4eb3895c080e25cbba5cd229e9991e5e2e37f1b63a0b8c9000dfe50f5bfa919ca5c357a733076c1fbb1f9cdf8a91a47123f44158fb3c26cdc9a40237fc584be57730183baaac5a3957d182f13b21f515eefc406149de959b4ca73b7997f94982c9ec154f3a24e8554b38d05184c6ee6a19041ca8956d32ef1e5ed9c4555304cf8a4f502d2115ddffbe8d4bb402fcac1895792f9e41de3b8c05e9f923f118a7fd949637b7c8f4cb53d1ba2482508015d79371bef12421b3967f3d14d4c7dd0a9ffe800e50a40048b09e8162f44e4a0f7b3e0edcddeb49386278ab14cba075ef9d523b52c025c359893af597559747df3f33add3d329d948593285977b2d7b938509520ac5cf26b07b2542b54f09c68e76125d263e610914591755b011f5725b59c561daa20b4914895c3b58b24d058096a4dbcbe5fda37f4ce95c86e7c88618d09b3922c7ceb2f134cdc69fd4e9ec37a75b7432e22b9ce19dfc7930524a9b14dd0add4ad54340b77aedfb9f67e79a550a46edead734e74414e161b1f0157d3975043ac4ba8fb3326a60d1489d05dab37610c2a33b0d1f905798971a7e9038cfbe61b5dabd22fc324c269092877b967c90e4a9d62c8b13dcff243b8c433b5c934af7a7b67e3db6e738e12fcdb50717cc46f402fe540d9c155fb24ef67e9e4ceec3c03bf530938b1fbbd70b7d227243b40c1bf9ad6cbd3404cb584a8d2f0d3b093a43d40027e4ede8730834404e2fbf7983fdd3e7aadd4b7f83bd12d10ce01898701a84cd96908428316315a5f0b366fd521a982af066b1ad2c1af212ab3a7e1c076d81d7dd65956f4022c252d0d9ed0b0395675627fcbaff089415d86a4dbe40c9c8226aaa1332f7cdb0715ac92f4c97fc4d4ea5916bc324a9e1e867a579a0e7d42b56e5c8dac140a8542df8c02c9a6713f17d4d2e579f8f7273d2981fe9207141ac6e3570392cd9b92662901fc2ec99ac6c19886eaa8c5382f7c327ef13bfb61fa1f7f48408f6185ea4d27ca202f3a71307504d5fc039478ab52765b2f3604656486791f63d275d72a437088699efb30595e989415a9392a501b169e7517b1e14c3d69bdde266ada4e089571d8fcd843fb645d1aa4f79aa78ed1ab5b9d1c7f18d87a0c9d8046c8c562d04c2ed6d3c89db66343b55de48f432426e44adb1c489a15785e1d85025069b20f184ef92a573f0035e6046ba7279d86b0b66b71a309d205d07c2f273ba0e0f2b4664e1e4be4d150c8e484bf6418f9af7975de6ccba01e5e5a8854b29405eef194fa612f27972215b19e4a05b009f88b203731d4e121649c46c5a1bb5340df247a1c420bee836df50fa66e0850eec45f7790797207fa629b614eb401f8a1f477ef830da9c96fb7a8335d9901ce320dd7c7a4b171f30c222e9cd14e21f288f982c9dc6de7e23810f9261b86959f1ae58ddafd38a18be78fb5799442b45c1271fb106c555b5360647c708404245751a18cffacce03c7ffe117d54207ae4eeff0ba98c53f4a0e2ba5ddbe24e7af0ce7054293c5762c0d098482c51a1fc2e57ba3218a63edc82a9e518d1aa0effb2eafdafd9a7fc2d261ce8a2f6557585c16c23d12f4f7488c15cadcbd732f413b9b5338a311546def5e34b97169fef7de239cb9b517fd6919383086cf28f9781f26079b857a1888173b86b8a7024e3678bc78cc4eb791f795a72596f3cadd96967d9fac674053d737cca69989e08dad6368b30a437866333febea119eb6366519f23edc1890bb7260ba0fc90faf0140b45de9fd05bc32a8d131960d152b447c56f180b5f33d3821ba75a3f6513221454d3de3172c7d1111c417ff2c2b2da24f61a6d9722c80d140d48e4dd78c777e67e6b57a9c2c90e92190332c335ecb02fe21e790ae6e768f7dc34b1d0b3bd4bb90465cb997a2bd6a3690f8e70f2ce51ce6aabf67c4d157667531b4488e00eeed4b60b3edacbbaae15f1304420e499d981c76cf0070ca03f20bf78db88b82607f9f42d03e5ef9372402ee1edd1e02d76dc11ddbba12d2df3c430b22624b712b55b314bd0cef5aa38bc97ae7bd83a50f19f8ddf3abea6ea2cb975c5e297e89ff3a6c53bb9cdd2cd0b46b289393a42e4b9ce3d98d01c8ef85a1665338340d57910bf3eded36bdb7d7e7d5a085dcf87d98b6627fb5e486cc43e58e946b0d78f4af46f9ff5ba931db5c0dbab77611c0a3cd6c46d94bc4b4adf53383e157ca6def8e5b18b4421c7a8d69d85e7427ed10990213f564cbc65cbd0c9acd238bb0f8fb1b4d3f5ad4a3e8be286daf460b0f53033d9c9e17c0d20b46046665b2f3b7b3faa08945d150a0dd060463ae3eb0990669ae0bdf7954853af835de1f7e457485550070f5194c2d56c50432d8049d6ea1307d0fa54f18e14950bbf3c27d15bbe717277213e40f9fcc6a700b49d80afc7375fac4b79357de19ac0c4055da34fc6aa6fc615792bf07aed64635d3cd2eafb3d8ae899a9a39484c7d16b325df4eb91b71e1b93117ded48b947154f25f6f4bd3c6b783789e4429577d0fa4c4c0df29fcf58574f8e2ed0b29bf96a9234b8a39471d9a0ed9839406b390f0cc960c825717cf70f62edcb26c4febb83b819734e3d15c397217e698b3556c82a0246799f76618e8530acf278de9bd91420239c379fb34d960067b573ec40dd9fac7583aa32342c599427d80494599f7f4e514af05560071199457a67ff7737ac111d0ff2915c85e14a551f707815988b984e464d8ebaafb0a01a7546447789c37a48eee86f24f33ce42c4a81d1513c0f1a2f2e71cdda92660fad29f06c6f63c454bd8072b5e459ae203965c79c76a53d12f463585c4d522b11337d30a234f4f3206491490bac0b7881ed974df9356e1cbc29f65fe5e2ad17655435bdf17402351bd30fa3d08ac3f268b3cc07f09d8511afaff366cc48b0633031d135efeb07b2a3decbf42d14b282e3e08b5df2faff1afe20337c8c83d049366e4270d2acfd5f799b6d566f4c202c944f2c04f071d10eda007e31afb3f7c738843b8c041244b023b85767d7b71f79d6d4a8ae569ca89c4fee5596fca8d579f57e4f4c6d22e8cfa48f4b802f080f6bf0f2bcab782e9ae42d7bf98a90368fdc38c443cc40917a7d2294ce7a9857074fb4704c7f413b278379e4b315c808e39f261325e3c3b9ac2b4b973a0854b11034d8f184b9a555a909457be65c9b76d942b9139c8f1255d14bc1520843aa7075843197d566bfce37ca7948dca0e94121a2f67654a88785feda791dd3a870c9b761245c78a48888a291ed54ec8797b8fabc1da559339475f3a36c41e432bce7b3f6862eecc5479a6a4658a8691f57510e09ef0663dd5ccd33ac308077d150fd202b36bb96010690ab9a7b9dc64ab3d532380978f6cd3aeaff1841c2bb0ca206a20be7ff332d0cc3807aaf1c5bcb4eebbc1fc1cabe2a4469dce90d2ebc43e7b774df680ec361794db614d6a1d3fa21db96fb6f787bf42efc066cdccde0a1b2c3bf1bbb1c38ea79be69bdb2ab78d9bd0f1b4780f44dc69470cea3667647c534be027b802b96539763b24187f38c3481234472976752d180aac17eafc727b773272c9ffa1721c31f66fc57353b2ec2be61fde0726bd5dc49a3ff5ae1ef1f1f79daf4accc13264fd91fe09001e337ce206a0524136000de6d0fd0e30c5067163f2662e9d4e037b5ac03dd3e1005431b0e8f558471c67cab2e69a9f9318864cb8006ef9445505466f32f2e4c8d9963fb5f8c2576a4c2ca8261c738a896b0bdbc1837dab115c442cc97fa99ecb09d4090827900964c970c72212337f582532604312c01f377ef41eb8f042ea863423121e9ce4d47e84b9d1c39967537530610a986794d1c6254a30f749a060c8652d12efa7b0dbbc73c91c22809a815a622ae81615ae62153afc572b289142e492b19145bec993aa6b5c71e369ff5fa52c44fb047d652339f3d635c47cd29cf70e403136487cbecf591edf77b6c9c4c02f24565cee6be318538d271ffe9eb676f58ea842196e27a319273c66a1c83c1a05f778aa1614ca7eb2694f95127d6bbdbfad2be89a05413fb0bca69fb644099730d14f78d50ea2aabb27561eb98d25a1cb4ee910dc3db7f874e67fee58a9e953270fa2074a5a430987ab807dfe12f2d2c3b559f583522d6d6ed36b6aecc84a250b239d5fab82382dbd961ee87f2949e89e96f6cdfe0f65e91e244c2a9cb52145f620863416102e9cf0c308b02feff6c49fbdce16d9117f9fa194169c10bbf8733734e24d27d4097a3d03d7e1acd4663091d8abed80f3acd67fb75332d7b35e09c1739af46a785e8e45a1557a5fd01b9972cc18d7dfe16987e60b19f4ae2beae20277df4348da8d00243ff2c8555a2d1739692ba9c82d997d6ab8b599a931dc5617c555fd8bc10a7e997b2456b148c7bd51533a0e029e8fd6f52baf873eb46f73c928bda656c797a769fe640739b4fc30abb301f78ac3ba1d18edaaee858e8a46e7fa7e3ca3fba5714cceb59780e71b54c300739741eba2fdb9f0abf597de7ea78016bfe4317a07fa224d79e88dfa9808cc6f486c4b1fc014c16ccff659ddbc2c08279356128b0a2ccc6b1e99483eeeff0dfc23e50e04e0adb800949fd5fe8d45b09b73da08451853cf5316bc32eb61ee49bd44e8c0c11bf8a821cd3477fea566d04f67e00d73daf0e5cd5919cc69d13082cf11b8622686b02106d7ab17c4a37a0e10153a252e00f55de7d45d001407b044084994f9e1a210e71fa9acb693f38bd432807ac1c9604c134241048cdf1d5a7a03392d44102eab1870099ddd69aaac6382c96295405f6b178f94c6f29be1a2df27b92aa541356c0941d581c93443ef81751957d9a3f9706badd6b7063cc752a331f311f3df0f36552622d3e69341c645ae6d0a97367f1eec34d5a6041ba6efee6ab7979a229d3e372bd5b493d338d4a79f73101ed32122ec42d460470951f22db98e7137f6875e4c29c90ab6e62f589fa47bb064ef8862f9c0abf892782f4cd672524ce66a4b6dad428ce2cb7a4ba76e5f0280a94664c96241f21fbd25a1ebfbbfe81aacd52d4704849af7dafa1db36c01fcf20a94de377bb36d741a68607b7719e9dee357138b1253820e6b4313a9e68f1338a5be70583b7339ac227bee38a1434471056f606be69449ab02ce9de320755f00abf4f8b9a817dca9e996aa983337349fff3f1f36a217c49186aaf076a9b679424e57b3ddc4314ec5b2635c96f0a107642c47157b0906794e2f1d8b8fc5b36d4b03a22a56ef5c5c94f2cd240991a84b71e93864260d2e266a951944a3fb85f3d39a5d9890ec1adcfae1fdbc0f1f00ef6660548877d64d532c0000e92642cd8c1ff234fd6b68141584c65eb6b1487d404edc250a63ed85aa5e8c6432940aa9e64fd8ff09f9e09d002b3dc2a8f57909e7a3ee30238714d112f8c8b6c77b86b6ad81e5f92b1474764b96cf060c0477c630f863d1fb1f4470555b02719011a398ef1f1895c99cfd04306bea89a4ddc0cbfdd4f75b28838a44a0b9ff3b884b6b7dc8b602e6f3a179785e03e49d935b0c9ba1b1444bfb218e69139341b94daec67f8d42288260f56acd87968b0613af5c7913f17bbb38fd5afd128d35cfe37af2096c635245c5df8247ba59d53d5a7d4a8ddf42d07130b80be7575e477e9dce98a174df2da7879f2fea2365ca21339a1d44660715fb3d8286799594913dd957f93151ac828c1b6e43a7b05e2b64e8318e3bf7920b9d0ceb2e0374e49cca11e618d36ae0a601cb6f6f5e94f6179d38442437d214345f004b0e006f3387c5ef31e4c3ca516aec12a0c90a2bcc5f85bd793b5951036a87d30ebeed3b43fc571d22f3ec5e0e4ea65e2dd4ce8c58140aa2dfed0b49a634cab00c7024bde0210eada518976cce1e1d07fdb2c98cb28430aa9faa0cf3f65ec3117c265536f69d6c94dd13eddd5af27cba6c4fd8322a15c472eb1cf0a8e38c74aa016a5825eba4caa4894a88313d6358ef41156c31dcb3ec24d1af5656cc87493dcd27eda8b7afbd656fc4ed174ced9bd80d7ce9a116c0e62a2aa8419a661fcd58dce74af22cce68507fc14d345561de0d735a6efc11e4020f1433d93a0b4f3b619e9168d42b70e8601c0006d1708d0fdb833a55408b2711581a8423170c530cc4a9fb76b2ea3d0d899af9dab2758406d26c657c502e119ef4be7625c42b00755ce20bd5635443cdb6f88925ae1e43ed8f5f299462eb5569b8bb93973ac26fde4e2d31e3055167dd3845360cd054eda7d0bd08bc70db47ade7dc5245bafde09ea114084eea704e700075f03436fba52e72248eacfd9439d2f81e7d2afa4ae2975bf1a4ec0bbbf0708a28bda59e0143c221d7037e08821b931416e6d77f484778e0d292b6f7d58ad3d55aa10233aa3110e52f7b831181918cbec76fb55552ea5a467b6ff0a947c35d0600c3e6b3d9180d0b00e7e42efa0a810d2357b129e8a97abaee0001ad0dc2a3e28e4f46a82f9dda39d14b0ebc278e1255ce01d8ff8a00763f4598b646efc729338b50e337706313db6703379c098c39a7f79a8afabad43ba96c16ce74c93a8892bdccc5e4b7d87b2ad43112a8d587e0a24f64866dcb0929dc2fcbddf9804b66431a2ae20160ea47ac3da7c0f78f340a11198f9a07972d1347880525670dff73dc373976e620423af52ea73618934d4760150cc136c4010870e18e674fef0495f4b11523499b8d0e238d723c3c5cf13cd9e9a71d008fcced58d27607b2073b2110fda587afc1185fd068dff45113b431131a62c21e8c43fbfc7b3153fa12ed5fd9f90a2fc3fd824216cbd768650d25ee8a2784146a42eab339e44bdf3cf7dd2e3978733e8e663f8c5fca4e2ef92c086209dacb76b52d53764992cbf9b59688e05a734dcf09dc6dd63f45f41630975712cb2d67beaa886bd3f721b70f448f0d4567d50388b6d6ca3f28e4a26a1622895f2bbdd28af4fd5213b227ec9e1b681a3e34bc8bc2a2f858b356945ba4682ce8fe008ae536a96b853ff0b9f8375ca845e54fbd01a14c396e8c8d24747d179ce853a6c7fe46256615c23da0768fb5a3694c661fab423c050c35842988b00bf09dc4b411f554a25c09d5465d1463af727413d64bd9225eea509fdbca0355c277c823f67fed04d2b4fa6d81bf7a4b58b8880e6daea83e8870a027c3fe2860d66fd3b74750428014580fd9863a94332c92637e390310599eda410ad6473e65e57fcb67c5d370fb38477f19e4f7287e92a5e830e22339e236f4b54c1028bd704b4bb60b4cce8c5148bd79f8e17b895c6c61d65aa3b8a20dc70936c70a8b03ef474e394705ee0a309f4aac7f194383f294a45ece66991bd958c043ab9212c54a9ac82fb0b0de4e6aaa14d3339b9e2241b8f3007e27bb756ea5f0e9025480445ca9948ec75f53ea716735573b01674765358ea6926f6c017edce6752c68118a9227442d5e41176ff43c3fd9639d6424b43d39b4ddb3b2491f164f7166b63ef09b2a21928622985b922bb6873ea9a2ba744333752b22f390ede8956ad0419dd14dfb9feabe4624837ddf63eb2a15ecaee6e62f3d896c140f5415056fac5cf0c2ce2a17aad8eb989bffbb6b752acba826e6b28a74f27c44f671b7c463432c42919c909e97000adcf5ea9fafaafa023debd5534f2d263e2178bb96613cb7a740e8d6f13d0a04e2bd3e3b866680ea937c3e24f6d382c7492dc4de84bdf587fada437f821d6d6af161e148be8574de6c558338a94b4d82e6215065563f09b4b8108f51a489c48eae3f728e43d08c53d1a84d217e2a9eff662023f11f9c88509138c0323243535a19bddcd666a70ca51eef12d26089ee5c3bb40c9084fbb95b8559e7a5ccb3edb54660c0f280d5d40fc6972c9a0d5fcf588803915760fbd5bf6ad862c243f183f2f88a544d637c74e643bc0d616e0a88ba77a4fd5a0b7db9e2a3f2ea5738dace0a7578622f637fb5c89e693c187bf78d991b5807195b57d7749178d0be5ea11efa97de663e1443b1aa5fafd8c7f1468f09ff2da0fbd1ca37801b9eb3067a8ea2eb3406ae4c0be101c48c65013f082fc4ab78d15ade1d3836ff2e9a04dfece64553251438a1a86327430d3bed6bd07dd0805c658901b40f1d4b51115ce2557db77351824b5b1932abfdf902e3831981cc0dbb2e59f89961d95945db32abac483247ead303e11653ee5bcd798895dbb24cf4901675c5eeb0c686c40a2ccf74d2be847959f556fb717bf22d5f266ed7bf10ea4cd0e8fd763e62e2279ce0d8a1c13bb7d6c54f059d7f8b8ab695db24b519ed5a778a16025ec85be1fe08841ba0d73a49b196beb0bacf8c6ef7511c39046ccafc3d494969fd551382dfd6aa97147e7b0e2098a90f5a7e2445bd74e831cf1431527371d1aaf2e33233a0baaeb960b531755a6c9f3cbf15f87c5a2cfdf87a28b1e4e62af58b60990c5617251c06a20ed5c8ccd1cb9246d8b1b23a62c80fb8aa4bb44ea74e33036c6cb6032bdc42daca0f213930f2f56281746ec5cbedf3d18cae14ed02099f622fa8e1cd508e43e8f8bac897aeb9d0c0774150c7758e400cca185c284f03c4682fd3a54de5febdaa08f444e40f786853f682342a05ccfe75d4a06161650e1a267a087a4feb950daa22212b4babe91817f3d9cc57cb7f1fbd865a4fa8c015e20e69a3b5061dd2fd3744b5722a95c5b0aa00febe879db35e07975392852e26fcdd4fc87ba23eea77742f32d8c15a006aec9d6670be8995eb38686306d2f5822b2e379206b05a94ec277bd3846b6d9d8adbba73f7ae15568f176bf3c189841cc52424fe68118dd8683ebf9c4fd205056e09f53409b6955a4944a792882cf6a4c6cf473365315b2636139d5b9beeb3523e9c5923603ab7d124ab3c25d10a49b1a42900a8f0653848b6fbf6bc72f28e127078ecbadb3656d91b5bc5859b82da32fca96c6cb3143fb7c2489aa301a8432b04a6658de2d4f3a2ed4156fc16ee2562d1690226e3bf3a8d4522a9a0b45d2688144b4d728693e7cb7024fc62d7425d104286aa322b63f09f990f09b89b4f95441f8153310ca7ed9409bc3df1d9302842048b64459a936225f55309ffb72456c5771dedd0e40db5e3876f9608d9e0eb8464375bf00f4e80ba60f3ac5b83403bd7019120b5ee58f93bcf1a275812e477f44a93df3074051f4759bcd5262fc4582d8966789c7f8382f64c6c5be936e1d6809d27f17170621476caf9a14235893df44489e1eb5ebceb232dac0183955634e49399183dc884de3c5aa19f74adb1f5ba49b01a494966f359f00e2f9807d7fe272d78ac605206e25b591addcc3274f8acdfcf767a131ffc5f83adf7939dc1ed73b74d4510db1a9cb4a02b98d2168aec22e88dd45d1aa3caa2fa53b642ca786ae7353241adec418a2bcbfaa3b33ac198edd8b0b8b59c29d0621ddecb39d053c686a501063bd4788cda399d934ede68b6ab93489795e2a0780d44e7e072736f07002848feffd5b1a7fbdb68d12afb97086fb3d6c944bfaea383383dc210717675b24a74564bbe8454583f54f9a554c409a1aa36c8ce03094fc1c857aa2a6af9dc90b0a5cc990d88e0ba6c12f63ec78c341ed3964cc4704863730b837fc855d4be60a8741220993211b2eb543ae23c7afddc11ffe5eae5b3d68ee9fa44c5493ce161d16d0947d1b21a21d1094bde44dcef8e457f804ef2f07c900b48fe2293690244222851727617e70541faecde58b5f019f73add4cf7c304303a3e17aeba958f523ace73f101a5528336daa7a147a4f4c015b338d0a6796c3b4bd212bfbd635d20bea507cc0d642d4d6bd8e92501595ba91317e47164b09d3106efc1b8222ddf7eb5995bf73a4ac15341b02cb4cc57f50991237fbe2964e14db6ac69cfd8095609078cd217f7dcaf9e76c67f90abca5bd8dbbe9e758a998382bb85e062bd19187c62a10a48a1efc03338784f1e362e49f82b1c354ce983dc0d07dceb0e8d536be482e1578db0015ba8f2b8a549e45954204bde368c7db772f9f5a363031ade172885737499cb374abc6947328f6cd61be6e131d060b4e439f237b362e50b6f6bb6a4ae040d83420db797d35144ef814ced8060527e66c93b0dcb79aaa08bd86f5d6f400f93b2f442dc5d82ca6e87e27cbb770d9abee5b67408c2c8dddb347f5d78799a40df7c3ad76f6a5c350d985694d46cdd03a44b76a30ecebb8ed5a3af1d59b402830a362a16c78cab21fb7e57e91d47d03ea81b766abb3c6936aa7463162f7c1f10a383bdb671ba261447dafd320637a52ed737fc53c88dcabfb4cd6d164c1677e0d8d4dbd4379be7c0cfc69260a4d7e9eb177c60216a03bf0da401c6cc5202d90bea56d93b7914c445287b3da835f02ca1f6d37f68d8558fc1e8c0e034a437448ad7884229ea26a9bae92a8392b0b7a6b1231b5dc2cb6e1eae6efbe8823d417a62cea702c04710e1a35fdc8d95315ec125573b55fd24d9820d64327ddfef56628a5479bd9966b1c315a7e1bb63b55e444bb4a875927b4cf727861c9d7f01bc0215f75db15271614322ea35697890324cb51b00dba670a8757bd3f95eb4f83740b98890b218c893f06805d494c810e032bdb244a26b538c24a8c98083af6a0db9f24ff5aa885222773ebfbdd63cd8b4abcf2087675ddd19fcc874197d1f010975e0b31edfd7ae56c1c3c38600cd5264be827537b575564f75a1192de990be3b60c55e2f5cb0f57bf911aba94626c36eeadadeb631c7302aa04874faf0c9d1ae1f7ca4da5103e206a87d9042badb4af50dde0a7531a41dc77f14001a4285faaf62a8602a2b5a4eadd19cfd70f5ecd5309a2db9ac1e98370209ed59e55dac6b533db205c590c1123de1e2a73248c208dea0d391aedafafd7dcbcd97a81e18d8a47b97718db9e5631440a564aafd5c8cc80ae8ee1ae6575cbacebfad5ad630c0a951766a2c44a31e73c13e0383248319301301974732affadb47377e0b43fd9e9c1eb764f8d8a24203f654c001130fc20facb31e7e10a70cb6c77f83c82424bf1025ba65de0dfea090e7988c4951fd60c0fcc576a93062ed3b8094145b7ff25e272478909aa66da418e93a9f12aef4d10e724bfc1fe3a4ce8009abb57cabeb20e3c787b0084dd05c41d062da36b0f343292c93ff8655477c264ddcc3425832607d8fae1c891a572c6a26efa9a480cb8bfb9559db9e6bdf1f619738e1e7ab04b5a6572bdccf0ca3e238ef51f718dcd56eb69e80e714d31c4f7be4fab07c0df0c07b23bbaf36469c5df7fc9cbb7310117582e8816f97de5f0a88adda3a62bba0a2cdf7c8f01c46c2eefec2ab96f8c2b1979a02bb8f604c4296b1bbeb36ae4f1057ff846f0d7ca2e6d9d4ed3ce9ce469af41c06d42c0ae5ce93e800bb7dc4ed72eaba037370c42c9f1ac65e72a6fba34729c9c44b82cc8e4b183daf853d154b6b3b457d5a2bbdd60e8a67c2154aea819aa38ae021188e7ca0668fa97468fc12a214c1140a01aa9f467bcf4111246c44c6db6172db8bd1b27dd3f11da931e1c0cfcd3e843818854f7ae9805d3be89f6689a86b8fca915cecaa675b36fe0390949d9ed43afdf5aa2c1a683894e2449c969a069e0c4647fa4cf6f95798d238d00e1efa5015610ea3369e4f0f58b91921b130a768d5e4aaec82e843304c113a79fc40e3bbd3e680e92750a709745f081cd64dd0671e6d70cfce3d6a94244a016486d7f3bdf0d85b422072b66832ad656f7abd540fa3b501def000f98eee254b30d47966abca162d5a3a9c5dde11fc658b28a0c51be31493d883b8d994510caab353d0fe21dd82e83ab6c81a11a89031644ae20a766d4fb51e57b564579379cde9680317e243ddd85711d9a904c732c9ea8477a1c54c6b1a151755fe8d37aa661da8aca6592e1d1ac448bdba738cd0ef3dbed8337f277ed09c89e7439d879bba62c2bd994f60cf00fe8d01fc3d87e3c228d4fe328e02b6ef4b96683dadf30a545d7a889df60ea4dcd818e693f2dd4b826061dd45d3ddb1e551d508482bddbc22a207ed39f17baba4af6c035717782f5a4bcba5c6bcb56543259374598f9b1d28c4cc561c2ad6ba41f5f63c5ae5b394a3ddc182a789b3b43e70a62e8a2856f74aacb8de6869206b35703ea3d24b59ea70704850614686dd855c2ae0b69a578dd747362ccc236ab857a627d6743df66f6dbc070483f093dc82fc1c34bc81f56f7449c07e3f34dd1f68abf7f72c3d2123cc07781f694f97d53422289d4f259407994ade614f39904085f2a32c7c4fcc186ad1318bbaf7e916d51c3590e2521f1227a939bc5781761f02b49684e57be42e21aa6575c86745ef2ddde0769b52dcc183e08681078fff1ae08ebb94b0bb010c051e4959fc671c337703de071fcb19e23eb63a50f653abeccd887d373ca6aeb40612e9d7a90a8772c755053b9286bb49b8abd8bec74b49d94069062e9d07a3581be8a019cb0b9298040b02df77ce92b35b851c0034af25b314c16c5a4a72cbaf20b1070bffce5c9d5cc7ea107d5c2bdda05d315970c8c4250341c53a44cbddb7a41aca8c528d0ae22a99972018a0bb506e06023d1f99a70dfeda5d2cc1e4491083cc644a6724e1038b62b75e32c32518efb32e13c6e50ac6e8cd2f32cf28aee7efcb26b10fb5e2bae8e1ebf956404a7601fff360aede85d88b13915dfcc32c9073fdc05d93ef9df8324dabb4c73265f8e16580c8b3fa644155327db1e609428f2ad9ff05840ca0b62856aeba909b0d9c7e7f2d98469ebc7c6b4519415d7317f96f1ec583724dbaf4ed7c6fc540fbf996e37cef5c9a5574d2be79bcc824c3ba463dee486f9ee3dc7d14fcd2e683003c6e49aac1b43165245e6611c55d26f0a7086978c25be2ac1167cf2e64338bf0aeece063ccdad0502238f0f650195b72f0cc1c09b8e690e357a5103aafe6221a3eb6bbbbf28dae90207f2660f9e0b0ded2ee0681e930be8e78d60594e073d7dfc67da16791dc3e7042159863d708e22d3ebb1b12cee32387c89a6d0ee08e7b6a490aecfa2500b945fb119bac6e85249f349c06292eb0b56e5aba8055f9bfa327f2e8883a1fd59804244237efe87f7f981dfc35b19eaccaa5062850fcfac1d177166851d4748d4d2d5a369b2508c9c05db5e05d1f9d01583a4e4430e1ce5756887d65ecae68d37892fb7b641567ae99c41ea2f4982d65373ee94a1fa1cb7a717f927c950e9eb9bc54a162370efe6c30b61bb3387615a2cbdef7a9e304be0e96e724ac7c11ad13cf2ae49a52abeda8aba317e2a264b6245e65b513894a83fc7ae2fb216429bb17a3aec465611522b14681fcd5440632ffebb470424374289e4461886713484cbb9360c7db29fc94ae991dd194945d9f00181bf6878faeeca98e7d671e8894859ef374c9be2d7a862b8e8637c062cc54462923f350e680530f84a9cf44f4ca6ae65a742fdab4c367fca31cb01a3c6eb34dbd0ebe36a5b6cb0b568f42582a9ac65597aeb91806fd6a5febaa4867e6d1eee05eecef98b444a60fc2b4348aee481d4effb6a2869ef8735beabd605906276f1edfcf8f80281048590d17c04c1dc16fd1b44f41db4d3430958121cfb09679e875dd05ea088d6c0ecddf370f708b8af3171ac9faa038d8f602986185bced1d849bcb1466eecf22b27f9d87378c9fdf4a22676cab4a3c8899acf2c1359d5e877b6ba6e50c89840895235dee40dd2943447d8032d281514cf579acb549e75c63a58023c83deef52ada7062c7768089c916c9f8f3e663cb0e029b16fb95bfc80c5de25b8c50c22ca98f3000fc72d84e73c72c02337a38146fe7caed2af82d39aee6078c42ece4d6b107ec5ec7cf01eecebe18ac5e2173eb468b2184d9b22d6c0d902f31a7ca10a880f22b8b9a7ea52a6a341fdeda4c3d7f6f51eb2d9b7fedb1a03ddadeaf9cf9ed75f23dd7935c754b23b9485076436cfdbc65f32ad0505d6ce3f475c31dc59d529e57cb3e347c6ef54ace3cb8c7e793462bfd69e970be163a3d143f75eec9b91ea3669d5c5da67ffe088212df2d3ab8dcdfc0d588a3114b89cc44052241f8e85a66b4a32d36ddf30d554cea95b7a0beb41fbc76edd781d68e84fcb15010a6c5010529089c6de6d4b564c2756dfd2009e44e45fcb01b880a4198aef1752e6f5d3f201943bc81ffbdb4cb6cefda56ac45641b50fcadf15f0309e4e68f17e1b6f6345de8a1fb484ab1ff639567b001ad733af2c630ea352cc99cdde4eef2d40fbcd09fc2b0bb1b26a0e194f625adae1174cf982e3c51073efe0f34e847c7cbe680e09a3418374c2c0dd8e7791edb0a0d962e5503be6168ac00f9b245cd75ea3e4ce09037a2004ebaaa03eb217267f58930127080b5beef9f43db01a6c3f75afc70294c3de8924d463f6de6d359467ed20562d7602b703949dabdbaaed300fc80afdd069e69041af380b2258bff7da229d1b8655e39afbe525da6f107451988c31091685ff8935b754154701240d5186a9961d4827184542536f1d6f8fb896a0b4d676d5d466673f28043e7e353bd7a730cf8d8e85321d7b5d4ed8f35fd8d064c75471c1dcd1b47a86af566714297e11a2d1588a7f586d9a5f846e48f991c4c90d025ace1ef9c98f7b9276785afde4d1651890fdcdccf51994eebf35bb5cd80e221a49e73bac75b894463963e867c68afe1fed99cd222706a40688356134e6da0e0577077c1d88cb2d9e7b6b7045f7ffecc69938dc6a6c02f653ae9ccd79d52d86d993f23f1b931c902016811b1df49a3b22a370e9e0ce7c2d8f745dfbe46b0c72e97994e7748beb0094e1be84169530b99cb6df6f630c088010b016b66b9f04330dc8b4829411ba21d14d3b835c7615abd1a0bd1d58eb918bdde06962a0fe9bbe6a30927129d4833179a983362faeac82e8819e6e207084cf88dabe8906019c060844c905222481a67068eb9dff0990faa7f4c4b3aab7662519ff2e1d9036182376a645dd5ba95d2e2d30920020d7e7646859e2ccad843251ee26a81b17850e18e8bda7e9add955ee92c51d01aea10225041854a48227bbf38c3289510b0ff93b1341c829dad0b309f8c0fea554a5120b32284a0a31cc2936e0d01135c70b4a67ee68ddde0f6ef744ea749891cb459f5a3369c3e60bf2b9d9959130b9d09615358bb1421e19001925580bf52b486e79c263ae8ebc76887ab0c3bb08d2c08d3a043cdf29a079a529bb5b8611328626958c3bae8ad92d73d2c882d65be0412171b5bf818a5663cbe94ace6cc9f8789e8145ceacceb79aac221106bfae7f526a9d4073456d46309ed61870f843026d971ef04386533f49b49d24a7b839c233b357e6e1047092174e3510aa9e1a3bb6897d2c72b39fa371b85cb8a45e994f4e62a4bc23e47466e98290e8c78704dcb37a5a8ed425bdd0b69514792807eef7a194d66999207d4f2bd5d607d8be99860b0ab4f747ce1e85f5226d1ac239f6819681650f54eb304b4ff8fdcb38e019ae43f42f3dcc4243745535e188c6c5952eadc18529d2d65a1cf1ed5db807f0d3d6aba12d6c45b095e9d332ac3f728e08694843d25579f57611240131dfe9307804bffccb59b6e53240c0299e6971415ffc1f1dc4a981fcbd95b0863cab56ed975d271d3a9c6044a4fec65039a805c7bdbfffd8e6b1aa1c74dd07fe373768074c538946e2fe155e3a9bf8d2df6435e9ba152fc5723a1900a06943af107b847bf68f67920ff828abe8945b67ecc3bb594cb19ae1508541f0ce8badccf1b4548ff98b4d9e82cf62394651db77792a2ed3f9a79b770ed81b4935072647bf5b7041b33a1dce7aa22581adc29a7841bef98446d9c6b32999401d6af4eb830d502b77808e5d1bd881cf3362e403462062c02c9b75d54c0279f6e4f19a533fa33129b42298bd3185d620453bb76bc8c36698649c162af9363635638973da06a97c8859504ba1c2be21f7a92b3daf2a7311d2eeae8fba52c16dd65ea294c53be95ef2580a0f2a8ed1c80cdd037570263dd4051a84eafa75d53cfe3eb861765913620bf9967e8a4f429bd23c9ae9cd8d8a889cf10de14bea81fe0f9ea0393e5455362ed8f16b0c636521c849b4b1b14a5610489b9bffec87a0390a90d7079c23be9daa812f9dcb7a7a46f5f76a2d37a33115de1e1c3f857701ac78d1a652d5ee17b04543a957abd8c1336728dbcd99797e49fb9dbc97f6bea80244ab4886738082b6a303c34794b7f95b0574d8b4e05a2385e14dd3141f826df2c53700e53aee4fd7bc430498aae66c5a1cc3f6ddc0730852063e4d288b37cb4f258d90b6810015e04c3f3e0b6f5ff61bf19bc79c8882a1dd0bb1fa2ce83165761398ed02fadd4b50c5b36e9e8520e6905afb9144dc7f2980c0e84d0493385ddee91e679699061f9aa4afe9746c76e1e1d8576c10aa851d68378d9774372fe10700f5ae1215cf13ccc32bc47cf725841936cd176d598c27471743e47e42fc72fa4f975edf84f3ade33981ed018868ce41fc4690a27391f31e2c442d77c1a90ce068f6c0c2ec9c8e83900a10b9c12eaada30035071ac1567dced04bafb727b7ddafa572ce124a57d799feec60d646db5cceddfb4d7129e771ab43076e874e047625628ce6b8456f3fa4ac617941630d97d5fc6525af55004518ec689e64f3b15ddb4cbbb6f38fe0de9a6c78e0b4708780c8e72269cd88e7b9f6a51bcef41e44963c395183b3fa41a85c4ca4cb9ecac4c4f4de9e5bc339ef66b54017f30c40d485fc2864ecf82142095b608221ebec7a7e88d1f032f100946af722477d539c3564cd648946b3902f14218fb0896c35a831db0232d1d4324c8f2d19ac6f7ce74054f4d0ab8cf0d1d910fc65e19a84ee3568e4d28d6613e4feabb8e4e94b4ab0b90b1f3331610f16147183f0ef5671baac4d3a95e5d8e2a3b5b276054c1f66b5b9c82c8f7e67680cdc151a43356614e0ad2ece02d970b9c46536cf390f5bf2e611ee31fe7df33ae36cc5b28241dcd7615cd58327a2f22850c441defcd6235a3f40382fc22479a6fc066564e9243025500e67256c38b6204e776c7580e455b0d1ce8564a30d3c23457fdb4c1aeeef01913e361e532d3fe391998d3876cba8dda172a215f0bc489c2c5072fe09778a591b08431e8572eab5012aaa39226e132cb878ad8ef1d5821aa027b853a7746ab5dabf4fe5eb30ba8cc8f14ceb578a7afb63ee9ee6db754206040eb304e2cdd4f0ed553b8af5a9ab85aefcd42b491f72bc42a00a657fd2dbca5105b1fa3f81e5e4a8baa0d990d89d1ee116d61a5a1c75b1b273fc87b2088cfb0d9902f5d8780b6c8a9d54dcdf080d074f671df2855c0eaacdd233257a0a7705cfaf04656638691c5cb74afc1f8b711269dbed566a8222faca16defbc3e44ff2efde7c0bd5809bfe6804f7c03d5bebead2eb1344886812f11c08a975168005b463c270da92d4956f960f2aea7e4fac2243aacfab339db96eaa421ce5614cd4dd96f7884ccb1f717d15771efa6f8874b170715fed8d0182db3a28330416d3b1a19d63419a1bd721d9753502bf967ded7d9156a81b05b6ab2c6b921b0eecc1b90e949a0c450aac07ae599e080976eceb889d495fa15bb6425cd30633d70893bbe4b99b817ea9e86dd3169c7242e14c2a87e7130ec0cc42d21b337845989fff2f81a2b3d1519f236f0c84d8938fd9e314de876d1107cf0fd30eaebbbd19a27d47fb1cb11cbb378e6261fd9d80319201bdff5ddb4d2b537a076d40d4567ec7ea5205812bac5b6db194c00c9bf9cba5a0e98097b0988e537d88e4e17b37390aab8c0235959e39e287a4a3f6e3c481b068c0a92d1f553847e721590023614e84e58c66fee89124fae814bebb694a5dfc435c3a0c2576ad774af332a8105edd7a1404913580710a9f02420515061e8bd96878f8d522c83eb6bb70c98399274230ba382535a342117a0da96b7a9aa6454686a765d2b0ac749ca6a3d293ddbb4c674ef0b924bbaa133917a05ddc96101c5d62cdfafd0c0af6603900a11ffba92f94edf06035abe649692c3127ce214ab255e423a6ff310542159d4dc855550635b178daa2001ddb80ac2a48057b884b1bd50519bd2df3a6e2c4b2a7db56e4a8b3ecaefbe1c858843bab6dddf23d554ed8e4aca064be459edce80c2aac0b1b8f67d802afe612ee35d34c62438674f3dd1e7d12cc9c5b73e4ccebe21f2d74408100f2a972e8fa60f23596e242d3dd51571a5447a9055b7392c212d8af16cf4db5c996101c9f443166bbbe4ad80c09c7e8b83eb366aaa6be0b351f2be6e6488d0c5d571217f1ff97a9315376302231a8df2fb2ffe32afb31cb10f51d64d44d9dde91a04683f2944cdfc671c4f3c38701a23c844006e54857531d6c6f32a00852b09a8392b6323c6ef0a0b77c00d18f1ba73f0aaf924638716277eae6563268fca6539468b14174ee941cad038ca61f05558a3948211ee559a37df7b19c1f5678efbce1b94069d792b86b145fa91a583eb4a91c25a90286fb1d6e9fb106ed1ed0778077798fa5f1a31f51b3adeff7b4e2bd09bac3cd3c715dab341efb2e04a9da1849744125e354b43511d38273e74793ba9913f7a5ff6de55788a67665c54f0a1cd96fbd48c652e0965c95bfb35354c3ec49c1263bd68bc2fb8c1834be105be4570d3f9aa6b61143e7ac7b9e9901aa70aa472a98a7b53a138ac5a6fbae4f18d3c33989ad1d2d8e75f9e92c2527143aa781a7502913500cdc64402e276b5e52766386735b9888c167caff804e045257f83a5acd524233cdbf84b9145b75e0bb1c0d60cf0e332893efa4bef5daf225b2d14a1aa242be0ef84c5a827215e4ee477e58009be408d435e792a5c455e7634239d9c83a8766b1dd905d79aaf96a9648c8158f2b12f668e2513508aeef2dbd4d8f6bf6de5f21eac5d2aca3b805575697c266fb9b68c69e0c17e56a030fc54dc7c9e5d9c720451fd063c213b4ea6bb8fe65446e799e00478065f13f158237c6680de7d0f27b2fd1d3531af47c506019bdbeeeaa4bc056d7a0b832cb90d30e00c583ca396acc69a58d1e0c070ae3c39f21f73781795a2608cbdd1ee509bea3179a940fbfb550d4bb10af4aaf4aed728dac2a41721ae1b33c4c7702be82cee09c1df290d090d114707a795a8826012ea1622168da749106fd4bddb8fbc04928851ac3e7ce949a03fc9c526c00f220a2860ceee336198a30ade35e9fb19a621b900601997a50dcc8676d14941130f2d87d1a44a8d032d2b631ec4f78dde2cb29078f5198e92041b26bf982ebacff8e27636d93c14a5ddbd05ecd8010e1e548442d447157c8e25fa1c17fa7c91a1cd4d97f06508b3a894624e057e3e57de34445a2b09f8626a40e43718528677852c8cd30955ac1679b18fffccbd7dc8a4d0caf1371652041b5de61c861662761aa8881bb96e5baa2687d4f3db936c663c956ac2b4d6951a049518cbae72400f2743c137b9ed12b5e7f297d9d50709262928f971db66d9f9cceb1922f7013b0418bfe097cc98f8b0a287d0831b789abe73f42651f43445970de3c7b3af5dd6cfb64c19a958c6bb92adfd2c7d97d672f5cdfd489d5a86f78a331a6e378acfae055c78f5a571bfe67a6152b1e7be4890f8a5bd8eb59efef249c6fa81a36db81997e83671bcb4777d777aa2d428ceb4aeb03710991c226315f4a37c312e3235782b0a2f1b1d448545c8902f77aeb76bd3e18c90cda2e1cf61f180e16c0a885b45c5a2c3013dc8901b74a0232bf8dd11352215eabc54088de9aa5ff7568443cfa90586490892a0dce1b775856b90d0a23b18222448d4987be1058583b53978e8786df4a408ef717aee21ac08454b73fd547c7822f7e1dfbe258727c62a14182929f80e97577687d44eb1251a7767505a9cb72153807bbe0928a0e10573c01fe1683e6efa5cfc64f34c5365fa344e4e93f2cab460a94f4bc66cc9646cf32447e02b9eb0219de436eee9b719816c58a14002b3bf40d9992322dd4753b3f11b61a6a379ff58ee7fbde334d8a98499d3341065ba7c634bc9831c85daa5f269cc84a1c2b14cef44542e4f154d69a22e3bc42f3287acb2ed62a78e3a14505ac04e1f9c844ef5da4cecc000c9b5dbe3bac466159de365c295cf7f51a2aecd4c87c12f1fc557dc57d39e7571110ac7ff529650e377f57c199d295cbcb617bb4edcec3ea74e9bd7280a6650f5a780704f6ac4c13f8b497e2d33844c7a3e315b164030691bc1ab5e8f412e6315eae172e654ced06aeb4751bde33010a7e1413a861acf504c499402bd5164d83b9fc8b4c968e153404e79a6d546d81951d91e3799a02e390df64ac9974b7004728d68f8c46b7bfa6f4f5a12e580430cb418b21bf8b18566babd6c433ed6e14c911bfba9ac08e36428c8107278efb910c8a5fe84e0bd27b698a147d9fa25a2b265f5d28323715b6bfd348872149d88159df558579fa838331fb4eb28455b6b7f697064dc505e18f30c666fd37e5877db03759537bb990a49a9ab3379fe5d9efabd27b2947bbaa16e09e37636a3868c128dfc4add1b96074c222063be5087fb6022b6e216ce5c81cb6e8267090dcdaeab8677e5df1c07ae504fc04ee18adc75e14dad1227b3534f51c9a4e10efd9925d0d3520a304557dcc6b89920cf787af4199c243050ebfbbdd9406920b52b9db4995c7a07a41e018aa1bc065bbd0156c33a7ca48d1c2de9ca62fe394f39e857546f882f5d5742cc94a8c8b947d2490bc45831b47ed5134b1b4fb2ea73a048e67ea69cb452667553ef6a268f932a4aa1ed2a38599101b4a374ff4830ac586ae3c523cabd48e5774d51db16588b2479482fee3d12a7bedc74c9f78d3026bf32e2cc4f0ec2a52908c7c2c289d8002a74d9f08484f42cdee9a14d942635c22c0a9606b2d54673541ca85f65b7ed7ce079a119ec9b07106978dd1d64c504b5dd4e8a61204eb2b7418dcf889f8983dacad280f9a11e50e03130272b187da6c45584dacebc311103787c5f627d8da226dd806990494fabe403d366a7f75326387f77fe3bf33dc962f253b051a0481c06e60e61c00585d145ad681b4a3f9e71722cc79eca768494a2e317feb8f09bdc15213659cdbc918aa139c60c9413e8d299f8ceb3332143b3df168cd88d81b631b9118e2cfad8e9aa092eabc0659990572474b3b367a2170142503d322be60f01cfc02a2cb7ee78b62095f79e6b1777a44a1cde41da2525dde837b8d0fd0bad73ba8db9e4c150f39e83cfd974efffdb8ac303b48b371bb0e4e23696f120c95d2459504eb25b4784f3a62f74f7ec747a9b6654a949208c5f0bc5ec05d5d0d9c61564a52c64fa16f0f4c9558b85db6801d34113989fc083908592c42c604a8cf4df915069ca1c9c1c0df9eb3027403f969ce79b7b5ee87781a6274c7ff2b384f8af421c481f62c83899073e77cd5a275af49cf6e5baa2b89287c8d1308046abb1b023392a587b17905ceec0e9e51fb4bfffcc5eb39b539863498c2f6b9ca555cc4119aeee41fb7f996553c3f7f1b63b81f689c2d340bcc43f92950dba12e690abfb8f348e185314015c22893990e168f8d3be8d3586a0ee3aa8912c8d2c342666979c79963039667382bba898bb4a71f3e79e06c514abc2b0444af248421974d8c9dd34927c84ee271a431c821809cbb25869ecd67b2343694c61515259c0075440bf03009a4463a925cb48915ab633236946f55cedd486a4301122bf68d267dd713d08708c69c4400d404454edd6e83f34ee88e2e9b1fcbca02a91b19141077d9211106007cd732a12bef4b49c485073dfbb0676190e0a26e387476738dd67131b5cabc2ee06cb7eb19c8fdee33cc48da53cad30b5686b32c3e0b5faf34d36b415052bcc72158e59bfa8bd912023a82a4b7a6751c373865631c0b330ca1ebb826c86c413fa8b757b4426327ebdd797f0d90ee7d08b9e6040b295386f18012a550de8bb9832978e836e6a6ff0a607c8ba340aaaedde8410cae6f8fcce182054c0dcf22fe45e5858e6519e908a7ea4b4271e13eee4dca3a1aa6b43688f70704763eb06ec663dc9cffa6fc8bcee2d16342d393f451bfa96de504f41451934759097bcc0985e7bf5c1fbba3e29721e0bee64cd5089690ce2887b6a3a05ad7b521c3059e9117ee0946ef311cefb8fc641c81d058df1500e64962234b6e64c9bb712ed68236d98b09e9d738d289f46b78db3bbce7c6be4b500881b83d397062dbaa0e8d0bee4ab892da2c5c37f4102f67c99b3c28d4afa41a3abfa00f403ac24fc668737eb7349976132a71383ff33487a2735182ba66680e4620c9c7eef56621b25f2d1aca9bbfd0c584b52f1a658e21f22ed4909d49c30f0c5f7b33539834c5be425ecf365b1ef44019a7a6c9f23e02d63ed21dc51f6d58665e54eaaace0fe16bd50dd8591ad490da203c960979442233be434b6c271f518f920b8cafc5e19f937f08fd7fc0d3540bdea83886794fedab3add70636a3a3da925be7ee86597e9185327bacaba7572b048c7cb11e9756e92cc90cc48a00f65df34c2f390b2033b36862fdf72a0650b2eb8d3710d43b2e99b1a6df9c7c47cb0dc7de2e9c6dd851e0dd39d8307b0e3365ad5980aebc2baa21aa31ff666397209cb95bce171ad30cb49c3868f79c1bc59a7dd751e2f9b440e293aa54cdb0282c496c55902147c9893acb8dcb9f95d6385b580b68a1083e56e136fead959e2a522fd22ee4e6bc5da32c42d2c439191c9a0c74fc733110d01fd66d20183904a08e1875eadc7f3e33fc6ab2a3c3402d4bc00739df899cb208b8c2615763557fdf9d241a59941710e70e257098a2618a9238b5b6c1021eeef8a789357b9489328051323854bf74916822907d891a5d174fa0f55d9e61ed7701ac5fe88519efff8b55334954674f874313c379cfcc5c9a3ef798d505d47ab020ddd61580dba89bc4975d3d050528cff3682094bf88fde90c82cdc613e46bb97cc340ceddbf07e60759bd5176e77a2ce879f21a99fb8f1b7505b79b62b9766cdb042bc92d7237d2712f0f9a722c2034408bbdccdffb15870ee6186c0ca77cf02a99337f315ddcf6c91992cdbfe315c60085425a796b807972c1f4576c3b4e63a342ab922813693a15ac99954edbcb6d3f3b57ea5316157821f67da91dce433ea968989336835d619a6a939104a5fa7f7c4cdc8a0c7e5b64d596c2f25dd25c1baae3183f7d8b2307730c62c8f849099859c8559fe0b0c489cd8bb6441d2a2b033200ecc31974d2293aab3e628c0e6f20f324d2d35303d7cf00e6e94086084eed3c00cafb7c877438e11e1016518d190e40d947978ee692f70c698d63b2b5601eed9b2b5b080ac19623ff74bd37b8f80b77bc332ca8a9e367f54d63a8769d2f997d39cc08bfc58da94d0c57a9b082c3afb4e18581f5a539fe08b3e310632e1ee9a486fdca4e857cc7a82722c21e4adeebc1d8ec6af43b65b5d9baec26437ebddbed08d1df78945a8efc3f1d8a82281532ff7ca0c5922f94aeaee21394d1d32eb63088f64c74db0b4363af50be3647978183ed9851b6531d2c3b3fe3a135780123aec185233f28c1a49413d3fdc8818f5109facd54afe991afda877f1cec5f9ca02ba99ddb20516fde0da475e697afb2d793ca9136683a4d91399593e50808d2e038108ddb9437ac47e0f9c5f150734dbf103d88a401bd07e54a7f6f85cb4d5be4b35c5d5fcddd1c73d203f078bca5c9567329c6529d15ee4fceb60cdcced35d6e47788a43b2d10ed43a51ab0a039c63886f295420ec5c10298c34174165c955a64e70bd7b370ad5ab31185e06380be19e64106934f7a8bc186635dcd33fe597d9881dbe6988485aa8f22a3425c5e8dda0a1fa3bb4c226509a6bc08b53cd21912685bb64e90385a66fc003232a4e20da9efba29bb7cd2d7243b26933abe948d9873324eb730e52f65f797147519ce75fba31a375c8c8b1dc3dd0bab5a0e634d4b726f41d30926f69d0483c22399e9e3cc25e0dc5cc38a06289eef47437a8cf212961b449539855eb0c29d58a37d574eb8a40011e9d4c52d2857328c0ebc6146505c6d73c75df2736c7039141f5816f6ec774aff513906182d18287f078fee664e6b72baaefc8bea81c3bdadeee73c348930cffd9a54e183712551e14611de9091e408627d8789b45afd34bf6af01a36eaa44873d6cb1e22a37a37d391a95512736d7b1f217a0931f709b665ddf0317af885cff74733383194b1ae3eec6b0af4594d93961898f0a3a438efccc703092f9e420916f8111d63b50081aa9bd9233f3cd0636542575856b50549d7ab28fbe873cf0f26d330ba7a6f52ea1a871ada6111289b9be74c0a9d19dc22ad6a459109726d5f16dd05bbe8610048624b4e4733831c5a553f748d8ab40ec915a617483dab7a07e1ff2a961c4783ac6909a3bf3ad7b6a3ebb62491ffed5265bcbaf59945eb405101f11eb179ee9dc104682923f43e9446c6f826086125958f7fd69b1a87a6c4e40dd31968b122c964c58e3a8d86876af72ebec700e5293b1ed7191fd71edac9f3fd3be1c6fa862eb8760f68cf7c4a62155bc2a47bb9b3e6f4b89dc4fe045097acf766dc6a1a787e8ee7d1c4bf442ce4795319c9939774d321d3308c1ba12197c8a32063c0c8c169544591c4c5493ab62e13187c80a2a35cd968e4ad1ec8777cfe32cd8816a59a8991053b67ec6330e4fd40e9fdf34aa3a162d5133fa4bc87d14ee5339251f479d06925177c1d64c7003f8fe0f3d1575966011945f2160a8631d6e961b683f6b81336b13dc3866c874704551211aa60bffec5acf90692bcf8a182b472c34f9f88289a0a0ceacf11f04d707d7515a5fb759fec57b7f173724136c6b6590beed8d3f86dafde7bfffbb4711f1370cde3f7f71855dbddae17b8b8129717c641942eb2b7871c5e99754b820969fb5162380681d62127b85153119766a531e9c8cc934d0aa698ce3a8dbd2a86baa24b451b056af199219426f45758d1cd99d872cc18decb1c23c30587eebf452a5c19842471104078a5a9f91f6cca57d63dae7b701f352b93eeb24567aed078f1fc057310de6d05b7828965726baf320d1bd980429c2d2ad1f7a6acce81cd3ab5374a193b7aaa507f83b5c13d847c8e316764abba7a30c580729b698f43f4982e845e45b833fad16beb3abe79a1f9b5a0168dd171976672f0581405e614aa3031ed1170f9c957188db4dc0a78d482bc5d341350ee8b095c3487c3a402481444b8168bec68552756b60c351df7d61437cc01aa373bb9dc4bcce467afebc53f2fc16258889177182f2aeae0d14a01ab723da19e4b20a4ca58109be26f9656f57d41328a359bdcddf9c3668ea283b2a24c1a66d0501a958603a91f647fffa510740591ceb95cff56d6107f816ac5a5a88d51298561e1507bc90bf7a46ee12814e8cf5786d45f71dc82a7708028c2c1a81501b2e807037c0cd12740e269696f1307bcbf282467ca0fed66338143545b1705ceea0e635c8a3258e6a483968a14b6d5f367caf54c5cb25d51a29dd07b17f09fbfe81af3bd7f25b139915b8a280efa6e8445dff090771309102abff29c6bfb048edbcfa2a4384b851894b59ccf093f70eae18f20412b6faac1272a3ebf8223b4a7a6e5e411e45cfdc64d2e040eef3b164dbd8ebf627e3931a811f77d4f94f7ec19369db682bf11d6f9878faac29c3d6a4f9b282084bae21005bb668faa225a657e36cdc3af4e65cf6bf127f6c27545cb4ff0be0ef37d415aed5126f67353b55d6cc48dbd10ec58c7cd85f1cac21b9650329d5068ea608905a7d266db6015aff471dc85632ca069eefd15035f27e496bd544d6a21319dca32f121446bcd89a92ed8e6b5301da35a848d8846367ef2ff4b305e44ef6fd34a97331456e9e93b2311fe373989e4823b1bc14a81df7ee9fbcad3b1ec475fed74fe51b447e1f4f8098d28d8eb3acf64d85d3e2064ac01bb8a016b31fd65766410a97c6c89a13a3dfe003c46624e3dc89dc2d5215ffdf181649d8f26caca54fe5adb28880c58f48b5a1b5df96582003309344c776aca5cf791c5cae7e10528cb9654e36ce331349d1a29ee30f88bd8e5f4fb6214c83381df2a6528217f2b010c0476381deaad983ee842c45123def7e53d56c46bf4e41565fd5f2f1378161b36b087cddd5a6b09863b8ab32770c23a75562801d3dcd3b792b3dc33eb21d626a553465509cec1fb74b26d664555ce9e966073db1b9ea46a84a9adb61f8907fa763bd3c25966ce40e4308f9cb271f192049a43de8bad3492cfdd87f0fa102bc29af3621bae354aafd3be8de42d9141b07776548e8295df62f655e0d17e6b87e67ca7aeb99f91ea7f4718c9e812e136e8dc300f4bf4268c165746d93289e79d92e5866919b0e0cdcb6c88df8b65c00c62f201ab595921e3a03cb820b59a2db3e0362bc90f77c4aa9a590d714badf9862a63f646bfaea56b8a0a1fcf1c1a1c375d26efecf8a999aa1f78636ee210e41e6098b0901cfa1b1ad3de4639c6647496e5d37fcce5aeab28bac57f6aacbcf1fa06f692bfb9246723a075a50497eb9bd559013c3e43402c782d9c88538e0dade870f106cec691fa8c78f0094edf82d37057ca0f61ec1379276088cd341464d72ab915c3c7d3d7b31652bacac0c8423965952564aff0c95c50140140b4576c3b0cb27988b8a48e0ba956e1e238764d88e3a18934b72303af075437c272f88cf07e56b9e276da474f1efbf5b7826b621121af5767a85620491802b771b4c7cce1f1914b512ae20079be51428c4771a308bc26ef874b0fedd2e4e13a020d31243bc3835a2000511b72eac9acaeb0e8263d993f707bbe8a155207144193b58828b6c2a2c3e99f5283965ff46e1724fde27f3eff3b2c55311877284ce2910f305c0f9340750366ef148c09d5de8820d8cd599b1f7ba39170cd4f5c1466f3d0bad2500d4401ef36eb3c6c7cc0f0cd8ed6cb6369b60079c7a397fc2d78ee47977d09802a4d3b40246eecbb4b8291707e8eb772d24927b40ed908034a166ebc7ade45755bced24e09e232f97a68e6469ccd4b1d56372d86b975ade940469ddcbc7566ff63e964c6474a43faaff93aba1e8e78f8b9fa6402b6cc166a9806abd61ffc98198a7af5401fd3926b5a159b365830739235569fbac2dbd4493a48ff4f17c66ac9d5e50840687cb2466c5c4c530fd6c693ed80465e041f1e883b51666fcde50f7863ce09fca4463b578fb9bb148fe6612424e026c3a67f53bcf5450aa279f625c380881f6528d42b77e698eed063c3661ab7ca424ac6cc2aaf6df4919dc1c24bc6ccfb9480ae28829f7d80ceb643ad3ec43d82621952502b081e6de51a97096d707c1df978019f323f044972c19ce9331d7e70c0f7b5e677ac6dde044dd0ce2a46e07abbc101fc82fe19786e85aea7cc5f184f4207bf05835cc8c50978986057b90eef16bdb9871d06b829ce86bfe0902bb9ca487adf4f0575dd262451e7b3ee532a229b41aced88319a274c673bd43e89f6ec18adc64b0418773f2ee92651d413d342baa1ec9cb9a09f3159bdc8adf2977a3883cd0f4eb691b3fce79b716ff2749130b4616a238458c4eb30f55566ed294067365cb896b6b531e500b7c3a5467bd9f8e96c40786fc305c9b165ed10e98d199aaf0dd412bf6bda2285478dabf7c70c6939eba14900df3ecf402a7d2325a2c51a7de84ef2b38ea3899f4d97d2cce1ae3b9aafb131e2d752a8795c0444b46a9d786115671b73ddb2cf847c5d9f6da6fbf222a3143de39ce2db9246c7d87b327cda384887abe2749121b94d818e7deada3affdbcc0975670a60c734c832fe1dff457986ab6c3f6cbd98b40286c57d3c0d0b0ac49eac160bdfb4b1ba8c58d92701ff961e52490d09ebc78cc7d70e2c12249c571c39e1da583b767a01fd2592347d39e84e8a4cbc99bc7cefadb0885d000635d0aa715f6c26a3b182f74b495bbc4f5861900071b53e49e22a64ed69f1a65ce1d442504b7df62e1ff7c488770b3e303c78d445668de16097933f547a7aca1de8a604c7012c46839e4ebb65f55611ad843ca03359cf6ec2dfdfd2fcdf383377682702e605cbbb093ab02b3ea967470e92e7357303210c3755ed2d4123cf75eed71a9e134127d07cf449d8d584699cb6872c91fc025ebf439c1369378e9f2a3eed1d6b90958a6025ecd4ce3ba2e8e3f4b0596b6839bb485f8f8c94d529551d64a90bf67f03223d30bc3a0e5b753bca5c41b44e1ece6adb1acc97cd3e8c3e0b826134dbc99c66a5b5e4c89dbc3cc98e3360a744ecfdf955480cb5e1e64e53f26b333dc573ef993d522509742d924f8fde9575a9d73c336a48d9b7b90f089f410611c9437729b066937871d6e1b47e28919cf8ec7e328dea369c6b69e9aec3f01c4cc3ab9f19ed59789b26c4d40d983418873c50660d030103d8096713646dce48fc353d7afd48067a51add10f8d92047323e34e5d44ee863f20b83cd8cc2313b0fb9b26842484c18f81159ecc36c20b4d78f623da4498f751e379635b085c80cde34ed9b1e2445f1211f46ef9257f2829edefb9ad9e0483a8a498eabec835bc85ddc5e147d9349c6f9f20ff734e8ddfd21ee8c7c3c6691b150cc3fc8e040650ac277eabeca3d8e7523763736c6bfa274cefb7382534af9f24691fe00c3df3949d5c39edf961ce446ea198b2541738634065fb6ed8a9d6aaf50900a50765f9f621e078077ce22b0ae02a964945b54e391359c75c65bbe5f03da43b63d092a9d7a58d04da5a80de22771e673f75ad53d92e5aa3e41e2d0a3be46b3a48fe819002652dd2d7a622fcb14d3a933d0b5fcaad812e9e499db092d2f2b6717d23a17d0914d1fa71d5e29954c00a179bf032db525131547fc533f111247a016a7f9f267ce99b133dd84e0e6995b8249a7dab4993b28ba3d76cd9b1e53ef5edfa6ee9810b6b301b899db92c2eb04c97f5b1fa70b6347cda33eb8f9ae30c763f6734d15651d359dc62e87683340a5670bd90bf6c0441aaa759a444376d5d79e7b699d352b524df6ac4b167d0b8fe34edf752dfb67994b91adf755ea52a8af3ba87e4af0a63f0bdf50a38396bac28d8076d67f2be0dde2cc82b697154f79da1cb2e704eefef31e2243608639bc4efce8d4234cf80713e0ac1379e2f4417ea610e5b40bbbe08b207f7599cfd7e975c721ab3c08f646e5db88fa0375deeb30e7b283d0aed854cbb5e89e7ac60f4f4dcabb96ec09ea3bea4c2179388ffcdcf503613b3bad05abef6e5aaa0749bf7364a17ab33839d86b34327170a5c204d8b4f8999375e24112595880047a2f434bcd4392a5419a7e593cf3eb7907c0ad9ba137e7ab78434940f1bb3b94622e79a9824e29b6e967b05362453faabb1921b27db579c2631546f34d4b5fd16bf65320eef86a7543e95cc80d662132b48115008e566f14a0144dbf58b7147098415bc41c4edbbe9d28d2200169121f531a8f4d70141edde74aa96066ba977915ef36f2c78a0c1e2611a7d120f665c2e9acb30267c9a39cbc8d31a1e934e26b610d76bee943f550e567c5527bb3da27ed82f3a644a4a53023cf57abe84ebcb0db63d77ee34440d089210e4f3cd2dd92d3d428c176f282024fdb8be7894570e6ef066cd4b4a6cd259975a05048b5db4cbbda399bf8740654cc3068c123b66c1fff9b6325a0fd5570a225d73da014611d2ce943b1a64af2632e55d9cf9848e4cf33268ba0dfde24e149b40df865e8976ad0c83d58338a9b9153cab0cf0593cbdcb0c49c898bdfc4236b0347f57a190e741dd976f24f5ab0ffc7348148c8daa69d5ecdce4356376b5a81fd70050c601ab511c8d59f83723d123f69698dbe7f0f8c8fab33b04fc81f823f59e7bd73eded9c937b3248de53e84160eca9e1c72a072db9052f1087377b9cb2d9215edae4facb9c92f6ff404d550f1cb1e0b6bf59fd872406fe1528fcf46d3ed0da2b9d668ce79b9bcc5d51412965e23b2055fbc2d1046e3db7e594a627de5266a203ffcf36571ec97497a4ea4609ff565b76b60882011fc980baf62c9bc1a2c0533be1728c534079814b0b8261c3db674881c1ae299f4a25fd50adce6d03ecc892edb84be7419e29a0382144fc109c8ae9600a668e44b732161d8abdc967e58a61c4449e306bf6ca093ab1a79eca6bbf5570b8cd4f5cf731382b34266e0c9f76998dc4c6658898737f2627fdb524de6e9934909e5d0ec35c0cc6c44e7815628c00c0ce3446132b621ca6d7be8ee72b621fc791685d983c2ef05bd899e6a7bc1d2df9a9ead185817c9862c983033f0528ad9a4a38073c12854ce87a534d2460d1093fcf20a28cce0c9ded477336b7f2a84ea0380893c5e35a4d35bdf604a0957bbd945f15f0f6e02b091c3d0264b6c681062fe1542828046b07874928bcbd5c2cc6a86028f1358ed0b7012586b51f86a4fe2adc4157ee2c3c0a8dce81c289256697a8b89c131e6d4ff8c4e87c4821ff5f4138c1c87cee053e2cad0bff9a02757b66dd4347b39d343b3cbc93d002c86c110c120d9b0d6fe19c2be86a5f07a89cb73e047c7129ec44933a4d50a07898eaebc7f9ac4d0247c7c5247ed427dbb1a9f7d02e1862c4e918ab3e30c7a67b0a580e6452e2f5ed861e6426cd7de68589405d0623e22e6fd7816f61df3711c7bb8f8c2df134d01d418e5be9fe6b014c111be2e1e7018ea32667829b88a1b6370aaf0daddcf75da875d6300bb8cf2fb88a261617d1a0209982a7d2c162e33c3c7361b7d7365497873c31a37f7a3bb52f9bd28da404e2d8403301e877f69da81f161db573698231a3523e0239ba5f8a5af072e0354e5ab6aba1ad52bf9485a53ebd0987985e46bcf028355c8feb53b0da1d491a8ae7941e865ac873dad4280882449117dbf89172540e18a31be33ee275318d7520043441fcf2d0e61fb952d832fa9b59d299d03f223508244d6c6b4fd2f6db33ca073dc9606d49ae93986797a3cb49e7d940887861f79c573bd7c859d795ffb6d65735e9aa06fc79ba5d937099828a7e42d9fb26acb1fd7c084866dc0cee959422fd8b16483ff23316e9191fa73b6ee73ad7a05524ec17656e98888fe2738c5ad1a9e7e4257eb25afc5860467c2cb13462e379c0a35a2873d115254921967c303d6b0a1cadeb930957be2ae11f06fcbfec3bb25ba9e15b5f8ec7eb80406baa1386eae2815dcabcbad0848745ef3ebea43167842e918a44f76a34ecc5774dab20742a151a375adfee10fe41b6b5cbbe3b9661150401c1da51e2d6344fb7b80ecae297574e5af0aa1ffb813952dc91db6c83fba354e9e4beac926eba59b0564c871c9aed6c81ef5310362a5fd7bae9823a8416c9b78761cd0532c2901cdc4e136974ddae369b05f8352a9a97b07f468bc87bfea5e0d29b87a3fe308c88618c2bd763b94e84e322a41d600564a341b132f1701475bea9221253aceccffc7ed6a662f25b2b046d8c42e19fa0db75cc06ccb90d05495c10c768170e3ea30db8e9abb30d4e8b9fa13c1ad247d6b0b6095a348db17a614399a9da43b0f2874b4eb4c2207d9e3a8ef660356243325f8eb572e0d376050a47dd2bf88642fe4f640e7eddf131696a476d26703ae86f38e27e4deb04352c6e7dde6181ff501a38a216516378c9d2e98f6aee29047d00c979409f54c9b2c2fc24777452312bccd6031d861dccefed0655c33d6941a08f3490f3516fa59aa64b9d6d5f125d6fcb458ef42d46c9ecbd74f98c15e6c21827dee1c2ee9f882731f3177faf67ec2dec717fea15c0d6cc89259b39ba6afa54d0d378b0f215d9f42eb4b928461af85a90cbefd90fcdb69575784b4bbcff81f807e48cce99267d026e4f649a4c4232f8fe43182dbd9a709c09c0586b6c201b9e057f735b27de0370d0801de95e3e7983866cd0e743cc67857a7811214c308cf9bc8065a9ef5c1da9419123b638f0cf6c73039813f1d4a24870965c8273166085194c8ff3f28bcae6e192a69a8963c7f6640ba97f16acf4194c53332c699b0b2fa06d4c6bba7c0f65874cc98f2734ecd94bc4b2191d9c5125643d11d499b7f3b906d8065aad335f460efdfa97250745882eaef45fc117c2dd6b76d3b456a9924df7409b879fec1fcbf8a9199c672110aa25bd37b13fc8a792e16c0321077c871b2841b462d1b4c75b5e145a10ba61760098811666abae3db0f3ce247a577b77c30972d0e363da616135d510515d4618bce8a40bdefd81cad224ab5cc13605e62cf30d3b312c61ca39dfe6b9131c75737ca18ba42aa8010d9471c6f8a308dedad51d10b5aa8a8768e956c89c38987b2959d250da3a2322bad1935d29c5c82a2e44e5a9503762d3294c6bb3275b266bda2a458d3be60e85e130eceb5d65671fe917afa33d5c9370150b8c13d036dc7880dfc728704cce3b6ca0b3e7db810638e7f01ff60c5f35eb0e6e34c6e779bf8c0d4b69d3f08f097a1e44e0e1ce91d0400b13529141dfe18e4a768ea827fc4615d62ecbf2542e81d3208d6cb8878cc71a57f4078a111ce8dac4d842606254fe7be72836ba8e396bd5e6d2f560a531a96e469eda39b129007b795151c8fee2d5340af990e24834daa7329ba4c055f7386ebe0184a1d524b77a094583a5bec832556fc97d28a2f846d767fb513da254127480d1c60ce2c6167105de9acb3c752ddcaf16e15d0e42abaef06cac46b8f9dff5be86051fed325408ca4b5ec392cde8f501d0e6115bcaf44e1c980a058ace6b0b06bae2708e3d7d6d633d2fee83f86c68191122c9d496068fbade9f50c9891a71bd3dc8df59eca6f18b4889c1e6b13bef6396c2d660045747653e834bb3828bfc99745e249d62cba55b5a1ca03705f81bc371b1864e8debea22f46707809915dd8dd3d096c678c8ba522eb952797bca93025a35a41fd11d2f156c863dd31e548626a6f817e94751f8f1b6a25c7c39e5c7411cc1d01989d5fc913ca45cfe23092d4eb8f51b194c72faf66b4edca85740d8a03caeb7d7f11fdd99c6e4e1924b04cf56bcc4043599a8268b1abac7a741de9e399556a3251ac6dc3ee69dd76d073421c8c3cbe0cd27069fd5e405826b0c6a1ce8f1fa8ff62a6f432db00e8955c87bdd75dbfe1ce874638310ed45cb857e3e091ccce4ec75996e33b213f87f97eb0693e00b049064200e2871ed25cffbd673809f1d7d98a032015c6a6883067537714b53c4b3aeb696587ca6e427c7ef75892ecc42a237f57ea7176c3bb3d7102808b36d1e39b1648ffc1e275820503b03bde46927a8342147cf5c8c44784316a785c8aa2aeed4f69d1897c8e878cbeea68482a885a8b827eb4a0860fcc9ea7b735216ba6a9c0bb7839893256c14cb2989544b2e36cf7e26a67eb99f560ff045ee1e57ba55eeb5194ae1e81e4d165830deb2656a915f8f4cc47c4487bbbc0ebbf4bcf7637500122cdbc8ccf035e05b33ebd35163ea345514fb1be849b96bd5acfa7d2c73ee6cdab1edbb6aba2f478bd8b8fc4a3279c5d6b8135c5eace3d5e8ca319c5cfc1ace9ef7c28e536c6c06c84496aed6d03ab00ccf45e2cb98941b873ffaaacc9c2cfec0d89bce19b600a155e728a3359f4a3ee136c16534fca0b41b46025e247d11078bb2c86ef3f54fc7c33b1dc6be342e985d3ee4a722e4bfef672dc048efa8b791f05bda834a102689444d35789ac6ed2470b8d4d4f88f2d1b012daaed8cd3afb94b80d04462b8f39a21c9c9ae5efc9266a7b96fe8f6c79621071b880d28a33f1fb41b04e2db26c22f9e59e07738da42c0ef3ef3d2a7428ccca38e907e913e5869309584f20af29a0c2144669df767605f0c01068e2e8d7fa589d6f966cfe773fe7e4d4589e4b9503c3e7794787b482810c120d458465e98ef25a427b683046b204bec419b09c10d2ad45f8fbec164c034b6bbd70a0c59275c92084d23664d6da8d46cca961891748b22e079e09e0e4ea69d46dbcbbb91de36ed256e69209f46229c11c5c29ce8bda843219451aa5fc5fc2e0494f58e4a1b258488f9049d1f43626c232c6ee4eed59f8bfab0e34adfcccc0d9997c738f75d75d7cbcab9af8cdb077e04e4ac4db2f129e6e77a673a634f402a31c8c5eb7565923079e67ac4c07a47293b1fa91bcd0231ecbcea1642d36484bc337c009c4f7226e111ba5ef65795ae747333f65e4d87d3038a9e6aaa2c00aa4016c22c6dc6e53a044661292d8233d379e17280e362d400ab1752800fed9d115bdef16ae5309394a0a1b23de9d947035bd37d2e11e8a73c19988b908ba34c0a4fdf91c1ee4d9fd035797ab9d57f168452d947bba4bbe865ed085963a20b2a84290f8ca1799ccd376d9c6f4286dde96f0702fab17e6524f4d2f492a7d1a275fda8e30ee2974d08e98bb82d2485ffb11abe4b5dca4650b16daa20fd264d74b6a41fa7f5f390537515bd0a8e9ca809819d60b6b2f19844b63d09992ffb8f0951d473221cb2427592c220621f0d63c6ad084b55cecb707170aee8a1faea21366f6d95e759b9b0dc72f6fd5659725150c4ad7e2aec4f9a1f832a0d207e1742f5fd6b1fb1b6ea1e9a21088dd7bf89dd400f658f937376df0e64967f94c4e4a2c1f589d04a91009f21f8412732012a2f80d3c5b1b6bc9abde667d444b152f2a3fb8c7d80da52d87ba4985e8d678d4324908b656a981656deabfa3c10cdff5d8b0109a579fecab9c9bc778f963ccbc7e52a4d46943720376487df147baf2f57e561a7b06af3fdf780813d1d1ec4d504d0ce89ceafe1224de48e2887781951e291e7d74a98823d5fb2182283a2bc3f500e233d30d5f5de3a995eb129322ad8ed9c785750dddda059c16cb6815570bdd013b05e7eca7de11624ac85e6ade67643162a4b1626ba68fdca8bf80a9ea1701f5db5447ea04e95ac99a0c20fffacc71e2b81ff4bf36dc7886ef2298504657b5e3d0bcdcb503a2b1c32b5b0b346300ac6b5efcc85b0280e121571369cb6f9911122360d88b16759f0523f5f8d06e4517614f504d3c49d1b92c907478c586206ac6e3107c7ebe27102c8d8f8a81d44a60abb3fbf11b8329e9d8f18f297befc6533cecc04814056103213ab2a0904e623def5982c3410dd798f2dc4f8b7d03a74016a62d6f1b0011e2423084b2e8f06550a11cf980f052a32ae803432b4f4589e4c352b3bb5bc3496d700cf7ec028453cdbb36075a61cdf0f3a7776c0e75188f8aa6a7a2c664217f78225baacfd20d39b53c941f7bcd87a5350390fa0624e52e4d6bd71df79e5c964288aabd1735ad7f5cca35253191b043ab0b13f03f81358842986fc899d2d945c51eade3170f03148726afec8b241256766b226545aa34753793d3b96d82220cbeceaef0421aac7f613d6aadda72984d7458d750706f66724620f6bd70160a64e105e6e51087a4d5efd380578ee4cccd78be2326a46988f9413e795acd9b54dabb21e1346492a02be96ae60fcd0ef720dd9c770931503313be5a864835fe16ae6ba94cfac34f42ffb9f739d035863536b652b35e566b41339407c3ad34a510c27fe92c59c6351e9791c991bfc79ab80a9accc411b3a8ae6a2c04351dd061ff034c2524f1240c058c59beaa3143b221147d8872244fd11e73d22f16bb05d810fcb7caa4a64201e33d718e3997055485b798f40714be8be765f7ac4d15374730492f26e50f159d5908af52627d3a4968bcec3b9e047fb448d1c7b924d7435bcbbcb46bb29a4d1c3f2e5f9d4013d172aec64c49dca47409f65d56dfa792cf7a265f529bd301baa0b8c8944e94daacd8cae21e59f395b4aafcba8332f30ff49cb8209dc43a91a06bfc83e683a3a343e767f45d1a701e1b4992c87c1cc96164afef5c7d6efc28599bc40a167ea21a00689b56a046c7d0780337feed652668ccc5bbe34fcaaae84270d70febd3e77717205d84dff64c5a9d0394857dbaae24757f40f8a8fa554525f14a7fc9a6e2cd4702bccde8562b19bd2c358c72d19de2fb3bf4da59c5c0bc2680f449a82ea522e2191a3300206095ab6d610b9a3e0a26685e56879f773f27ec9d34855176a2efa4993a86ffa84baa6f73416bceef7330a93cbf8513a6112a43e3b8625bc456b2c83e220f133b5f59bfe94a8a9ac83cd4757fa0af049aae1b5124f473f37f396809e668d7c4722f3cd205cc1fedd9670fb68debbf822374a8879497b6657d07a6be86781713eaa5f88f10f65559fc3afd8d2ab311968feb23400b60c16d4cc619d21d05a9ec44006ecb8db568181dd3fc1240354e77ab39112523329bf22cd8098598fda368ddfe9344b2facbabc7f7c46a195b79281d7f86c056a9ce1d699d9c6eeb86a4a78cf3f3f0f3c914a6017f090a9f2cb8f49105298aa82f2b2a75f7ea525b3f826cffd4f9255ef5f01fab028462eb30e7387246f4dedb2cdd85fa53f854dfedf6fbd1f1abb2edd7162265e44952b8f72e731fc5557f6e8e34a2af16688b83b65db14e33427a723c8fbfc0d16e56121a62bfa69564fcb87bb3ef26428070523caf4505c1d4b309fe524a914126b13d87b040e96b13ad7f97c2235551ce18a57c1a8c9d65942badae05160ced228ea833f23606d9f4b9fe57f40baf7eec1d3f6e163c1257ae45411fa2723659955fb7a568c9142405b0c98343fb06964553674bd9b255a26ad549bcb7a1a8ab15686c6287685209d6c6a818d12c99dd3536d82787b2d8aef6c7d6fbe757b1360e1a2cfc8b9fa0198c284be16ed27c8dba4b1538dbd50f1df30544ca26c29b16637cdaaf9ce9d27d71478f7f3eeffcc5402dfb42d60922880b568ff3277eedb40c4d3bc9513af1233c1835224f76aa05922eb069b366a1c66e57bb5add5df0087b6d19694d8902d4d68f023fd72aa937420057711e9239193129ecf29bb4c83cee78017140ca1ba561bfc51406a57f8416d17d7b862a405f30058b519ed9dafe425c096eb001e0cc8d7670f665f933503d8734e4c8934ecc41be120cd0c8446c324987bc98f7e68b15629624137894fab7d34308865c758f4f099d440a4acfe2b1359d01e7ef26365666e3b15751dff0ba3ca9744e81ff95034d2d6971f454a8f41302808e3d5e45621ba3861e394be470c40928a206d678d182d69958f514fe7e20ed497c763df2bd04f686e2a2b2e35e1b8b5f470da9f2131938b52fac13bb350d183ed92e358940c0f55001904f70204e022cd4830dbf696fb342928fc7ff681179ca3ed7bed528823b839ce0894afb95a3a6c082950c67fbfe15665eaa103d76944a7ef38b7bd1966c4c33984e686cc6bdea20d802241d6556a91015bb3af90447df6ab4b938b99e63df649326009109c1fc86c5ed3abfea938f573e12529ec78f7ac0cccfcb23d86b0ab8d92bb4c65edfca3a45984a02ac7ae901d5b544192cb2074a12c3e6dd1852bc04edbce42012f34ed26b0a2c3cef9050103158039890cf7f091258a43b34adda338d610c548ad477eb7c893d9651e5b51d718ee26e5a06e20dccd6959d3edc89ca075c105d8964c837e34427fac0acb706b0aec7ee46c93f206b2622060a67aec00ea9c63d53c8bc071ff9749eb037813e170796490de624cb018cde7e47a747be2366c33ad06cb059e4346f2c1978f74fc0809de07b37a8e671e2167b732879c2b1e7993ac326aedf30089c4a4c66b3e55d99f1ea4d6167073608148aad540e5b32269bc82ea3de934d88fe3971d5ff789112a9a3e8d490e292fb3a92eefb28bd2a3ea54377fe44ed46fa49e6c11134453319f54928997253725e83992a07d1087734fc66944ab4e6a4a5dac234ed0e23f4adbc532c8208d897669bf9c0b9f9e3d36aeb2e0921253eca66d8648f1ce8653410a508c8fae9fba393ffa64486e2cb3c8433eeb26129d0584729081a996255e36ad63557294eedb214fd8f38e1620247756021ceac205da03c6a9388230950acdb43c857f6b5485dbc48916fd84076f999f767be065ee77c98e0db5bbf711fe7dc009efe4a9954f970a4970268ad94490503414cf33d606ce6827d3e63c864087c0edbafd1fc17505f99627053907417c8985f80f58c481dffefe29f58ce32e12dd38c19c50c36adfa5abc93bbb762cc8972ee0920eb2bbf4ff40654124a84cf50e62847ce6ab488caf2ac3006b23e8001caf0f7b484267f3d2ac4a95faaacc8fa596f3a30393bcd0d46c8dccf1def1990af1f517aaf821cdd89b6a88d4805d54009ccaf9d8b2f21c8cac73f9d5e2c68e1fd36b5bc0b69b0231d8ee33e2ec82f327dbcd5babc786bcdab36431669396b257975b4eb51db3fc742720341f267738267f52b054656fac7476b2e5778e29cb495b9ebe7a19475b6e9abe350c1db780c7742102e859fa7c4e6368f34daa2ac034626662af13b81a92ccb3ff10846de58ebf833cde6152600f8ab0f9533fe67864f8adc9a47a9b2de070b895fd26e24dd675bd85b0c71347d4c6a80cdc682258bdc75d910afa1635ddfe3014928ca8382ac1fe38363a3d41442115eeb2529ff9f3831797cbad4aa8ee27ed53b269adab9367733d455a7d2821171e5792f1a0dbe39512b380d53f9d5b0cc3d1a0d994139b09db9b12084de3c947cf1b3f5fabe89cb16555095ddc2b00637f9643ef0602eac09439f5577257b2efc84d287a377bfc82373f82dbd92c08d5b5d9d9dadacd2fca238d8fbadb51d1ea79aaa3611b9dce5fb13a396162cc994b3791bcf737464671c23cee15c976aed301bba5fb45af9c3745ba45e1df08e6ec0e3f3f6837dd96aa442dac17036e90d11cbf53469d3f93538f9dcce9cb30098886dfb86dc3649bcd22c578a817fd784645fd3f76aad6b3f6eebc20cc75ef71053f07f30b37ce1f59f0f8f9d6b7b67d144ef50d8b455d70afa1dfa31d770a7ea5d06d2434f76c2343b3dce8cfecb513144d57f9e08331d40b69f433153e0c7aaaa0f54b6620a1cb01674de5cbb2eda95b426f96824b898f850aa1e3f7830f20d9153064021b0a2d1c55cac2d2f6a50101763c311014f9f2eb821e1db1d345674524913e5488c32daa9e15f024bfaa490d19515d8e22a0e4716530d30ac899d6dd66d714929f0833b556a68e0ae55c3345f85ae95532cc43dce9b0e37f6ebe2cab6140f47c905e5542f9b74c007b5d5001e3ad16a3aafce8dc556ebaf1c8a5dee80d7ed1664e91b5c1dfefa979cdc95732a1ab53318725b81b3832c2d4226b4ee4a1a57a129372f73aaa89727c3fc8fb1aa150f473a762c515f597b9a3641a04ef090e223bbc4a0819e2f4ca8a4a6dab6093cdbb335ecc4c107f7b618d51457296a9282c3b5c1a7224bbdcb7cebf50a224187210bc9a232b8495070cd23ec5a7d6d134040603688ab5997805f1b61c0479317b846f8a92809d3b43b4d5f10ddb444e19db91ef15f148a01d50dfafc29c15df270ce45cee1402b1b6f0eee7c7bf29487690cc6645cdd04f1750ebdf9e916d2493dfe6a050040fd1b834f115388f7dde4a1e0430dd200d9978b898e5c30eafa52fd71e735fd5c946246f58c036e968bbaf1ae4a2d94cf89533f9a96cb0e9dfae9037a4427c5802f4925929ac65c157d8ceed2991eed7cd72ae94959142635881c9bb7b4764dc2bb804f513c44e91622ac6cecaa4e05571a9f427a05dafead0a5f47257e4f7ce3a8448b6550bfe303c456aae7c63a555a912cb089908806cd54117a61b8412d9ba0794797628e6450678d2e584d3671a2fe03f7c0df5161365a105c86395c69e3fb7ea0c83b29322d0a01b0242381cda38498c352e4a3a9522d07969c4e4a491c195cf289f7f30296618e01ec0ac13bb79348f0e92daa61b00db6fb2c9a9d27f95933fd6f6958ffebec0f8208d4e3bf621d9fb99bad38312280ef3c62b4155c66c3046ba6c24b847a7255f334340509233a728d28147d4ee66659b59cfd7728780b521f06403e004d46d20cc4eaa3fad69719fce0de71732dd0afb8041525bdede7ce58c5045d979402995682007305922ef3968b24e2c501974f6314ab20d7060a9f80919c8302fb108b8e21da6c3596068a2b4d7110839f30543ffb6d89dfcacb158d7fefada34204d3ec1cbfaaeb8f22b3d9c76bcfeb27e9e2e8b67ca815264bd9c5eb680caa29eae3361ab008f9f80082222f2d4a231bf934ae7241a5dfc89fc06c9c4f892a15e107cc0a2fc2b69660b9ebf722d59e102dafa8af2f33f0f2a60856c06cd46cc70e93de5a400d134c88eb8693833230fe8d3be92274f3554fcaed67dd452599def855c927860385e1d67d8fdd86b7629ba09a63f130c3eb0d9ae42a238047b177ec4f8656105824785308b167dc735ed48be77177bd314fea5a971bb757671b469d4f468f6671a69684f6e3582a9aa4404efad22d43b398b6e2e2632f37097ac026790c8d2ba2f2d606032576bba837b0a3ddc70976de94123b9bf8b609258c661ed6bfb2272bef56f4eb02d94bbea68d576c88b53c24c94729b29a2745a875329436d2f48ad99c0daedbd03e985b5cc413179e271638dc93dbca078f027083be0cf4fe592216ce6f10961c1c7662b87db1526f16b5d399d3813ec8f76ec5e9a99f97815625d63653f4bcc00c3e740393c6d4cf589d6d70e1a5f57124d1f326a916c7dccc83e66e0fdbdf7b7cc5ca7cfae180e11e314c1f2946b8fa39dd5e4bf28a09b32596f28431568737da706d264a3d25a5dab15465d5db4238122db7607c86aeb7a9a14552ebb12fb8ec23037c384ffb5e36fa2f8fe835aa97467c1237e93383f815f3116762338c0344d687ac99083f1e9d2a861c9b51b80c7a6e9d349856da7962bc5261e2430b9c7d0c80c16e8071cb85dfcb0a328ff8afabfd9df8116cf6cd90f05b96ac73894a6fccc222325cf4b6f5016b1ad1d224ec582ea9536d1753f243901eed12b99bd4d8eaa43b5c9ec1fd75e2fbd3be6fa08446d2fef257db7dc599715df4c4c6de7a36e33941bc603438fa6f265623041ad2f526f238f5870ca3ccf9c805a6e8bafd6bd068fdf50badf07803d6388c4cc5956e1ee4425410e3e64459221ccdb8f2fd4a7fd684ef2e5922b918a3bde10c3aa050f595a23d858216cf36340b782d59d1563c09f22ae27920986d8cefcc69d7cf9636f289ce19cd68a26f7e7de49be5063efbb6e3eac7b708b8581af39300bf198c0b20f8f5d3a9f7f0a0394bf972a04377b483abc0e81b4ecfe179fc8a181f9b842796de137c5c7f3d1686aedd1340b4c48d8c782985642f059768905ba2669df03f0b6ce300af50d1adbe57a32ea80036f5ac383e49cd8306e7dd55bf92d19d6b1647cc867e90900a5161e4bd87c4a37a291b41261166e92aa28e99313be2ccad7a4e3323e818a7503068e1fc635ca17969540c824f831686275ff41266e0b456fc2b597554ca2e25441cdfba0bb082ebe5a99ff033e44fd7abc618a64a856de102105669061e0e0484e198e891ba53288cb90ccc1445aaf02d7e4a2915c2a05f30215237259289c3539268576e8574b421ccbb0b18c3ab043da1f3ac9c1162375f6df6f4eda97d77f7018875ef8d8ae0e0ad1e5e2af8ffd8038ae24d7ee415cdea41816fc6e522dbe467f7931392d2d8818196c3dd0e0971c78f09b679431194dcd6107caa9ed18f24b419cd6695fb443547f2546c2630c99349c2a86ae472d042d23ca4d4ca97b0e038c4cce481175dbf886d916067303073c6c5205d49220976bdd7f1a486f36e32e22a1e8e26ab77a6a01611d17e83ea52774cf47b922b0e28ecb2f2fe071bf9e5e3a0b82550014c11fee069a705e9c1957bfeedde3ded64451a993d5232b56c707ccad7fd5c353d8f5e1481ba23ff119e0e64968fbd42726425ff19533942b4212cd9b30806ee468c348da5dda821f066efd02b68073de00f8ab60eb788ca34118669438c8c4da6cc1e7be8bc0e71cc494b737ff6a30072b0ee52b1e9d966bcf2b5037bd72b2d433069567701db520f1efef0eced19444ba22af1a0a71d3eefdbb343e5146e22a802e598f7358202bdc32b136b03487c2381fa7285df7b161b8b2017961c90b8a735f4ace029693d05dae5918bea92dc6944c055997005127370a42cd0ab62c3f4267683f7d64fd05ac2a7a7d8cc72768cc84094bb493de4ac3653da81d5b36a4cd9166b36b4ee6bc2c4f0febdf1e89dda6e03732f21454fa92228ba3cdaf6c6761984728ec10abd33a9604c61a7c65e2140dc475271f8b05baecc31387baa3e3d7f2d89f7b865897e4a0cad7376dfb5e452e5ae64a70e4b4cb0ca2baab0f6a327fe3408b468078b9aee7e524faa5e2ee7c5edcc4fb33c0cdba4d7671834b9fd15eb2a7fefda786c83117d005b24367becc849d99e79fd983d43d2dfc4a940c552b5f3dd46e07efc1899ef7c6a169f87ec0bed0e17306b1192e324df303568f1f7a671e0d91f1f5369cb2a9ae6b51299b5130dd6f70e121d9e95692179993ff700271dd225b58d7e1d5ee113b17607f6b4a4d522d12a7c0940751abc49dde347621231a484de3b1dc99c487d2be8c55bf72e6ed492ba709aaea5167b714b9498a58d42e68aa3d4a2dcdd3b93863c2ab35a47a3f5ce8f5b2a804538445fa2a5a70fbcc91654cbe63801ddbfc7257ea687aa3f5c2b6dcdf4fd3cdff460c0fcc9578c764a1f042f054662e9afd909fcf056a3bd92ba2160f4a622a5359d78c08537fcecafeaff510f9ea06856299dfbb4901ec4739a8acf33b7d0fb16d849057bd9130298bf00584a3f06cb7785be0187ca08e2154f9479e0dc9d4015b4f61efcf97235570ba04403731b4c90f6b7877eda0119d9ae78076d2c02a4193d0aa7cda5b331c0c11c5e27208325290fd461542c8ac578baee193470ec3f67a2051f3dc4d12797776dd518fd0e4314bfb339cdbad8010e7e64819aff1bfa93b4f37e82bda4cb71e9b24b352216a0b059f9f70d0907522972f4c1b2bb1524366f67403fad3c958935ea673f2dc2a7182af9a54cbc1f3e254c9b0c77cc0fd276e710d119929aa32f114ba6afe24ec00f49375abca6f1a97756a56432d7728dcd10620dc61b14ddb837ca4ff14e811ca3e38b4f072cc2a19b7eaf43a5daa20a6c657a92eb1105434210a0ccaf175d1ce30ac0c1a79bd5a36053c2557c00e87aef4e025c5489264770ee63d9056371b45d8ec929d4503b384e03cac51feb4325e638fb3a5059acdaadd5c71ab5aa4904ffb78b4c66e270810d32efbdb5fda3b157b11d2ef4f04a1f0c455926697661764148288aedd3c56156307835ecde783da3438b1a17c36d2492079d17bace861075fe0cd092451bc7ee617166381bf8019c1daef2bbcf5e5fd0831089b466daf166d56d5f1ec5d54cf304658174b8975fd3c80591a83d48f9c27c2e5cc5cd7c82f9ff16c8f8318bc8aad43e905d1fb6da7bf6ad9cfe0276a64e176c5386e16e62230aebe1ad5d9eafbaacb6ca138e4224bae187da9cd5dd0fb4b26585d355c4105b2759931f0808a66248f7c60d49140248d48056137064497659e41792467bdd34ff827f266d4f703b387b94e58aeb9b6c2ccd744b1e944570b0aea8b9f2b22a78e88da7c9c734369f8fa4384cd15786fe186324747d7ac665c79955135adac6509af97439ca35fbe3fcd099adbdfd24ab79acbbf3a06c054b8e4882417586694e0b9e9aa7274e15f69a9656587579c247b7f945f01a2b4b4d2f4352bfb422876342fc544a382c7a5a584308c853ff31eb47250126363ecac3c8906501232f55396562db1acabad38c104672b500ebbbde1b2f4a9a28bff4305e00fee5ef4f7bb8f905e66554d28cb332b461d83cad72e35fe8e2afea9cdcb957ac315831b27f47290888c158e8ba409820fe04622e957c0b342ec96e4f9df31d0a85a12a72d382be56ed64cb52d1e62c5322ec20afaffc69e493066bf33b7388ae121fbf7c208a98019fe0cae75657295b952f846ef97430aa19002c56be66c3a6b073764f9746e0254d3c4fc060831bbed27481758c9fa196aa36131d794d0864d31e930c10455abafbea405b5a2a36fcb0f00dd2eeee5a98107c014201898211f30a01562428c020e76a82e6e57c202985d3b718bad05e4badd9d6dfd9d568a1084a0c9bb12cd7a0cfc3bba3c772c194ef2686af73825b864d1b77fd34a946e0af505dbfe7099d2843c4abe9ea55184e407140ebec2707e447fcab055fa382d18626fc7d52a0fefa3ad2a71af471ed6181dc06da7e131020940e83f5fbc7314d8f9a6eb2c63708e5db955cc4430fbee52af079764507f28f9761161eb3c92a2eb0c3f429e9f4d6e8f0c120c7ca3abcf8b462e1309e20fa7eae6f64e731b9fe60e176ddb6e2e21678827e51d9a3e775327e9089d6e0a141425397ae378faec3e2468b2a015783ebc08c2de88bea19cbe07fef54078f72f80496dc89a5a8bfb517eb73f7035afdd6d8364586c9760bbc94f52ab673a94a3d8a2863cc06a99ccb7d56dbb4d7ee04f48eb7ee5013be084225eb059a1d272410d70ed1b9019c794efa94853a530ce8eea756341a6530a166214ecc4606519b1cf385a48d6d4f0de2e90ee6372cd3b9ac7bc666b05d8865f6fb2e9bc295d99d4e31a423a39ae88fc7ffcc4b731b4f925eebf5608ea0088b9be07f3c0ad99e0b79f6e26078e704df56af7c79e6cbbadce9e5b4bdeb8acaef0ce41603c0cfcf385051f2e87605521e763b2a61f5501330c64f8315c6d055b9552c198d4b2e28ebafffda654757cb48ef8fdacfc9e4c0f6db879c3e57c90be28864514f81a5cb48632e77f0dda952075ea971b60eca09eb372211db3a679f3d1934dfe8bc9173d5633ba5692701f60fa746784df188c96cfd3a04d2aaf797573fb95bd8bafab11fa1adf757872fe874195587f2ea2598ebaac9cd170612e02ed19713d4725ec82480e66f1d15e80f5f126e2725a4eb2c3e1668544632a478c7d1967811027dafa2c70f65fc98f72d3fb27ddfe71a966ae68dc1017a53f1229537570697b8093b3e00f8e43e0376ad98e0e48a546fa9c04794e0716d2dc56258273bc8d5b958a271fa29ccac8adc9ea36f1474cd1c2c9ec8625c0a8c9683bfc338965800cd0962d2463386342beac2e5ebaf1edd2d6bac82a066ecf2f6401b8d941c5e0b0291669b990f5f00800d7bbce10377d84376f1b1d9a7bad382742e7e760da9d36608e3dd65e9bb290c283b33e9e2439cf17d0696ffc54920dcad481e0cc559b0581200c0d45de19ccaf481c21f9a7ce1eb12835c33929d2f3378dbd507aae7f27e0aaf3baf15756b1d4207ade084b5b58b10418d5c1c481f90fbc6ec6b9c88dcf39b04b20ac338c8782600a2f0ecaafd4ee68f3348af20c3e536209a90edb408c15c4139bbc96b77ee71cc337b9b3df71793f335178cdbac35ef9292f7f51f90212fff6d57b89318524b39477001486c49acb15bc0cb864e466cdd5450be9941f888ded77da64c84230ee42520d04d14059d63448d095daabed4b319c1736606f3cf2fc1d4bdf948221628c02cdce3c049c3ac00c0be35258e64cf746ee3d6e8b7c8d3ff86b99155e4c28c8efe443eb097d0e7f40dbd21e4533126ea06713173cdea6efe83af3e29334a2f446a84d0c8f8059d6556ae7d042c5e74b417738efcee2b37df1fc3761a7b628bfef4c87284b6520ffcadc19aafad3e385e4047487ee4a4f0a6afab9c0350fd132f6c76433eca8b6bc3e391f066129a7d8aabd1f97be3cf7f94e0f9a455438fabf52d7e207147a5620ed17234703ee398ddacbfcb3b6bc789f6aecf18f9a580869937a2ee1c8dee74e4ee678131322cb619012c567461dfbebff553372cd27624aa13274ee70bedffa7d404fbb41cb35979884ba37eefa977d67006b1e8a86bf1c86518db67d3c5a38b3ad91c804760a4eff7fed67899f1ac873d8adf173e583833d11425b81025f55ae91c34f5968beea97358f1bc4b7c5d10ba1022f4952b2149685f061f433bdfdc4d9448a04c7e84b01fb21a93e1bfbbaa0577886c7d57b18c30b657b130246c1301737972b94b4c23ec0337eaaa7cced1db310fcb4de110ac70d87c471cdf33a3ef43bc2dd9e66bba5f6662af84187ebdfd3cb6201003ddfd970757e7c9b54cb745facb7c3f3ecba6b94936e1d9e2c5043bed121854a63f53fa2c2562e4ee6098999114e1009a7b85b0c99b0b8c573718c032d906d60275d1663cb784ad37cdeb13825a9ab1ef637c8ab4b9b2cac2a7f17880c9eea985bf6918997c7b52511fd1e9f3ce164ec585cf8359acdc5e4e163cbc70bc07b4d1f947de6d8c9dad78652feb419b29ac965830843a6a7a9bb88a71c4ec160e7bf636f8024c3402e82a6f76dea0c835d511704ef77d57abe917cdc953d6bd0de5916634e9d43e31bad4fea0b23027b87b36b2c27bba5dc5e5492df75b0ad3260665c9081457e33908a8fc6ff08783e5e031793dc80610d7f632d06c83d2b7c9b6413b5da8bc07476db8d2e632f0d18fde2d70c7fba9672b29a3519312b5ee4070b697fc3790068185b502eb91c714692f301304c89f547de64df126008b04480fadd7f3cb3935aa66bcfba017e668d8ebf0d1a45ca0415fe52641b95694b44704fd00e4cfee19d83cebbfb2f04c5872db6cc956953452e7adb97082825c8ee6f44376b09f07dfd81791b40249e137934e124cd40511c5953f3f57d19e5e286cbeb020ee35bf745c927554880a2f399d1a069e64b54ddb19cef188dbb57b7477ebcf0adbfa2996ff4a8b98eb0506222940779e3315dbd3254f6d18de3a79a1a9cd6fe04da4fced8f8f25e1c96b200190ee0d5f5b246a1b11c491758909dbf892299af15ff38faeef3352efcc0e657d3f5b9479c13f96bb15bfc560e6e66e81e2a1b575bf9cbb8604fc8c9927b679a1d186cdfb78c8d423ae324f90572273254a70bb706c5931e1048a6a1b0c2517bd59dc32429a8efc0db6cffda787fdd94cd91c5616fbbb4d58d08012569417c434f3596584365d378113c96234a90de1cae42af258627becd55b64ba116d2c0789ff95fffb8ba58e7a24a75c496189f26423e4e1775eaf2825780e41b4180b12b5c8e4143fd2af302754c3fda02daa5f0e5c4fd38ae00859a4d29ea6a7209b848ab2fd9689dde8c856721071d10e7dcf314486cc19d1a48a068346dd0dc9fe1db3b88d5713f7dfad46f976e59132dbead0b3437ce876de91b6a7aef70636d337deb2397d609dbef3ea962e6f811f263f9ce2dbde8f96486e68e5ae240ff3f65a0a054c022d561e1dd92f6f38dea4eb74d1ad73a48ab26a1ea8f0ab4b3d327d920755de851c56c5810dd338994fe5ce0dd54dbb14703e6022388ce85df8e777a9316685098e115b38d012d39f63d90efa4cce0b9f090a8c389d92638feb7f52a1128e02fbaa871750f846683f872b65658bafb6d241751bb871cd16ba345633bf14d97e96bcff71950925e9f2267c0d06821bd7eefad17a2ab799d592b21da62f2a1bd01e11e50fad3f6ebf93a4c8c825ceda69059536945da41542849d0fa0476f264c283fec63761065c40b79124224f53623b99e3db7dfc9ae728e53479288cf9c7c0168e26003574c0f971eebca6d1fa356681e757ab1de5b568312853369427a19c99be879d5ef1750390f119bbe55db2ed75940611c72cb9bf07ec2fc3d6efaa97a8e4926066e0de748a777a6ea52a7721ddbae1c981fcfe930a6630c6d9b844d420e9d2c8b8e5b2a24c160110364fe1611ff014c782e7dff8f6b825f4203de6cf8f54a1574ae4c9730a8aaf920d5acbf7332ebc993acea4d24681e875af6c8d9f458c3a8d13911fbcdd72d6dabacbb203e8c4753dac7b4e744be06135a446909c2b6a00b75aa29c35193090329717bdb31c0f951e6aad0e12f3a5eadbb12d0ab03f562ff19e0ddc621a5d9ab4b84e6b15fb335c8f41452a8b71652104c821525e5abde14445561c3892157e32ea30c5c5708f003b75f890dd67e928d5a10fda22ea5d226aff487a907732171bb76bf1882eea29bdcfa75851825ebb226070f3152ba152f9b0c9e9f5edbdd2506c651e3b75262d1d03c0f9e564327478e22a01fedb149920befcc15810bc5e16ae80f0953cc1b2a5db729ec7b7d6fec29a2431c6ba306c8b46acdd00dab1be587505c7d96bb965175babe7a450f843b60b7b57d03da5dd122015e7e187f4920e65e6af8c9791565072b001308d478d127e0fc295d2a633f332591139a23c904d7bc76883b7795aef1ca18c788a8b22dcdc0d74e3621fd5d043f2154347f92c61a81890f58a026e847fc93e15f4f51614f29b87ade96ec2e2e43517939ba5403c6e1d057cc67eb1614e3165844d8e4817c2951603709a857a1437fadab8313985120f92c4bce4310d73f4195c878be382b8c54a5fc73637fd68ea1595f89c9396981d6fca02fbe95e30cbdc4877e12b46fab0c5bfa343b18855701a695ce40b0c049c5af0fb61e8f48cc5e7eea9a3e8b8d6ac5b4e1d05337c6f234e089e6baba8ff4a0219ebce38cb37d85e4d18090731ae95d8152f59b6e00e8582e3618564d9afd2246a02f189d89313f82f1a1c51e5b34a47943999927ea1889b3eb1731da71fcc91e0e1417e64a534634c1cdfdfb4c8c19adc45bbd24465a74b2449772556cb6853ab191c6641498dc3b29bf67bf86704f3bd3b3c014253436c7f11833ca81fc48455e8ab7e9eae385d79b568810cc8da653b43b0bc9e1228f807dbe534e4d72b3928c9e36cdacb7637519ce2cbbfa2eff917acd8bbc7a0bb8433a35a01b548dc4f4e88583d077a856aaed01266b6eb323f2a52fb6aebe595576cb13982c22a531d0f4722bd1578492768f860a8fd067a77c40a39c829b16bd1e7fbf0f963285e990303419d339b20de86c042c34094550664ddf8d2c597479189999cee006efad41b1d4d780573396bf0764ccc2e63dbb13d9a82fdd1f9336cad2810a76e330c54a1f3f140b511ba2cb11d0fbcd8b507210749b62bc306a6f94a7cd62750746039bb887f755163863f37f396a9f8d20f6719cd49e7287944ae3a27d31610b061a97e72a5a908ba6dd58dcd05db1ba517d70d3a8bfc717e825f1e88b0b32daa436348c64066fc51fadb6e32541936144a6248ef30354cf151e667e0fbdedadc77929030d062c2cb1bd4a2ab7fceda5c7c5014547e9729c06a2b1195043aba7c4e6c2dee8162959df19671121ddbe6f5903d0208246184e9a6ba185cf6cf1e81bb9f2b4a946e27600e473532e6fadb45dfd03a35e931848a2829623a49c16b5f37ded8501b69c28379fc6769d813f046b7d40cf28682f53267a04c25bfd242a1a7a35d0873bafd59fc367ecd897695b574170b842bd19cd95c0f4e046cca805f269515816c0e1df939dd7e33bfacbdd76416ea324bd2a37eec4c2e7514fc59455767b82527ab469a409fb6fa6623858e0a7fe488084957f42d2a4b383defd80f3011a6976cb96add2521f45c3db346dc4476f91c0eef0ce17d2d2ef270f9600200720b368c06bd90d05d2d5ba7ba9567507ccbdede2096fafd292302c6d8d67ef65bb1ba33245453da013468e65ef79e69fc186c6b97233ec06ab75b28ec06d890b1667af6d9fdaf432238260ad6ab9361d6daa3bf9d8e62603390dc16bd4194157c40e0dfeb2bff25f6515ba17f60156e222faa300e28bbe8feab12a83217c0012c7b6dc930c461e4c3df4649471665238c6767ed942877e66a92bdbdecedaf4ebf4878a824b6bb057215f5fa5b83d7f643dc39cdbd196587e59b80176e1ef0dd821efe9c13388b0afeb6705a2cb3637ed83bf1fc46a943bdef3300fca10fe3c40d215e96b4603f8307feb02c481e1f506111af44d19b56aa32bf2f446d507bb8b7430ae114b82581533e1202d6a471794730efce5395d59a0a4f6091f0f94b12ff206ef5361893c10ecd2ea4c9cfaac37f7f1a018ad44aad909c4b982db887d8be80fb27f3e06406c6a5eff1aa11e400702270cda16811b1df90a51cdd4655d96b8ac773db39445979f3e539b37febdf67479ab9440809cc0dad4ce8437728e4a96e7d045feae244fddd89da6de7ec64ec0208ddcb94eabef24b2bf57d6becb48a27cb6cee9f53c0baf9499b948243ee5910c0cd4112d2a93dd5f6dfb9cd76431662998e0b7379ba198db54cd2fcfb3f8961b3c98625bcdfc30c067ae474651923aa3da96f24e923f1784e656a685b8f8f660a2eb569a2664baf29cd412a90677a92fced5e67243197134e9fe75212db2a749dde8da088b51fbcf1b687b379a4438bdeab48a1b095ac90333b7855623930d0de022a4b84350ada6b019b41d1ab4eaba0532eee4db47ba22e8399abd4050c79df16b0db13974006f37ee8b753c84d362200f49a14153356e79b1372fc50abe799bd552b95b94bb56e6661c2a16cf7eadad4057478168143d9857e940170b74d9b262e4b144082b2eb074fa3c9041b95346ce5c23e326157beb39c324e83de5f0a52faec1d2d6f85a6a33b217160ae3bccb1aa38d07dd022ea301ee06c0b868f593bab456f0a4b648fd4d061146e0a263fd8b7a19469d33879219c75655b283fabb291e567c229debcf1f6795ead28bcbc9734d9c62fe5c5c23871ab71adecaffd18cf4c9d0406c371ec8363820aff3fd9f118d7f7b7afb8b4f811ffe737f2c4e3f91672907604995ad76aedf0a2041a4d0ac3a458d3222dd0e4996dc8220ae173391ded67e92c18acfc501ad1efa017c88c12d0d14152f951083636eb443a13dfc2428f3470abdb0d25be098c0d3d82961e953d58c63b90aa214911a68baf7f9b25553fb11bbf2ac6e78cf3a713c7cebc811dca77d7c5ee2dda3299ab11c3de034133d30eac72e9bfe53fa1c2658b0b1f01f9de4ec61ec85727d406cd3f52507f9c9e8674c9e878b85c925afeff6d42b48137d3a531fddcd7f38f28ca14f69aef911571489f50f58d4cefbad53a643104e2a90f42f4aa6c811b661c41fdcbb99048196ac41a07605f85036f35653aa52a50550a628d637b0ca4c38d65fe1ca565039c5c1f81030d68a06c420b3f46805405359694b73ec8140b76be909e721fb498da1b7ff105ca264b9a147372099fd59a15bc78df92b7b48bf6c3e25197eb3ea22d62197328e2fa6e8f0e6ed4049af2d579d83fb30f4668faa53fe8db15cde762c4ff044ab5578ab174c1171b8fa6404195348f55197cfd99055eaae978d7baa97b268e0efa9b4c9bd5de075078e06d3b79d53e60633d4f7fc4a77adb0e59d0e762370f2f03e5fa5fcbcb63c315859cba3fe9021872b0f03b0bab6c732dd0a35f74506ea050953b0251c8c82bdc222bc977d3a362d82d1e3f9bb18abb883910f24d7c36892e2b1f014f497260e2342bc8bf9a1bd3f75ea76dea981ebb33c3fe64e65d16cb3e9badb94909e24b2d7de254ca76237122c9fc0eb7b0422176c287337e1be68a37a691248d223172fb8260443b6ece026cefd382521d3d2835ab8edd32ac18486f68885684d368207ab20680319e4b6bf6894562e754647a7177af5fcd8e4550fe2cb5ebffde2f2744212fd2d8aa631b5b4fe75ba10250aaf10b538c8762f64f7f8e7da3eba983a4eb2cda0429971c4b8d62d2860a6fa14d6ce87022470cdcc77189d24ae0e60a2f68199b8b32a5a1c1d0e2b5bf5e4561f224ea3d2d19d55f9c3963060c17a84e767e7f973b500911e406169cb6a582be9b58f4045b4ad7a3945b929c7d20a046f99125c9885418903f40d247af664f5ef21297ac89cf1972f80162433ac6c53b117005a2e4a32fadeac810be21298135065facb4836788f7bc364e028b564dfa154e4f196572bc29e0ba67aa9a612345feea156f502b95d9d6e54f1c1dc108cbedad3589a2a64786afad00ed0609a31acb1e77e5adcaf49a47dd92f400addd0745182f04716fe07ff214774d52dd0e209894b3ec2a727a800e1b5852fa62e537df187d5b9dfed5e4ee9a720890c8a051758ad41376a107785632e1c11f558a991bfa7b673313f5ae6d0b08b6137fcabd73087a1c362a57dd7ad5ced2daa5d3b3a3edade2989707e35feffab97d39f1afa9c3b65a4c189d87d6941d866316895baffaf5f54f8ca092004f183db07222fa037974c691ba0aa1755a45fde8f80cd60085394b50af53687d3b7a8214262f91a86e833295776f6800a8f7e48531d70166ef8ff83cf74b1915038f43eacd09533ad97f57a5cb5e22a0bf65898df91cb99bcdc229d11d18e5ffae62d8bd39b2fdf38c4a173b844be1cce2cdb6b8b64f6da9d53bf392ffc0caae11358a0f985bcf0897bc1b14ffb6c961e6c2b8eb4d94e15e712e45bacf080d766ea3f5925d06c9d1a9fcde9628af6387c101162e9b5ea2a8574fb7e1409e784806bacd679490028129d658992cb0b6f0e0fd58a6f7e8dc332838c64083a370a0d2b7834744ca85e39f139f77b1e59de2fc6285cdcd9b87768a0e33697ec38ab93640c191c845bf08fdc9b8b935d1c85e107426c942338eb880d36b0e726c3b799c87e3480ca0b9247e1d1a3149db9ce39f4fe58aa076561cb4b5a04651d0e47f55f66362c607a05ee46331957ac854ceeea894712a664924efa005d58781a4859bfb05d65c434d5a8bcf081ed7de1d709c2971febdf56bf120ac936b312ad71154fc43f3d59d03dd36213262292388c71cc877d7be0a7b06c5d4733eabb7472a3e637c322dd7301f27c9c162ea04ea246b237f239d8ec1333e541d3201d3bae177be784e0331d60bf3a76835c795dc60f58d706e33d4dff492c627172f4b1a52248ce52c11a3c23e851e6c9788293da7affc67c0bd021414c2caed238374f76b755fef7dfad3b9201da91508af4c3f6613ea5a31bbab90bc81432e3063a3a813f2b81da2348bdf7e9288169d9206412bbe6840eca7d781e3bfcb8cace4f3d0e7400288ea06344956e38493104166b69c2bc224d54d6c6a9f08b384d714056bad63737f0419d518d0fede93cba351fea83c0f72f131773b3a6d876ce0616496d46af35be1c563b598f627b504a33cf8ea668c58cc9f66bb2023e6f1eecd7c103f23ec807c8199d8f2661c8c3e05fdf63723c6cfdf2b885bac8fd3d3a4fd61211c9878509a3fb3bca536c1e8d57f6660353a53499397a281f09a65b04c6bbf83568c4dbc300ac054830f5125f71c45bdb969b3678ed3c4c477e6825e133fe28a034b9ffe8d6909054205c7e9c2daa753df643c46a3a81cf913515f6b80a39053d27d7c40498d184901b3d11ca009a8fbe301170789bbb333b71117784695fe1be61581a30c76c3cb097d7b7d838da5a064329ae42e8a18112850c9d801377b6e673e05dcac8977ab64904dbda8f8919ed41bbd2ceb87fdc6dbd7bec9ff2f2b0ae34e5b4a0105899d5344576163d712c9e21683993cbdd9065511ecec2af7c8f0ef74cfa0b29b79d6a3163c0e28adf58f0184372914bf71e12a093ec1734933b950c37eaa6b9dd531b624a3561663903628b18455308e5460936a04f88a4a8094e635c465bed9d894dab66c5c76e2c373087076a36007d9d729079245f7cbfb364d884be9ebcc4823bb600ec35e735651947d27ad73129e86f148724cecd5b3b0592ed43899aee6687b3dbe38e1ff7ae7c1d07b1da405763e641a2d3216a1e877e33b8854895d412fde84967d0d6c5d801aa170ab9ab2752213b96f20da4ff22c67bc8ed58d9f64ad503630342ccd34a4bac1a0953665fb451f340951030e73c9e9cb002c4194bea327e536bf076c4d26a501670b104e7ffb763e6aaa361e04ca74222befa7fb609aa199b015d4922ce7d937e88586dee643b97c9069f7f3e5137694161ae5fe643c0c02606402f20a6a7317edbd03fabf13fe94e0d40bfca0b83c7b121e2007a509f703950b4686a5de4dd67a9245146d3f137629f52290df3003e034b51162bd7a63c5cb988b47ae112ef250ce02ace2493403d2f2dda0b46840b15855a8d480a1f0706b0f81b1bfbe5ef308e246fe21a61fad5eb1b9907f618767b80e12ccc799579458fab93801854bd11e084211cd1ff2cfa36d9599a8d443587fd8b02adf74fb054a477af924dcdd3db32b3b888ef4a7c8d82711ebd46eb4044183046b42e6504e21916cdc9cac2e9b404fe22ad2b346897c4722599087d055ae760843a2281a06d877ef414d8d2b34482b7e78bb485436888bf8de2aa255c54fb754541f4a2fc9ff9892b2ff410308315f234b36cbd1878662cfbca54c8a9024cef6ab4a7fbc830b793bc89d4b0e6cf4df6ec385c7ecf7301b954c22434ecdb21f67ac86d04ec1b4321fd955d86fd9289ebef90177fe9d59b2378a6f0e7543c5e616a4a8acabe09eb622122a6afafe11208702edc8a718783ccac5f4eb554f02208f3ffa96d08d885daf5697241ecbb7b80e51f7ddaf15a081296c601c4c99ba59caf79f3ec6576c60f54ac0b22f2443bc92b3c062a9abb563afe65fb7725365b2867d7fbc0a0efd05fad76afd422243aeabd1fdb90f0e703295b78ff7043eb605ca3edf6a3d56bf239da9c89ee5755dd9cd9bb8ba5665faf885b886abc180a7e19707ea3f2962c4912554730ebb3b2bbd2eaa0fac1351d50bed47363ac1976a9d1f37741b9e1d681eb4b26a25a5fef63b8ce42df7f2a753df2cf51f05b3de34e150c09feb6b425cb8410bab25fcaf801a596e3ddf256ed1cd8032703608b47729f07950eb19c7d19fd1635db2c157b09cca5d11bec6b2d292c8df8c2c71b4e3ef414250b781f1955905e390174ee3cde14f4e5d4811389f3fb44bf038aaffcd9ac0eed5e164767284057ab736db269e681ae2c6c1ae75360107658ff7cbc7b592ebc85faaf48514adda780a2f7d3fdbc34fd7f65380ac4e6154ca0625c9e465b2c928c8fd9e8e615eeabd8b9fe6ba575ecfc81a5229a8a7cfd33292a84987c84f0b5f4ca47afb0b312974cab0a368d44b30a750595c6717af1f8a64e1c5b5ffb1f0e82e8bf8b19cc267c7e2d07e44de67b857cc3eaf557abca61d688d58c7f18595114758821f55417ecc0633748205216d22750ee0be03ced025211a8b4fbf551f5430f946643791946b5dd7ad8372fa60cf422a250ace69ff22dcceb71fa299db6bb38d3524fc2d8f8c00b46ce511a253e6d29c1dfdd17038104495ecb653b28f93692220df6e3f0a4c96bda9db11752865997805cf4e19a5c6dd51a5b65f90c376ad064f635a1bb3812f7ba1b9656a7cfba6fcbbfd0df05c71122ab53552ee3f94ee162277f40189fd5b49e7b5c7bba77ad91150131e3aa74f6630973da1f90312b432830c6ba028a1cc436f163fca0d17b8c7d3ead81eb36ff145b4b6d526e052d86fefeee4ac055fe52cdacd315267ed84b762673ce5bf8a66aef52442f562f244526f2d153bb944f3a71be108f8c79585644933c038d384277583a7d57e925bb22fa9eff9a20531b4fe0852afbd1aa926ca92b0f05e2a4bacada8937d38e28ef9c0984a81948765e11f97bd58e655501db0a104c0779eaaa622f960d45fc7149801ca8e028ca0c1cf69050afa0b48de70f8b382b87e5c8355e49a25b4de0c64c91f1b328801c5900b038f63d142f8ba9b1c1f6a07b67490da883c1e85187389606ec101cd41864f998ed3f427a590ff29d6aad660b9e18c76a18c6f8dc89cdc9661665c5cd18a267d6d52f25ec49cbea0513b9d2a4057c8c16aa013911c44229d6f3172bd1975ee131f0cc287aaefaf83ad428cd90740c20c37fde867e524bb404ff799e79336fd63486b1f4b0bf15c13297aa86634d18b8571c72a2e5b844343070b93a1714e51693db8c66324145b5efaa63957190364eb362a7d9ec40420fec08bfe2317341d5cf1e68f5dc5a6fbee24d2c3d2e8a1149bf5e14666fb43934b4bd93317d6e4942f9fe65794ea6f060b2ba37d04e587a7c31d01acd250b3fa17b4c32b5493758c3b38dc365dd5b6803728dac74345b598ad10367d3d8b1427f78d6c73be68eba24b5efdfc35c138206dded68a254ee42d1dac5de19212caf2198f49a39eef996c5b257054bcb3853f1bbb354dbc98f0c23c822df6f071fe18b32ad447ab9c927721aa917d21e7ad87b375408993a403366ff6cca8d40b1e0e5cbdfdf89424c6d4a582415bf34e1d4629de9baf43f1d2628441005a8520d79165516f42217edb68814ce526e66572a30f0734ddc1713430b977fd280c899e8e8aaa787209e21006d6ac07229884aea87445701aee4c5d876fe8727e6fa15ba4cc0f503683b861ea2d5d0275e52877af2710acba713c393e32ab6ba3bbae5e3af2d254ec714f53c928132891f436a182dd41213b797890b1490c76489071351efc522ed6d720cab1accc4628ddfc19783ddf67e0c7656b20000823d01c957b17f60920b6789c585012e6d5b65f1131aae8e726ef7c81f12562a2a41a55961e5740c8766132cb659cff27aa5593b3da605251c2314ebb7819add950ea44b8ad0565af9ec59191032b690e86d95d363d07985b91943239032b5e1ce23f46950c167610a34136a08eb5211aa16b67b0320a2efaa65a8b215121a329b2fbcd89909a5085ab860a9834a5fb856f92f948e516f9fe85436d3c098d2bf8048837508e8322cd5fadf5955624f50f1cff8112b4e2e5742a3db63f8536bf314d84e82f973ed9cdceb67dd7c7e30317f12e8f6ace854353c19a971bb86a49d13f869a103fc38b82df197a8f22cbc6d33c712e797cb89c4d63261af7e43ff8ac2c7795801eefe3ea422a9c5ed4b0e1fb1fc22f29103405ec5bb383a46e3f5a3b2477ba367fc6d39cd656929bb7c0ddae26e3229bc726bb8d1ad6c9777c354bfb9f37c0fb5349c84c2987227537c2decd0bc285bda1645008b3ccb583e1a3e33bb944b361040289a23b86e2f676bb5cbf9d50bc3eb5d8cb9c668b127ed6b5560ea31abf54b403848e928274b8cd3f3352bc7c1a4f7effc107dc56cbc1d00cac9034d70a7f6e6ce5f8f025553de9ae2a95f35f0df0476b1d05387e375a12dfb840817fd0216c1f9f01dcb732bc4846143bcd7fb49ea8b74bfa300bc2000f139639e9782d0f77aaaedf0cffe74f410c30ffc40bfa2d0d9fca3ff9b05636387e9c54db6755a64e521bdfdf7e2c5ec7407161540833448944d72b51a56d618dd0c752ea7afd5e33d2148922e50432daf01579f24951e81ee5e58c8dfc361348c726c26018b2cf88711f90c512184e3bb470221360268013524205183566f86e0781a6797e8ff5e3168f6ffd5cf676de127012fa3177d0ef6eb836f3e196d69897683aa4a0f1b4f834473da20ee4987e1adf9984f5b5ec352478bf6df3d623ce4ff0d9c9d7d442d24d82bcff34370383b7851bd05c52e0ee033b68dc5ee46d7edbc9e385c60c2663e61934ec8be11fcf4865e60db9156dffed577626621e94dce00036f1bbe338bf97f9db8864c6bcc6acd70dbbb1ea500c08af353f2ed84e45b0cd3f51ec6d6c5587aa7ba44e68791c5394e576166d3232b9c98c7c6570516c4094bc4c6041639081057ad73652e507667452e331eb32dbdc441d474d81e93944ee9a2d88e4f62652eb0e5572d511094936ea917bfc03de5efbdcbd4233bbef2653e3c02e1b705914288cd4ea187b8bfec5b8f47cba7a95deb884a68cb2621a1792385fd4e82d870317813846d5dbb25a9769425b5e48e3bb4457b976496f8533ea9064f8ded5c4973bfd8104fb8f8e67366ec56ae792c33ca1c22e16c0f611869bea3f8202ae380269a663fb013e0ab7283557c5de017f43b51e625e8e70a7db7a88b7aa27d6058297bec15c0088077bfd64e05d8c6475e901db68cff5284532b9a879e53b5ec0338e9444ff9436a31a55eaca85a3563722b699152809953ec2d55a023c7f6c4fbd214bb7b33aabcffe2ff8c58d6716807f129d605798f76e443a1eacbf09a0a37b2647d66765d45ad35a98b30ba77a466d9edb86f7f7356ca3826c031ae2bc706dd0a4539e723c0034116b59b68b4185b0d18fcc7239420e8b706a55ebeade42dcd450dc88c432a968c2bd016adc00981bbc8b02f495e74442d052669b6569093086bb41a98f30318d1b4b4b07ad7ca0f09e46d0fe1749e1523c071ab0190b89f8ec15f7db2b7d41f659eef8e7115cf318cd790e8c178f17482793679c785ef332417da937f5199730a110624faf8a56d0a64055299e6fc370f2f78aace3e1b710a43e29a8d04ba17a6d6b22488d18e022d30842c602481054d7ba0fa04a7e65e75bc5d8d145616b1fafdbc64625044fd72b3b8a97b035260f7a9ac4d58d8be65af2d26e92c82a3be0d0de6216e988aca899e3d38171206f0e45145023fb314dd029aa091f613210f5dc61460938c4dcbcd558046ed986bac7b75884a2b5a71722b2e60fb817f6d025cd3f50674effca03f209c67f6c13a209b12337d5e2681c9787c6450aab79c7df430926f2240abf4ddb04dc3b196f57cfde616ed8f979226265f2d95748f2e01952d0a1f50709d17b39f463784ad26d0ea328b5f9f60cf99e5bc3db71933fd47fed94c041c4395de0134636fd674bc3b3ee451c613abd7f1f0c481a509e25e49d6c3d92c951ac73609942ac257c782f6053de12ba27f9cff846616aa9071257efff147803cde398c01baacbfd472634eb371158a38ee832d23a61be07fc1850d7c2b0c26a2f7bba792990290b5bac995fc60faa0f37f7a320ac9b924e80c2f35885303d42e128d93178a429b1072fe72f1145562f2c0da7663e41d884e503c94bdf29fd846d4409a1313322201af2bb06a32ed4a927398c15140114c594e6bfdaa14876a5023933a5c4ae161587f0334610b953fcfcf39b4ff75148d0f2a2235d825680ef1a9f9fd5056f88ee7e23d2a7001cafeeb965291dd3537c7bcd489045faeefdcc38f56c47772e6e09063cd612e178b1aec912e3b48fb12d19f038664721d8eefeb198855dccd9d71c12b19b8c488214a50d03126cd9edbc7c22959064b62ebc34d28de22d01a6b2361afb66f70a749cd77a0197f8f1144ea53f15c52498638f2450531da94bc38bb2fb9ba465ff6d67ee5532289cf1dcee277f87f8e925430e8259fa901b996a2ed27e99a404a5c09de1868da9fcdaad2e76abeb7234eccf7787a56baecda7fcc3f0b1c0e970fce90dd0d65b2570fa1e68f418b2fb067706081253aab8c7c646ff6d68e697b58356f99956ab40cafdf20697818a0aff3f00d9fee4d22b4dd6b39e3cf14b10f23a2b808f2fc105b468e8ef0960d1af4e577a2f63e3a18c8f15d88358baf4d05921a5f219413c569132eaf71d258bd3547a35e6c9cc8d7fc0cfa0f2ac4c2c5afe14e3e5a70631525a3af855570627a1a4eef84df21e021578bba9b9fe373ea78581cfff02f8bb6913443d1d2c062023d3fbafa8e3c36e0ca01466e4ec12d8cfe728554e4fce579939a7392b73188277306abc28b495a335f1b2ff0f47ab403dbcd1bd709092e47274631ff40205f87789114bebc6488773428fa3aa4d013978800fdcd8b4e29c507f47f7295028427214d56c1fecfc8c63b228636aa939c03e4aab041150b13dfb7a442f0b8880d9c19ac4c8f1842b6a566d4ae70c5482f2980efec692cbab988d60ea65081d973745847b04949bfa9b38d203f16f988cf9a33b1b8f2029077edb20358395e4e344189ac4a74a67cc885c1950c26f81a121612665e3f2db07688196ee2001a773dfa37274857f3e8f6bed6e6804179eaeb30b1c6984e656764f93324552b8e81f8c8e2fedd34b5f918e16e9d3bbd743149b3de751e8dd796f8cff73b6f2ec41a1ffa32f18e1ec4643fb2e5f33ee5508ba301fe9534958f067408b59cc251aaacb8b5cbe82b62a4d466cd7a32e82d33a205c3de1b4e90aa087158355d41b219a383bfd975bd1fcb3fef230afb2d8b0558658a1d13b4e90c9eb6f2922148cac51e9630631510f91c3e589fbb6426942a6ea8cc0628608d8a8aac4af7f05bc2ecf2f6cdd61bc43e1d2d5a49a2c4bc160088004d7a87e316b4cc5b590f9e2e79a056cb3c9a3b49a49441180be0f6f1192e843029550e085c1b03f28dd88a71c1242d0098f5b2f9206bb0d7a7874b12284a0a5fe51f0d3f89aa2426b98530488dfdd53948729eefbb54be278f903a7b0dde754c9d4b08157d8ae6500b3984a63595db63e13ebb11954c2a1a2e8dd006b0ac22a454d8120f2e61ab168819d54005e44eed8a2fe694c962aad1a31fd59e44f3ac30751dca039b8bb2fa5e69a139bde70013cbb9227ade15198d31b73e8b6d817878a30d51b862db6c10136c21cb8c2c2efc0ebe1559684ad787d29182d20631908e6e2b8c32fb8b65698ad383186985002f1a644de8cd4e1486ddc368bf78e84770b729bda3a14656193869c7eee62e7b297b747368f06949c0368cd3e2746ef114bc22dc2e0bb2ba9583e68b439cdf8053555766b82d7a9b02223860aab79d62008924f6d2e5d56c3a007f7073e2779b1ac25eda60bd2137c093ef152077abf98e8c7583e3b5fb515b7f12a8eadbfd1842b1842b971c459a23052569efc752f8f9f8328eeee48e0f89f0c3070d4f61b19c664f7e10ead8f4726058054b4585c41e04f4b5902082a14ed214da73c0d904a127e6f2bbd2bc1ce0f11c8db0aebaef4c01bfecdcc7d3bc55b56568de970143e398feb821fd5e0ddd77ce6a3e363eee5bb53ced1473e7688c3246aab346635a2effa6cb54de75e35e0a2cf80124e7947804b92ca074734b11f4d8b24b24c50f100520619b2fab20816d89b689ee80afe7a2b068d37fa6968f767d9d5cc7d9b97db066fda5770632bf16dfd7c7f3cbc2813f05df712633471d4895e933174686fb45525db34f45b80b71d789961a80fdfb82ddcce12a2880e16ddac4c9ff79f3e0ab8f55cd4b5d978bec17f0f411c72ea69b840a22957b4c70f1e7161b21e39f8e867f1c9c48b9fbdabc25fdb7ef3ffd961514289a4a17097266edf0601dc32d5c751f114f79253369f9111597770d2ad59f7d0b3e9ca6cd3732f7fbce59c87d94ec4860633ebfad47f41697e6c5c7588d73e91552a7103afa9ee3b656095414724887d6750b5c2dd2a64fd499bfed2707ca666cc4eb7c8fb23eb37efefbdec2f2ea7ec2e263f048b066bc880c6cab2fbf47ef126c25631df7af1b1ba4437ced6a64815a7a4276ca851c6a9c921ba62b5b37ceac404a22e460070a4dc6175ecc6d58645abd8ef56200ec99cfc4eaa380126f7e2e851065490cdca89b5caf673d6af79c26f6db5810b64f68cf46c9800e1f6328cae6cf245d762abe60a71b3a26a31a0098aac15bed0df4a85c4573fa544390efc6078236a387319c0a5c0c9ee88de97cbc242050ada609ae2a040e04d846f02e4980978079021b80e071f08f7b205cbaec12dcfe14b0e1d255b5d0ffc12b8aeb1396f1dfc1ddf15f93ee92a8800cf66f920f3f85da10e95d6019de244d13d88bc3b2ef356a0559eedb1b66f96d66ab104dcf6aef99188f45a5649632d78c5adab3b989b170b30840c40c44c88caea48fde8dece6e6e920b6453911f42d9ec047b9b49dc1a9846c541cd053af74dd26164c1a2ac5fda31009aa1041b1f16e970eae2641d5fbd6e00608eefc44eb34e7cfdce0a5b12ea14146739c6a3301f7a69f55b304de32b8347da452253bd9cb1f36add83ea8258b7db166746bb4b492691d246c21c0ce107c6970411cf94b775a4f01579821ae6c3002483e82b18ea45fec14fe45e5c2698e0ca757788ed6ac561f38314f7a5e43ea42f732ba835253a176d8aa915293473f628fdf4a4a7d77a20b3cf5380fcbee7b8f0248e7b8bddae1515763114cd6244e38647c5ea00b6c964e2f59b56c3adaa0bd693ae9798b2d7ca6a57ba99020e25a3c8cdd73194ecd4613186aa82a9f5192b9a5de7a4b9d3534b468f83ce145e37e56591564adbb38cc42c1ab6a6e8728973e2cb0c8817c0c3ef109c67679405d465b12267e799d0a7e4cbdf6c6eadf4f911ed7225fb3bc9f32ff0a282a3a8d6d8e278fec51b666236d5989518d84c4ccd3f5645e1c203e5f78b7b80757552520801b042d9bda43cdd9e09de4285e73056569f14e20bd1fc8887c06076a664d0cc40e5691e09dc2217d65289b8cbd9a931ddedacae5ed955af8aef6bc40854d1742bc9971186be98781220ca16fb93d007ce02a3eef8bd5ac08a056dd3a2ce06b92e6e0942014433ccec66b2db90bc24bc0525d0f610d1af9325663caf72bbc7331d4e1a0e4143ebb2fbd50a61ca29f156bc1c12a2a9c793fecfcd2d38a3ea44e0bb0b2cab7d871cae675b2ceaaa2fd2616211ba17005c26acf56d715d587dedfac3cd318945cfe5a6da6801a0617b529162c83a21cb7ee73e921f57ecb51186987ccc16dce12356d6b3b94a4faffc9701287999dc5b0b654a5e7e1b535f2c2b4ac1a7af85a6ef95b757a293562f3795c331acb2fdc8bca020518fdbbf414dc726d8773c51143722eab0475fa05b1c00a25d6227d489ec6b798486b02adbf3c81a840099c936a6e6391fd285e4c08247203acc2d04109ae662619db30807a57fdb0ec3674e07d68c524cdde86ca8c7529dcebeb7058825254b5e2bc2f655a69b2035cdb83751984c4f1889f915235acba624c650b6a655b6a4aa1fd8965b1452de76300bd438725bcf67a89320288861f02c2b376593487bb00329b98f0ae9bd718d540ec3375f2c728e712a23c8a191f1ddd532bc37499129ad6aaf49a73cd8e364b7e600e9e213e6f0f735234a287521961af9e551ca9dad8dc89526f4884347bde33619572fb2d9fbbf3194cfed1c9b71fc5884870fe1b0f142c731d52695f37bda07c47a7ec253d1607d0e3dbdde5447855337bb4e9ffcd5f6d531fe499d983953211012300d1f5743263ff95132220ac74311c85ff7eefb7aadc1cf170eacb21e1e5048f22288863540c97708997ea963109ebe8a1d5118c2</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">主页支付宝转账5元，并留言文章标题获取密码！</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> Linux驱动 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux驱动 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>块设备驱动</title>
      <link href="/2024/04/12/%E5%9D%97%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/"/>
      <url>/2024/04/12/%E5%9D%97%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="一、块设备驱动引入"><a href="#一、块设备驱动引入" class="headerlink" title="一、块设备驱动引入"></a>一、块设备驱动引入</h1><h2 id="1-1-磁盘读写"><a href="#1-1-磁盘读写" class="headerlink" title="1.1 磁盘读写"></a>1.1 磁盘读写</h2><p>磁盘的读写慢在“磁头”的机械结构的定位上面。从一个“磁头”的某“柱面”某“扇区”读到数据后（步骤 R0），跳到另一个“磁头”的某“柱面”的某“扇区”去写（步骤 W0），接着再跳回原“磁头”相同柱面的下一个“扇区”去读（步骤R1）。</p><p>若按“字符设备”中的“opne”,”read”,”write”方式，则总体效率在硬盘上会非常低。<br>字符设备读写：“R0”–&gt;”W0”–&gt;”R1” —&gt; “磁头”跳转 2 次。<br>调整顺序优化：“R0”–&gt;”R1”–&gt;”W0” —&gt; “磁头”跳转 1 次。</p><p>总结：先不执行读&#x2F;写操作，而是放入队列，优化后再执行。若按“字符设备驱动”那样的读写步骤会在硬盘上反复横跳，整体效率会非常低。所以有必要引入“优化过程”。即：读&#x2F;写操作先不执行，先放到某个“队列”中（调整顺序优化），最后再执行磁盘真正的读&#x2F;写操作</p><h2 id="1-2-Flash读写"><a href="#1-2-Flash读写" class="headerlink" title="1.2 Flash读写"></a>1.2 Flash读写</h2><p>Flash分为很多“块”，“块”里有很多的扇区。Flash 要先擦除再写， 擦除是整“块”进行的。若现在要写同一“块”的“扇区 0”和“扇区 1”。用“字符设备驱动”的方式来写：<br>① 先把Flash的这个“块”读到一个 buf 中。<br>② 然后修改 buf 中“扇区 0”对应位置的数据。<br>③ 擦除Flash的这个“块”。<br>④ 把修改过“扇区 0”数据的buf烧写到Flash的这个“块”。<br>⑤ 以相同的操作写“扇区1”<br>故：当要修改多个扇区时会多次擦除烧写动作。总体效率低下。</p><p>“块设备驱动”的方式来写：<br>① 先不执行。<br>② 优化 - 合并后执行。<br>    a. 读出Flash的这个“块”到 buf 中。<br>    b. 在buf中修改“扇区 0”和“扇区 1”对应位置的数据。<br>    c. 擦除Flash的这个“块”。<br>    d. 把修改过“扇区 0”和“扇区 1”数据的buf烧写到Flash的这个“块”。<br>故：“块驱动”不提供“字符设备驱动”那样直接读写IO的函数，其步骤可概括为：<br>① 先把读写请求放入队列，先不执行。<br>② 优化后再执行。</p><h1 id="二、块设备驱动框架"><a href="#二、块设备驱动框架" class="headerlink" title="二、块设备驱动框架"></a>二、块设备驱动框架</h1><h2 id="2-1-层次架构"><a href="#2-1-层次架构" class="headerlink" title="2.1 层次架构"></a>2.1 层次架构</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">用户app: open,read,write &quot;1.txt&quot;</span><br><span class="line">-----------------------------  文件的读写</span><br><span class="line">文件系统: vfat, ext4, yaffs2... (把文件的读写转换为扇区的读写)</span><br><span class="line">---------ll_rw_block---------  扇区的读写</span><br><span class="line">       1. 把&quot;读写&quot;放入队列</span><br><span class="line">       2. 调用队列的处理函数(优化/调顺序/合并)</span><br><span class="line">-----------------------------</span><br><span class="line">       块设备驱动程序     </span><br><span class="line">-----------------------------</span><br><span class="line">真实硬件:  硬盘, flash</span><br></pre></td></tr></table></figure><p>对普通文件 1.txt 的读写会转成对块设备的读写，即要读写哪个扇区。从文件的读写转成对扇区的读写，中间会涉及到“文件系统”。普通的文件转换成对扇区的读写，是由“文件系统”转换。比如：要写一个很小的数据到txt文件某个位置时，由于块设备写的数据是按扇区为单位，但又不能破坏txt文件里其它位置，那么就引入了一个“缓存区”，将所有数据先读到缓存区里，然后修改缓存数据，最后将整个数据放入txt文件对应的某个扇区中。</p><p>当txt文件多次写入很小的数据的话，就会重复不断地对扇区读出、写入，这样会浪费很多时间在读&#x2F;写硬盘上，所以内核提供了一个队列机制：在没有关闭txt文件之前，会将读&#x2F;写请求进行优化、排序、合并等操作，从而提高访问硬盘的效率。ll_rw_block 是通用的入口，会把“读&#x2F;写”放入队列，调用队列的处理函数去优化（调顺序、合并），最后执行真正的读&#x2F;写操作。</p><h2 id="2-2-ll-rw-block分析"><a href="#2-2-ll-rw-block分析" class="headerlink" title="2.2 ll_rw_block分析"></a>2.2 ll_rw_block分析</h2><p><img src="1.ll_rw_block%E8%B0%83%E7%94%A8%E5%B1%82%E6%AC%A1.png" alt="1.ll_rw_block调用层次"></p><p>① 分析ll_rw_block()函数(fs&#x2F;buffer.c)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//rw: 读写标志位,  nr: bhs[]长度,  bhs[]: 要读写的数据</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">ll_rw_block</span><span class="params">(<span class="type">int</span> rw, <span class="type">int</span> nr, <span class="keyword">struct</span> buffer_head *bhs[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i; </span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; nr; i++) &#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">buffer_head</span> *<span class="title">bh</span> =</span> bhs[i]; <span class="comment">//获取nr个buffer_head</span></span><br><span class="line">        ... ...</span><br><span class="line">        <span class="keyword">if</span> (rw == WRITE || rw == SWRITE) &#123;</span><br><span class="line">            ... ...</span><br><span class="line">            submit_bh(WRITE, bh); <span class="comment">//提交WRITE写标志的buffer_head</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中buffer_head结构体为缓冲区描述符，存放缓存区的各种信息，定义如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">buffer_head</span> &#123;</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> b_state;               <span class="comment">//缓冲区状态标志 </span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">buffer_head</span> *<span class="title">b_this_page</span>;</span>     <span class="comment">//页面中的缓冲区 </span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">page</span> *<span class="title">b_page</span>;</span>                 <span class="comment">//存储缓冲区位于哪个页面</span></span><br><span class="line">    <span class="type">sector_t</span> b_blocknr; 　　　　　　　　　　<span class="comment">//逻辑块号</span></span><br><span class="line">    <span class="type">size_t</span> b_size; 　　　　　　　　　　　　　<span class="comment">//块的大小</span></span><br><span class="line">    <span class="type">char</span> *b_data; 　　　　　　　　　　　　　 <span class="comment">//页面中的缓冲区</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">block_device</span> *<span class="title">b_bdev</span>;</span> 　　　　 <span class="comment">//块设备,来表示一个独立的磁盘设备</span></span><br><span class="line">    <span class="type">bh_end_io_t</span> *b_end_io; 　　　　　　　　<span class="comment">//I/O完成方法</span></span><br><span class="line">    <span class="type">void</span> *b_private; 　　　　　　　　　　　 <span class="comment">//完成方法数据</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">b_assoc_buffers</span>;</span> 　 <span class="comment">//相关映射链表</span></span><br><span class="line">    <span class="comment">/* mapping this buffer is associated with */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">address_space</span> *<span class="title">b_assoc_map</span>;</span>   </span><br><span class="line">    <span class="type">atomic_t</span> b_count; 　　　　　　　　　　　<span class="comment">//缓冲区使用计数 </span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>②  进入submit_bh()中：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">submit_bh</span><span class="params">(<span class="type">int</span> rw, <span class="keyword">struct</span> buffer_head * bh)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* 分配一个bio(block input output)，块设备i/o */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">bio</span> *<span class="title">bio</span> =</span> bio_alloc(GFP_NOIO, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">/* 根据buffer_head(bh)构造bio */</span></span><br><span class="line">    bio-&gt;bi_sector = bh-&gt;b_blocknr * (bh-&gt;b_size &gt;&gt; <span class="number">9</span>);</span><br><span class="line">    bio-&gt;bi_bdev = bh-&gt;b_bdev; <span class="comment">//存放对应的块设备</span></span><br><span class="line">    bio-&gt;bi_io_vec[<span class="number">0</span>].bv_page = bh-&gt;b_page;</span><br><span class="line">    bio-&gt;bi_io_vec[<span class="number">0</span>].bv_len = bh-&gt;b_size;</span><br><span class="line">    bio-&gt;bi_io_vec[<span class="number">0</span>].bv_offset = bh_offset(bh);</span><br><span class="line">    ... ...</span><br><span class="line">    <span class="comment">/* 提交bio */</span></span><br><span class="line">    submit_bio(rw, bio); </span><br><span class="line">    ... ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>submit_bh()函数通过buffer_head构造bio，然后调用submit_bio()提交。如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">submit_bio</span><span class="params">(<span class="type">int</span> rw, <span class="keyword">struct</span> bio *bio)</span></span><br><span class="line">&#123;</span><br><span class="line">    ... ...</span><br><span class="line">    generic_make_request(bio); </span><br><span class="line">        <span class="comment">/* 最终会调用__generic_make_request()提交bio */</span></span><br><span class="line">        __generic_make_request(bio);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>③ __generic_make_request()函数如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">void</span> __generic_make_request(<span class="keyword">struct</span> bio *bio)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">request_queue_t</span> *q;    </span><br><span class="line">    <span class="type">int</span> ret;  </span><br><span class="line">    ... ...</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        q = bdev_get_queue(bio-&gt;bi_bdev); <span class="comment">//通过bio-&gt;bi_bdev获取申请队列q</span></span><br><span class="line">        ... ...</span><br><span class="line">        ret = q-&gt;make_request_fn(q, bio); <span class="comment">//提交申请队列q和bio</span></span><br><span class="line">    &#125; <span class="keyword">while</span> (ret);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个q-&gt;make_request_fn()又是什么函数？到底做了什么，搜索make_request_fn，它在blk_queue_make_request()函数中被初始化为mfn这个参数：</p><p><img src="2.blk_queue_make_request.png" alt="2.blk_queue_make_request"></p><p>继续搜索blk_queue_make_request，找到它被谁调用，赋入的mfn参数是什么，如下图，找到它在blk_init_queue_node()函数中被调用： </p><p><img src="3.mfn%E5%8F%82%E6%95%B0.png" alt="3.mfn参数"></p><p>最终q-&gt;make_request_fn()执行的是__make_request()函数</p><p>④  __make_request()函数，对提交的申请队列q和bio做了什么？</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> __make_request(<span class="type">request_queue_t</span> *q, <span class="keyword">struct</span> bio *bio)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">request</span> *<span class="title">req</span>;</span> <span class="comment">//块设备本身的队列</span></span><br><span class="line">    ... ...</span><br><span class="line">    <span class="comment">/* (1)将之前的申请队列q和传入的bio,通过排序,合并在本身的req队列中 */</span></span><br><span class="line">    el_ret = elv_merge(q, &amp;req, bio);</span><br><span class="line">    ... ...</span><br><span class="line">    <span class="comment">/* (2) 执行申请队列的处理函数 */</span></span><br><span class="line">    __generic_unplug_device(q);     </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>a. 上面的elv_merge()函数，就是内核中的电梯算法(elevator merge)。比如申请队列中有以下6个申请：4(in),2(out),5(in),3(out),6(in),1(out)。其中in：写出；out：读入。最后执行下来就会排序合并：先写出4,5,6,队列，再读入1,2,3队列。</p><p>b.  __generic_unplug_device()函数如下:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __generic_unplug_device(<span class="type">request_queue_t</span> *q)</span><br><span class="line">&#123;      </span><br><span class="line">    <span class="keyword">if</span> (unlikely(blk_queue_stopped(q)))</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (!blk_remove_plug(q))</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">/* 调用队列的“处理函数” */</span></span><br><span class="line">    q-&gt;request_fn(q);         </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最终执行申请队列的处理函数：q的成员request_fn()函数，它是操作硬件的函数，如果是RAM模拟磁盘会执行memcopy；如果是真实块设备会执行擦除烧写动作。</p><h2 id="2-3-块设备驱动编写步骤"><a href="#2-3-块设备驱动编写步骤" class="headerlink" title="2.3 块设备驱动编写步骤"></a>2.3 块设备驱动编写步骤</h2><ol><li>以面向对象的思想分配gendisk结构体。用alloc_disk函数。</li><li>设置 gendisk 结构体。<br> ① 分配&#x2F;设置一个队列：request_queue_t(提供读写能力)，即设置request_fn()处理函数。用blk_init_queue函数。<br> ② 设置gendisk其他信息(提供磁盘属性：磁盘容量，扇区大小等)，这样块设备才能分区。</li><li>注册gendisk结构体。用add_disk函数。</li></ol><p><img src="4.%E6%B3%A8%E5%86%8Cgendisk.png" alt="4.注册gendisk"></p><p><img src="4.request_fn.png" alt="4.request_fn"></p><h1 id="三、RAM模拟块设备程序"><a href="#三、RAM模拟块设备程序" class="headerlink" title="三、RAM模拟块设备程序"></a>三、RAM模拟块设备程序</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* 参考:</span></span><br><span class="line"><span class="comment"> * drivers\block\xd.c</span></span><br><span class="line"><span class="comment"> * drivers\block\z2ram.c</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/interrupt.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/mm.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/fs.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/timer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/genhd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/hdreg.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/ioport.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/blkdev.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/blkpg.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/delay.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/io.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;asm/system.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;asm/uaccess.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;asm/dma.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">gendisk</span> *<span class="title">ramblock_disk</span>;</span></span><br><span class="line"><span class="type">static</span> <span class="type">request_queue_t</span> *ramblock_queue;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> major;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="title function_">DEFINE_SPINLOCK</span><span class="params">(ramblock_lock)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RAMBLOCK_SIZE (1024*1024)</span></span><br><span class="line"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">char</span> *ramblock_buf;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">ramblock_getgeo</span><span class="params">(<span class="keyword">struct</span> block_device *bdev, <span class="keyword">struct</span> hd_geometry *geo)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* 容量 = heads * cylinders * sectors * 512 */</span></span><br><span class="line">geo-&gt;heads     = <span class="number">2</span>;</span><br><span class="line">geo-&gt;cylinders = <span class="number">32</span>;</span><br><span class="line">geo-&gt;sectors   = RAMBLOCK_SIZE/<span class="number">2</span>/<span class="number">32</span>/<span class="number">512</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">block_device_operations</span> <span class="title">ramblock_fops</span> =</span> &#123;</span><br><span class="line">.owner= THIS_MODULE,</span><br><span class="line">.getgeo= ramblock_getgeo,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">do_ramblock_request</span><span class="params">(<span class="type">request_queue_t</span> * q)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> r_cnt = <span class="number">0</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> w_cnt = <span class="number">0</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">request</span> *<span class="title">req</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 数据传输三要素: 源,目的,长度 */</span></span><br><span class="line"><span class="keyword">while</span> ((req = elv_next_request(q)) != <span class="literal">NULL</span>) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 源/目的: */</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> offset = req-&gt;sector * <span class="number">512</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 目的/源: */</span></span><br><span class="line"><span class="comment">// req-&gt;buffer</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 长度: */</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> len = req-&gt;current_nr_sectors * <span class="number">512</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (rq_data_dir(req) == READ)</span><br><span class="line"><span class="built_in">memcpy</span>(req-&gt;buffer, ramblock_buf+offset, len);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">memcpy</span>(ramblock_buf+offset, req-&gt;buffer, len);</span><br><span class="line"></span><br><span class="line">end_request(req, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">ramblock_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* 1. 分配一个gendisk结构体 */</span></span><br><span class="line">ramblock_disk = alloc_disk(<span class="number">16</span>); <span class="comment">/* 次设备号个数: 分区个数+1 */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 2.0 设置 */</span></span><br><span class="line"><span class="comment">/* 2.1 分配/设置队列: 提供读写能力 */</span></span><br><span class="line">ramblock_queue = blk_init_queue(do_ramblock_request, &amp;ramblock_lock);</span><br><span class="line">ramblock_disk-&gt;<span class="built_in">queue</span> = ramblock_queue;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 2.2 设置其他属性: 比如容量 */</span></span><br><span class="line">major = register_blkdev(<span class="number">0</span>, <span class="string">&quot;ramblock&quot;</span>);  <span class="comment">/* cat /proc/devices */</span></span><br><span class="line">ramblock_disk-&gt;major       = major;</span><br><span class="line">ramblock_disk-&gt;first_minor = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">sprintf</span>(ramblock_disk-&gt;disk_name, <span class="string">&quot;ramblock&quot;</span>);</span><br><span class="line">ramblock_disk-&gt;fops        = &amp;ramblock_fops;</span><br><span class="line">set_capacity(ramblock_disk, RAMBLOCK_SIZE / <span class="number">512</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 3. 硬件相关操作 */</span></span><br><span class="line">ramblock_buf = kzalloc(RAMBLOCK_SIZE, GFP_KERNEL);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 4. 注册 */</span></span><br><span class="line">add_disk(ramblock_disk);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">ramblock_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">unregister_blkdev(major, <span class="string">&quot;ramblock&quot;</span>);</span><br><span class="line">del_gendisk(ramblock_disk);</span><br><span class="line">put_disk(ramblock_disk);</span><br><span class="line">blk_cleanup_queue(ramblock_queue);</span><br><span class="line">kfree(ramblock_buf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(ramblock_init);</span><br><span class="line">module_exit(ramblock_exit);</span><br><span class="line"></span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br></pre></td></tr></table></figure><h1 id="四、Nand-Flash驱动分析"><a href="#四、Nand-Flash驱动分析" class="headerlink" title="四、Nand Flash驱动分析"></a>四、Nand Flash驱动分析</h1><h2 id="4-1-Nand-Flash引入"><a href="#4-1-Nand-Flash引入" class="headerlink" title="4.1 Nand Flash引入"></a>4.1 Nand Flash引入</h2><p><strong>1. 问题与回答：</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">问1：原理图上NAND FLASH和S3C2440之间只有数据线，怎么传输地址？</span><br><span class="line">答1：在DATA0～DATA7上既传输数据，又传输地址。当ALE为高电平时传输的是地址。</span><br><span class="line"></span><br><span class="line">问2：从NAND FLASH芯片手册可知，要操作NAND FLASH需要先发出命令。怎么传入命令？</span><br><span class="line">答2：在DATA0～DATA7上既传输数据，又传输地址，也传输命令。</span><br><span class="line">当ALE为高电平时传输的是地址，当CLE为高电平时传输的是命令。</span><br><span class="line">当ALE和CLE都为低电平时传输的是数据。</span><br><span class="line"></span><br><span class="line">问3：数据线既接到NAND FLASH，也接到NOR FLASH，还接到SDRAM、DM9000等。怎么避免干扰？</span><br><span class="line">答3：这些设备要访问之必须&quot;选中&quot;。没有选中的芯片不会工作，相当于没接一样。</span><br><span class="line"></span><br><span class="line">问4：假设烧写NAND FLASH，把命令、地址、数据发给它之后，怎么判断传输完成？</span><br><span class="line">答4：通过状态引脚RnB来判断：它为高电平表示就绪，它为低电平表示正忙。</span><br><span class="line"></span><br><span class="line">问5：怎么操作NAND FLASH呢？</span><br><span class="line">答5：根据NAND FLASH的芯片手册，一般的过程是：发出命令，发出地址，发出数据/读数据。</span><br></pre></td></tr></table></figure><p><strong>2. NAND FLASH操作：</strong></p><p><img src="5.nand_flash%E6%93%8D%E4%BD%9C.png" alt="5.nand_flash操作"></p><p><strong>3. 用UBOOT来体验NAND FLASH的读ID：</strong></p><p><img src="5.uboot%E8%AF%BBID.png" alt="5.uboot读ID"></p><p><strong>4. 用UBOOT来体验NAND FLASH的读内容(读0地址的数据)：</strong></p><p>先用UBOOT命令读出NAND FLASH 0地址的内容: </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nand dump 0</span><br><span class="line">Page 00000000 dump:</span><br><span class="line">17 00 00 ea 14 f0 9f e5  14 f0 9f e5 14 f0 9f e5</span><br></pre></td></tr></table></figure><p>再用UBOOT操作NAND FLASH控制器读出0地址内容：</p><p><img src="5.uboot%E8%AF%BB%E5%86%85%E5%AE%B9.png" alt="5.uboot读内容"></p><p><strong>5. nand flash驱动框图：</strong></p><p><img src="5.nand%E9%A9%B1%E5%8A%A8%E6%A1%86%E6%9E%B6.png" alt="5.nand驱动框架"></p><p><strong>6. 驱动注册流程：</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">s3c2410_nand_inithw</span><br><span class="line">s3c2410_nand_init_chip</span><br><span class="line">nand_scan  <span class="comment">// drivers/mtd/nand/nand_base.c 根据nand_chip的底层操作函数识别NAND FLASH，构造mtd_info</span></span><br><span class="line">nand_scan_ident</span><br><span class="line">nand_set_defaults</span><br><span class="line"><span class="title function_">if</span> <span class="params">(!chip-&gt;select_chip)</span></span><br><span class="line">chip-&gt;select_chip = nand_select_chip;</span><br><span class="line"><span class="keyword">if</span> (chip-&gt;cmdfunc == <span class="literal">NULL</span>)</span><br><span class="line">chip-&gt;cmdfunc = nand_command;</span><br><span class="line"><span class="keyword">if</span> (!chip-&gt;read_byte)</span><br><span class="line">chip-&gt;read_byte = nand_read_byte;</span><br><span class="line">nand_get_flash_type</span><br><span class="line">chip-&gt;select_chip(mtd, <span class="number">0</span>);</span><br><span class="line">chip-&gt;cmdfunc(mtd, NAND_CMD_READID, <span class="number">0x00</span>, <span class="number">-1</span>);</span><br><span class="line">*maf_id = chip-&gt;read_byte(mtd);</span><br><span class="line">dev_id = chip-&gt;read_byte(mtd);</span><br><span class="line">nand_scan_tail</span><br><span class="line">mtd-&gt;erase = nand_erase;</span><br><span class="line">mtd-&gt;read = nand_read;</span><br><span class="line">mtd-&gt;write = nand_write;</span><br><span class="line">s3c2410_nand_add_partition</span><br><span class="line">add_mtd_partitions</span><br><span class="line">add_mtd_device</span><br><span class="line"><span class="title function_">list_for_each</span><span class="params">(this, &amp;mtd_notifiers)</span> &#123; </span><br><span class="line"><span class="comment">// 问. mtd_notifiers在哪设置？</span></span><br><span class="line"><span class="comment">// 答. drivers/mtd/mtdchar.c,mtd_blkdev.c调用register_mtd_user</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mtd_notifier</span> *<span class="title">not</span> =</span> list_entry(this, <span class="keyword">struct</span> mtd_notifier, <span class="built_in">list</span>);</span><br><span class="line">not-&gt;add(mtd);</span><br><span class="line"><span class="comment">// mtd_notify_add 和 blktrans_notify_add</span></span><br><span class="line">先看字符设备的mtd_notify_add</span><br><span class="line">class_device_create</span><br><span class="line">class_device_create</span><br><span class="line">再看块设备的blktrans_notify_add</span><br><span class="line"><span class="title function_">list_for_each</span><span class="params">(this, &amp;blktrans_majors)</span> &#123; </span><br><span class="line"><span class="comment">// 问. blktrans_majors在哪设置？</span></span><br><span class="line"><span class="comment">// 答. drivers\mtd\mdblock.c 或 mtdblock_ro.c   register_mtd_blktrans</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mtd_blktrans_ops</span> *<span class="title">tr</span> =</span> list_entry(this, <span class="keyword">struct</span> mtd_blktrans_ops, <span class="built_in">list</span>);              </span><br><span class="line">tr-&gt;add_mtd(tr, mtd);</span><br><span class="line">mtdblock_add_mtd (drivers\mtd\mdblock.c)</span><br><span class="line">add_mtd_blktrans_dev</span><br><span class="line">alloc_disk</span><br><span class="line"><span class="comment">// tr-&gt;blkcore_priv-&gt;rq = blk_init_queue(mtd_blktrans_request, &amp;tr-&gt;blkcore_priv-&gt;queue_lock);</span></span><br><span class="line">gd-&gt;<span class="built_in">queue</span> = tr-&gt;blkcore_priv-&gt;rq; </span><br><span class="line">add_disk           </span><br></pre></td></tr></table></figure><h2 id="4-2-驱动入口"><a href="#4-2-驱动入口" class="headerlink" title="4.2 驱动入口"></a>4.2 驱动入口</h2><p>参考s3c2440的nand flash驱动，drivers&#x2F;mtd&#x2F;nand&#x2F;s3c2410.c。</p><p><strong>为什么nand在mtd目录下？</strong></p><p>因为mtd(memory technology device 存储 技术设备 ) 是用于访问 memory 设备（ ROM 、 flash ）的Linux 的子系统。 MTD 的主要目的是为了使新的 memory 设备的驱动更加简单，为此它在硬件和上层之间提供了一个抽象的接口。</p><p>进入probe函数中，主要调用nand_scan()函数，add_mtd_partitions()函数，来完成注册nand  flash：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">s3c24xx_nand_probe</span><span class="params">(<span class="keyword">struct</span> platform_device *pdev, <span class="keyword">enum</span> s3c_cpu_type cpu_type)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* 初始化nand flash控制器，设置TACLS 、TWRPH0、TWRPH1时序等 */</span></span><br><span class="line">    s3c2410_nand_inithw(info, pdev);       </span><br><span class="line"> </span><br><span class="line">    <span class="comment">/* 设置nand chip结构体，分配接口函数 */</span></span><br><span class="line">    s3c2410_nand_init_chip(info, nmtd, sets);    </span><br><span class="line"> </span><br><span class="line">    <span class="comment">/* 构造mtd info结构体，并读取nand flash型号信息 */</span></span><br><span class="line">    nand_scan(&amp;nmtd-&gt;mtd, (sets) ? sets-&gt;nr_chips : <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 添加多个mtd分区，里面会调用add_mtd_partitions */</span></span><br><span class="line">    s3c2410_nand_add_partition(info, nmtd, sets);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-3-配置Nand-Flash控制器"><a href="#4-3-配置Nand-Flash控制器" class="headerlink" title="4.3  配置Nand Flash控制器"></a>4.3  配置Nand Flash控制器</h2><p>s3c2410_nand_inithw：初始化nand flash控制器，设置TACLS 、TWRPH0、TWRPH1时序等。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">s3c2410_nand_inithw</span><span class="params">(<span class="keyword">struct</span> s3c2410_nand_info *info,</span></span><br><span class="line"><span class="params">       <span class="keyword">struct</span> platform_device *pdev)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">s3c2410_platform_nand</span> *<span class="title">plat</span> =</span> to_nand_plat(pdev);</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> clkrate = clk_get_rate(info-&gt;clk);</span><br><span class="line"><span class="type">int</span> tacls_max = (info-&gt;cpu_type == TYPE_S3C2412) ? <span class="number">8</span> : <span class="number">4</span>;</span><br><span class="line"><span class="type">int</span> tacls, twrph0, twrph1;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> cfg = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">clkrate /= <span class="number">1000</span>;<span class="comment">/* turn clock into kHz for ease of use */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (plat != <span class="literal">NULL</span>) &#123;</span><br><span class="line">tacls = s3c_nand_calc_rate(plat-&gt;tacls, clkrate, tacls_max);</span><br><span class="line">twrph0 = s3c_nand_calc_rate(plat-&gt;twrph0, clkrate, <span class="number">8</span>);</span><br><span class="line">twrph1 = s3c_nand_calc_rate(plat-&gt;twrph1, clkrate, <span class="number">8</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">/* default timings */</span></span><br><span class="line">tacls = tacls_max;</span><br><span class="line">twrph0 = <span class="number">8</span>;</span><br><span class="line">twrph1 = <span class="number">8</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置TACLS 、TWRPH0、TWRPH1时序</span></span><br><span class="line">cfg = S3C2440_NFCONF_TACLS(tacls - <span class="number">1</span>);</span><br><span class="line">cfg |= S3C2440_NFCONF_TWRPH0(twrph0 - <span class="number">1</span>);</span><br><span class="line">cfg |= S3C2440_NFCONF_TWRPH1(twrph1 - <span class="number">1</span>);</span><br><span class="line">writel(cfg, info-&gt;regs + S3C2410_NFCONF);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使能 nand flash控制器</span></span><br><span class="line">writel(S3C2440_NFCONT_ENABLE, info-&gt;regs + S3C2440_NFCONT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-4-设置nand-chip结构体"><a href="#4-4-设置nand-chip结构体" class="headerlink" title="4.4  设置nand chip结构体"></a>4.4  设置nand chip结构体</h2><p>s3c2410_nand_init_chip：设置nand_chip结构体，为其分配底层接口函数。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">s3c2410_nand_init_chip</span><span class="params">(<span class="keyword">struct</span> s3c2410_nand_info *info,</span></span><br><span class="line"><span class="params">   <span class="keyword">struct</span> s3c2410_nand_mtd *nmtd,</span></span><br><span class="line"><span class="params">   <span class="keyword">struct</span> s3c2410_nand_set *<span class="built_in">set</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">nand_chip</span> *<span class="title">chip</span> =</span> &amp;nmtd-&gt;chip;</span><br><span class="line"><span class="type">void</span> __iomem *regs = info-&gt;regs;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 提供nand flash读写数据接口</span></span><br><span class="line">chip-&gt;write_buf    = s3c2410_nand_write_buf;</span><br><span class="line">chip-&gt;read_buf     = s3c2410_nand_read_buf;</span><br><span class="line"><span class="comment">// 提供nand flash 片选接口</span></span><br><span class="line">chip-&gt;select_chip  = s3c2410_nand_select_chip;</span><br><span class="line">chip-&gt;chip_delay   = <span class="number">50</span>;</span><br><span class="line">chip-&gt;priv   = nmtd;</span><br><span class="line">chip-&gt;options   = <span class="number">0</span>;</span><br><span class="line">chip-&gt;controller   = &amp;info-&gt;controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> (info-&gt;cpu_type) &#123;</span><br><span class="line"><span class="keyword">case</span> TYPE_S3C2440:</span><br><span class="line"><span class="comment">// 提供 nand flash控制器数据写入的寄存器地址</span></span><br><span class="line">chip-&gt;IO_ADDR_W = regs + S3C2440_NFDATA;</span><br><span class="line">info-&gt;sel_reg   = regs + S3C2440_NFCONF;</span><br><span class="line">info-&gt;sel_bit= S3C2440_NFCONF_nFCE;</span><br><span class="line"><span class="comment">// 提供nand flash 写命令或者地址接口</span></span><br><span class="line">chip-&gt;cmd_ctrl  = s3c2440_nand_hwcontrol;</span><br><span class="line"><span class="comment">// 提供nand flash 判断就绪或忙状态接口</span></span><br><span class="line">chip-&gt;dev_ready = s3c2440_nand_devready;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 提供 nand flash控制器数据读取的寄存器地址</span></span><br><span class="line">chip-&gt;IO_ADDR_R = chip-&gt;IO_ADDR_W;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-5-nand-scan-流程分析"><a href="#4-5-nand-scan-流程分析" class="headerlink" title="4.5 nand_scan()流程分析"></a>4.5 nand_scan()流程分析</h2><p><strong>nand_scan：</strong>最终目的是使用nand_chip结构体，构造出mtd_info结构体提供给MTD层，并读取nand flash型号信息。</p><p><img src="5.nand_scan.png" alt="5.nand_scan"></p><p><strong>nand_set_defaults()函数：</strong>为nand_chip中暂未设置的接口，分配系统默认的nand flash接口函数。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">nand_set_defaults</span><span class="params">(<span class="keyword">struct</span> nand_chip *chip, <span class="type">int</span> busw)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* check for proper chip_delay setup, set 20us if not */</span></span><br><span class="line"><span class="keyword">if</span> (!chip-&gt;chip_delay)</span><br><span class="line">chip-&gt;chip_delay = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* check, if a user supplied command function given */</span></span><br><span class="line"><span class="keyword">if</span> (chip-&gt;cmdfunc == <span class="literal">NULL</span>)</span><br><span class="line">chip-&gt;cmdfunc = nand_command;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* check, if a user supplied wait function given */</span></span><br><span class="line"><span class="keyword">if</span> (chip-&gt;waitfunc == <span class="literal">NULL</span>)</span><br><span class="line">chip-&gt;waitfunc = nand_wait;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!chip-&gt;select_chip)</span><br><span class="line">chip-&gt;select_chip = nand_select_chip;</span><br><span class="line"><span class="keyword">if</span> (!chip-&gt;read_byte)</span><br><span class="line">chip-&gt;read_byte = busw ? nand_read_byte16 : nand_read_byte;</span><br><span class="line"><span class="keyword">if</span> (!chip-&gt;read_word)</span><br><span class="line">chip-&gt;read_word = nand_read_word;</span><br><span class="line"><span class="keyword">if</span> (!chip-&gt;write_buf)</span><br><span class="line">chip-&gt;write_buf = busw ? nand_write_buf16 : nand_write_buf;</span><br><span class="line"><span class="keyword">if</span> (!chip-&gt;read_buf)</span><br><span class="line">chip-&gt;read_buf = busw ? nand_read_buf16 : nand_read_buf;</span><br><span class="line">......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>nand_get_flash_type()函数：</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="keyword">struct</span> nand_flash_dev *<span class="title function_">nand_get_flash_type</span><span class="params">(<span class="keyword">struct</span> mtd_info *mtd,<span class="keyword">struct</span> nand_chip *chip,<span class="type">int</span> busw, <span class="type">int</span> *maf_id)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* 调用nand_chip结构体的成员select_chip使能flash片选 */</span></span><br><span class="line">    chip-&gt;select_chip(mtd, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">/* 调用nand_chip结构体的成员cmdfunc发送读id命令 */</span></span><br><span class="line">    chip-&gt;cmdfunc(mtd, NAND_CMD_READID, <span class="number">0x00</span>, <span class="number">-1</span>);</span><br><span class="line">    <span class="comment">/* 获取nand flash返回的设备ID数据 */</span></span><br><span class="line">    dev_id = chip-&gt;read_byte(mtd);</span><br><span class="line">    <span class="comment">/* 循环匹配nand_flash_ids[]数组,找到对应的nandflash信息 */</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; nand_flash_ids[i].name != <span class="literal">NULL</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (dev_id == nand_flash_ids[i].id) &#123;</span><br><span class="line">            type =  &amp;nand_flash_ids[i];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* 匹配成功，便打印nandflash参数 */</span></span><br><span class="line">    printk(KERN_INFO <span class="string">&quot;NAND device: Manufacturer ID:&quot;</span></span><br><span class="line">                     <span class="string">&quot; 0x%02x, Chip ID: 0x%02x (%s %s)\n&quot;</span>, *maf_id,</span><br><span class="line">                     dev_id, nand_manuf_ids[maf_idx].name, mtd-&gt;name);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>nand_flash_ids[]数组：</p><p><img src="5.nand_flash_type.png" alt="5.nand_flash_type"></p><p>启动内核就可以看到打印出nand flash参数：</p><p><img src="5.nand_flash_log.png" alt="5.nand_flash_log"></p><p><strong>nand_scan_tail()函数：</strong>构造mtd_info结构体，为硬件和上层之间提供了一个抽象的接口。mtd_info中包含nand_chip成员，故mtd层的接口最终都会调用到nand_chip所设置的底层硬件接口。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">nand_scan_tail</span><span class="params">(<span class="keyword">struct</span> mtd_info *mtd)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">nand_chip</span> *<span class="title">chip</span> =</span> mtd-&gt;priv;</span><br><span class="line">mtd-&gt;type = MTD_NANDFLASH;</span><br><span class="line">mtd-&gt;erase = nand_erase; -&gt; nand_erase_nand   -&gt; nand_chip-&gt;erase_cmd</span><br><span class="line">mtd-&gt;read = nand_read;   -&gt; nand_do_read_ops  -&gt; nand_chip-&gt;ecc.read_page</span><br><span class="line">mtd-&gt;write = nand_write; -&gt; nand_do_write_ops -&gt; nand_chip-&gt;write_page</span><br><span class="line">......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-6-添加MTD分区"><a href="#4-6-添加MTD分区" class="headerlink" title="4.6 添加MTD分区"></a>4.6 添加MTD分区</h2><p>系统启动后可以从log看到其MTD分区信息：</p><p><img src="6.MTD%E5%88%86%E5%8C%BAlog.png" alt="6.MTD分区log"></p><p>probe()里的s3c2410_nand_add_partition()函数注册nand flash的mtd设备，并添加分区</p><p>最终它调用了s3c2410_nand_add_partition()-&gt;add_mtd_partitions() -&gt; add_mtd_device()</p><p>其中add_mtd_partitions()函数主要实现多个分区创建，也就是多次调用add_mtd_device()</p><p>当只设置nand flash为一个分区时，即主分区，直接调用add_mtd_device()即可。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">s3c2410_nand_add_partition -&gt;</span><br><span class="line"><span class="comment">// 在s3c2410_nand_init_chip函数中已经将分区信息设置给了mtd </span></span><br><span class="line">add_mtd_device(&amp;mtd-&gt;mtd) -&gt;</span><br><span class="line"><span class="comment">// 遍历mtd_notifiers，通过其add接口添加分区</span></span><br><span class="line">list_for_each(this, &amp;mtd_notifiers) &#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mtd_notifier</span> *<span class="title">not</span> =</span> list_entry(this, <span class="keyword">struct</span> mtd_notifier, <span class="built_in">list</span>);</span><br><span class="line">not-&gt;add(mtd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>mtd_notifiers链表在哪设置？mtdchar.c (字符设备)、mtd_blkdevs.c(块设备)</p><p><strong>①nand flash 字符设备</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// linux-2.6.22.6/drivers/mtd/mtdchar.c</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">mtd_notify_add</span><span class="params">(<span class="keyword">struct</span> mtd_info* mtd)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// 创建字符设备 设备节点为/dev/mtd%d</span></span><br><span class="line">class_device_create(mtd_class, <span class="literal">NULL</span>, MKDEV(MTD_CHAR_MAJOR, mtd-&gt;index*<span class="number">2</span>),</span><br><span class="line">    <span class="literal">NULL</span>, <span class="string">&quot;mtd%d&quot;</span>, mtd-&gt;index);</span><br><span class="line"><span class="comment">// 创建字符设备 设备节点为/dev/mtd%dro (只读)</span></span><br><span class="line">class_device_create(mtd_class, <span class="literal">NULL</span>,</span><br><span class="line">    MKDEV(MTD_CHAR_MAJOR, mtd-&gt;index*<span class="number">2</span>+<span class="number">1</span>),</span><br><span class="line">    <span class="literal">NULL</span>, <span class="string">&quot;mtd%dro&quot;</span>, mtd-&gt;index);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">mtd_notifier</span> <span class="title">notifier</span> =</span> &#123;</span><br><span class="line">.add= mtd_notify_add,</span><br><span class="line">.remove= mtd_notify_remove,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">init_mtdchar -&gt;</span><br><span class="line">register_mtd_user(&amp;notifier) -&gt;</span><br><span class="line">list_add(&amp;new-&gt;<span class="built_in">list</span>, &amp;mtd_notifiers);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>②nand flash 块设备</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// linux-2.6.22.6/drivers/mtd/mtd_blkdevs.c</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">blktrans_notify_add</span><span class="params">(<span class="keyword">struct</span> mtd_info *mtd)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> *<span class="title">this</span>;</span></span><br><span class="line"><span class="comment">// 遍历blktrans_majors链表 通过其add_mtd函数添加分区</span></span><br><span class="line">list_for_each(this, &amp;blktrans_majors) &#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mtd_blktrans_ops</span> *<span class="title">tr</span> =</span> list_entry(this, <span class="keyword">struct</span> mtd_blktrans_ops, <span class="built_in">list</span>);</span><br><span class="line">tr-&gt;add_mtd(tr, mtd);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">mtd_notifier</span> <span class="title">blktrans_notifier</span> =</span> &#123;</span><br><span class="line">.add = blktrans_notify_add,</span><br><span class="line">.remove = blktrans_notify_remove,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">register_mtd_blktrans-&gt;</span><br><span class="line">register_mtd_user(&amp;blktrans_notifier) -&gt;</span><br><span class="line">list_add(&amp;new-&gt;<span class="built_in">list</span>, &amp;mtd_notifiers)</span><br></pre></td></tr></table></figure><p>blktrans_majors链表又在哪设置？ mtdblock_ro.c、mtdblock.c(以他为例)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// linux-2.6.22.6/drivers/mtd/mtdblock.c</span></span><br><span class="line">mtdblock_add_mtd -&gt; </span><br><span class="line">add_mtd_blktrans_dev(dev)-&gt;</span><br><span class="line"><span class="comment">//分配gendisk结构体</span></span><br><span class="line">alloc_disk(<span class="number">1</span> &lt;&lt; tr-&gt;part_bits);</span><br><span class="line"><span class="comment">//设置gendisk结构体</span></span><br><span class="line">set_capacity(gd, (new-&gt;size * tr-&gt;blksize) &gt;&gt; <span class="number">9</span>);</span><br><span class="line">gd-&gt;major = tr-&gt;major;</span><br><span class="line">gd-&gt;first_minor = (new-&gt;devnum) &lt;&lt; tr-&gt;part_bits;</span><br><span class="line">gd-&gt;fops = &amp;mtd_blktrans_ops;</span><br><span class="line"><span class="comment">//设置gendisk请求队列</span></span><br><span class="line">gd-&gt;<span class="built_in">queue</span> = tr-&gt;blkcore_priv-&gt;rq;</span><br><span class="line"><span class="comment">//注册gendisk结构体</span></span><br><span class="line">add_disk(gd);</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">mtd_blktrans_ops</span> <span class="title">mtdblock_tr</span> =</span> &#123;</span><br><span class="line">.name= <span class="string">&quot;mtdblock&quot;</span>,</span><br><span class="line">.major= <span class="number">31</span>,</span><br><span class="line">.part_bits= <span class="number">0</span>,</span><br><span class="line">.blksize = <span class="number">512</span>,</span><br><span class="line">.open= mtdblock_open,</span><br><span class="line">.flush= mtdblock_flush,</span><br><span class="line">.release= mtdblock_release,</span><br><span class="line">.readsect= mtdblock_readsect,</span><br><span class="line">.writesect= mtdblock_writesect,</span><br><span class="line">.add_mtd= mtdblock_add_mtd,</span><br><span class="line">.remove_dev= mtdblock_remove_dev,</span><br><span class="line">.owner= THIS_MODULE,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">init_mtdblock -&gt; </span><br><span class="line">register_mtd_blktrans(&amp;mtdblock_tr); -&gt;</span><br><span class="line">list_add(&amp;tr-&gt;<span class="built_in">list</span>, &amp;blktrans_majors);</span><br></pre></td></tr></table></figure><p><strong>③MTD设备</strong></p><p>所以mtd层既提供了字符设备的操作接口(mtdchar.c)， 也实现了块设备的操作接口(mtd_blkdevs.c)，块设备接口最终会分配设置注册一个gendisk。在控制台输入ls -l &#x2F;dev&#x2F;mtd*，能找到块MTD设备节点和字符MTD设备节点，可以看到一共创建了4个分区的设备，每个分区都包含了两个字符设备(mtd%d，mtd%dro)、一个块设备(mtdblock0)。MTD块设备的主设备号为31，MTD字符设备的主设备号为90。</p><p><img src="7.mtd%E8%AE%BE%E5%A4%87.png" alt="7.mtd设备"></p><p><strong>④MTD块设备请求队列</strong></p><p>块设备的操作接口(mtd_blkdevs.c)会调用mtdblock_add_mtd，最终会分配、设置、注册一个gendisk。</p><p>那么这个gendisk的请求队列在哪被设置，这个队列最终会怎么实现flash的读写呢？</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// linux-2.6.22.6/drivers/mtd/mtdblock.c</span></span><br><span class="line">init_mtdblock -&gt; </span><br><span class="line">register_mtd_blktrans(&amp;mtdblock_tr);</span><br><span class="line"><span class="comment">//mtd_blktrans_request便是gendisk的请求队列</span></span><br><span class="line">tr-&gt;blkcore_priv-&gt;rq = blk_init_queue(mtd_blktrans_request, &amp;tr-&gt;blkcore_priv-&gt;queue_lock);</span><br><span class="line">tr-&gt;blkcore_priv-&gt;thread = kthread_run(mtd_blktrans_thread, tr,</span><br><span class="line"><span class="string">&quot;%sd&quot;</span>, tr-&gt;name);</span><br><span class="line"></span><br><span class="line"><span class="comment">//mtd_blktrans_request这个请求队列唤醒mtd_blktrans_thread线程</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">mtd_blktrans_request</span><span class="params">(<span class="keyword">struct</span> request_queue *rq)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mtd_blktrans_ops</span> *<span class="title">tr</span> =</span> rq-&gt;queuedata;</span><br><span class="line">wake_up_process(tr-&gt;blkcore_priv-&gt;thread);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//mtd_blktrans_thread线程便是gendisk具体的操作了</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">mtd_blktrans_thread</span><span class="params">(<span class="type">void</span> *arg)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">mtd_blktrans_ops</span> *<span class="title">tr</span> =</span> arg;</span><br><span class="line"></span><br><span class="line"><span class="comment">//电梯调度算法优化队列</span></span><br><span class="line">req = elv_next_request(rq);</span><br><span class="line">dev = req-&gt;rq_disk-&gt;private_data;</span><br><span class="line">tr = dev-&gt;tr;</span><br><span class="line"></span><br><span class="line"><span class="comment">//该函数会取出对应的mtd_info结构体，调用mtd_info的读写接口，</span></span><br><span class="line"><span class="comment">//最终会调用对应的nand_chip结构体的读写接口，实现flash物理上的读写操作。</span></span><br><span class="line">res = do_blktrans_request(tr, dev, req);</span><br><span class="line"></span><br><span class="line"><span class="comment">//结束队列读写</span></span><br><span class="line">end_request(req, res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-7-Nand-Flash读取流程"><a href="#4-7-Nand-Flash读取流程" class="headerlink" title="4.7 Nand Flash读取流程"></a>4.7 Nand Flash读取流程</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// APP对块设备节点/dev/mtdblock进行访问操作</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//一个读数据的bio，被合并或被生成一个请求，触发请求队列的请求处理函数</span></span><br><span class="line">mtd_blktrans_request -&gt;</span><br><span class="line"><span class="comment">// 唤醒一个休眠线程--mtd_blktrans_thread，该线程在register_mtd_blktrans中创建启动</span></span><br><span class="line">wake_up_process(tr-&gt;blkcore_priv-&gt;thread);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 该线程从请求队列中取出一个请求调用do_blktrans_request接口进行处理</span></span><br><span class="line">mtd_blktrans_thread</span><br><span class="line">do_blktrans_request -&gt; </span><br><span class="line"><span class="comment">//tr-&gt;readsect 即：struct mtd_blktrans_ops中的mtdblock_readsect接口</span></span><br><span class="line">tr-&gt;readsect(dev, block, buf) -&gt;</span><br><span class="line">do_cached_read(mtdblk, block&lt;&lt;<span class="number">9</span>, <span class="number">512</span>, buf) -&gt; </span><br><span class="line"><span class="comment">//mtd-&gt;read 即：struct mtd_info中的 nand_read接口</span></span><br><span class="line"><span class="comment">//在 nand_scan_tail接口中被设置 mtd-&gt;read = nand_read;</span></span><br><span class="line">mtd-&gt;read(mtd, pos, size, &amp;retlen, buf) -&gt;</span><br><span class="line">nand_do_read_ops(mtd, from, &amp;chip-&gt;ops) -&gt;</span><br><span class="line"><span class="comment">//调用到对应nand_chip的底层接口</span></span><br><span class="line">chip-&gt;ecc.read_page_raw(mtd, chip, bufpoi) -&gt;</span><br><span class="line">nand_read_page_raw -&gt; </span><br><span class="line"><span class="comment">// chip-&gt;read_buf 即：s3c2410_nand_read_buf</span></span><br><span class="line"><span class="comment">// 在驱动程序：s3c2410_nand_init_chip函数里设置</span></span><br><span class="line"><span class="comment">// chip-&gt;read_buf = s3c2410_nand_read_buf;</span></span><br><span class="line">chip-&gt;read_buf(mtd, buf, mtd-&gt;writesize); </span><br><span class="line">chip-&gt;read_buf(mtd, chip-&gt;oob_poi, mtd-&gt;oobsize) -&gt;</span><br><span class="line"><span class="comment">// 从nand flash控制器的NFDATA寄存器中读取数据</span></span><br><span class="line"><span class="comment">// chip-&gt;IO_ADDR_W = regs + S3C2440_NFDATA;</span></span><br><span class="line"><span class="comment">// chip-&gt;IO_ADDR_R = chip-&gt;IO_ADDR_W;</span></span><br><span class="line">readsb(this-&gt;IO_ADDR_R, buf, len);</span><br></pre></td></tr></table></figure><h2 id="4-8-Nand-Flash驱动编写"><a href="#4-8-Nand-Flash驱动编写" class="headerlink" title="4.8 Nand Flash驱动编写"></a>4.8 Nand Flash驱动编写</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/ioport.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/platform_device.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/delay.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/err.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/slab.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/clk.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/mtd/mtd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/mtd/nand.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/mtd/nand_ecc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/mtd/partitions.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;asm/io.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;asm/arch/regs-nand.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;asm/arch/nand.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">s3c_nand_regs</span> &#123;</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> nfconf  ;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> nfcont  ;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> nfcmd   ;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> nfaddr  ;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> nfdata  ;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> nfeccd0 ;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> nfeccd1 ;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> nfeccd  ;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> nfstat  ;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> nfestat0;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> nfestat1;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> nfmecc0 ;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> nfmecc1 ;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> nfsecc  ;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> nfsblk  ;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> nfeblk  ;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">nand_chip</span> *<span class="title">s3c_nand_chip</span>;</span></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">mtd_info</span> *<span class="title">s3c_mtd</span>;</span></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">s3c_nand_regs</span>* <span class="title">s3c_nand_regs</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">mtd_partition</span> <span class="title">s3c_nand_parts</span>[] =</span> &#123;</span><br><span class="line">[<span class="number">0</span>] = &#123;</span><br><span class="line">.name   = <span class="string">&quot;bootloader&quot;</span>,</span><br><span class="line">.size   = <span class="number">0x00040000</span>,</span><br><span class="line">.offset= <span class="number">0</span>,</span><br><span class="line">&#125;,</span><br><span class="line">[<span class="number">1</span>] = &#123;</span><br><span class="line">.name   = <span class="string">&quot;params&quot;</span>,</span><br><span class="line">.offset = MTDPART_OFS_APPEND,</span><br><span class="line">.size   = <span class="number">0x00020000</span>,</span><br><span class="line">&#125;,</span><br><span class="line">[<span class="number">2</span>] = &#123;</span><br><span class="line">.name   = <span class="string">&quot;kernel&quot;</span>,</span><br><span class="line">.offset = MTDPART_OFS_APPEND,</span><br><span class="line">.size   = <span class="number">0x00200000</span>,</span><br><span class="line">&#125;,</span><br><span class="line">[<span class="number">3</span>] = &#123;</span><br><span class="line">.name   = <span class="string">&quot;root&quot;</span>,</span><br><span class="line">.offset = MTDPART_OFS_APPEND,</span><br><span class="line">.size   = MTDPART_SIZ_FULL,</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">s3c2440_select_chip</span><span class="params">(<span class="keyword">struct</span> mtd_info *mtd, <span class="type">int</span> chipnr)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(chipnr == <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//取消选中：NFCONT[1]设为1</span></span><br><span class="line">s3c_nand_regs-&gt;nfcont |= (<span class="number">1</span>&lt;&lt;<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//选中：NFCONT[1]设为0</span></span><br><span class="line">s3c_nand_regs-&gt;nfcont &amp;= ~(<span class="number">1</span>&lt;&lt;<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">s3c2440_cmd_ctrl</span><span class="params">(<span class="keyword">struct</span> mtd_info *mtd, <span class="type">int</span> dat, <span class="type">unsigned</span> <span class="type">int</span> ctrl)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (ctrl &amp; NAND_CLE)</span><br><span class="line"><span class="comment">//发命令：NFCMMD = dat</span></span><br><span class="line">s3c_nand_regs-&gt;nfcmd  = dat;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="comment">//发地址：NFADDR = dat</span></span><br><span class="line">s3c_nand_regs-&gt;nfaddr = dat;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">s3c2440_dev_ready</span><span class="params">(<span class="keyword">struct</span> mtd_info *mtd)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> s3c_nand_regs-&gt;nfstat &amp; (<span class="number">1</span>&lt;&lt;<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">nand_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">clk</span> *<span class="title">clk</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*1 分配一个nand_chip结构体 */</span></span><br><span class="line">s3c_nand_chip = kzalloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> nand_chip), GFP_KERNEL);</span><br><span class="line"></span><br><span class="line">s3c_nand_regs = ioremap(<span class="number">0x4e000000</span>,<span class="keyword">sizeof</span> (<span class="keyword">struct</span> s3c_nand_regs));</span><br><span class="line"></span><br><span class="line"><span class="comment">/*2 设置 */</span></span><br><span class="line">s3c_nand_chip-&gt;select_chip = s3c2440_select_chip;</span><br><span class="line">s3c_nand_chip-&gt;cmd_ctrl    = s3c2440_cmd_ctrl;</span><br><span class="line">s3c_nand_chip-&gt;IO_ADDR_R   = &amp;s3c_nand_regs-&gt;nfdata;</span><br><span class="line">s3c_nand_chip-&gt;IO_ADDR_W   = &amp;s3c_nand_regs-&gt;nfdata;</span><br><span class="line">s3c_nand_chip-&gt;dev_ready   = s3c2440_dev_ready;</span><br><span class="line">s3c_nand_chip-&gt;ecc.mode    = NAND_ECC_SOFT;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*3 硬件相关的设置,根据nand flsah手册设置时间参数 */</span></span><br><span class="line"><span class="comment">/* 使能NAND FLASH控制器的时钟 */</span></span><br><span class="line">clk = clk_get(<span class="literal">NULL</span>, <span class="string">&quot;nand&quot;</span>);</span><br><span class="line">clk_enable(clk);<span class="comment">/* CLKCON&#x27;bit[4] */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* HCLK=100MHz</span></span><br><span class="line"><span class="comment"> * TACLS:  发出CLE/ALE之后多长时间才发出nWE信号, 从NAND手册可知CLE/ALE与nWE可以同时发出,所以TACLS=0</span></span><br><span class="line"><span class="comment"> * TWRPH0: nWE的脉冲宽度, HCLK x ( TWRPH0 + 1 ), 从NAND手册可知它要&gt;=12ns, 所以TWRPH0&gt;=1</span></span><br><span class="line"><span class="comment"> * TWRPH1: nWE变为高电平后多长时间CLE/ALE才能变为低电平, 从NAND手册可知它要&gt;=5ns, 所以TWRPH1&gt;=0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TACLS    0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TWRPH0   1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> TWRPH1   0</span></span><br><span class="line">s3c_nand_regs-&gt;nfconf = (TACLS&lt;&lt;<span class="number">12</span>) | (TWRPH0&lt;&lt;<span class="number">8</span>) | (TWRPH1&lt;&lt;<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* NFCONT: </span></span><br><span class="line"><span class="comment"> * BIT1-设为1, 先取消片选 </span></span><br><span class="line"><span class="comment"> * BIT0-设为1, 使能NAND FLASH控制器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">s3c_nand_regs-&gt;nfcont = (<span class="number">1</span>&lt;&lt;<span class="number">1</span>) | (<span class="number">1</span>&lt;&lt;<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*4 使用：nand_scan */</span></span><br><span class="line">s3c_mtd = kzalloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> mtd_info), GFP_KERNEL);</span><br><span class="line">s3c_mtd-&gt;owner = THIS_MODULE;</span><br><span class="line">s3c_mtd-&gt;priv = s3c_nand_chip;</span><br><span class="line">nand_scan(s3c_mtd,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*5 add_mtd_partitions */</span></span><br><span class="line">add_mtd_partitions(s3c_mtd, s3c_nand_parts, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 不分区的话，也即只有一个主分区，直接调用add_mtd_device */</span></span><br><span class="line"><span class="comment">//add_mtd_device(s3c_mtd);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">nand_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">del_mtd_partitions(s3c_mtd);</span><br><span class="line">kfree(s3c_mtd);</span><br><span class="line">iounmap(s3c_nand_regs);</span><br><span class="line">kfree(s3c_nand_chip);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(nand_init);</span><br><span class="line">module_exit(nand_exit);</span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>驱动测试：</strong></p><ol><li>make  menuconfig去掉内核自带的NAND FLASH驱动<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">Device Drivers</span></span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">Memory Technology Device (MTD) support</span></span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">NAND Device Support</span></span><br><span class="line">&lt; &gt; NAND Flash support for S3C2410/S3C2440 SoC</span><br></pre></td></tr></table></figure></li><li>make  uImage<br> 使用新内核启动, 并且使用NFS作为根文件系统</li><li>insmod  s3c_nand.ko</li><li>格式化，默认格式化成 yaffs。（工具制作过程参见下方）<br> flash_eraseall  &#x2F;dev&#x2F;mtd3  </li><li>挂接<br> mount  -t  yaffs  &#x2F;dev&#x2F;mtdblock3  &#x2F;mnt</li><li>在&#x2F;mnt目录下创建文件等操作</li></ol><p><strong>工具制作：</strong></p><ol><li>tar xjf mtd-utils-05.07.23.tar.bz2 </li><li>cd mtd-utils-05.07.23&#x2F;util<br> 修改Makefile：#CROSS&#x3D;arm-linux-  改为  CROSS&#x3D;arm-linux-</li><li>make</li><li>cp  flash_eraseall  &#x2F;work&#x2F;nfs_root&#x2F;first_fs&#x2F;bin&#x2F;</li></ol><h1 id="五、nor-flash驱动分析"><a href="#五、nor-flash驱动分析" class="headerlink" title="五、nor flash驱动分析"></a>五、nor flash驱动分析</h1><h2 id="5-1-nor-flash框架"><a href="#5-1-nor-flash框架" class="headerlink" title="5.1 nor flash框架"></a>5.1 nor flash框架</h2><p>nor flash与nand flash类似，对于nand flash，硬件相关层构造一个nand_chip结构体，然后向上注册一个mtd_info。对于nor flash而言，硬件相关层构造一个map_info结构体，然后向上注册一个mtd_info。所以对于MTD层而言，nand和nor是没有区别的，在MTD看来他们都是mtd_info。</p><p><img src="8.nor_nand%E6%80%BB%E7%BB%93.png" alt="8.nor_nand总结"></p><h2 id="5-2-nor-flash规范"><a href="#5-2-nor-flash规范" class="headerlink" title="5.2 nor flash规范"></a>5.2 nor flash规范</h2><p><strong>1. JEDEC规范</strong></p><p>老式的Nor Flash一般是jedec规范，其一般只包含识别 ID、擦除芯片、烧写数据的命令。要想知道其容量大小等信息，就需要先读出其芯片id，然后到内核中的jedec_table数组中比较得到对应的芯片信息，比较麻烦。另外如果内核jedec_table数组中事先没有对应芯片id的信息，还需要先在该数组中添加。jedec_table数组：</p><p><img src="9.jedec_table%E6%95%B0%E7%BB%84.png" alt="9.jedec_table数组"></p><p><strong>2. CFI规范</strong></p><p>目前的Nor Flash一般都支持CFI规范，其除了提供识别 ID、擦除芯片、烧写数据的命令之后，还提供了进入CFI模式的命令（往地址0x55处写入0x98），进入CFI模式后就可以通过读取相应地址的数据获取芯片属性信息，如容量、电压等信息。</p><p><img src="10.CFI%E8%A7%84%E8%8C%83.png" alt="10.CFI规范"></p><p>读取芯片容量（从地址0x27处读取容量大小 ）：</p><p><img src="10.CFI%E8%A7%84%E8%8C%831.png" alt="10.CFI规范1"></p><h2 id="5-3-nor-flash驱动使能"><a href="#5-3-nor-flash驱动使能" class="headerlink" title="5.3 nor flash驱动使能"></a>5.3 nor flash驱动使能</h2><p>make menuconfig：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">Device Drivers</span> </span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">Memory Technology Device (MTD) support (MTD [=y])</span></span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">Mapping drivers <span class="keyword">for</span> chip access</span></span><br><span class="line">&lt;M&gt; CFI Flash device in physical memory map    // 将驱动编译位内核模块，方便调试，设位y为编译进内核                                       </span><br><span class="line">(0x0) Physical start address of flash mapping  // 配置基地址</span><br><span class="line">(0x200000) Physical length of flash mapping    // 配置物理大小</span><br><span class="line">(2) Bank width in octets                       // 配置位宽  2*8=16</span><br></pre></td></tr></table></figure><p>可以在linux-2.6.22.6&#x2F;.config中看下如下信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CONFIG_MTD_PHYSMAP=m</span><br><span class="line">CONFIG_MTD_PHYSMAP_START=0x0</span><br><span class="line">CONFIG_MTD_PHYSMAP_LEN=0x200000</span><br><span class="line">CONFIG_MTD_PHYSMAP_BANKWIDTH=2</span><br></pre></td></tr></table></figure><p>2440内核没有使用设备树，是代码注册driver与device：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// linux-2.6.22.6/drivers/mtd/maps/physmap.c</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// make menuconfig时配置生成的.config中，定义了CONFIG_MTD_PHYSMAP_LEN宏</span></span><br><span class="line"><span class="comment">// 所以这里将会定义#define PHYSMAP_COMPAT，</span></span><br><span class="line"><span class="comment">// 进而会在驱动入口函数中执行platform_device_register接口调用。</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_MTD_PHYSMAP_LEN  </span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> CONFIG_MTD_PHYSMAP_LEN != 0</span></span><br><span class="line"><span class="meta">#<span class="keyword">warning</span> using PHYSMAP compat code</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PHYSMAP_COMPAT</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">platform_driver</span> <span class="title">physmap_flash_driver</span> =</span> &#123;</span><br><span class="line">.probe      = physmap_flash_probe,</span><br><span class="line">.remove     = physmap_flash_remove,</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_PM</span></span><br><span class="line">.suspend= physmap_flash_suspend,</span><br><span class="line">.resume     = physmap_flash_resume,</span><br><span class="line">.shutdown   = physmap_flash_shutdown,</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">.driver     = &#123;</span><br><span class="line">.name   = <span class="string">&quot;physmap-flash&quot;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> PHYSMAP_COMPAT</span></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">physmap_flash_data</span> <span class="title">physmap_flash_data</span> =</span> &#123;</span><br><span class="line">.width      = CONFIG_MTD_PHYSMAP_BANKWIDTH,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">resource</span> <span class="title">physmap_flash_resource</span> =</span> &#123;</span><br><span class="line">.start      = CONFIG_MTD_PHYSMAP_START,</span><br><span class="line">.end        = CONFIG_MTD_PHYSMAP_START + CONFIG_MTD_PHYSMAP_LEN - <span class="number">1</span>,</span><br><span class="line">.flags      = IORESOURCE_MEM,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">platform_device</span> <span class="title">physmap_flash</span> =</span> &#123;</span><br><span class="line">.name       = <span class="string">&quot;physmap-flash&quot;</span>,</span><br><span class="line">.id         = <span class="number">0</span>,</span><br><span class="line">.dev        = &#123;</span><br><span class="line">.platform_data= &amp;physmap_flash_data,</span><br><span class="line">&#125;,</span><br><span class="line">.num_resources= <span class="number">1</span>,</span><br><span class="line">.resource= &amp;physmap_flash_resource,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">physmap_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> err;</span><br><span class="line">err = platform_driver_register(&amp;physmap_flash_driver);</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> PHYSMAP_COMPAT</span></span><br><span class="line"><span class="keyword">if</span> (err == <span class="number">0</span>)</span><br><span class="line">platform_device_register(&amp;physmap_flash);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-4-驱动入口"><a href="#5-4-驱动入口" class="headerlink" title="5.4 驱动入口"></a>5.4 驱动入口</h2><p>进入probe函数中，主要调用do_map_probe()函数，add_mtd_partitions()函数，来完成注册nor  flash：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">physmap_flash_probe</span><span class="params">(<span class="keyword">struct</span> platform_device *dev)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* 1. 分配一个physmap_flash_info结构体，里面包含map_info、nand_chip结构体 */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">physmap_flash_info</span> *<span class="title">info</span>;</span></span><br><span class="line">info = kzalloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> physmap_flash_info), GFP_KERNEL);</span><br><span class="line"> </span><br><span class="line"><span class="comment">/* 2.0 设置map_info结构体；从device的resource中解析nor flash的物理基地址、长度、位宽等信息 */</span></span><br><span class="line">info-&gt;<span class="built_in">map</span>.name = dev-&gt;dev.bus_id;</span><br><span class="line">info-&gt;<span class="built_in">map</span>.phys = dev-&gt;resource-&gt;start;</span><br><span class="line">info-&gt;<span class="built_in">map</span>.size = dev-&gt;resource-&gt;end - dev-&gt;resource-&gt;start + <span class="number">1</span>;</span><br><span class="line">info-&gt;<span class="built_in">map</span>.bankwidth = physmap_data-&gt;width;</span><br><span class="line">info-&gt;<span class="built_in">map</span>.set_vpp = physmap_data-&gt;set_vpp;</span><br><span class="line">info-&gt;<span class="built_in">map</span>.virt = ioremap(info-&gt;<span class="built_in">map</span>.phys, info-&gt;<span class="built_in">map</span>.size);  </span><br><span class="line"> </span><br><span class="line"><span class="comment">/* 2.1 设置map_info结构体；提供nor flash的硬件相关读写接口 */</span></span><br><span class="line">simple_map_init(&amp;info-&gt;<span class="built_in">map</span>);</span><br><span class="line"><span class="built_in">map</span>-&gt;read = simple_map_read;</span><br><span class="line"><span class="built_in">map</span>-&gt;write = simple_map_write;</span><br><span class="line"><span class="built_in">map</span>-&gt;copy_from = simple_map_copy_from;</span><br><span class="line"><span class="built_in">map</span>-&gt;copy_to = simple_map_copy_to;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 3. 以nor flash规范识别型号信息，构造出mtd_info结构体 */</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> **probe_type = &#123; <span class="string">&quot;cfi_probe&quot;</span>, <span class="string">&quot;jedec_probe&quot;</span>, <span class="string">&quot;map_rom&quot;</span>, <span class="literal">NULL</span> &#125;;</span><br><span class="line">info-&gt;mtd = do_map_probe(*probe_type, &amp;info-&gt;<span class="built_in">map</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 4. 添加mtd分区，优先级为：&quot;cmdlinepart&quot;, &quot;RedBoot&quot;，physmap_data-&gt;nr_parts*/</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> CONFIG_MTD_PARTITIONS</span></span><br><span class="line"><span class="comment">// &#123; &quot;cmdlinepart&quot;, &quot;RedBoot&quot;, NULL &#125;，添加cmdlinepart分区和RedBoot分区</span></span><br><span class="line"><span class="comment">// 从uboot命令行或&quot;RedBoot&quot;获取分区信息，然后添加分区，并为其创建对应的字符设备节点和块设备节点</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *part_probe_types[] = &#123; <span class="string">&quot;cmdlinepart&quot;</span>, <span class="string">&quot;RedBoot&quot;</span>, <span class="literal">NULL</span> &#125;;</span><br><span class="line">parse_mtd_partitions(info-&gt;mtd, part_probe_types, &amp;info-&gt;parts, <span class="number">0</span>);</span><br><span class="line">add_mtd_partitions(info-&gt;mtd, info-&gt;parts, err);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在设备信息中配置了分区的话，就添加对应的分区。这里没有配置，即physmap_data-&gt;nr_parts=0，没有要添加额外的分区。</span></span><br><span class="line"><span class="keyword">if</span> (physmap_data-&gt;nr_parts) &#123;</span><br><span class="line">add_mtd_partitions(info-&gt;mtd, physmap_data-&gt;parts,</span><br><span class="line">physmap_data-&gt;nr_parts);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// 一个主分区，直接调用add_mtd_device创建对应的字符设备节点和块设备节点。</span></span><br><span class="line">add_mtd_device(info-&gt;mtd);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-5-do-map-probe流程分析"><a href="#5-5-do-map-probe流程分析" class="headerlink" title="5.5 do_map_probe流程分析"></a>5.5 do_map_probe流程分析</h2><p><strong>1. CFI规范Flash识别分析</strong></p><p><strong>1.0 CFI协议层注册：</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// linux-2.6.22.6/drivers/mtd/chips/chipreg.c</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">register_mtd_chip_driver</span><span class="params">(<span class="keyword">struct</span> mtd_chip_driver *drv)</span></span><br><span class="line">&#123;</span><br><span class="line">spin_lock(&amp;chip_drvs_lock);</span><br><span class="line">    <span class="comment">// 将协议层接口放到chip_drvs_list链表中</span></span><br><span class="line">list_add(&amp;drv-&gt;<span class="built_in">list</span>, &amp;chip_drvs_list);</span><br><span class="line">spin_unlock(&amp;chip_drvs_lock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//linux-2.6.22.6/drivers/mtd/chips/cfi_probe.c</span></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">chip_probe</span> <span class="title">cfi_chip_probe</span> =</span> &#123;</span><br><span class="line">.name= <span class="string">&quot;CFI&quot;</span>,</span><br><span class="line">.probe_chip= cfi_probe_chip</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> mtd_info *<span class="title function_">cfi_probe</span><span class="params">(<span class="keyword">struct</span> map_info *<span class="built_in">map</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Just use the generic probe stuff to call our CFI-specific</span></span><br><span class="line"><span class="comment"> * chip_probe routine in all the possible permutations, etc.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">return</span> mtd_do_chip_probe(<span class="built_in">map</span>, &amp;cfi_chip_probe);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">mtd_chip_driver</span> <span class="title">cfi_chipdrv</span> =</span> &#123;</span><br><span class="line">.probe= cfi_probe,</span><br><span class="line">.name= <span class="string">&quot;cfi_probe&quot;</span>,</span><br><span class="line">.module= THIS_MODULE</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 内核初始化时被调用</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">cfi_probe_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">register_mtd_chip_driver(&amp;cfi_chipdrv);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>1.1 CFI规范识别过程：</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// linux-2.6.22.6/drivers/mtd/chips/chipreg.c</span></span><br><span class="line"><span class="comment">// *probe_type--&quot;cfi_probe&quot;  </span></span><br><span class="line">info-&gt;mtd = do_map_probe(*probe_type, &amp;info-&gt;<span class="built_in">map</span>) -&gt;</span><br><span class="line">drv = get_mtd_chip_driver(name) -&gt;</span><br><span class="line">......</span><br><span class="line"><span class="comment">// 从chip_drvs_list链表中取出对应协议层接口</span></span><br><span class="line"><span class="comment">// chip_drvs_list链表在register_mtd_chip_driver接口中设置</span></span><br><span class="line"><span class="comment">// register_mtd_chip_driver接口在协议层调用</span></span><br><span class="line"><span class="comment">// cfi_probe_init/jedec_probe_init/map_ram_init</span></span><br><span class="line">list_for_each(pos, &amp;chip_drvs_list)</span><br><span class="line">this = list_entry(pos, typeof(*this), <span class="built_in">list</span>); </span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">strcmp</span>(this-&gt;name, name)) &#123;</span><br><span class="line">ret = this;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">......</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line"><span class="comment">// 执行协议层的probe函数 即上面分析的cfi_probe接口</span></span><br><span class="line">drv-&gt;probe(<span class="built_in">map</span>)-&gt; <span class="comment">//即cfi_probe(map)</span></span><br><span class="line"><span class="comment">// cfi_chip_probe 结构体中有一个.probe_chip接口（cfi_probe_chip）</span></span><br><span class="line">mtd_do_chip_probe(<span class="built_in">map</span>, &amp;cfi_chip_probe)-&gt;</span><br><span class="line">genprobe_ident_chips(<span class="built_in">map</span>, cp) -&gt;</span><br><span class="line">genprobe_new_chip(<span class="built_in">map</span>, cp, &amp;cfi) -&gt;</span><br><span class="line"><span class="comment">// 在该函数中，进入通过命令CFI模式，读取芯片信息</span></span><br><span class="line">cp-&gt;probe_chip(<span class="built_in">map</span>, <span class="number">0</span>, <span class="literal">NULL</span>, cfi) -&gt; <span class="comment">//即cfi_probe_chip</span></span><br><span class="line"><span class="comment">// 进入CFI模式</span></span><br><span class="line">cfi_send_gen_cmd(<span class="number">0xF0</span>, <span class="number">0</span>, base, <span class="built_in">map</span>, cfi, cfi-&gt;device_type, <span class="literal">NULL</span>);</span><br><span class="line">cfi_send_gen_cmd(<span class="number">0xFF</span>, <span class="number">0</span>, base, <span class="built_in">map</span>, cfi, cfi-&gt;device_type, <span class="literal">NULL</span>);</span><br><span class="line">cfi_send_gen_cmd(<span class="number">0x98</span>, <span class="number">0x55</span>, base, <span class="built_in">map</span>, cfi, cfi-&gt;device_type, <span class="literal">NULL</span>);</span><br><span class="line"><span class="comment">// 看是否能读出&quot;QRY&quot;</span></span><br><span class="line">qry_present(<span class="built_in">map</span>,base,cfi)</span><br><span class="line"><span class="comment">// 读取芯片信息，比如cfi-&gt;cfiq-&gt;P_ID = 0x0000 0002</span></span><br><span class="line"><span class="comment">// 由芯片手册知P_ID: Primary vendor command set and control interface ID code</span></span><br><span class="line">cfi_chip_setup(<span class="built_in">map</span>, cfi) -&gt;</span><br><span class="line">......</span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> cfi_ident) + num_erase_regions * <span class="number">4</span>); i++)</span><br><span class="line">((<span class="type">unsigned</span> <span class="type">char</span> *)cfi-&gt;cfiq)[i] = cfi_read_query(<span class="built_in">map</span>,base + (<span class="number">0x10</span> + i)*ofs_factor);</span><br><span class="line">.....</span><br><span class="line"><span class="comment">// 根据上面读取到的P_ID调用相应的接口申请并设置struct mtd_info结构体</span></span><br><span class="line">mtd = check_cmd_set(<span class="built_in">map</span>, <span class="number">1</span>) -&gt;</span><br><span class="line">......</span><br><span class="line"><span class="keyword">case</span> <span class="number">0x0002</span>:</span><br><span class="line"><span class="keyword">return</span> cfi_cmdset_0002(<span class="built_in">map</span>, primary) -&gt;</span><br><span class="line">.......</span><br><span class="line">mtd = kzalloc(<span class="keyword">sizeof</span>(*mtd), GFP_KERNEL);</span><br><span class="line"><span class="comment">//mtd_info的私有数据为map_info，包含读写操作最终的硬件接口</span></span><br><span class="line">mtd-&gt;priv = <span class="built_in">map</span>;</span><br><span class="line">mtd-&gt;type = MTD_NORFLASH;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Fill in the default mtd operations */</span></span><br><span class="line">mtd-&gt;erase   = cfi_amdstd_erase_varsize;</span><br><span class="line">mtd-&gt;write   = cfi_amdstd_write_words;</span><br><span class="line">mtd-&gt;read    = cfi_amdstd_read;</span><br><span class="line">mtd-&gt;sync    = cfi_amdstd_sync;</span><br><span class="line">mtd-&gt;flags   = MTD_CAP_NORFLASH;</span><br><span class="line">.......</span><br><span class="line"><span class="keyword">return</span> mtd;</span><br></pre></td></tr></table></figure><p><strong>2. JEDEC规范Flash识别分析</strong></p><p><strong>2.0 JEDEC协议层注册：</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// linux-2.6.22.6/drivers/mtd/chips/chipreg.c</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">register_mtd_chip_driver</span><span class="params">(<span class="keyword">struct</span> mtd_chip_driver *drv)</span></span><br><span class="line">&#123;</span><br><span class="line">spin_lock(&amp;chip_drvs_lock);</span><br><span class="line">    <span class="comment">// 将协议层接口放到chip_drvs_list链表中</span></span><br><span class="line">list_add(&amp;drv-&gt;<span class="built_in">list</span>, &amp;chip_drvs_list);</span><br><span class="line">spin_unlock(&amp;chip_drvs_lock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// linux-2.6.22.6/drivers/mtd/chips/jedec_probe.c</span></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">chip_probe</span> <span class="title">jedec_chip_probe</span> =</span> &#123;</span><br><span class="line">.name = <span class="string">&quot;JEDEC&quot;</span>,</span><br><span class="line">.probe_chip = jedec_probe_chip</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="keyword">struct</span> mtd_info *<span class="title function_">jedec_probe</span><span class="params">(<span class="keyword">struct</span> map_info *<span class="built_in">map</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Just use the generic probe stuff to call our CFI-specific</span></span><br><span class="line"><span class="comment"> * chip_probe routine in all the possible permutations, etc.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">return</span> mtd_do_chip_probe(<span class="built_in">map</span>, &amp;jedec_chip_probe);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">mtd_chip_driver</span> <span class="title">jedec_chipdrv</span> =</span> &#123;</span><br><span class="line">.probe= jedec_probe,</span><br><span class="line">.name= <span class="string">&quot;jedec_probe&quot;</span>,</span><br><span class="line">.module= THIS_MODULE</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">jedec_probe_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">register_mtd_chip_driver(&amp;jedec_chipdrv);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2.1 JEDEC规范识别过程：</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">info-&gt;mtd = do_map_probe(*probe_type, &amp;info-&gt;<span class="built_in">map</span>) -&gt;</span><br><span class="line">drv = get_mtd_chip_driver(name) -&gt;</span><br><span class="line">......</span><br><span class="line"><span class="comment">// 从chip_drvs_list链表中取出对应协议层驱动</span></span><br><span class="line"><span class="comment">// chip_drvs_list链表在register_mtd_chip_driver接口中设置</span></span><br><span class="line"><span class="comment">// register_mtd_chip_driver接口在协议层调用</span></span><br><span class="line"><span class="comment">// cfi_probe_init/jedec_probe_init/map_ram_init</span></span><br><span class="line">list_for_each(pos, &amp;chip_drvs_list)</span><br><span class="line">this = list_entry(pos, typeof(*this), <span class="built_in">list</span>); </span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">strcmp</span>(this-&gt;name, name)) &#123;</span><br><span class="line">ret = this;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">......</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line"><span class="comment">// 执行协议层的probe函数 即上面分析的cfi_probe接口</span></span><br><span class="line">drv-&gt;probe(<span class="built_in">map</span>)-&gt; <span class="comment">//jedec_probe(map)</span></span><br><span class="line"><span class="comment">// jedec_chip_probe 结构体中有一个.probe_chip接口（jedec_probe_chip）</span></span><br><span class="line">mtd_do_chip_probe(<span class="built_in">map</span>, &amp;jedec_chip_probe) -&gt; </span><br><span class="line">genprobe_ident_chips(<span class="built_in">map</span>, cp) -&gt; </span><br><span class="line">genprobe_new_chip(<span class="built_in">map</span>, cp, &amp;cfi) -&gt;</span><br><span class="line"><span class="comment">// 读取芯片的id,和jedec_table数组比较得到芯片信息</span></span><br><span class="line">cp-&gt;probe_chip(<span class="built_in">map</span>, <span class="number">0</span>, <span class="literal">NULL</span>, cfi) -&gt; <span class="comment">//即jedec_probe_chip</span></span><br><span class="line">jedec_match( base, <span class="built_in">map</span>, cfi, &amp;jedec_table[i] )</span><br><span class="line">cfi_jedec_setup(cfi, i) -&gt;</span><br><span class="line">p_cfi-&gt;cfiq-&gt;P_ID = jedec_table[index].CmdSet;</span><br><span class="line"><span class="comment">// 根据读取到的p_cfi-&gt;cfiq-&gt;P_ID来调用对应接口申请并设置struct mtd_info</span></span><br><span class="line">mtd = check_cmd_set(<span class="built_in">map</span>, <span class="number">1</span>)</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>do_map_probe执行完后便添加分区，最终都是调用add_mtd_device，与nand flash一模一样，此处不再赘述。</p><p>一个nor flash的读写操作，首先会执行块设备的优化，放入队列， 找到对应的mtd_info结构体，再找到对应的私有数据map_info，执行硬件相关的读写操作。</p><h2 id="5-6-nor-flash驱动编写"><a href="#5-6-nor-flash驱动编写" class="headerlink" title="5.6 nor flash驱动编写"></a>5.6 nor flash驱动编写</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 参考 drivers\mtd\maps\physmap.c</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/slab.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/device.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/platform_device.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/mtd/mtd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/mtd/map.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/mtd/partitions.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;asm/io.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">map_info</span> *<span class="title">s3c_nor_map</span>;</span></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">mtd_info</span> *<span class="title">s3c_nor_mtd</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">mtd_partition</span> <span class="title">s3c_nor_parts</span>[] =</span> &#123;</span><br><span class="line">[<span class="number">0</span>] = &#123;</span><br><span class="line">.name   = <span class="string">&quot;bootloader_nor&quot;</span>,</span><br><span class="line">.size   = <span class="number">0x00040000</span>,</span><br><span class="line">.offset= <span class="number">0</span>,</span><br><span class="line">&#125;,</span><br><span class="line">[<span class="number">1</span>] = &#123;</span><br><span class="line">.name   = <span class="string">&quot;root_nor&quot;</span>,</span><br><span class="line">.offset = MTDPART_OFS_APPEND,</span><br><span class="line">.size   = MTDPART_SIZ_FULL,</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">s3c_nor_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* 1. 分配map_info结构体 */</span></span><br><span class="line">s3c_nor_map = kzalloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> map_info), GFP_KERNEL);;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 2. 设置: 物理基地址(phys), 大小(size), 位宽(bankwidth), 虚拟基地址(virt) */</span></span><br><span class="line">s3c_nor_map-&gt;name = <span class="string">&quot;s3c_nor&quot;</span>;</span><br><span class="line">s3c_nor_map-&gt;phys = <span class="number">0</span>;</span><br><span class="line">s3c_nor_map-&gt;size = <span class="number">0x1000000</span>; <span class="comment">/* &gt;= NOR的真正大小 */</span></span><br><span class="line">s3c_nor_map-&gt;bankwidth = <span class="number">2</span>;</span><br><span class="line">s3c_nor_map-&gt;virt = ioremap(s3c_nor_map-&gt;phys, s3c_nor_map-&gt;size);</span><br><span class="line"></span><br><span class="line">simple_map_init(s3c_nor_map);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 3. 使用: 调用NOR FLASH协议层提供的函数来识别 */</span></span><br><span class="line">printk(<span class="string">&quot;use cfi_probe\n&quot;</span>);</span><br><span class="line">s3c_nor_mtd = do_map_probe(<span class="string">&quot;cfi_probe&quot;</span>, s3c_nor_map);</span><br><span class="line"><span class="keyword">if</span> (!s3c_nor_mtd)</span><br><span class="line">&#123;</span><br><span class="line">printk(<span class="string">&quot;use jedec_probe\n&quot;</span>);</span><br><span class="line">s3c_nor_mtd = do_map_probe(<span class="string">&quot;jedec_probe&quot;</span>, s3c_nor_map);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!s3c_nor_mtd)</span><br><span class="line">&#123;</span><br><span class="line">iounmap(s3c_nor_map-&gt;virt);</span><br><span class="line">kfree(s3c_nor_map);</span><br><span class="line"><span class="keyword">return</span> -EIO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 4. add_mtd_partitions */</span></span><br><span class="line">add_mtd_partitions(s3c_nor_mtd, s3c_nor_parts, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">s3c_nor_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">del_mtd_partitions(s3c_nor_mtd);</span><br><span class="line">iounmap(s3c_nor_map-&gt;virt);</span><br><span class="line">kfree(s3c_nor_map);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(s3c_nor_init);</span><br><span class="line">module_exit(s3c_nor_exit);</span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="5-7-RAM模拟MTD设备"><a href="#5-7-RAM模拟MTD设备" class="headerlink" title="5.7 RAM模拟MTD设备"></a>5.7 RAM模拟MTD设备</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 参考 drivers\mtd\devices\mtdram.c</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/slab.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/ioport.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/vmalloc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/mtd/mtd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/mtd/mtdram.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//要添加分区的话，加上这个头文件</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/mtd/partitions.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">long</span> total_size = <span class="number">10</span>*<span class="number">1024</span>;  <span class="comment">//10M</span></span><br><span class="line"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">long</span> erase_size = <span class="number">1</span>*<span class="number">1024</span>;   <span class="comment">//1M</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MTDRAM_TOTAL_SIZE (total_size * 1024)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MTDRAM_ERASE_SIZE (erase_size * 1024)</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">mtd_partition</span> <span class="title">ram_parts</span>[] =</span> &#123;</span><br><span class="line">[<span class="number">0</span>] = &#123;</span><br><span class="line">        .name   = <span class="string">&quot;bootloader_nor&quot;</span>,</span><br><span class="line">        .size   = <span class="number">0x200000</span>,</span><br><span class="line">.offset= <span class="number">0</span>,</span><br><span class="line">&#125;,</span><br><span class="line">[<span class="number">1</span>] = &#123;</span><br><span class="line">        .name   = <span class="string">&quot;root_nor&quot;</span>,</span><br><span class="line">        .offset = MTDPART_OFS_APPEND,</span><br><span class="line">        .size   = MTDPART_SIZ_FULL,</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// We could store these in the mtd structure, but we only support 1 device..</span></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">mtd_info</span> *<span class="title">mtd_info</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">check_offs_len</span><span class="params">(<span class="keyword">struct</span> mtd_info *mtd, <span class="type">loff_t</span> ofs, <span class="type">uint64_t</span> len)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Start address must align on block boundary */</span></span><br><span class="line"><span class="keyword">if</span> (mtd_mod_by_eb(ofs, mtd)) &#123;</span><br><span class="line">pr_debug(<span class="string">&quot;%s: unaligned address\n&quot;</span>, __func__);</span><br><span class="line">ret = -EINVAL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Length must align on block boundary */</span></span><br><span class="line"><span class="keyword">if</span> (mtd_mod_by_eb(len, mtd)) &#123;</span><br><span class="line">pr_debug(<span class="string">&quot;%s: length not block aligned\n&quot;</span>, __func__);</span><br><span class="line">ret = -EINVAL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">ram_erase</span><span class="params">(<span class="keyword">struct</span> mtd_info *mtd, <span class="keyword">struct</span> erase_info *instr)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (check_offs_len(mtd, instr-&gt;addr, instr-&gt;len))</span><br><span class="line"><span class="keyword">return</span> -EINVAL;</span><br><span class="line"><span class="built_in">memset</span>((<span class="type">char</span> *)mtd-&gt;priv + instr-&gt;addr, <span class="number">0xff</span>, instr-&gt;len);</span><br><span class="line">instr-&gt;state = MTD_ERASE_DONE;</span><br><span class="line">mtd_erase_callback(instr);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">ram_point</span><span class="params">(<span class="keyword">struct</span> mtd_info *mtd, <span class="type">loff_t</span> from, <span class="type">size_t</span> len,</span></span><br><span class="line"><span class="params"><span class="type">size_t</span> *retlen, <span class="type">void</span> **virt, <span class="type">resource_size_t</span> *phys)</span></span><br><span class="line">&#123;</span><br><span class="line">*virt = mtd-&gt;priv + from;</span><br><span class="line">*retlen = len;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">ram_unpoint</span><span class="params">(<span class="keyword">struct</span> mtd_info *mtd, <span class="type">loff_t</span> from, <span class="type">size_t</span> len)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Allow NOMMU mmap() to directly map the device (if not NULL)</span></span><br><span class="line"><span class="comment"> * - return the address to which the offset maps</span></span><br><span class="line"><span class="comment"> * - return -ENOSYS to indicate refusal to do the mapping</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">long</span> <span class="title function_">ram_get_unmapped_area</span><span class="params">(<span class="keyword">struct</span> mtd_info *mtd,</span></span><br><span class="line"><span class="params">   <span class="type">unsigned</span> <span class="type">long</span> len,</span></span><br><span class="line"><span class="params">   <span class="type">unsigned</span> <span class="type">long</span> offset,</span></span><br><span class="line"><span class="params">   <span class="type">unsigned</span> <span class="type">long</span> flags)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">long</span>) mtd-&gt;priv + offset;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">ram_read</span><span class="params">(<span class="keyword">struct</span> mtd_info *mtd, <span class="type">loff_t</span> from, <span class="type">size_t</span> len,</span></span><br><span class="line"><span class="params"><span class="type">size_t</span> *retlen, u_char *buf)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">memcpy</span>(buf, mtd-&gt;priv + from, len);</span><br><span class="line">*retlen = len;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">ram_write</span><span class="params">(<span class="keyword">struct</span> mtd_info *mtd, <span class="type">loff_t</span> to, <span class="type">size_t</span> len,</span></span><br><span class="line"><span class="params"><span class="type">size_t</span> *retlen, <span class="type">const</span> u_char *buf)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">memcpy</span>((<span class="type">char</span> *)mtd-&gt;priv + to, buf, len);</span><br><span class="line">*retlen = len;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __exit <span class="title function_">cleanup_mtdram</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (mtd_info) &#123;</span><br><span class="line">mtd_device_unregister(mtd_info);</span><br><span class="line">vfree(mtd_info-&gt;priv);</span><br><span class="line">kfree(mtd_info);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">mtdram_init_device</span><span class="params">(<span class="keyword">struct</span> mtd_info *mtd, <span class="type">void</span> *mapped_address,</span></span><br><span class="line"><span class="params"><span class="type">unsigned</span> <span class="type">long</span> size, <span class="type">const</span> <span class="type">char</span> *name)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">memset</span>(mtd, <span class="number">0</span>, <span class="keyword">sizeof</span>(*mtd));</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Setup the MTD structure */</span></span><br><span class="line">mtd-&gt;name = name;</span><br><span class="line">mtd-&gt;type = MTD_NORFLASH;</span><br><span class="line">mtd-&gt;flags = MTD_CAP_NORFLASH;</span><br><span class="line">mtd-&gt;size = size;</span><br><span class="line">mtd-&gt;writesize = <span class="number">1</span>;</span><br><span class="line">mtd-&gt;writebufsize = <span class="number">64</span>; <span class="comment">/* Mimic CFI NOR flashes */</span></span><br><span class="line">mtd-&gt;erasesize = MTDRAM_ERASE_SIZE;</span><br><span class="line">mtd-&gt;priv = mapped_address;</span><br><span class="line"></span><br><span class="line">mtd-&gt;owner = THIS_MODULE;</span><br><span class="line">mtd-&gt;_erase = ram_erase;</span><br><span class="line">mtd-&gt;_point = ram_point;</span><br><span class="line">mtd-&gt;_unpoint = ram_unpoint;</span><br><span class="line">mtd-&gt;_get_unmapped_area = ram_get_unmapped_area;</span><br><span class="line">mtd-&gt;_read = ram_read;</span><br><span class="line">mtd-&gt;_write = ram_write;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 新版本的内核做的实验，add_mtd_partitions改成了mtd_device_register */</span></span><br><span class="line"><span class="keyword">if</span> (mtd_device_register(mtd, ram_parts, <span class="number">2</span>))</span><br><span class="line"><span class="keyword">return</span> -EIO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">init_mtdram</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">void</span> *addr;</span><br><span class="line"><span class="type">int</span> err;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!total_size)</span><br><span class="line"><span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Allocate some memory */</span></span><br><span class="line">mtd_info = kmalloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> mtd_info), GFP_KERNEL);</span><br><span class="line"><span class="keyword">if</span> (!mtd_info)</span><br><span class="line"><span class="keyword">return</span> -ENOMEM;</span><br><span class="line"></span><br><span class="line">addr = vmalloc(MTDRAM_TOTAL_SIZE);</span><br><span class="line"><span class="keyword">if</span> (!addr) &#123;</span><br><span class="line">kfree(mtd_info);</span><br><span class="line">mtd_info = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">return</span> -ENOMEM;</span><br><span class="line">&#125;</span><br><span class="line">err = mtdram_init_device(mtd_info, addr, MTDRAM_TOTAL_SIZE, <span class="string">&quot;mtdram test device&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (err) &#123;</span><br><span class="line">vfree(addr);</span><br><span class="line">kfree(mtd_info);</span><br><span class="line">mtd_info = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">memset</span>(mtd_info-&gt;priv, <span class="number">0xff</span>, MTDRAM_TOTAL_SIZE);</span><br><span class="line"><span class="keyword">return</span> err;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(init_mtdram);</span><br><span class="line">module_exit(cleanup_mtdram);</span><br><span class="line"></span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br><span class="line">MODULE_AUTHOR(<span class="string">&quot;Alexander Larsson &lt;alexl@redhat.com&gt;&quot;</span>);</span><br><span class="line">MODULE_DESCRIPTION(<span class="string">&quot;Simulated MTD driver for testing&quot;</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux驱动 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux驱动 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gpio子系统</title>
      <link href="/2023/10/21/GPIO%E5%AD%90%E7%B3%BB%E7%BB%9F/"/>
      <url>/2023/10/21/GPIO%E5%AD%90%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="想白嫖，没门！" data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="2d3b286e78c5c4a874cb119b7de6247d1eff251cda51ad58b480ab849a444aa5">571d5de1f5a053f5c86199ac456cb1a43eb166bd6254c6c81e96bfa55ef337b30ef7fffad4ccf2147b4986dfb39f6dbe375cd01e0f025e0b1a01773e5c43df500300e3c436c06e35d29910270292f1a78b2fa3c15ba2164fb766f487b4e1d069d6ed014fa526af67e6f4ce8d29104a0a7c85771da6e7d517d34767b6129be92faee8306664856a367a305371394f07e7456df7612ebf45c24e00045fc5b2e1460999ff3ccf6d844caa5b7cbf66aed10ea5e4c096e552d9a000c1fcf9a8b5cb4b88f23893f6b73c23788838e3168a5a360f398238f38e278c47a2f21c10b27a41914966c0400c7c706ece176f47ceb670166f405b9ff107c01aa94e78931b5ccc11ee455d496948f4180db26237ab93fadd7e904d970b5e803add5c18f58eb9f0eafeba4eb0a809e1577acb25cb1ab049bf063212fae5cef7ca11275c962e66fc4bbeabe7087be3d7e741555f9426d84088857826a27e359c4a7ac6d84343695711953e5047738404f62dae96e31a323c87757121ee52533a3bd19393383d51880b2d570412d1da8e39727c616bb577a5b426a92ce8a3a2733830118451b6b5752d0614d0127ef09311fbe2d6e3df8da1b0977ca2c187fa393c1dc33c8ebc0d0bb5e3ce07217f58e68821bc98573932ab5d2e402d981d9a7a9468b7a5e8c86e2eadc149e83c6193900af32bc55df6046a5b2910ff0fee9468f9f06229174c71a3db8c4b76cc86a38ad021ba9a4e138f71d75ca58f76596d2956f43f7673fafd3a963a7af5014ffc340af9212d78943133208480c96cf1af56f7be119025bb07177d02ff10d265da8d9bbf2941bb260c5c1a6011928ce3356ea8e2f6e82ad1cc7bd2a2d423b6de805ed0cc0d6244a6e5766a211df9e355f53b8ac84e1105da6cc323df9dec5848aaaf6dc32cef4355cee090632f3864c5aa0563956c571ba1a4a2d03791ac4ed8a8a19c13a5656e44c7e00240bb01c1057d6d97b7bae3ddecdfdfca9bf57fa641efaaa8da0e0448c2805e527bf0fb220e02eb3b70566afa8954efb6254367365a0682dad0c33b8b599b96f857f416119e3c8da0038d09f0578acb8df3951db886c345147fa1810f2c8b5b7b83128124a9406309dc9bfa762cb1c0510f9b83124515a1a6a2607d5fa74ff72e99f58a76d89734520471add88e6ea37d0cf5bb553414826e649be05741a43dafe004400b220320f412dc23fb51c7c3ece3d3a42bdef07149fc1c28e54d15c5be7a27a151e618fd153d3ceabdad58eae30e4559638a0a0117ae139091c93d177b38bab9b55b2a62b1733365b4a1ed00dccb18b8260a475ba95db600f8f01858945b652842d3a65a7c6ed111951bf8811710c45b20bbdea496565462883354605e953d11c6a62bd58817fa48f24278b8905a1cdd903112dd82a9ac4208e9f01f4982e185cccb48bb2dfc38c22aa655655a15fac47df002b6d8d27e4e1cb8eecd9cd27d88211c5792b5e1f753c32062610341a59d9da3c854efa9bd1f175ec76f1fc1bdd4eab09b2c6f9c4145fee25d31977c349d6fadf2f7f6ebecd84e6ea6f74fc603a646f8723d38d112f87c0ef66c183eea63d7c9032021177de2d5d7e394e0fe93d61aad01b7ee82acd6cddb0e7189f2fabafcf7f345c317d7e0c599e822f6b8ec4baa93cc4fef68ea5a39b1aac9a6e18adc67f5490d72bfb23ebe14a59a55479eb9e3331612b30fcde4da0e90a10286bfdb1db98e796e0fd9f994ed57718e98715ca18254053459fb2aac28ec39f1b0fb6f661e64e9a99c2dfcda8a91d2c1b3aecc67ecd75ce5250452889f548d789b3e9d29ddc7b071cdc7d3d98d24d17c881265912c2d991f5f6dc958e30b49b95986da65387b0958da4fe25f61042f59793401dd70c83d675fb1bd7172b120c282eb178c627f5fb929f4b4637a3fda4f23d91d90dde2adccb6fd718d84c2be59b06446200d23c6a8e2ad0fbcc5d0fe08458ddcca0ba48df65e1327dc6aa0ff9f48b33f9d03644d7dff2b6373aa9287ee8720d44b70e621dbcc882627a159884588fa4e835f7553cb8d5cfe9735e3b8a8e98be7412a9817098c7fcec4aa77177f0544b2c647d263f820eed1236ef20c37eef6d532edf6b70f50f84d9af563de22fd1bcce13aa1866e36de9b151a1a490e70978a243103baace3f71fe1ef1eb03694d0aede4e0952a7e49ce83ec9957a68ec1fc322d6999cbf2c74f84635f6daaf491c4bae0c53b405763d0e46c96e4adc16144203ce4b941f243c908b64bf9dc0816ccc0e3d1deb6093c931eb156be0d84e6e769c7241909175ab41a78416672e6eb4a70242a8f3bf5aa3b68701ba92f2de9a51046c275f97fb02fa8b0db5230109ddf03714756365de2abe2585419d1d651c97afd8879c96dd07cd4c60af1141a0b0833683768ecb8864cce32e0580d0c2c98b7b3085d726e93d9e762f62c3c85b2eaa7429bb3ab65f07e50afa78d05ec653c28934f4c4a58d512ab1a5fa88bb4c80c51961d73678e4f71aa795a62212f0e726f222abe0f7c2a65c988a276777ac783b0db86b27a58c9353f42b0fa696e787ce9adcc2e2a68b180c8c44efe7118ca0d639410acda912ac2b2080885d85af4f90927a810b439162878c2354f070fae56ca5179bbccee78a99337815732f8582ce3d1a5c9f25d1cd5cec3257f3a398d073ff279874a918ddbd8e708df5b1c749561110a9ab1191b4adb65ead5cd38f62890acfd263e2974d17f7d3c577be89c18e514ee36a920be0d67227f0556d4f1bcb31142c2387a9dc9996ca3aa44ac2a632431c170f4928a6f59f3883f561bf0011f77d0a2aa92991b1770502eaedca4ba87ff429d581b21f2939095c3624b6fc6508dcd7a41ab7117c16ce528a163c35f86f100e8635eec1b1672ba892246cb17d8d259342397b242e21c59588022a945e41e29a872d2846b65f3012608f7b34248ea946eca8124f2570a4c9af10109661e33b99f4af2fc993a7ccc50c63143d814e47d99660864484d11c2078be17ce3f2dac95c50655e7371ded5594e9b140d8a381b2210d4cc1daee3d9bac0f0995bcba582dfa6e5685e8c58b7502374e461be5bb0db1846154a54298d3b0368a7cfe46c47ac99700ff0b81c8976e3bc609881e04284561fed5198d3e30a58533ea7c63eb07df22a3db01145fa0bede354ea2772a16a3bb4bc8c8c952c6a47ab91cf2f67966cdd9f6c5d178b7ff431f9bdd02db4fa7bf16ec7805776b7a967209d1eb53cff5df27ea49fff7fbe40e048c6880a0b0944ef645e277b4d10cd9e17971828e474684b284147068c6fca1ad097d3f68bb158e31be7b912609d14925a20d159dfcbdc174a34c817179bf76d1d783af793158a274f88379a465eda25ed1d000467d55425c35808bdb2956f579d2d2f78b69187a47713dce5f33af559bd9ded9fb8d971ff781e69dcc4e0ddb83272ec699856df91637648b3ea80c99a2839890a8fcd1958c49091637f9847490435c54826f36bf128a0352453f8cfdebd3e6c68721f1865dca67a434912dd76c9b58f87f46ffd03cb7096289110b710f02bd37387592b13b587cc39eaa331038d86e5669d1bfcf5cf7060cd8eac52c47f317e36c08e04f449001db2f707edfe60a36a4037dc21ec48538049636cee4a21649026cba6c3b58e508effe0915877792eb9865420b16de39c65b8281a4ccaa2cfeb96add5559c7a6bf68dcef25ce8d1ea43ac0e5ccdc36908fbe2b61f45ef65896b873cdcd846b8420c5afaaa04154cbed1daed604a00381b6a8b8273c60cf06801cf8904618655615762d843c33737d52b1d1b7ff4b0e1615fac4bb02bf21af261083fab3a08b72b872ac6cfacd2a984f0c01ab1be2a84c447fd9cbbf284ced588de03d1e96ff8c1bea1fe96c825a1c435748f671926fcc786c9a0eb4cbc21a5016c7c4b1b182de9b978b317aec79acffa44f57e28a9ebff3c1f45990e4a47f6eca798cd9cb2f830d77cd50a9c6dc3df7f05cc5ed4eff0fcd38d88e54a8435c132ac53ad9e1f90f1f3dd131dcf20025a37ed06fe80f716d3a845f55472d65e0f205b7188279b1730c3c7d6b1dff092baa4631e6bc561a1cc1a6229c77630f7a3ffdf2b4823a2dc28f1282e6cdebc4be916c85de705b664028fe9e8c86a49265a552b7030cc4e987329f24c8e8a1fc825a06f01e13ea8b34911ade6d5f800311d43e0ce49311f5a10450ac6076291e5c4d0fda97f098d48d05858181f49b7760d8367c937478dc79c4de101d1e7eb129a49c1c3813bdbaf88ad3853e76d20e80f016c2fad0ac1d498aeff626f42913d32ad58fd6e25f955beace54912176f228741fdfadcf1d8cfee5dd275f57546f0ccdc922e575b97d89060d2ba283a8bfad0ec2b5a5c95c00b7ce3bef0843fb1bedd33293a35f3ccfda75f58b64f77328dbd01cc5910cdcc0d6d67889930799ff6d9d9a172ebd4f8cd2a62cc1fe92a02e22eec261019857fe2dd511191b15f8379e63cbbbac77a89af9dc0092074dae0f9d9206092858f2461c2fcdddd25b8a91727bb5dd33da1aa6ed8ff4522c56a139fdee12cc1ea9b3cb88bba736797edbedf7d4eaa32948730f53847c9501c9dff7c6a61bcf72ef4647a4feb857c39141af2e8a98aed4d6fa5718fc932e66553eec02880a052ddeda14d9d7a7179864c1425261b79fce673201dc479f71bcd0e3413fc1d4857b4e5a8ee3b83211d569f22654b696da665eaaa3e377096c346bafe343287669626f500f5208a70d6c58c1c525352c8b99f7d024a4512e33e9d9c844507194b105207a489a110bb1d5d767c8edb0a6e08a4669d8e3fcd720dce6943deffacf6fb6113ed8ec559471240f57d2a83bffa4f2450e3fb0f4c332170c0dcaa275af2aadce3f7c2b38c4077987f79afaeef8c9503303453a05bded92cbc0a67a3a69104c308f6e12a6b160c780f9035c0df96e5e11e7f2d3b4e265d44de3e45b0b94186267df934e92de911911065f615f1a3046c1959722bacc22ee93346ab98ca26385a14f3603cedff7f96bc27b047bef7e54797d7e320827e0392688b9c3449400629b143b674081a9fa9673c8b25011f28f35f33d60b908c333bb4ef370c40eccf3d36e2ff58705952f5eae3953a62e6bd8a1742672198a8c3c8d4f129a9645544eba8109fe61c7406b16f76325d03d69b7927837d896120498cf349eae4623fe413550e0d268e4ed152c839a03e031013ee733b093c704975c34c8b1b916d51c2530d9f14b68919fdd10191109ac34c066a3abf7a3cb0d8d7bf25e290bec18774a90eb9ca9e4b98d89789d3beb128a906f1d38942072ec6eefd367a3ecfcfc12f7a160fd6ff41b1947e97fdff463c8a10115ff2ec4d9adfd5929bcb8660a13a331ee40e78db5afdab315546e9285e3c37e8f76a719ae00fa058f9675747d7bdd7b35b516634a5b55a29275325d1449f31c9c5e8ae81a6886bf839aaabfb58b1ffe8be8940227dcdae4ff177cc221e3b88791baf2921338596b1fe85987e238042e5fe42de9d8afac8241a17a51b53e015e37e0a6fb1875157b4d9251556a8d207008295c9b866974e3bbec6798f5129e3db5aa6f62e63d6f8f3e8e65324779747a112ae453e20167665584812595b11f576361d304f059ce38eab8c15451283785e6b23bb1315d8e49fd7aa9a40b3fb802c6a3e8b8ff2bfed917d5bbc8839e2a21a53322dc17d7b91bea0e0fa774b29236879f1c869283666db92701beaabaaf17de87ae96fa6d9ca812bc1290c788f1dadafb726b9e2e7a62fadf94e6d8634fef5c658a55370cdc04127a943a6b08b4db427d6e044092b39fea5c6985a38abd87905770430c1b3d41a654a0cea072ef962ee073eddf671415343e29e0172dd89bcc4f764258af090540ca1505ab86a7ad73ea3840163ae7d8ba39555b4c35d6f8cd00d12b3ace1351953c779cfddf71e842c35a5fc59034fd45cd427e6717b75b2a31212f77b669e845d107b79a9262cb3ad844b581f67d39a4f9455ddaa57133816b4cf4d49f95ba05c3880acf24e352e5595914c124e55064009eb12050b3a4c2fdf82a3d0a4a42841033de7479b36cbacd8602582413cea0e857defa06ad92fc917da6dddd8bd5776e33a48b3e8cccd758d3b3db46883ff212569be0fdd9b66bafa2a76e8da52e00317b060a99ba25c55f25d951d77e431b8d5fa9146c8781ba94e2eab1307a020ea7704c8c0b57582ab1f1b0f20c0fbdf68dffec46ad2a2b3483dddab43dcd69f3977bf33fa487450ef54a35fd94f073328c5c8175225ea258505d9b329894607e1b4d7f1f019ebe857d7303d521ba2f18adea8a88bb9858ad7f456c1ef4b86f5d1d8aabb6a1137c4db807a77df4cf696c1446d417c10e045a2987759bb596dab6ca43184dbc8faf844eb924acc1a81b9a76081173730de31aedad6ced79c6fe210e44c3c36007444a2dc3e428e0288311cd96ceeb26ae00ffdb673968ae7b7a22f36439cb319dc2cd886de1414008aa23dea15a6a63de5bfa4cd829560a48d443a3ab9f8056fefca8cc0f005a181592612e9583cb08a1796da80e4d2c9cfe5ffe2d427d153d7858112cad9c304a42fedb56f19e268a021db2a8f09646402d9c1f0283c51ff12db8d282e4d46701ef8869e38740a70e2d0125e10ba59be8c2098c5e045220be6c806b523e77489aa05581a585ce4abc6cb2e4386a35b0cc2b6a45ce204d3abf2f62dbf6f5b75d80c8dc47b668e3190aca2db331712882506916cb0fd421b44c2f84ec65e0d27fae7b9d4f56bed5c96acf9889fe1cc52a534a53a0b96015558ae4bd3ead34b21991a1b75d7d74639c696acee2ed8ce8e2553a417ecb1c3fbaddc0bbef19e1ff792505b1603160b2c0bb73591e6a78a3e1da958dd17387b9f5a1bd489ca8a3baf5af4228aad61fd135a225f1922b28fafc1274c0a67423e3383f2071c942873d0ea0200f5ebfacbdec3f32687f93a46a910e0cf13d559b3c06e7b53ed09cea6006210eed70a5b3dafea0b034abd7bf64047e61e9aa9990908d456f4c27df13717b45678ed65a6852947d0052be2a17ca982033a65be9c534db298d2c5baebcc464fc5ab5e98d9d0b9a6b178a8ebc67c0b676b8b84b0de2d4cfa931164a3a5085363e30087c4d02efa543d2052504951c039f2d83a94e251b54e1b5faf3ea31e76f1b053840470412fe5065938391e6fd9b74f0f861781dd7d628483bc17a298bd8139fa7961814a8a6aa5f212b091fa44bb891eecf70af302ff013a363455cc54770d3f85d371bba5a51f317cc1867175a45c893e2abef9e54f88684cd851f5b83893ed59dc601b4551068a08e9ed935f7077b6ac61f4a7445df1bba67462c7ceb0ec1530f24bafad84e01e9cb8dd095545b27cf1b93b93635201c48a3559384ae5aef3b91a89adf093edd6dc7c00060c92450c03cc9261d48900d84746a99116aa11bfc248a1f8133a1737ee4059c48495cdecbf83380bc8e2441664304dffb0b5b2ca4eca52f092bf42d51c377bdfd70e7f913c48e5fc196bb25f7b7e0a5df996500164c05fed589d54af6b2f2e38e708a4b9616d6c2a05c74f2010487edb92da5ad7a45e087e561f16a48079cf09cf6fb734cf84f02d1368b0e520dd3d1aac90ce9fbae850ee84c7449080dd3abc3fe7757026c0ae3d33086360e7cc4394f0c9d31c88d5bdce39b6f4b3a7444d30b23e0a162a45972c5141957d3974ec82cef75ae1a7e42f2447007bf8d40a6171b5ad28e256c271fe382b9c95e0c54bedd15178df07ab40fd0eac882a85c37486a3816ffd9e0edf5a8957b2b3bf4dde3294a0418e56b4e02f531a8efeb788cd79feae5e2a093c4b0505207cff89104069a56d442eb200c513b2820a81ab334c20f67f950f916e13fc3eaa607e141834897cce5191cba7d1c9fb1eb7101d008a11b8a38f3a814a6126d23e14d9cfe9a985deca32d4286ff61623f4589c588803b7fa0fcdde4231e4384c12d831c7def78b2949ddffb48401abc165a0109e48ae3f705166c046351c1f48f6b7953a347815b1246a4b5b2fb46a0386164d3f660326c947df656b88d79e1980861f0a5ab148ffc11bbeb21e74637aed874654bddf5ba2f32e188c19da16f6db2fc7ff5f272cfe016693125308e1fdb1be9170085304dd80aaa2f7272bac7a062643c709996e1629601ad0cba1f03b573db5dc1b1ccf4f3b80d8d8f4195cb3462200df9193105d53171bc34e7cf159118338d5331d457cf4bd2911a4136d5889ac2b4b83b9899d33ead51df84f428fb5f3ac68279ec72d2122ddf56f493e4d81830edd0e9421ab58814b5b374cc1de2639892ce2077cab95649a3e1df111f97a5878a27a014826dcab8ff3784cf7f7c3f34cb05d27c6a82961db33585191261615e5414deeabe324eef8258cc386a68ae0e9e99ef473a99afb9d85889c7c9e2c34ef9d8a5eb2e64d6129330300b347c3f81ddc60551d1720b05fb1fb5f259496e53c721486b959ba19865bcc5720e5c36f04e4551f9f896f42dc8b5cd79373a4a3cef17ee77eb0b123ff1120f1af663906768f671742bf4c8c734b2154312cddbd7aedfd431433d0dbd420eec28e2e1579d1cd8323e3b28fd537093e574944d5ea0085da5a109de5ce3527cf25dec95f033ae3971e66f0fed6d87630036e4ee1b7b0b466b5a621b49196725f2784d72c480f2df21c895cf15131124a3e147b826142320a28a752eec7c3b8cc59146c3fb68a38417fc7d18947fde3dfdc04172cfa33c7eeb8d32d75651b0971237ae4870a8d30639621965149a4bd4478fc6a10a7a7e450d01560cae0cdf63a744987d2272c8dccf5f5e731a81e43c66a5330187bef97f1cf9244b1e69046d21a3e121ced27a185ed13cb253d62aad0ff8e34f50d77754a86116edb67530817f30413e7a1db05269dec3ad27ae3fd8b7538e6236ede17ff7acd5ca7033dbee62c6d00b31324eb7428d5f6b3cca2ae4919928412ec08bf4820cc3619b19faabb437578c7ba7b9b1b8d65002e3197ab121162ca60fd128d76a57e90398281d59a306701068d23e2facb56aa4c4e75b8c727fb37554fa324336258d8c05ca2bdee6b90ede2b1a9a2f538df34677bfe61bbffa269b1e934496d8aabecf20a81283871ad39662414082ad0c707070b05d46a0e23eea039769e0abe610ad7a7c62bfd77f3b126e47c8b74e544c1406fc13c0c0fd258ef8e67f3af574a33cef58bc75f711a6af6e9c77905556f4acb5374d6f37197a2af58023cc32ecf91f0b16c14474be4bffb9ea7c9eab0dac860f4e2fd44adfce7b96b4f16ba7a343e8ddfcdb7f0122c01dd5ec59b58083500b6c06919803e228499033b794794e79c9c48cc41965bf36fc047d92545ab4ff707a916518d56299233f7e45092db69ba0fe26ef766a89a1a5c0bc8a7d464fdb2a6b46e34ae725704e67073a60b4edb9f23395982beb097ad243b2a190fb107b60a3f765285ae57f0809363f5e40a79884239afa783a7a018e29fdf64839ecff489bca02455c8ccffd0ed7e5f850959bd184b31e7717ffd51a6631a089012d8a14514bed769aa4abf39214cedea6c98e49afe117f084e809dfaf55c99d226d64e1f4324f1111cd9d8653a26aa20e78dbc5f5646d19a6a0443bce5af079105fa4c4b4b513b52eb3aa325a797fc5b4e0a2675974b4e48be0f262d82f62c81db6be630bdda1b0d71a062a752b973240bd323fec8de25647088ecb2245a50d41569db4e121b19126f7a0725c8ceb73d9367ba521c93a407f4ce2e5be7d58bc308ac713b38acbf1b648df0e4d81ddbc16bc10a17398b2e344ced38cb75cf47e993c2420fcf05eaf5b62d663d59c1344187f4ef3cd01d757405abdb1b42fb94e3dbc3f654bdc9767f653e46ac9095f00a1b1d28beb82264e692940cc2ac428ae9667241e0b12f66196fc4f21ddd813f2ad68584b35563f0ac63494cd70e3e9c5db7fedbe63a4bdd99a082dc7711e2bb436f1385e925d88c528d49aa96abb78dbbe4cc3fb9fcc77d4da400d9892599bd1900e92052b2bd0d7d35b8abe7a04706ea2cc34fc138bb4d918df539665d480b20f6b889b66af53ef037546bc7c31e3ce998411ebef11b118040f1c7b5b4daa22cd01693e908c069150cf64df73bc36d6d10e70858587409be0e4be2e135c9278199847d6be9b6c0b688b437db6a5f0666596425f540025e9e3fde0496a13163d83718e016069ad51d6df17e6a3e7537478b48649dedb173d75ad51ad940f41c714fe887f1b587690879b06f90c9c259e6cefa6912b0a1eee359c6ac52cdc51746012c0a5098e99b72bc9ea7f87d45a62b09781b65836c0e389dbbf4174b92ec12c0a2f7dfe2a3b520a4e804c6e6372efadcd1723e968e7517e653ed8ed994516ad76f8b61dc3cf87777271d1209780de370d4c00fe9c3201150bb1424e71c5178fef7f77a98935f51d1a2ee1478fc9d0c2d15a4e67453f20a9ed7f9f70aa8fe9d33282f4721951dd48b2261df7d224d5f5992889c4ca27d881d08f591f1431f8be440c6d70613c1cf3f92e87361fa4edb0ca28bffc4914bfcbb3a276531049bf50750fc79748a1fb5d4d85f23f5f6a55aeabb85f049b0afc1d2158d5ef2d9dca9299e72f4c829cfed922036338b01f4f3a78fd167f317e7d4fbc9120db00f07e694ff3659abc62eb5c35c3a2a80c47eab9e4f00a27f50663bf271db156b97889823c10092e34c65ee83722f0c200ba687f795ac637e00744f8466e2dc487551e3df1123b907709ba8f9cd954d9365228d18b139e46865715a9291763170401878f45d7b062f31e882f425e423c73d595c48ee1e6f7912b439a68f3ab1e7556e9375349d2cf710cd724e562e30334afd066d018cbe73347a90f40307dc437007e5905803da395b593a7f997c75f3f0801ee35f3547f66b3abee9d281485e5e8dfebc3a2b6c7a8d6f2c1790b7ef4a7c2eabf1546431e33c997de162a1828807649fa583860eddc15fc3234bd7e719c44b603602fccc959ec7992b353023619284f2b9115834dd7a447594c53381f1a144d0935cd2bdf65d43665fb96c3753d499277ebc109b30bf049a0b7528b5058d0e9d09f76ecf169418245c6aa0be0bb103a9c4f7b72f0be5f20bd2e308e9e6761b64e8a61541cf7812ae5e459c204de054e18146c7c2934458d54f812356ad895fed83f660a6b358bbf62b35355a6264cdd0a4c55e616d72823c0c5c125ff8555d54f83b6cb30a108c9aa592cf920f1862d4379d1fd650f56b82cd6326d7adc3257072138e0c39ebf594639fc36a61462e6ce46304d360a3589535629c48b5a3f0a3ef4b2c270ebb469da36cc040f11b5aa7a440c05f0e2cbf2df98268ea7bf7571c9c25572420ccf4dc5c1f99d1e81a3e4c9e3e8eef49873d16efb69b32b777d13c77063aab280daebdd92d9b7b9363bc862981d28dd382daf1c910efb4c498ee383ed548d9835f8b9a61563dcef6eda2673f7890864a31ee96b57bbb1190dd42a30b390b9b522347f9346099d848334e30f0f1276d841c81749aa19004deff02d88561a8d0562852a8200c6efef1c45307abfa5fcf21cf40f75fed4401e9addc36f2615601f0680661ae48e9dde48819fe532227e81d459c58cb2f661b7dd5ea9d0a999f5adf0546514770be59264ee323bdba347788a45881e718a1415638f652726547d7bb6e6b9e2141ccc5e27d1b3f58ad25708f1c3de3d4308914a3923edf54b358587e120a54ed42b63f528da69b6a47f45bdb986de208e81555711e772e69320e982e96fb04f958bddb72acc835020bd5782adcde2cf881869c3f1785112f98cf181414b51532a97f344b57d291255bb21aeaa78d711096ee539cb28a1630fe0db448ae13cb874b887e357362d6b67c40adb0330a777d8ab309ac7492117dff319af9e3f0336b13866b0896004ed3e0247996dc4cb4ec5babcbd025f6735f7385042ab172735bce7cc26038502ab326dbf9292bfffd75ee20c8ec8b83bff7658029c84109fe71abb9345db5421b0294b6afe749265c8c30b6dc2fbe6886a6e52d05c0aae4bd39466180db78d61c8822dfecb4a17a9422202cdead3fbdd7a884f720ba77d3f04040fbf19e7a6818f283ff33850338debaa77dcd8787b955e1bac0dfd7972fea508bc0c7be6bc9de014437c43d5c08046f513ce68cbe2c2a4448d825fbfc366ac34fa0cc76cd15485b4ff591058a10631c0915f124afc4dcd3a21766971bee62303b95c92609eaaa7388d5636ab0e4019de7ac046f2acc32346fc50e1490ed739d528c108f7ae433d5d5af7cbedcb579bfe9e118089e0ca1f937d4aad9c8be00c0e98cf55f43a04a3f3ff2b99d1d56749bdceebda8c221e08df1b60df1205114d12e90546bbb98de19ab56b723069f4d605e5bfdc93aed8c2eba1b3682b3cb8b9140835d6d3170357ebaa38f0589cc7541eafc6afa51f93eeaf0ad3fe9fef8c98d52b0ba5ebe38e3f5337faa34182094dc46e20eb7146d8308a7fa8820de8027109643a5c5b2098f40905ea1bf18431ceb3d12c1a9b4f80059cea9e65f8e3228daecd8dcadfa52ec23530248e1d948b4eea8d91c569eba43316f2ce55f089b5fe1b36216c8339525ca21c439412cfd7bdaf89cb47cca6da2c56ca5d85adbaa8a945b892e30596485a624f390760421ddcfc82f6c1c47561259d8b84cba054fde9c94be0018aa18a272cca2b7bbb06ec471b1c9ed618a16bfa6b4affebc8f3f00ebfd6b1d5384586cddb7ed899ee713aa53225c6d744266e6a87e2156e9af97856bf696bd4b597a69c943c9a5029cec3fd4d5160fb5e21d4e5c39fd6eebcbee995898f1cc4ade6ab9461b28f0ad4550f67df40d6aca28129f5907e13674dd42801b504650c59c1dd4c6eb9da370b27b9c1d4b22011c894fb51a2e88328e4fb144a4fd4dc301958ee689cca943dec733319fd2f985785f1679a036e213b9dadd1f2440522479957a4e87b8924834ff8e89da5fcfd79389c4a9f2d56c849a0d5e8d4b527d5a50b1d2c5f9022b0ff93a87ac18209e36a4ba42e2e90669d1e6398ee3b2669d3d3d394cd68b78c59c5a7c578af94ee1ec2c6ff9b24f951ceacab8af09a77e892b5506bdca9d3e04d7c7dd1c845fa5d169e40a917f263ad6a7e62889798db8f8bc3a604879b115c8130dcd62f81f003c29fa6f5769e4216f63f76d6f38335d675e5e73b84de454b7a6b7e948962f2165895e26b3f7a4d9695702cbe686119aec70c839d6636ecbefeab58506584b26b3bc6be1cf9fb12e9b1b12080ae2468989ce320a68ff2c6d28d1abaf85c1a840d5e57f45c2fe17d134668dd7c8ccf47c6120193a280ecf2e3e587a8365948ec0fd9bed087df2a1ebffd91636c05e080268481769ce50bd76fedb11dac0839fa81e4682cff72893b25ececd3a2527bdfdd9a80116c36ed96d3952df801b681a0219952e152f2b29e749b2d4dda1581cdf3e54da2a3237c1fad2f66e649a4b9ad810bd98c2bdebc2127bbb376c8c0b83592f9a0a4ee45e846ffa5c511cfde84f7054e8f2c47760c4d56110bb7c8658b46a022f785b874ccd25bbab6f6d7cdf42e7e77000f6c27a77b0addd5381970e5ffeb843457ed3647913fddb3be9dd891d45404d62188b6ba19b1e268bcee7f9427fc8a7aee324c14c766863862774a3e8315449730e99557a5811c892253ea468ab8ee00111ae8c15fa0accea3253bd9f22c4c511219e1a2071ff3a7f0a6381048567d53694bfee935f8923f45270515c17a9ed1aee6c9a917df3f42702c7544594193f796b6196799e7be5f667dad6d1f1c2c4c7979f896fd6702f1dba23ea708bb5f7a974a8d5323f5855eea277f6f648091865a93ffc6c88f6acf831ec79484a47dc2400eff07535cbe98830b189aae3ff46721466947886db1aad84663c563df5254cf1e5aed22cbd492e1e1f1db1519c2c6c5b7ea8d9d6febd5b360fcca68cccfbe70733aad2076c1818efb53abcc5875661f12cbe3060a4a8d8489f716d62e77058c63785c5006093e1c2337260b58c46680fca67368d3953b17985dd8905869c6182e84b13b90bf86d8aa28afa0ccf4045e0599761ae0a5e8a0d232822594b35349137fc060eb859829bca70a6a97de61fba827ace1da7e97fdfe0960407087ec9e2e65adf89cc0d334b950eee170ecce1e0c92bbe3661526b17265d91d028a876c5cf461fa7303b4aea03534c2e9eb48f764eafb04a357550bc565b9364b93486bffe661919323e8d4e552cac483569155af5434dc6cc1e9820ce0443935f9428b9a8ce8cd165705110e8624e93edb2ac957e6d1d986748278408841372127a9d9cf40f949c0bbe74fd774f54167940320e05f6de13b9d945c217534079de88b109c0389f13fad73ecfdc5be36830c99edc9f8fcf0ab02e57e10cd65078737c2a96aad7b8035f322335539c3f6203aa216a7f9d431548eea60e26304afbdfe21f4d6aebfc387f7d59e7c8a3e7b154e426a0e98f0f8818dff38818084dcf1a239c7deb384eb95b105d26a27ec095d58c9e07ac473176b9baff117360bf3b006c82345d898a11761d2e4d578b2b3e8d5ffd99be29dab881fde421e6cc826c06404ba7c178a740e7a8d6204562febce988c22baac157901c622f8d27788f3d65d3ea607541defa97a726f747f3b796ce129e67ece4623fa727cbd933889d5dffcec373d5f732d60cb0be6ffa550d9d31dc43db7e49a86ba74a94506c7d72620259efccbea53a257b8f346d7991285687b21c442cbc428c12d75b7f7c2dd0c709b87127708398e2618b9f3c46098716f5a9bc565fa6cce31406b5bd25a5c353dcc26a63a7a9c4a9bc78ff3f96128d6e087f0e82b9c20cfdc6ecb21a5f62d0c50eb68e359593107d5b1448d925c580e8bebf9515c31a40b7d45ec98d11442cd74e60fa39fd18b678cc12e761348b7212e07075a038d429bbd891a78a1b128db12916b1f0c505ba09473c522ac09707848423ff923632235f273efb34bb89084dc91881cf380bc0c69890db74229fa66f0907007e8006e4941f296aca2967c75096516e7e3e8b5861dd3b83ad55881e18d32630663e60fd2c006e280ae905115faface87313960e3a5e9180ba4e4fcd3c455164d167764bcd4f3889e62660c1579ab5403f0c03037a233f5f4cebe84b7fcf81bec30c273f668ba792341151f7ab119464931f136839bd6984a1a00957294f434ae21e35592919e131702769e6b539aba06e4fe8bc47611e416470faae0bebd1f50f33c088f5fca8457b8df11de358f4bf26a704cdfc9aaf5becc4969230f6d1461d5ee2a5bcd30ad968df98fd805520078d79ae0a01f889064d575a35760604f322bf7c229213dcc7eaa12e889714505d6150d20e29c6b667264a18942983c3eedec5fb4831f41bbc98dfd212f06633182b563f00d82e5078780131351113f3662aad6ec99b7da37402b50ac6c8121f4c783f59e2156c606620a2086f338e5d6ac57fdaedf3de6ddffd5a91390be93d4990f8863cef477bc865bf7e925b87615a765ce723cf5f027bb7b8a02a5f7f8ed9ea58724c77cd79c47493d581035b75e151bb1c92c6e227cf94c2563bf3986f8b05f525c719a541cad4eee99eec6e64770d20c5a51962a6ded3ed6bf2bb78c4b50e00d14f925ae11da1bea7b956a9f81e11ad0eb299b7e131cf1a324f3e10947112892980dd85123d126a15aa35bd985dbbfe62e14589e4d085215baf8f84e7bd45228c05fbe5a43b9a05979cd5fd3570e31031f5d0c6eeef0582c10b73903766f34e98b87f5fb0bce17c458a197e286cb5a3a19a880bbdf3ab66a9a06065d772ee4cf17a3f278ea08d165379a89ac59cd1dea202b7d18c7c023472f64954287d3216b51c4e470926b7e51db2a58e1718def8f6d2281a84c80e108806a49dac1a88677e05c0995afcb0c52e343ddf9960ef671dfcf3be4c6c8ed1eaae47fa854e08ceb2a7fd3260f48bae466e143ff8c88ff7552cd295f774d2c3bc465489730a198c4512f3b82587e2b33c4315a44dc521bc649df289e07d323123f58205fda1d788110be2a03630daf32f145edc8a2d40323f3481ca32cf47fe069c80a4acc0eec5ff616b68b929eb2d0e82a0887f2f1bd99e615eb95ea0e71661339a6cc63fe9feab4b37936f46daab421afdbf9cad66903561e619355ee15ffa1dde318a5dc992e79936bb5d7c89e068f75d435f4fe424519e1499a976974d56e7758c2b7cd6a8306828b654421660d02ccd2fbe5a751cd49672d78fd858f769f90cad35acc2afee5ba2e334bfe2e46cf43d491af1a2cd8ff3bd6afd7c50a4b6f41b54169dd9aad44d9aa6b08a156a3afce24725ef16be0ec34a8561e8d39eae0a94f372705a5ad7057981bcf5ea855a38ec11f98ea5e0c95dd9dcb5788ac4f2f0c6cb06672e153b5e0cca22b6f27ae462d5adadc95e77da3821cc3fd586b31c08a157099546e59b24a7502dda96377a80e733dd3118d30e25b3235d8632fff973141af39e0f24bcab2a368f7d769a44d9502ebedd6c338a2087feb0b7ddc060f0f4bed44ce39754c0c22dc372e8abf60f6f1fe7f00f7d9c955d2ac94b79a7524e10055aae4918481cc0edf25a59a9435160a2555347f7b62bec699bf7a9751a6fc688d46b29348eb2964268a68c9e4508f3df75ce57e3ff025364ff8ba831c9fb877c774425a20c07f98838ecf263e7cd3fb90026b4539a7e179d9421ab59324f16ab298ca254e2c854c2b66962b111f2f2749de9d2768ac6648adec5199a39251c0dc8fedcf924b3441c2a8ed530a71bdb99690208b9dfb91f5ff38f1622d9f9fe381ca5be6f55e6994decf0f24ada6c70e64ef16211cbdd038cf95d9a37695765326c00fa4f9cf91440310a548b3985f67c4befdc1d8636810539e4f39f001386993e52bc792463304b674712d18e06854851d40d96862e5f92ed8fc2652af1f4ab79b3dcef8631413fe5ec9f5607ec187d2994be1821179f6edd8a40a26e3cc74529b20470eaac0e6e06a906cf68f34eb1de533798b190162c977422cec4c174fc048d09a2011a050ae438b8ada1c6857405c5aea3e031ae3f90b800a9237337d94dc30cbdc5b56846fc421a5236459dcbb24871a0f97adf719bba531faac0aa6ac1e91475876562da584d0b40a7f4f7555592eacadf994158d9c64741aafe997638825f56490247630a7c8c888703b6ee341639f1387ab361167879ba3c7f14da8bd42fc32c025203c09a8b9122ee8825cfed1043e92555c99428885603d43520c6d353ac1885a8bada60b9a17b134ce758101389a06c354692987b04ce01e1ef72a574716b5efb9bf222ba3f6ab0a6574015cb8c70fbb3a498fe83f6d34066dbd96f939ca88ce4cd386577e0de89906b912b1bc79060bb497a6a108ed62e65879a0f8df7241b482fb50e2c0401883c2d88b19e502006499e305aeb6207c4a062e22dd66aa66952c5c5e79657417c52a2ca07b837393171e531e01372844d4e95075add24543041cf278090c3415c1026fce4b63a938d6774dfda6485bbfe12b3672f5af82a001c8dce32134e053b3abe990635334d8bbb0fbcfd6bc7ec8c155cfa4beb38f16d420dfa0eb3f152c428c6b7d30bd1f9d6393d03413f98d928172d611025a4af785cf0ad4e70274e0a43041078d5ca9e2160da5a7ae7175f2a52432061f995ae2402fc4c0bef9fa7884395aed851a25ab7d1e322850b356b710edd65ad671c5dd6df59e53519240744f6503855e890237bf3b9b8927d756e083fc20288441afac977ed9b538ac13b2ef6ce40db8fd6245fad231b9794784d6c7f3ebec8c434031375da2b8cca153cd19572eb32178c6242ee5aa6ca48d154ec48913f9496d58f3e88eb9f0dfa2325f14335fecf009d9b4f8958da3a7417008f6573e00ea7b3aa33572234ece9d378f428287360aec225b3d01b426586e0426f7437b14348578c9fb8b53ebe86e45ece4fdfce9898b1efb5054b8eb54a276c1083c53db91ccffc3425948bceca82867045ffa8a69a3319d6c0304849c04e1da848927a60a848aa3358576ee99f55454ef2fc9c2c8b5311e2cd4325c551412d3cf4775c1511cb9709e5d22e482a3442274775bd807c0c1c613df492f04bf487bbfdc30697f5b9c8b1b1847043a11cae06a79d20dbb7d104e3d97d1576e24eb99d5decad28a34bc3c0e762e3cade879497acb68810664a99260409c4ddfc379485ba1ea3a7814489db77a7652aedb1784bc6c745be8ef5e0a65368ee689a6607f32897f265e1bca01cc563c3a2595701116c669ae2fc4b4979ca11dd7552214527aa21a0f4560bbc8da60f8d9b41ffa178875707097d7642c26eca67b8fa3a13c9ab98e8962bbd6d367e5c2b9af405fb151accc6a9b8da6b611f6cdb47e96af01480779018dadfebb410305a1a0ac9df55b77ff54d44887ad126735a28dcc1440c354fa7a01f25fff46ae6b31bdac05ad030b16c0b9f690cb39ad0c376c412f43b70408a454a2091e85512dd3dc0c1f98da52cc88125c1ac3c5dad3b23444a93ac4b5e0f4a3eb0dd4fdeb198bf4a73b9aa3c003405f02861222cf199b596aeb06fa062688ae0846258f09a873b37563609671cabd04b50ab0e54819ccee427bd51e207dd63605f5f8a14d6f2f4a8bae84d347bbc4131e2751f0760a0d474db260903c0ccfd7dd664eeb016be622f8aec428e079fb3c81119f2227faf6cd2b1f55d33e0a23ecb4c41673e3d338fa8ed9246aa7644bb17ff449cf3fb76e0b3a75805e88ece952252994446a87630d86fca88aef7b46e6e59bbe9ff3e2137b6dd61098962aad8e768d7e95e4f0eff8820fb91128076b42741d431e299f64fe144a288b78cd23ced1b938d77dbf2d92485529e2d9109d0170011a454d80caec78d51d4fa592031e58eade7028311d23fd5ea1e5ec2b1930be476f5269a61c5d76bb0230e6c910f9b93d722694f645c25214128c44338f50845fc8088b1b517368d6a1d296923084195f539e888697a219b325fb691a2a189adcd7ec483bdfd4b27d78496969255bff0bd79e6a19e159355adcdd41d1e1665dca010ec7e74a544de8622c974e7ed5f36ad124d13138efdc9b60314b5690f03eaae662eeb2db2210ab34ccaf70690cc733aab360c9e77e6b23ca52280f8e29acd6e9ff636a6476cbbfefea6c4627ef21fffed6a10cc54be8a1b4427262dab2efd9f24e347b72216188043147bb495cff29f56be92d687ae5ee971927bd73d2af7a3b6e706ede098295a5fee2c47e439a4808377cb79a32a5ffcbf3e5982fabb760527970bfe164e242aae9ac527fb3fe130e9451896509c8cc426067564e2e6752ec181e14f6009c49b749551c13dac55cd6a03dd36de4c88df9269de2c464fcf9767a17d62575fa4b0f1cdda28e3e108087c3dba85db04911eef363e65107f3c068209831ed2ebcc9913c9d8b77094dc9ae9c8fc96b7ef1220861c1721a6b92d42bd8a2b51a883892e5b6c5598a7b48c18144143a1f1fc7e6b1d8a073fb3614be48cb4555aa5c0c1c3d3f2f91c9cf2c875be3eca3a3b1849f6d9b6ea3e2fc6e466c491b6bdbe73ac224be2f7d58b8eac7e6334edb2a8abe82df3bd0b93dcc779ece55c2adeac14e6e57dda3b9c75c25c053d65513cc832f803c9db01ebb97c36e77ca95132f57cad65b9f142311f8e24536255e87644d04a3fe2a09665bf5e9061df128fd5f610a40d7cfa84325487245d3fcf2f5d95eca7b04450659e7fa5fd8c8cdef4df3f46cb705ca6d7e9eb204b22059962b5c72aa307a91479791d6c24a4a2dcd7a8f06056c79bfff849cfdd65ff71237593f62046a5f94693ad55953206f16c940576d887a3cc2863848f4173a98f826cf639d2b68ee512be9502308c8949e0dd9f2cb209db87b13ed1e701a1fb86e3063687120d28aaee398d53f1404b0ad830b612b96f261f3c47d60149f4988d1a6891047256ed9d8d7883edb45fb2ddfda32efb3c8bc82f367f4439a8b72d154085a3ece9957ef4f611e27d04e41b913f88ff13bbcff4ff93a357b09c5079ed654c435ab9b3a1d1ff2a4619eb67a58408f14c0e3cc0930d825364c20ac66ab7e7fd2bfa70743edc5f251e6e2ff3ec8169873fd423539f0f1ae71bedb8d5d2f4e9a53fddd51e3550873ae10b29f92cbd70c893032bfce8a4d066abcb6f436ce6f4348db6c0889302a8f7ece5d0814f1bedd8ca289eab3922ecef2248748817c584c236bc2d5ee5571aff0324bf2dd3d367fc735b0b59c8d96539f99730449edbd641eff5d1f24cc5869e97757f05ac2efb9a712d8ca1a7edd9d4512249ad2cfc09adda4690c8143265c510ca3a6451c8ffe8007a608d2d4822e97857774352d41ee9a36abd06ea8932ad6bc27a2416be3208def2a9abbd3369d2208204c34bd4daaa1988f457e207fc5cc9c83bd2a345a7c55f19725106663f991c1df76b3f226fef6aa5668201fd7e0aabd296a225824ff00cb79826d8344a602db089768221c1c44c25e9c80248b53964f81bbf5614ce0c7d1a82627e22dfd28cc009dfe0b185094dd36c5566e8af5d83627e1bed6a8753f9edade1382b4c3fd36fd65a6d54ed7fb7cbbbb3a9040cc1d6a7d04d1a1044b03b2acf3c3141dbf4318d2e312054857e55adf4737e040f15ebac3aa1d4f7f0bccb6913aa2e58ca7dd5ef2535368fddf5b670808651ecff4f735508285d5c9e716c181aec8246da24a5b691410a07919e7a399346a375a06cf82ac13d43ca7e8cc8269e5de85250009204cd3a127f4387abf52223928c21ee17aec3926e7ce05d80abfef3017db4d556b003bc0f831adb20c5673c2a69365d65ba9c3d75d9e432043fbadb8db473679690a9be075047bd8f1ed744a0484f76ad3d0937589727b5a897df0718acc9a6bce8f36722ea866efdef59857bc76c6308ea2ba23fdd09411c999bedb929b601703503ca758339332609f7e3307ac05ef3924d97d077e2fd1f760ac83260e2729204e60eeec3a82c6a1466a143b7c8acfdad6ba1eadb12eec82003a343807d58574f99b6e071c24fb52cf5b0b4f872517d24ca7ad8c0c290460fe8c366a4f3d185102252ac6154d88f1d1b4d582ef35753fa167c7080194db5f2d8fd89d33b33490c9ccc6e1704cbae0b61415c9b6ca073e73e180b4f5768a13629f4ecaa8b140415baf236ec379a4c47624b4794b6a0cd8c1970e492f2ade87157f84c0741d0331b8fb9dca7148d13ad63ecc26eb7ed72f807cdb7281ed38cf2933ba21ad52f95e79e09fbd5e215168cece325b06786488e9107b595ef1b958ab1d1a2faf3ecd0ca97366ab488f9dc06bde3c2ef464992225aca2cf4518db05a458f9d7d7f70b94b82f14de31be2a14898a7483b02559bde575340b386c3375c6e36335ebbed13e52945a48d765588157aea479d1ff8ec738708ed01694aed83baa5274d65e6e69e2cee3c21844da3a8269ccbbf6531d9bda79a38132f3a7c63f4adf4e4a53bf94cc7b0c93d5a2cf1c8225a4985711b29880201454c3ecdb8235186ea7d316cf462cd8c5f8056c1075beaa0987f60c947acd780b40ad29eb8c0251e8981a2b4945653055dc82e684bceed8db168114bcf8ee04a9f76edd56dc93075fcba9d99fc8150902a2248b7d76b22ae81bf8cca567e316c477649cc0e76d137cd61bf61702f7b8abea743ec84c43856990b6030e1bfc19f55fbb75510cf5471d2f8ad8695bc76bc9907f479f9a01c7725845539f09077035e65dc2d7e577a2860e48f0ce24c5bb1febca27a5dacbaf2d4ff17fa09c835c065d40e7ba093bb1bf029e9ef203388fcb603520446f2a56af734205e9cb05abf78912a19d3e45e1500fa7980ebf12a5d59a042b74e9e46dd595261d110262940a1f2ec95938e61026814b9013f47930577ce88e3fd9d9c48482f06a8cc383f2f9182113fc3143e328fad42827c68320c8d2053bd0e46d9af58c72e086d8b7e8bb986f2d7fa92d78baa357a90cdcba6b3d2bac1ff01c1eadca026946d2d598015ab310bbaff34209940970a79cfd543446d60fbf0e9da525f1f1371f94b9eccd3213d9b22ac2a424aea6e024925da61dc18a5ca6d691a053e9074037ec3dcadb7640d1b154b04512461f949e601aa97b645e79b7f605c5043711f40ff5a1ed3391211473636e19d46073d4b9f76a6445b168a5e7cdcda6f52dbbd113cf4bada3e6e33fb3534e73ea8999a333c0e068ce806e833157eeb2fc42a4e654b8428846ab7e66a70688e977af00880599317e6621ea4b39abf02d9729cb05fb6f34ef7fb3c05a76f7101d523678e20d73d825e0c065107d06b1501d5bb6e77b6ce27e685db5d4070e0014283c65413a05c6175b67a85631af6f2f6268622e46cd00f3a71c6d9ee5d3003d66b981f493ea4bd67bcc03c966938d134439a106951d8661dd16337c3c7338ce23f6ae97aef961e68ef0aa7cea048801fb276e35ce644f2e8b38f766039f7ecb1b871eb0f95e8142fc2ec5b15137f9ad8fca54fb13eed2ac17fac1388ace8042ef75ecbe01510eff0f23e62a53f775e216e99345993c11f65b595cea4c94fa4006e4fed07124af9fd52c2757bffaf374c40727bc5fd3e96dd5f4dbb73e0c33e48b74cc1f9e344ddcc2d5c151052a97caf44c409054edee77a7b3d17ed033e1feb2fb7d48a7284f8a26c91275e5ddfa749f08e7f0afc0fe0310f6f91e3145916e7cd40729d70a9d7b22225f3352d471452c9e42ef5fe4dd8bb31595f5b18a0f40c3756c69095400b67b58167f23c7f39ba34cf64eda7b4166ee965edd869d899a81f64407e5d84c7520d1dc21dabbe8e17aac710ea1f2e14251fb442653f68f05992f19042c60970dd8250a8f8addb6f52d451edcb9a76fea656fda85cab6184adb50de6ab139ee4ecada2abf17f77459de882c458b8c32301e4c4d1f7d70c083d0c96940ece66f67867fa1f8f5c42acf3a966f775fccd6d93be8cb732a6c96b457d28207f6c990a8aaa8c2db69c6b0626c15137cabe14147a3ac4dca4ee7e771c293963faad0ceba7687d52dedb314c9b5b830c140f933aa816dcf4a81c015236decadc6295ca7e0567a6b22b3fc71052a504e0a0f0ebcdefbdcfa79030962e902db4d71e53c1a8ac94b09b749acdc7e3bd8bb4c4e698f13d3e9e05338392ba7b72a4078fde249a92aa5b533271ff1b39d3732cf27da756466e704cef8101ccc78553cfe168cb03e9953df0038ce53ace12161e6d164bb7cd0521074e27e72dc7510ef5cc334a0f4fc9764a86d735c00c55abdb0c3acbcb8cc1e842051b432c2108965651028e05722bc905181ea132fc48196e5d3ac792b0f8190f33846b526e98addf73a13410f5703fd1ff734b4d3ec121032961598f0bfc742b7177f69b94cd3e5cd473449fef91537fdd7e145b027fedac0211e947759c4b72146ee530e4c663845256314976574d225adcf805cd1438dd2b0973993102d6d62bcb86fa767e14ae9db234db78eb35c457c4e53602865ef4f0596e98e72ed37d12eb2bdcb6f4e5e88198a9dcc9c3425e20e79c69e6a05b5401bcdd8e912b77ee619d54635e468364bfbf5825c328d88cc13e5088f8db9b9d92419e2376ff3afb715685afbe598ca77c72c4ebd934e5a137e6c58a3e701e289a94bc2774cd442edec8a61f6dd7c7ec3c11b9e28a1aa93193c705dbb7e04f72fe5fefe9b52ab5799ef03750b37a910c2ab5c39e2c7f8a6208dbfc01e50fc7a8bcde61ab67730218a4efe2ca503ec967cd6eb46a800c6089d6776266460e6fe754b090d0c52ac0c49715b6cf124154054fc0bf24a14284da0db8a630c162cdedc135c61c15b95b3eb6ca9ad5634a943dc249841bf7814d7951bc1cfd09e293085683530574e572bd219cdf292a674e794b92bf0ff00c49ed18df50de03dc7efb4230871405d227f7ca7e40e25263b0d290e9105c8b02607bd82fa2eeb08da9cfd10c41423f10a3933a830ae253ce6eb890470d346aab21cd04bb7d9608162429fa47f0ae41d1f0a27261acd63a4715f9335653f9f1d0e620f1c0db613d3db151d0385a36bebf8cced5d1c4407722d31924b73a665d4f385521ec80ef13c90905392f1e60370b20ff7db46dd75d4a0704c2539c7b455803301a8cb0cd86c5b9afd0844eb33bae72844e759102345000c700a410f341b1be24d3b8e759f70c03371dddf20db54151df16d451440ff3b29a98c55928fa87d7dbb96c46d791f5a508c62b9d0f1562e94cd8cc647b1fa7253d5a2604ae6a9fa8a203a928e8ea73a0b31adca88ad2319fa9b7848ec7c9e8edf21a6ed3ed0e167a502c6baefaa0995817db737718e1ea473f126f99ff77a5f8300928ac3853e03728bb56a376934ac767bce28b47a547ffb1358f8618707eefe9c7a1fc9f794dd536fb2dd3b32f11bdbbde15109ee69426417e2a4e011a7e01d3b5490d16f33c25465340371c138e8317019cad12631731dbecf04288c86b0b3eaffc7ca18a774623386be86286e84e8f3b947b3b530b829950e2a02ad92b8e3ad4ad5945780c78a9c7640c911ea693130946f21accb5cca0f88900ac38096759e5e586e67f70ff589dbcdab5032faeb3752c4895ddf03213f59458ac930e0aa520d4ee90308706c45acb519998cbe1b93060ef06def1480aa6c344c92738273e6b8b3b4eb5964925d7efa3d5afc69b9df6ce7c97452963e00eb4b62ee53b66398f7e1a72cafe4112ba22ede7e81e1c66781003d40131511a033867b587826b5c0d621aabb18cec633566136754167bd3ba9f6522c94f0bb361d7053374458c8d6d9ad6f5abcad3b04aece4d3368f8245cecf7c92e1b1d98aebf94cc94916d7baec8aa6b2a10bc97fe6421920c3e23165fc24f801205612571f9ed3df0929afeebed37b69b94de663bcb9cc4ae96cf09275e244937454092774f0092ca38d0dffff9f920fdcc4e17838d759d641dbc208603c499c10a7c1bce6dad27d2314a8fdc3f33c75fbb3747c45a319205f3bc4a43c68bfbc789503c9207d2b237a26d30d32cded8da6418638f47b26dceeca1965b587f380d2dd11a0537e6f38035fe66494e242f05957cd7b6d4cf3a448e3759c24a1b300d9e3e5818c8d66f75f78edc90775d159fe4c9cc9f4251e066c484dd455fd7456945ea1a6a7f0cc4248e5ee45def83a47faaf079a535e14d19af9c7a79bd668f5996cf5702557c94f59ec05af7b188b290ac9d06bdd0120ccb8b69c6e0c4f5dbe29b77168cf0744ba11c2f6381f3fb258145172bf3ac277fa330909fd8b6b317ff843f384dd06a004ab3f00790400511436f7b686d5831da0f441b6c977d8254530c6823a89b31a9a208cfa83f9a184fc9c58afa8028942ac73204d156f539ca3c78f0d5ccf38004de0a738ad6ab736385d0339f3a23c6bc4150e4be72b4adf92678b2d2e422b6085969821e275a21bcc837b2e1b1184d1bdaef616ed5e25252dac73e107b28537ffd21600091d70d056ee79c02fd0faf89658144eefbac9afb1435424500a5b84a53e8bba325040ef77d0879e3b1847dd1a4ee220030898ce6667f1b09110edbbdae356413747fa526549f9aeac8560da55eda3ffff0e0c4a005a06a3e2f400ac8c3e2e939f6d2207ce9d4618f320cb37d778c8ac8fa357a106a04eb059585d5078c7629977552ffe19ab7edd844839a642ba048103c32fd8e27a723b8fedcfee269840d6684d06e17b9e3ef87e4d8b7b1d9c4f7460c39835f11baa992603da761212f2e7769dca08018e1b630b3cb754e44b8b77c103216bc0db5b7eac0b06ea021580cfd1ba67cd426df6eccbe5ddd8565f779b02ae61a6e112354b8163ff810c87f233d585d13e6781f74e7dff58f214738c79dec53adce49eb748f4fc21b0ddd73e6f38f75d14ede3b5d71c639e172f205d12290da8a3dc6ea9d8aa3b319e8dbe1a94b14acbd227e578818643e4cf962550e2cde781c66a7ce2e5a28cbbbd349babc853173dceeb122d88aae55e78777676c404f42818a20a47cf504bfce3a11579063ba7aa36de1a838ae9ff4d61b5ff339cf51ae74924874b99bdc88360056dbb4643f6e7edcff2b31cf4bb4204e0077787efbccd4e72af82865a584e529b0b515f491553bb0aaa24525a9b9b8a5f6df132e58ea95a9846c40143996069f8431ec7feb16910d341241064d1d4c4af6cf11b39164d07dba6b7493f3f57df991c6dfa51d98c1390c6648a0a278064a0e968c1e15237e43eb8b4cfbce917f34796aaac498b507ce4668717402bbe84ac631915833a88981983d85682b08ae02d2272412a19dd7b5c689611ebaaf1ad4000f6ed81161373938cd728e9b704a11539e2ca4bf07052c58f74b4947d6baa4ca90d32e44975f236200b79c161bfab1ceecc753d79221ad4dd7da2cece54c27e162f3fb7f39eca8f15eae5e844761c00d412d51471a8f746402788ae54d989c9c8dcdb24e823e58863814fc0e8daaf972edf066c2e401f426280ee8fdd7c7aa7a42ecb64f169ad0099aad7b5f405cb26d403563e9adb00dc4405baf5f5cf4a918f5291d8abd1cc1a1e84583790d82da50c58de68a3dfcaaebd02559cc45ce2119f80fd0b9de1698bb804acad764b986071ffcb15c42dd388c504355fbb1a53e44abfee2aeef532f1e286b64bc4df8e5092ba2c53d3f6433510dbec503ed4c7fe927cccfd609fc3517a1036510d1560b58ba919e134c41265355a05d6da2a52398d91a9681d265b11251a26dbedc03c90ab8d41bb3e52f02cb4621bbe864beca6519522694255bb285dcf7b58bf2508f983085d7e9ab445cb604a08714b98db162476e3ac3aa929d591c8e61b71ecb555ac8f0bd67f41de7dc3ffeef7265259e8b9f425fdfbc64999ed9065b9888196a67cfe3f268cc120318df07b86a6ebd40563bc12846a2913700e55dbe8656e6e9e22634eb6db00a6322b4c05364e028ded67909cac3971e0b6dd169d6bf7b4f288d69d4f1067aae49a905bc860492c96c92163888ad2b435350e2ca0d59f3b811775f8d5e1384e432a1f0c1f3a1bddd33d23405ca63f4b1d36be32e68ce05f0995752b553794290194d7e8b50632278348e6217ef6ac7697e10618da30dffc1bf048e8009b4088fea8d41a1f2b93dad9e30a57634399511ab65c9fec5838690401e67436fcc3be2107aefd8006b46043b67f8c708d8f4c2eb1c0096078431d579bf00f43aa96ab7d39b53484d40a561498e181e508672e5259a5ed9e265b0d08bb9fecbbd96be6384ca8319dd69e6c15238de9f9337d9494e75b90ce81cd55ea582e4888339155dc188e8771e93fa12243dcf646159e302513c5ebeaf35731551e9eb5b12b98292adf21ef96dd0c8ea6c2fc926a8ad0e30d0e96ae45a811ce555f03fb54bf95e011091f7238cd317252d17620a01160832d7daeba9e147b57aacd83d861b781662d23b210e0bc4fa3599dd6b7942b3ba1fca9cf76f60169c587f627596db6a5b31b7c96b49f6009adc77fc185addf0a473db14f9f5fd040c4185bcc75efa55a512f08021a178731b4c693607854f303c1d9414e68df05613e5e5b21ebd863f6b7d6f07562abdfb5e3f7cca8a380707fb3c2f7951401d60b292eacf17377eaf19d4fa6798e5ee80896166943cc99fd8dd55470490e46f9279dab77e969c5a82de3512d7df159807124e4181d0565ff8a81dc405c5ed63399c3e4d00495be1e3e79da01602efa175c5cdbd6c902f50f6b84fd7f9d8403ab738e5c61323a28d70285c58a1ad10589b584cdb3d151fa44b66a56f2b8532ba64427d003d11b42f3e1da7e76e30f81bc84eacc6b4c71ba8d73eb92f06af6f5056ca8c4032d91c699a53a22168c0be4d540bac20f57bb9cd53b29dfb9b1a16b5f1efef26b2a8121f56cd0e8baa65201954635e278d2d76efb42eb16a396707f4503c65fdce754c33707dcd37e405bded5f1ec59f34abe760c07cd8d19f4b0f4210e109edd19a22e131893c59725109fa68f1f187629c14894dae7dc9e7fa51f70f67c9438984357b40305c0841dc612b67822917a4728f0a6b8a4caeb007d548137135a32ee2952274cf8e41be23aecd9faa413dfbef287cf33c017f943449e6a2c7f7178c7c2729f670d97b442be5435d3c05d437006a00b9c1fb2eac3c3a68b18be1d2471085e1084e254e3afd8505ae0f93bddd704772adaa9fd2222cda32a0112f303e56a80ceb2f046d8f1c46cdb095893f4f8b00bd4bf57e14c38ee1995e60559e2acefca787b7ae86d95df31eb6714779e101b202bc1440a50e09fa87ddaa833c86afcd05834715e928c612a6d84ad6cc81fd5988c8322ae15873faec742b541090696b0a6f78d022f53a4e10a3f0ef38a869473d0a0e5bf2918215fd07faa7084149130fc02ddc5f0d652e32e0473d9918fc3db986cf7c02282e27e995bf034c6df018ac80d1d002ed0dbc56e0a0f34ed0e10de882c638d9a7d570a61990edd431b96c45b38d43051ff377f2a9dfd40d8045841e797561cf698b29908aee2f8b7c45465ed2e70c2f137c98511993018dd02b4d2b9bb9a48c215c92888915cf61881498926f6f4fed5cc89cca67e25a4840c9b00b947251b910c2c07220df2e0fed54566d082e1535643b8dbf2f0ee4a5eb8afb684d3f0cfee30a8a8bb93290c6f6a23ee2809b4c044190afb061a51e19aeca3f7bfa20b13b4d1460265d6952052bc372723a378999b3331126d02c5718b7223a5d2a5701076167b82915bc0dd81d6b289dc00fae158677e60d90759cf4e4b3c8f1e4e21828a055dff4d9cd4592956dba9b2bdf3f3554eb0b71c0022138873d82f093ba6850c2f1de2dd49f0e884e7b2c38c579a1cc201c10466cb6198479ecbd145a987a66d1ecffa2718a17d4a49de62c102a485beac1cf010fd0ccd30d0e82d93ee34fbd2955acff770fd3196ddb53e6e7d3ac82f44e308aaf557720c26ebbde1e8c25bd57697262254f105dc428f926dda217e0a860c5ca4de73f6a26361c53d8e9201bf577696527c28f7f74c4691f84e3f46807d831f054fa89ef0ac40e0252f59e307528b7e2434ea3fa536175e81ca194a84d10afa5f751356b8bb7926cfc513932421f5297292335425253c100a36b4f7f41f9efe818cc136b08641bf96ea5a7c67039847a52262703d3c54acee2f9932706b77789f2256e8f0893bb441ec82689534128d0c6fc3bd1d4630cc13ac561179408a24cd1499e4317dac59f1ab8c0012246afe0bd7daf4fd5d480b786569a14af44d70e7465d3a95fc77780f1b43ec52cc6512eabd06fd1cbd5f251923944abd0febc4c37560d629f4e4a82f825055242bf9cddd8f300684fbbde5d0df9de8d2cc89e6ced23e026dbfdcca8b5b0c221ca818b2fd99011b32814ab470d8308cf9addb90812707cce76490a7173b7e76728bb3eaacf77979c7288a5d21f91d30e1e77ac2d62d373c4b7b5213b54f125c6d2bf4c49c42724e68071b1fac9d382e4543ce541e1a8d3ef70a7544837cd1e6a674816fa3923bb183d1aeb909193efc79d1aae2a765ab119e35c00d42abf60f28ead5d8151e4af4237ac3c42d2948d1f0c13164f1b86d0166527e1679f9993287d3ac0be856b773ea5613fc373d04699193dae0da1d40fd10aaea3fb974014ec7633ee70635fe9aa9b56e9820e36b965dd713b2b7f919209982705ed97a572b26c404a27f4b62312b162d581e4a7ff8ab837766e79687ffa76be0c36565e488cc66633c31865552d8108c724638e9fdd2d7344c53ed8385d23401dba576d8178a5d2dad2398b8e7f4e08e64cf43b8d0429dfc91223ad74c5fc67ae8169b0c5baea75988df07f3f8f98eeb530afa6cf0b1b9bd2633616c15ca9aaf67aacc1e9dc1bcb76dabc26970f9ca77258d49381f8123729ed0e2b485fae59b6ef1213135d0622e4a63f3a9b1576b90cbfc38b70fd74f908f6921033550b5a0b848c40e9f6bb143134142d3fce78fae4fab9eaf1aede529fd591fe99a2d226d6da3fd995f2ea24a836ed6acfcfedf97ada8f6f3745085ff27c650c433310699cd8c662e758ee6264cf0a9e21d55053bb8428f8bbb7b78fb2f5673e628ed1dcdb3a2f3c1ee8213088dd1b82611d08d56b088ba5c527f1b81d1b4220b77e26f5be1f9340251a5f7b22cf5e4fa7d33ce17be24bd6f0b0bbfc4ca1f95174280f88b6ff542743e704c9299d989cbdd4622cfe8088fdbf5c96eddf3a9c18c20585eeaf045693c40f7c9a95a00e36821dce084dbe2eb29df60e46dc1ced4e96e72881710bbd1039ea591a3013751361f7863ec9b480e982d71e18d3d0994cb7bb4557e48f7e761e4a17bac0ca45b1cb6b8b4ff75994002ffbe0c3a37c3e81418506721f31326c3ed483ccd90ab651d3e398f4fc90e5fc21cca50474c19dd814d363bcdb3f60f6d5aaf2db85299c6a4631ce78848e2bda53a996099d9e72a2a9598c73aaec18b6031c58dd0fbfd137791cb2c932a95e499d4134d62c1369efb39c792904dd3929dba40e3bc8a578564b69145e9a23cd028f199f6a484a4a9b463dfac40d9bcf3124edfd20eae95565607284a2c73550384882be9b1597e28f8bef223a2856245f623f3c8e1385a257bab4212dc4d71e44ca0cf6654b70941a2351130bb9d8148b187f95f919a95c8b8a4f8e4ad3525b88e85a9b060c7e4e5e9dd241a107b70c9099eebac498433d4893e1c1b6cf9ee97250f2cc28dee05486cd8729277df4439978288997ae12ac51fb23babd7ac69663b94c07529bb0fce02c9aa25aa34452e4033b1cbadd767cb53e9ecc49ad71c6360d2969c492b9d12ae62aa1c2970c92b382371af32157d1ed89765be510e181035ba20dde5daff03f9cc690ed30397f179b64d734cb4cc76d7e6da90edbde9e41114d57636da72f3f41adb25a9703ecfec57bc05af68cec70e152b6f2b067b14ecfdcaa6eb66c1826d0416cbf2385f175e00a5d1c3eb2907fc66b654ef6778695ee170dc96e5dc8fad0dca10af1ea3fedd58741f662672a3fa0de58c6bfbe260a83ae0ed35d76cda48964d10b0f0ced4ea5ea2eb4a6aead8d9f199666d18215d0f828c441eace63a719a6b78b05aa7fe8b2747fd38c2790f54b887a157f0cfcb997e16289f2ba2edfc02a97a6044b2f0a442d63cd8a9a77cc8bc449d90ef688b364c002cc73cd4c2e2463620d61c65ee8139f124dd81245442c71222f25f2ab369c4d44448da1f8b35eca6b686b739d33af8d8dda46aa98f4cc28e61cade2cd4cb60c7f610441a7fd44fdae80882f7605bda94421b5085507f176c8782eb0cef1407a53cd8dbf1dd1d249f92d628fd2dcac2b79a7a2473a50f1e1ba05a0a0d67ee454dc4f077acc957276d3a4cd357c78e9dd410fb1520ace98217fdef010f4d00f9830d66f35ae2ac15ddd093c7cd49326906c2f9a67497cace410540c5568927473ff69c8c325eea5b2662c8896315276d579c1a9b7511d427c6f90dd441c224b2540c4f47d9fc2d9f8b38f9ee3a341a2bd2e4ee404187efa8a8832273838c4e98560c3ffcdd8c1279890c9b15b84938c579a6ce8ceb26fa21c41b7e4dc3f81a3578405025731bc016bd23994826030671aaa7a6a816281b8f0c51d80bb78d649fbd947c261c1f15e3179d95daa1c4bbbabacde9ead58da5f8284ac473b96dbe83a4aa25b19cfc124cf4b83a6614f3558ef2c4c12d583e89cacc770485393377a6d1b525bc290f3864da03d49f58cbd8b0ba8ec11a45c30b3be22bfcd1413186a8418c6ae5a92af280e1e90b09827fdd35f8c43722fa0754851fe9bd997abc3debacde7bfd1d3b20017fbad5c3da655ee1b713acc0df4faa35beb56a6257e1f37977ba5f4e85e9c700302d3a78b34a8126dafc745d462e857d50c1f0a67e595482e9bd1e7f14425ba9aba14954d7b20ec69b987ccad57bacde156a59f0b1a5e90f79e5110b39abd9bbf991949358e85fa3e6a124c5ca809403f27826bbf04acc480c6438281a1acf406e3fa179f24bd22c9e81bcf3de4d73eb60e912dba0ddf873c83aaaddded92df82a32aca5ca9da8fdf18ce26acfa053dd08c371fa6d3da2014bd955bb773825fb51cd3346b3da5e5031f7ba6e6ea6d2d0f1cc813216071ca854fdeb67ce283dc6a8573de7f78f967f31c5ee3281543b8b6f60e06106e153a2d24b5700f5430e7c31ff37576e2e3bfb45f1e84bf3777104e9cd46a96ef3a58721bbd1b1864ea92dc7b4fb8836598db45062d4ec90b49e60af3489ead16ba10e262bb0bd1af9832b71a4e8ddbf03b51d9434c2a1637366879ee7377d8df440dd0b8c631f3cced20dfb902b9e141f1f232f2c5bb40375820df1fd61a3042851b19aaf0858fd60ec332a2ebf2ff4091f19c6e03acd791ea0ae0c00dd8ee23af88ac9537c36ec573e9171d7dbee6e235b98654b22a9939599a1ab3bfd4b7df124772e6a49370dc6bdec2b0a3cb3d947e7711937933b812ac94b643864f0c14b1e16ae889cb7fc7607e71ce60c5c6f326959813dfbe494d3a12afb303fd4b561921d47be4ffa3c791adc877cd1adc3806686603e30208f5d547bf2d12690d2854368c733a043cb1c57c22c9c2875d57e8b22143a7382c6b85b0311abd177cd082bde8b40ea8e42168e12c44c8d6a78541122d4ac81c4478489cf1c8f071222fb964fb32b954501113584d88c9c262eb7ceaf7653daee8fc428ae6b08988507836eb8b1fb0ab6dfc5152bb4e2303fe699cf0a88f9a18ada53322dc573c8e09083ad766695530953d17f750787652b83d26e6fc51234e565998c5de95f307deaeb0aa73648cda749cda68e2775333e8a13472124dc4609db59f72af61738c99e1001fad59e6689c971b3a265a50ff50249c5db8723366617fdf48e6f5c54d54cef9153e9629548900a138ead969a97488da3979685ddb27c0c8d1b0d8dabad4a0bda4de6ab54cc31d12a09ab4e0dfd82b8d4ccf249922961b94932e8a5cf9f5f0a280456deceb1efedebef625a785c2db5cea499f53d94cc398ce9eb99652960280e6110a2eed44d1fc903e06ff00fc17f1635b8e41eb74386b70686802fdb0b6c1c7fb83ec0423c0a1ad92982a941cec4cc48a3cb0b14575774d3df03c986179a91477059881be2736a7ca9c343fda6ac5476f3e9b186aed57e5e7f1b2c8e724ecb968d3802200ee6ae35fa0021501b497da4ed1a7bc1811491d1d84437b871970102188889d41d44ea468e0b093b7ca0068250bf9665f50218d400fb37e9d7a383420b81c155d00b3b7e057f106910a60e08bfc7bdaa65c2e0b11895fc3a2adc96ce4c7031ee0b3eea1920b0e0ab1dba804843289c1918767178a254599d24ab572140d852552affa7e0dc7278e6505c66c63bbd5a25d4d4b11380d8e484b914eca5f907b93c46d8fbb2140382d3899cdcf59bafa57aeff23fd7335cb74e69f34cf71b573c23b6d79a9f0c86787af8cd787c321afd5a3e64a04408b2d6f5943035b5c4656bad6b3dbe68cc401b8fb07e147bf9e698ec5c17f2f01e25ffd8437cca30e3c0c5a9daaa8d5b8d362088541adc2a74e8ecec30de71c6a2e94550e85728e77ff193e4d0ef6124d65b3917e2ab770a8d1acaeefe90a2032a808fe81a17b96d68f9d9471f66278854944751d919054bac0d162c560022f62fd062ef611c246ea22ae80f1cfe185615e20d3096157d4b7a61bc8f78646ea175dbc78caaaee4f216761b263c32b820c038c9ab060ff8b1f547eb8f9bc44c6ccb69d89023926f6a4288a0272ef0491d8f2f6470d5c71164d82d15802abd14179be2e1649cdf7119cf26a77dfd0aa1832df6d0da0a9c4b7019cd184cd994174f7c41e940fb9a58a39f8a604dc4ecf70c886ab3a7d8aebbe8d87a6cf7d7613bcc7c6c02c1b762b2803f7958a1275c1d4bd720708d2e8c84d1e767fb7a0abdea0a323fdd3a7c2cf775e8b0d068b2d77df2c0aa54fa4b803495a99b579fb9c6ef86a50e89db3f5154872cd57186be8f3d9633cf95ded40c500f0d6a3fc6d7434ca4501287960198e395edaa45305cf8d69902e5f219aaad9b852fd6dedb595ed5d76139365a282882d127ec868038374dfdd24d23bd9fae99c9478bc4fdea482d7281d310d526584321af5458372fde59e78042a834e81e82ac5e12fba065dae12da45b4daea616fe59c4234bdc65b73e4b57fabf5b186d5c6ead0f1999b62f0f3ce32a3968ea1051e6635a541e1aefb9c15760e2e15b447fd7c5ed4ea29c01ff3667fbe9f54a8603a4305a3876e6028bb921531a0d1fc3e6e9f781168ed2475da1af9870f9c00499dceb4f6e4189d696503fe7060799fa3a2553faadd2b4f64c7cb8b33072fded4876c7fcf04a3ec59e50b4d6ab1b5277fa6dbb44fc877a0ffc269e4e389ab097c655ee6f69901c7b1f48d490c69ff0425ee8d8428ce68213c485db4785db65844097f028bf3517f8a12ea2a1c7d6265d04cc6e15848822f9c5c42041d873ec7681d6be8592ed45b88316da9692fad9de192751fbb46b42a84695ad4d6dc3c16a88777c7ec6584b6ed53b3327b3aad4acf24449f615953402c84ec6e5c964c9099bc5e6ba86e88227bf62e31e80046cff777885f7af8be4fe6340cb21b44f8900d7dd56cc022bb935905389cc2b5c8dd897afd245785f3c180609a20cb7a8ca4bcad82ac20ca4e121aeda32db6c6b0d09dee36ee6efb040bcc987dd39e5817fe0ca4a5da2c1e07dfb83a9fcda8d645</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">主页支付宝转账5元，并留言文章标题获取密码！</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> Linux驱动 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux驱动 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pinctrl子系统</title>
      <link href="/2023/10/17/Pinctrl%E5%AD%90%E7%B3%BB%E7%BB%9F/"/>
      <url>/2023/10/17/Pinctrl%E5%AD%90%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<h1 id="一、Pinctrl子系统使用示例"><a href="#一、Pinctrl子系统使用示例" class="headerlink" title="一、Pinctrl子系统使用示例"></a>一、Pinctrl子系统使用示例</h1><h2 id="1-1-要做什么"><a href="#1-1-要做什么" class="headerlink" title="1.1 要做什么"></a>1.1 要做什么</h2><p><img src="1.1_i2c_example.png" alt="1.1_i2c_example"></p><ul><li>查看原理图确定使用哪些引脚：比如pinA、pinB</li><li>生成pincontroller设备树信息<ul><li>选择功能：比如把pinA配置为I2C_SCL、把pinB配置为I2C_SDA</li><li>配置：比如把pinA、pinB配置为open drain</li></ul></li><li>使用pincontroller设备树信息：比如在i2c节点里定义”pinctrl-names”、”pinctrl-0”</li></ul><h2 id="1-2-pincontroller设备树"><a href="#1-2-pincontroller设备树" class="headerlink" title="1.2 pincontroller设备树"></a>1.2 pincontroller设备树</h2><p>生成pincontroller设备树信息，有3中方法：</p><ul><li>有些芯片有图形化的工具，可以点点鼠标就可以配置引脚信息，得到pincontroller中的信息</li><li>有些芯片，只能看厂家给的设备树文档或者参考设备树的例子</li><li>最差的就是需要阅读驱动代码才能构造设备树信息。</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&amp;iomuxc &#123;</span><br><span class="line">    pinctrl-names = &quot;default&quot;;</span><br><span class="line">    pinctrl-0 = &lt;&amp;BOARD_InitPins&gt;;</span><br><span class="line">    imx6ull-board &#123;</span><br><span class="line">        i2c1_pins: i2c1_pins &#123;</span><br><span class="line">            fsl,pins = &lt;</span><br><span class="line">                MX6UL_PAD_UART4_RX_DATA__I2C1_SDA          0x000018B0</span><br><span class="line">                MX6UL_PAD_UART4_TX_DATA__I2C1_SCL          0x000018B0</span><br><span class="line">            &gt;;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="1-3-client节点使用pincontroller"><a href="#1-3-client节点使用pincontroller" class="headerlink" title="1.3 client节点使用pincontroller"></a>1.3 client节点使用pincontroller</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&amp;i2c1 &#123;</span><br><span class="line">    clock-frequency = &lt;100000&gt;;</span><br><span class="line">    pinctrl-names = &quot;default&quot;;</span><br><span class="line">    pinctrl-0 = &lt;&amp;i2c1_pins&gt;;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="1-4-使用过程"><a href="#1-4-使用过程" class="headerlink" title="1.4 使用过程"></a>1.4 使用过程</h2><p>设备驱动基本不用关心流程。当设备切换状态时，对应的pinctrl就会被调用。</p><p>比如在platform_device和platform_driver的probe过程中，流程如下：</p><p><img src="1.4_pinctrl_really_probe.png" alt="1.4_pinctrl_really_probe"></p><h1 id="二、Pinctrl子系统主要数据结构"><a href="#二、Pinctrl子系统主要数据结构" class="headerlink" title="二、Pinctrl子系统主要数据结构"></a>二、Pinctrl子系统主要数据结构</h1><h2 id="2-1-设备树"><a href="#2-1-设备树" class="headerlink" title="2.1 设备树"></a>2.1 设备树</h2><p>理想模型：</p><p><img src="2.1_pinctrl_dts_modules.png" alt="2.1_pinctrl_dts_modules"></p><p>实际的例子(imx6ull)：</p><p><img src="2.1_pinctrl_dts_imx6ull.png" alt="2.1_pinctrl_dts_imx6ull"></p><h2 id="2-2-pincontroller的数据结构"><a href="#2-2-pincontroller的数据结构" class="headerlink" title="2.2 pincontroller的数据结构"></a>2.2 pincontroller的数据结构</h2><p>记住pinctrl的三大作用，有助于理解所涉及的数据结构：</p><ol><li>引脚枚举与命名(Enumerating and naming)</li><li>引脚复用(Multiplexing)：比如用作GPIO、I2C或其他功能</li><li>引脚配置(Configuration)：比如上拉、下拉、open drain、驱动强度等</li></ol><h3 id="2-2-1-pinctrl-desc和pinctrl-dev"><a href="#2-2-1-pinctrl-desc和pinctrl-dev" class="headerlink" title="2.2.1 pinctrl_desc和pinctrl_dev"></a>2.2.1 pinctrl_desc和pinctrl_dev</h3><p>pincontroller虽然是一个软件的概念，但是它也用一个结构体来表示：pinctrl_dev。</p><p>怎么构造出pinctrl_dev？我们只需要描述它：提供一个pinctrl_desc，然后调用pinctrl_register就可以：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> pinctrl_dev *<span class="title function_">pinctrl_register</span><span class="params">(<span class="keyword">struct</span> pinctrl_desc *pctldesc, <span class="keyword">struct</span> device *dev, <span class="type">void</span> *driver_data)</span>;</span><br></pre></td></tr></table></figure><p>怎么使用pinctrl_desc、pinctrl_dev来描述一个pincontroller？这两个结构体定义如下：</p><p><img src="2.2.1_pinctrl_desc_and_pinctrl_dev.png" alt="2.2.1_pinctrl_desc_and_pinctrl_dev"></p><p>pinctrl_desc示例如下：</p><p><img src="2.2.1_pinctrl_desc_example.png" alt="2.2.1_pinctrl_desc_example"></p><h3 id="2-2-2-作用1：引脚枚举与命名"><a href="#2-2-2-作用1：引脚枚举与命名" class="headerlink" title="2.2.2 作用1：引脚枚举与命名"></a>2.2.2 作用1：引脚枚举与命名</h3><p>分为2部分：</p><ul><li>描述、获得单个引脚的信息</li><li>描述、获得某组引脚的信息</li></ul><p><img src="2.2.2_pinctrl_driver_1_pin_and_group.png" alt="2.2.2_pinctrl_driver_1_pin_and_group"></p><p>使用结构体pinctrl_pin_desc来描述一个引脚，一个pincontroller有多个引脚：</p><p><img src="2.2.2_pinctrl_pin_desc.png" alt="2.2.2_pinctrl_pin_desc"></p><p>单个pins 的信息在 imx6ull 是代码写死的，info中的pins是在pincontroller构造时赋值的，后文有分析。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">imx_pinctrl_desc-&gt;pins  = info-&gt;pins;</span><br><span class="line">imx_pinctrl_desc-&gt;npins = info-&gt;npins;</span><br></pre></td></tr></table></figure><p><img src="2.2.2.png" alt="2.2.2"></p><p>使用pinctrl_ops来操作引脚，主要功能有二：</p><ol><li>取出某组的引脚的信息：get_groups_count、get_group_pins</li><li>处理设备树中pin controller中的某个节点：client pinctrl端回调pincontroller端的dt_node_to_map，把device_node转换为一系列的pinctrl_map</li></ol><p><img src="2.2.2_pinctrl_ops.png" alt="2.2.2_pinctrl_ops"></p><h3 id="2-2-3-作用2：引脚复用"><a href="#2-2-3-作用2：引脚复用" class="headerlink" title="2.2.3 作用2：引脚复用"></a>2.2.3 作用2：引脚复用</h3><p>用来把某组引脚(group)复用为某个功能(function)。</p><p><img src="2.2.3_pinmux_ops.png" alt="2.2.3_pinmux_ops"></p><h3 id="2-2-4-作用3：引脚配置"><a href="#2-2-4-作用3：引脚配置" class="headerlink" title="2.2.4 作用3：引脚配置"></a>2.2.4 作用3：引脚配置</h3><p>用来配置某个引脚(pin)或某组引脚(group)。</p><p><img src="2.2.4_pinconf_ops.png" alt="2.2.4_pinconf_ops"></p><h3 id="2-2-5-pinctrl-desc注册得到pinctrl-dev"><a href="#2-2-5-pinctrl-desc注册得到pinctrl-dev" class="headerlink" title="2.2.5 pinctrl_desc注册得到pinctrl_dev"></a>2.2.5 pinctrl_desc注册得到pinctrl_dev</h3><p>调用devm_pinctrl_register或pinctrl_register，就可以根据pinctrl_desc构造出pinctrl_dev，并且把pinctrl_dev放入链表：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">devm_pinctrl_register</span><br><span class="line">    pinctrl_register</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">pinctrl_dev</span> *<span class="title">pctldev</span>;</span></span><br><span class="line">pctldev = kzalloc(<span class="keyword">sizeof</span>(*pctldev), GFP_KERNEL);</span><br><span class="line"></span><br><span class="line">pctldev-&gt;owner = pctldesc-&gt;owner;</span><br><span class="line">pctldev-&gt;desc = pctldesc;</span><br><span class="line">pctldev-&gt;driver_data = driver_data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* check core ops for sanity */</span></span><br><span class="line">ret = pinctrl_check_ops(pctldev);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* If we&#x27;re implementing pinmuxing, check the ops for sanity */</span></span><br><span class="line">ret = pinmux_check_ops(pctldev);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* If we&#x27;re implementing pinconfig, check the ops for sanity */</span></span><br><span class="line">ret = pinconf_check_ops(pctldev);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Register all the pins */</span></span><br><span class="line">ret = pinctrl_register_pins(pctldev, pctldesc-&gt;pins, pctldesc-&gt;npins);</span><br><span class="line"></span><br><span class="line">list_add_tail(&amp;pctldev-&gt;node, &amp;pinctrldev_list);</span><br></pre></td></tr></table></figure><h2 id="2-3-client的数据结构"><a href="#2-3-client的数据结构" class="headerlink" title="2.3 client的数据结构"></a>2.3 client的数据结构</h2><p>在设备树中，使用pinctrl时格式如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/* For a client device requiring named states */</span><br><span class="line">device &#123;</span><br><span class="line">    pinctrl-names = &quot;active&quot;, &quot;idle&quot;;</span><br><span class="line">    pinctrl-0 = &lt;&amp;state_0_node_a&gt;;</span><br><span class="line">    pinctrl-1 = &lt;&amp;state_1_node_a &amp;state_1_node_b&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>设备节点要么被转换为platform_device，或者其他结构体(比如i2c_client)，但是里面都会有一个device结构体，比如：</p><p><img src="2.3.0_pinctrl_in_device.png" alt="2.3.0_pinctrl_in_device"></p><h3 id="2-3-1-dev-pin-info"><a href="#2-3-1-dev-pin-info" class="headerlink" title="2.3.1 dev_pin_info"></a>2.3.1 dev_pin_info</h3><p>每个device结构体里都有一个dev_pin_info结构体，用来保存设备的pinctrl信息：</p><p><img src="2.3.1_dev_pin_info.png" alt="2.3.1_dev_pin_info"></p><h3 id="2-3-2-pinctrl"><a href="#2-3-2-pinctrl" class="headerlink" title="2.3.2 pinctrl"></a>2.3.2 pinctrl</h3><p>假设芯片上有多个pincontroller，那么这个设备使用哪个pincontroller？这需要通过设备树来确定：</p><ul><li>分析设备树，找到pincontroller</li><li>对于每个状态，比如default、init，去分析pincontroller中的设备树节点<ul><li>使用pincontroller的pinctrl_ops.dt_node_to_map来处理设备树的pinctrl节点信息，得到一系列的pinctrl_map</li><li>这些pinctrl_map放在pinctrl.dt_maps链表中</li><li>每个pinctrl_map都被转换为pinctrl_setting，放在对应的pinctrl_state.settings链表中</li></ul></li></ul><p><img src="2.3.2_pinctrl_maps.png" alt="2.3.2_pinctrl_maps"></p><h3 id="2-3-3-pinctrl-map和pinctrl-setting"><a href="#2-3-3-pinctrl-map和pinctrl-setting" class="headerlink" title="2.3.3 pinctrl_map和pinctrl_setting"></a>2.3.3 pinctrl_map和pinctrl_setting</h3><p>设备引用pincontroller中的某个节点时，这个节点会被转换为一些列的pinctrl_map：</p><ul><li>转换为多少个pinctrl_map，完全由具体的驱动决定</li><li>每个pinctrl_map，又被转换为一个pinctrl_setting，里面保存有引脚的mux和config</li><li>举例，设备节点里有：<code>pinctrl-0 = &lt;&amp;state_0_node_a&gt;</code><ul><li>pinctrl-0对应一个状态，会得到一个pinctrl_state</li><li>state_0_node_a节点被解析为一系列的pinctrl_map</li><li>这一系列的pinctrl_map被转换为一系列的pinctrl_setting</li><li>这些pinctrl_setting被放入pinctrl_state的settings链表</li></ul></li></ul><p><img src="2.3.3_dt_to_map.png" alt="2.3.3_dt_to_map"></p><h3 id="2-3-4-使用pinctrl-setting"><a href="#2-3-4-使用pinctrl-setting" class="headerlink" title="2.3.4 使用pinctrl_setting"></a>2.3.4 使用pinctrl_setting</h3><p>调用过程：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">really_probe</span><br><span class="line">pinctrl_bind_pins</span><br><span class="line">pinctrl_select_state</span><br><span class="line"><span class="comment">/* Apply all the settings for the new state */</span></span><br><span class="line">list_for_each_entry(setting, &amp;state-&gt;settings, node) &#123;</span><br><span class="line"><span class="keyword">switch</span> (setting-&gt;type) &#123;</span><br><span class="line"><span class="keyword">case</span> PIN_MAP_TYPE_MUX_GROUP:</span><br><span class="line">ret = pinmux_enable_setting(setting);</span><br><span class="line">ret = ops-&gt;set_mux(...);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> PIN_MAP_TYPE_CONFIGS_PIN:</span><br><span class="line"><span class="keyword">case</span> PIN_MAP_TYPE_CONFIGS_GROUP:</span><br><span class="line">ret = pinconf_apply_setting(setting);</span><br><span class="line">ret = ops-&gt;pin_config_group_set(...);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">ret = -EINVAL;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="2.3.4_apply_setting.png" alt="2.3.4_apply_setting"></p><h1 id="三、Pincontroller构造情景分析"><a href="#三、Pincontroller构造情景分析" class="headerlink" title="三、Pincontroller构造情景分析"></a>三、Pincontroller构造情景分析</h1><h2 id="3-1-整体执行流程"><a href="#3-1-整体执行流程" class="headerlink" title="3.1 整体执行流程"></a>3.1 整体执行流程</h2><p>驱动程序位置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">drivers\pinctrl\freescale\pinctrl-imx6ul.c</span><br><span class="line">drivers\pinctrl\freescale\pinctrl-imx.c</span><br></pre></td></tr></table></figure><p>调用过程：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">imx6ul_pinctrl_probe</span><br><span class="line">    <span class="title function_">imx_pinctrl_probe</span><span class="params">(pdev, pinctrl_info)</span>;</span><br><span class="line">        imx_pinctrl_desc-&gt;name = dev_name(&amp;pdev-&gt;dev);</span><br><span class="line">        imx_pinctrl_desc-&gt;pins = info-&gt;pins;</span><br><span class="line">        imx_pinctrl_desc-&gt;npins = info-&gt;npins;</span><br><span class="line">        imx_pinctrl_desc-&gt;pctlops = &amp;imx_pctrl_ops;</span><br><span class="line">        imx_pinctrl_desc-&gt;pmxops = &amp;imx_pmx_ops;</span><br><span class="line">        imx_pinctrl_desc-&gt;confops = &amp;imx_pinconf_ops;</span><br><span class="line">        imx_pinctrl_desc-&gt;owner = THIS_MODULE;</span><br><span class="line"></span><br><span class="line">        ret = imx_pinctrl_probe_dt(pdev, info);</span><br><span class="line"></span><br><span class="line">        ipctl-&gt;pctl = devm_pinctrl_register(&amp;pdev-&gt;dev, imx_pinctrl_desc, ipctl);</span><br></pre></td></tr></table></figure><h2 id="3-2-构造pinctrl-desc"><a href="#3-2-构造pinctrl-desc" class="headerlink" title="3.2 构造pinctrl_desc"></a>3.2 构造pinctrl_desc</h2><p>pincontroller的最终目的：提供一个pinctrl_desc，然后调用pinctrl_register注册。所以我们要完善pinctrl_desc。</p><ol><li>引脚枚举与命名（单个引脚）：info的pins在imx6ull是代码写死的：</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//[root@qing:/sys/kernel/debug/pinctrl/20e0000.iomuxc]# cat pins</span></span><br><span class="line">imx_pinctrl_probe(<span class="keyword">struct</span> platform_device *pdev, <span class="keyword">struct</span> imx_pinctrl_soc_info *info)</span><br><span class="line">imx_pinctrl_desc-&gt;pins  = info-&gt;pins;</span><br><span class="line">imx_pinctrl_desc-&gt;npins = info-&gt;npins;</span><br></pre></td></tr></table></figure><p><img src="3.2.0.png" alt="3.2.0"></p><ol start="2"><li>引脚枚举与命名（某组引脚）：某组功能中有哪些引脚？这要解析设备树，由imx_pinctrl_probe_dt函数解析设备树后放在imx_pinctrl_soc_info结构体中作为私有数据传入注册。具体解析流程省略，调用如下：</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//[root@qing:/sys/kernel/debug/pinctrl/20e0000.iomuxc]# cat pingroups</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">imx_pinctrl_probe_dt</span><span class="params">(<span class="keyword">struct</span> platform_device *pdev, <span class="keyword">struct</span> imx_pinctrl_soc_info *info)</span></span><br></pre></td></tr></table></figure><p><img src="3.2.1.png" alt="3.2.1"></p><p>imx_pinctrl_soc_info：</p><p><img src="3.2.2.png" alt="3.2.2"></p><p>imx_pin_group：存放各组信息</p><p><img src="3.2.3.png" alt="3.2.3"></p><p>imx_pin：存放各组引脚信息，reg addr，reg val</p><p><img src="3.2.4.png" alt="3.2.4"></p><ol start="3"><li>引脚复用、引脚配置、client端回调获取引脚组信息和设备树引脚节点转换成map<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">imx_pinctrl_desc-&gt;pctlops = &amp;imx_pctrl_ops; <span class="comment">//client端回调</span></span><br><span class="line">imx_pinctrl_desc-&gt;pmxops = &amp;imx_pmx_ops; <span class="comment">//引脚复用</span></span><br><span class="line">imx_pinctrl_desc-&gt;confops = &amp;imx_pinconf_ops; <span class="comment">//引脚配置</span></span><br></pre></td></tr></table></figure></li></ol><p>整体框图如下：</p><p><img src="3.2.5.png" alt="3.2.5"></p><h1 id="四、client-pinctrl构造情景分析"><a href="#四、client-pinctrl构造情景分析" class="headerlink" title="四、client pinctrl构造情景分析"></a>四、client pinctrl构造情景分析</h1><p>client pinctrl的整体流程：</p><ol><li>设备树转换为pinctrl_map；使用pincontroller的pinctrl_ops.dt_node_to_map来处理设备pinctrl节点信息，得到一系列的pinctrl_map。</li><li>pinctrl_map转换为pinctrl_setting；每个pinctrl_map被转换为pinctrl_setting，里面保存有引脚的mux和config。</li><li>切换state；在platform_device和platform_driver的设备probe过程前，也即really_probe中使用pincontroller相关ops函数，将引脚的pinctrl_setting都进行设置。</li></ol><p>第三点切换state的调用流程如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">really_probe</span><br><span class="line">pinctrl_bind_pins</span><br><span class="line">pinctrl_select_state</span><br><span class="line"><span class="comment">/* Apply all the settings for the new state */</span></span><br><span class="line">list_for_each_entry(setting, &amp;state-&gt;settings, node) &#123;</span><br><span class="line"><span class="keyword">switch</span> (setting-&gt;type) &#123;</span><br><span class="line"><span class="keyword">case</span> PIN_MAP_TYPE_MUX_GROUP:</span><br><span class="line">ret = pinmux_enable_setting(setting);</span><br><span class="line">ret = ops-&gt;set_mux(...);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> PIN_MAP_TYPE_CONFIGS_PIN:</span><br><span class="line"><span class="keyword">case</span> PIN_MAP_TYPE_CONFIGS_GROUP:</span><br><span class="line">ret = pinconf_apply_setting(setting);</span><br><span class="line">ret = ops-&gt;pin_config_group_set(...);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>总结如下图：</p><p><img src="4.0.png" alt="4.0"></p><h1 id="五、编写虚拟的pinctrl子系统"><a href="#五、编写虚拟的pinctrl子系统" class="headerlink" title="五、编写虚拟的pinctrl子系统"></a>五、编写虚拟的pinctrl子系统</h1><h2 id="5-1-整体步骤"><a href="#5-1-整体步骤" class="headerlink" title="5.1 整体步骤"></a>5.1 整体步骤</h2><ul><li>pin controller：<ul><li>创建设备树节点</li><li>编写驱动程序</li></ul></li><li>测试：<ul><li>创建client设备树节点</li><li>编写驱动程序</li></ul></li></ul><h2 id="5-2-硬件功能"><a href="#5-2-硬件功能" class="headerlink" title="5.2 硬件功能"></a>5.2 硬件功能</h2><p>假设这个虚拟的pin controller有4个引脚：</p><ul><li>pin0,1,2,3都可以配置为GPIO功能</li><li>pin0,1还可以配置为I2C功能</li><li>pin2,3还可以配置为UART功能</li></ul><p><img src="1.1_i2c_example.png" alt="1.1_i2c_example"></p><h2 id="5-3-编写设备树"><a href="#5-3-编写设备树" class="headerlink" title="5.3 编写设备树"></a>5.3 编写设备树</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">virtual_pincontroller &#123;</span><br><span class="line">compatible = &quot;100ask,virtual_pinctrl&quot;;</span><br><span class="line">i2cgrp: i2cgrp &#123;</span><br><span class="line">functions = &quot;i2c&quot;, &quot;i2c&quot;;</span><br><span class="line">groups = &quot;pin0&quot;, &quot;pin1&quot;;</span><br><span class="line">configs = &lt;0x11223344  0x55667788&gt;;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">virtual_i2c &#123;</span><br><span class="line">compatible = &quot;100ask,virtual_i2c&quot;;</span><br><span class="line">pinctrl-names = &quot;default&quot;;</span><br><span class="line">pinctrl-0 = &lt;&amp;i2cgrp&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="5-4-编写pinctrl驱动"><a href="#5-4-编写pinctrl驱动" class="headerlink" title="5.4 编写pinctrl驱动"></a>5.4 编写pinctrl驱动</h2><p>核心：pinctrl_desc</p><ul><li>分配pinctrl_desc结构体</li><li>设置pinctrl_desc结构体</li><li>注册pinctrl_desc结构体</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/err.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/io.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/mfd/syscon.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of_device.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of_address.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/pinctrl/machine.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/pinctrl/pinconf.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/pinctrl/pinctrl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/pinctrl/pinmux.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/slab.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/regmap.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;core.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">pinctrl_dev</span> *<span class="title">g_pinctrl_dev</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//把它作为pins的config register，config val是由virtual_dt_node_to_map解析设备树得来</span></span><br><span class="line"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">long</span> g_configs[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************  引脚枚举与命名（单个引脚）******************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 单个pins的信息直接在代码中定义</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">pinctrl_pin_desc</span> <span class="title">pins</span>[] =</span> &#123;</span><br><span class="line">&#123;<span class="number">0</span>, <span class="string">&quot;pin0&quot;</span>, <span class="literal">NULL</span>&#125;,</span><br><span class="line">&#123;<span class="number">1</span>, <span class="string">&quot;pin1&quot;</span>, <span class="literal">NULL</span>&#125;,</span><br><span class="line">&#123;<span class="number">2</span>, <span class="string">&quot;pin2&quot;</span>, <span class="literal">NULL</span>&#125;,</span><br><span class="line">&#123;<span class="number">3</span>, <span class="string">&quot;pin3&quot;</span>, <span class="literal">NULL</span>&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******************************************  引脚枚举与命名（各个function功能中有哪些引脚）******************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">virtual_functions_desc</span> &#123;</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *func_name;  <span class="comment">// 这个功能的名字</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> **groups;    <span class="comment">// 支持这个功能的pins是哪几组(我们现在每个pin都当作一组)</span></span><br><span class="line"><span class="type">int</span> num_groups;         <span class="comment">// 这个功能有多少个组，也就是有多少个pins(我们现在每个pin都当作一组)</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 各个function的group pins本应在设备树中定义，然后解析出来，我们此处也直接在代码中定义</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *func0_grps[] = &#123;<span class="string">&quot;pin0&quot;</span>, <span class="string">&quot;pin1&quot;</span>, <span class="string">&quot;pin2&quot;</span>, <span class="string">&quot;pin3&quot;</span>&#125;;</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *func1_grps[] = &#123;<span class="string">&quot;pin0&quot;</span>, <span class="string">&quot;pin1&quot;</span>&#125;;</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *func2_grps[] = &#123;<span class="string">&quot;pin2&quot;</span>, <span class="string">&quot;pin3&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">virtual_functions_desc</span> <span class="title">g_funcs_des</span>[] =</span> &#123;</span><br><span class="line">&#123;<span class="string">&quot;gpio&quot;</span>, func0_grps, <span class="number">4</span>&#125;,</span><br><span class="line">&#123;<span class="string">&quot;i2c&quot;</span>,  func1_grps, <span class="number">2</span>&#125;,</span><br><span class="line">&#123;<span class="string">&quot;uart&quot;</span>, func2_grps, <span class="number">2</span>&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***************************************** pctlops，client端回调获取组的信息和设备树引脚节点转换成map ****************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 模仿stm32mp157的每个pin都当作一个group</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">virtual_get_groups_count</span><span class="params">(<span class="keyword">struct</span> pinctrl_dev *pctldev)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> pctldev-&gt;desc-&gt;npins;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *<span class="title function_">virtual_get_group_name</span><span class="params">(<span class="keyword">struct</span> pinctrl_dev *pctldev, <span class="type">unsigned</span> selector)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> pctldev-&gt;desc-&gt;pins[selector].name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">virtual_get_group_pins</span><span class="params">(<span class="keyword">struct</span> pinctrl_dev *pctldev, <span class="type">unsigned</span> selector,</span></span><br><span class="line"><span class="params"><span class="type">const</span> <span class="type">unsigned</span> **pins,</span></span><br><span class="line"><span class="params"><span class="type">unsigned</span> *npins)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (selector &gt;= pctldev-&gt;desc-&gt;npins)</span><br><span class="line"><span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">*pins = &amp;pctldev-&gt;desc-&gt;pins[selector].number;</span><br><span class="line">*npins = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">virtual_pin_dbg_show</span><span class="params">(<span class="keyword">struct</span> pinctrl_dev *pctldev, <span class="keyword">struct</span> seq_file *s,</span></span><br><span class="line"><span class="params"><span class="type">unsigned</span> offset)</span></span><br><span class="line">&#123;</span><br><span class="line">seq_printf(s, <span class="string">&quot;%s&quot;</span>, dev_name(pctldev-&gt;dev));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">virtual_pincontroller &#123;</span></span><br><span class="line"><span class="comment">compatible = &quot;100ask,virtual_pinctrl&quot;;</span></span><br><span class="line"><span class="comment">i2cgrp &#123;</span></span><br><span class="line"><span class="comment">functions = &quot;i2c&quot;, &quot;i2c&quot;;</span></span><br><span class="line"><span class="comment">groups = &quot;pin0&quot;, &quot;pin1&quot;;</span></span><br><span class="line"><span class="comment">configs = &lt;0x112233440x55667788&gt;;</span></span><br><span class="line"><span class="comment">&#125;;</span></span><br><span class="line"><span class="comment">&#125;;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">virtual_i2c &#123;</span></span><br><span class="line"><span class="comment">compatible = &quot;100ask,virtual_i2c&quot;;</span></span><br><span class="line"><span class="comment">pinctrl-names = &quot;default&quot;;</span></span><br><span class="line"><span class="comment">pinctrl-0 = &lt;&amp;i2cgrp&gt;;</span></span><br><span class="line"><span class="comment">&#125;;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">one pin ==&gt; two pinctrl_map (one for mux, one for config)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">virtual_dt_node_to_map</span><span class="params">(<span class="keyword">struct</span> pinctrl_dev *pctldev,</span></span><br><span class="line"><span class="params"><span class="keyword">struct</span> device_node *np,</span></span><br><span class="line"><span class="params"><span class="keyword">struct</span> pinctrl_map **<span class="built_in">map</span>, <span class="type">unsigned</span> *num_maps)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line"><span class="type">int</span> num_pins = <span class="number">0</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *pin;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *function;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> config;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">pinctrl_map</span> *<span class="title">new_map</span>;</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> *configs;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 1. 确定pin个数/分配pinctrl_map */</span></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (of_property_read_string_index(np, <span class="string">&quot;groups&quot;</span>, num_pins, &amp;pin) == <span class="number">0</span>)</span><br><span class="line">num_pins++;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">printk(<span class="string">&quot;num_pins = %d\n&quot;</span>, num_pins);</span><br><span class="line"></span><br><span class="line">new_map = kmalloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> pinctrl_map) * num_pins * <span class="number">2</span>, GFP_KERNEL);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_pins; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* 2. get pin/function/config */</span></span><br><span class="line">of_property_read_string_index(np, <span class="string">&quot;groups&quot;</span>, i, &amp;pin);</span><br><span class="line">of_property_read_string_index(np, <span class="string">&quot;functions&quot;</span>, i, &amp;function);</span><br><span class="line">of_property_read_u32_index(np, <span class="string">&quot;configs&quot;</span>, i, &amp;config);</span><br><span class="line">printk(<span class="string">&quot;num_pins[%d]-&gt;groups = %s, num_pins[%d]-&gt;function = %s\n&quot;</span>, i, pin, i, function);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 3. 存入pinctrl_map   */</span></span><br><span class="line">configs = kmalloc(<span class="keyword">sizeof</span>(*configs), GFP_KERNEL);</span><br><span class="line"></span><br><span class="line">new_map[i*<span class="number">2</span>].type = PIN_MAP_TYPE_MUX_GROUP;</span><br><span class="line">new_map[i*<span class="number">2</span>].data.mux.function = function;</span><br><span class="line">new_map[i*<span class="number">2</span>].data.mux.group = pin;</span><br><span class="line"></span><br><span class="line">new_map[i*<span class="number">2</span>+<span class="number">1</span>].type = PIN_MAP_TYPE_CONFIGS_PIN;</span><br><span class="line"> new_map[i*<span class="number">2</span>+<span class="number">1</span>].data.configs.group_or_pin = pin;</span><br><span class="line"> new_map[i*<span class="number">2</span>+<span class="number">1</span>].data.configs.configs = configs;</span><br><span class="line">configs[<span class="number">0</span>] = config;</span><br><span class="line">new_map[i*<span class="number">2</span>+<span class="number">1</span>].data.configs.num_configs = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">*<span class="built_in">map</span> = new_map;</span><br><span class="line">*num_maps = num_pins * <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">virtual_dt_free_map</span><span class="params">(<span class="keyword">struct</span> pinctrl_dev *pctldev,</span></span><br><span class="line"><span class="params"><span class="keyword">struct</span> pinctrl_map *<span class="built_in">map</span>, <span class="type">unsigned</span> num_maps)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span> (num_maps--)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">map</span>-&gt;type == PIN_MAP_TYPE_CONFIGS_PIN)</span><br><span class="line">kfree(<span class="built_in">map</span>-&gt;data.configs.configs);</span><br><span class="line"></span><br><span class="line">kfree(<span class="built_in">map</span>);</span><br><span class="line"><span class="built_in">map</span>++;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">pinctrl_ops</span> <span class="title">virtual_pctrl_ops</span> =</span> &#123;</span><br><span class="line">.get_groups_count = virtual_get_groups_count,</span><br><span class="line">.get_group_name = virtual_get_group_name,</span><br><span class="line">.get_group_pins = virtual_get_group_pins,</span><br><span class="line">.pin_dbg_show = virtual_pin_dbg_show,</span><br><span class="line">.dt_node_to_map = virtual_dt_node_to_map,</span><br><span class="line">.dt_free_map = virtual_dt_free_map,</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/************************************************** pmxops 引脚复用 ****************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">virtual_pmx_get_funcs_count</span><span class="params">(<span class="keyword">struct</span> pinctrl_dev *pctldev)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> ARRAY_SIZE(g_funcs_des);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *<span class="title function_">virtual_pmx_get_func_name</span><span class="params">(<span class="keyword">struct</span> pinctrl_dev *pctldev,</span></span><br><span class="line"><span class="params"><span class="type">unsigned</span> selector)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> g_funcs_des[selector].func_name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">virtual_pmx_get_groups</span><span class="params">(<span class="keyword">struct</span> pinctrl_dev *pctldev, <span class="type">unsigned</span> selector,</span></span><br><span class="line"><span class="params"><span class="type">const</span> <span class="type">char</span> * <span class="type">const</span> **groups,</span></span><br><span class="line"><span class="params"><span class="type">unsigned</span> * <span class="type">const</span> num_groups)</span></span><br><span class="line">&#123;</span><br><span class="line">*groups = g_funcs_des[selector].groups;</span><br><span class="line">*num_groups = g_funcs_des[selector].num_groups;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">virtual_pmx_set</span><span class="params">(<span class="keyword">struct</span> pinctrl_dev *pctldev, <span class="type">unsigned</span> selector,</span></span><br><span class="line"><span class="params"><span class="type">unsigned</span> group)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//真实情况这里是去操作寄存器设置复用，我们这做个打印模拟即可</span></span><br><span class="line">printk(<span class="string">&quot;set %s as %s\n&quot;</span>, pctldev-&gt;desc-&gt;pins[group].name, g_funcs_des[selector].func_name);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">pinmux_ops</span> <span class="title">virtual_pmx_ops</span> =</span> &#123;</span><br><span class="line">.get_functions_count = virtual_pmx_get_funcs_count,</span><br><span class="line">.get_function_name = virtual_pmx_get_func_name,</span><br><span class="line">.get_function_groups = virtual_pmx_get_groups,</span><br><span class="line">.set_mux = virtual_pmx_set,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***************************************** pinconf_ops 引脚配置 ****************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">virtual_pinconf_get</span><span class="params">(<span class="keyword">struct</span> pinctrl_dev *pctldev,</span></span><br><span class="line"><span class="params"><span class="type">unsigned</span> pin_id, <span class="type">unsigned</span> <span class="type">long</span> *config)</span></span><br><span class="line">&#123;</span><br><span class="line">*config = g_configs[pin_id];</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">virtual_pinconf_set</span><span class="params">(<span class="keyword">struct</span> pinctrl_dev *pctldev,</span></span><br><span class="line"><span class="params"><span class="type">unsigned</span> pin_id, <span class="type">unsigned</span> <span class="type">long</span> *configs,</span></span><br><span class="line"><span class="params"><span class="type">unsigned</span> num_configs)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (num_configs != <span class="number">1</span>)</span><br><span class="line"><span class="keyword">return</span> -EINVAL;</span><br><span class="line"></span><br><span class="line">g_configs[pin_id] = *configs;</span><br><span class="line"></span><br><span class="line">printk(<span class="string">&quot;config %s as 0x%lx\n&quot;</span>, pctldev-&gt;desc-&gt;pins[pin_id].name, *configs);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">virtual_pinconf_dbg_show</span><span class="params">(<span class="keyword">struct</span> pinctrl_dev *pctldev,</span></span><br><span class="line"><span class="params"><span class="keyword">struct</span> seq_file *s, <span class="type">unsigned</span> pin_id)</span></span><br><span class="line">&#123;</span><br><span class="line">seq_printf(s, <span class="string">&quot;0x%lx&quot;</span>, g_configs[pin_id]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//我们的一个pin就是一组，所以使用上面一样的函数即可</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">virtual_pinconf_group_dbg_show</span><span class="params">(<span class="keyword">struct</span> pinctrl_dev *pctldev,</span></span><br><span class="line"><span class="params"><span class="keyword">struct</span> seq_file *s, <span class="type">unsigned</span> pin_id)</span></span><br><span class="line">&#123;</span><br><span class="line">seq_printf(s, <span class="string">&quot;0x%lx&quot;</span>, g_configs[pin_id]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">pinconf_ops</span> <span class="title">virtual_pinconf_ops</span> =</span> &#123;</span><br><span class="line">.pin_config_get = virtual_pinconf_get,</span><br><span class="line">.pin_config_set = virtual_pinconf_set,</span><br><span class="line">.pin_config_dbg_show = virtual_pinconf_dbg_show,</span><br><span class="line">.pin_config_group_dbg_show = virtual_pinconf_group_dbg_show,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************************************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">virtual_pinctrl_probe</span><span class="params">(<span class="keyword">struct</span> platform_device *pdev)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">pinctrl_desc</span> *<span class="title">pictrl</span>;</span></span><br><span class="line"></span><br><span class="line">printk(<span class="string">&quot;%s %s %d\n&quot;</span>, __FILE__, __FUNCTION__, __LINE__);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* a. 分配pinctrl_desc */</span></span><br><span class="line">pictrl = devm_kzalloc(&amp;pdev-&gt;dev, <span class="keyword">sizeof</span>(*pictrl), GFP_KERNEL);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* b. 设置pinctrl_desc */</span></span><br><span class="line">pictrl-&gt;name = dev_name(&amp;pdev-&gt;dev);</span><br><span class="line">pictrl-&gt;owner = THIS_MODULE;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* b.1 pins and group */</span></span><br><span class="line">pictrl-&gt;pins = pins;</span><br><span class="line">pictrl-&gt;npins = ARRAY_SIZE(pins);</span><br><span class="line"></span><br><span class="line">pictrl-&gt;pctlops = &amp;virtual_pctrl_ops;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* b.2 pin mux */</span></span><br><span class="line">pictrl-&gt;pmxops = &amp;virtual_pmx_ops;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* b.3 pin config */</span></span><br><span class="line">pictrl-&gt;confops = &amp;virtual_pinconf_ops;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* c. 注册pinctrl_desc */</span></span><br><span class="line">g_pinctrl_dev = devm_pinctrl_register(&amp;pdev-&gt;dev, pictrl, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">virtual_pinctrl_remove</span><span class="params">(<span class="keyword">struct</span> platform_device *pdev)</span></span><br><span class="line">&#123;</span><br><span class="line">printk(<span class="string">&quot;%s %s %d\n&quot;</span>, __FILE__, __FUNCTION__, __LINE__);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">of_device_id</span> <span class="title">virtual_pinctrl_of_match</span>[] =</span> &#123;</span><br><span class="line">&#123; .compatible = <span class="string">&quot;100ask,virtual_pinctrl&quot;</span>, &#125;,</span><br><span class="line">&#123; &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">platform_driver</span> <span class="title">virtual_pinctrl_driver</span> =</span> &#123;</span><br><span class="line">.probe       = virtual_pinctrl_probe,</span><br><span class="line">.remove      = virtual_pinctrl_remove,</span><br><span class="line">.driver      = &#123;</span><br><span class="line">.name    = <span class="string">&quot;100ask_virtual_pinctrl&quot;</span>,</span><br><span class="line">.of_match_table = of_match_ptr(virtual_pinctrl_of_match),</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 1. 入口函数 */</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">virtual_pinctrl_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* 1.1 注册一个platform_driver */</span></span><br><span class="line"><span class="keyword">return</span> platform_driver_register(&amp;virtual_pinctrl_driver);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 2. 出口函数 */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __exit <span class="title function_">virtual_pinctrl_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* 2.1 注销platform_driver */</span></span><br><span class="line">platform_driver_unregister(&amp;virtual_pinctrl_driver);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(virtual_pinctrl_init);</span><br><span class="line">module_exit(virtual_pinctrl_exit);</span><br><span class="line"></span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="5-5-编写client驱动"><a href="#5-5-编写client驱动" class="headerlink" title="5.5 编写client驱动"></a>5.5 编写client驱动</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/err.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/io.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/mfd/syscon.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of_device.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of_address.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/pinctrl/machine.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/pinctrl/pinconf.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/pinctrl/pinctrl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/pinctrl/pinmux.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/slab.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/regmap.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">of_device_id</span> <span class="title">virtual_client_of_match</span>[] =</span> &#123;</span><br><span class="line">&#123; .compatible = <span class="string">&quot;100ask,virtual_i2c&quot;</span>, &#125;,</span><br><span class="line">&#123; &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">virtual_client_probe</span><span class="params">(<span class="keyword">struct</span> platform_device *pdev)</span></span><br><span class="line">&#123;</span><br><span class="line">printk(<span class="string">&quot;%s %s %d\n&quot;</span>, __FILE__, __FUNCTION__, __LINE__);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">virtual_client_remove</span><span class="params">(<span class="keyword">struct</span> platform_device *pdev)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">printk(<span class="string">&quot;%s %s %d\n&quot;</span>, __FILE__, __FUNCTION__, __LINE__);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">platform_driver</span> <span class="title">virtual_client_driver</span> =</span> &#123;</span><br><span class="line">.probe= virtual_client_probe,</span><br><span class="line">.remove= virtual_client_remove,</span><br><span class="line">.driver= &#123;</span><br><span class="line">.name= <span class="string">&quot;100ask_virtual_client&quot;</span>,</span><br><span class="line">.of_match_table = of_match_ptr(virtual_client_of_match),</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 1. 入口函数 */</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">virtual_client_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* 1.1 注册一个platform_driver */</span></span><br><span class="line"><span class="keyword">return</span> platform_driver_register(&amp;virtual_client_driver);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 2. 出口函数 */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __exit <span class="title function_">virtual_client_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* 2.1 注销platform_driver */</span></span><br><span class="line">platform_driver_unregister(&amp;virtual_client_driver);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(virtual_client_init);</span><br><span class="line">module_exit(virtual_client_exit);</span><br><span class="line"></span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="5-6-使用方法"><a href="#5-6-使用方法" class="headerlink" title="5.6 使用方法"></a>5.6 使用方法</h2><p>依次装载驱动</p><ol><li>virtual_pinctrl_driver.ko   注册了我们的虚拟的pinctrl控制器，里面有我们的虚拟pinctrl的操作函数。</li><li>virtual_pinctrl_client.ko   这个client的pinctrl控制器在设备树中指定为了我们的虚拟的pinctrl控制器，在执行他的probe函数之前，系统会先执行really_probe函数，会用这个驱动对应的pinctrl控制器的操作函数设置成设备树中指定的配置。</li></ol><p>开发板的<code>/sys/kernel/debug/pinctrl/</code>目录下，每一个pin controller都有一个目录，比如virtual_pincontroller。里面有很多文件，作用如下：</p><table><thead><tr><th>Pinctrl的虚拟文件</th><th>作用</th><th>解释</th></tr></thead><tbody><tr><td>pins</td><td>单个引脚信息</td><td></td></tr><tr><td>pingroups</td><td>引脚的组信息</td><td></td></tr><tr><td>pinmux-pins</td><td>单个引脚的复用信息</td><td></td></tr><tr><td>pinmux-functions</td><td>function下的group(支持该function的group)</td><td></td></tr><tr><td>pinconf-pins</td><td>单个引脚的配置</td><td></td></tr><tr><td>pinconf-groups</td><td>引脚组的配置</td><td></td></tr><tr><td>pinconf-config</td><td>可以通过写它修改指定设备、指定状态下、指定(组)引脚的config值</td><td></td></tr></tbody></table><ul><li>单个引脚信息</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat /sys/kernel/debug/pinctrl/virtual_pincontroller/pins</span><br><span class="line">registered pins: 4</span><br><span class="line">pin 0 (pin0) virtual_pincontroller</span><br><span class="line">pin 1 (pin1) virtual_pincontroller</span><br><span class="line">pin 2 (pin2) virtual_pincontroller</span><br><span class="line">pin 3 (pin3) virtual_pincontroller</span><br></pre></td></tr></table></figure><ul><li>引脚的组信息（模仿stm32mp157的每个pin都当作一个group）</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat /sys/kernel/debug/pinctrl/virtual_pincontroller/pingroups</span><br><span class="line">registered pin groups:</span><br><span class="line">group: pin0</span><br><span class="line">pin 0 (pin0)</span><br><span class="line"></span><br><span class="line">group: pin1</span><br><span class="line">pin 1 (pin1)</span><br><span class="line"></span><br><span class="line">group: pin2</span><br><span class="line">pin 2 (pin2)</span><br><span class="line"></span><br><span class="line">group: pin3</span><br><span class="line">pin 3 (pin3)</span><br></pre></td></tr></table></figure><ul><li>单个引脚的复用信息</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat /sys/kernel/debug/pinctrl/virtual_pincontroller/pinmux-pins</span><br><span class="line">Pinmux settings per pin</span><br><span class="line">Format: pin (name): mux_owner gpio_owner hog?</span><br><span class="line">pin 0 (pin0): virtual_i2c (GPIO UNCLAIMED) function i2c group pin0</span><br><span class="line">pin 1 (pin1): virtual_i2c (GPIO UNCLAIMED) function i2c group pin1</span><br><span class="line">pin 2 (pin2): (MUX UNCLAIMED) (GPIO UNCLAIMED)</span><br><span class="line">pin 3 (pin3): (MUX UNCLAIMED) (GPIO UNCLAIMED)</span><br></pre></td></tr></table></figure><ul><li>function下的group(支持该function的group，模仿stm32mp157的每个pin都当作一个group)</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat /sys/kernel/debug/pinctrl/virtual_pincontroller/pinmux-functions</span><br><span class="line">function: gpio, groups = [ pin0 pin1 pin2 pin3 ]</span><br><span class="line">function: i2c, groups = [ pin0 pin1 ]</span><br><span class="line">function: uart, groups = [ pin2 pin3 ]</span><br></pre></td></tr></table></figure><ul><li>单个引脚的配置</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat /sys/kernel/debug/pinctrl/virtual_pincontroller/pinconf-pins</span><br><span class="line">Pin config settings per pin</span><br><span class="line">Format: pin (name): configs</span><br><span class="line">pin 0 (pin0): 0x11223344</span><br><span class="line">pin 1 (pin1): 0x55667788</span><br><span class="line">pin 2 (pin2): 0x0</span><br><span class="line">pin 3 (pin3): 0x0</span><br></pre></td></tr></table></figure><ul><li>引脚组的配置（模仿stm32mp157的每个pin都当作一个group）</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat /sys/kernel/debug/pinctrl/virtual_pincontroller/pinconf-groups</span><br><span class="line">Pin config settings per pin group</span><br><span class="line">Format: group (name): configs</span><br><span class="line">0 (pin0): 0x11223344</span><br><span class="line">1 (pin1): 0x55667788</span><br><span class="line">2 (pin2): 0x0</span><br><span class="line">3 (pin3): 0x0</span><br></pre></td></tr></table></figure><p>我们可以在pinctrl驱动的ops组中加入打印信息，这样就可以确认这些cat操作分别对应的ops函数。</p><h1 id="六、相关疑惑与调试"><a href="#六、相关疑惑与调试" class="headerlink" title="六、相关疑惑与调试"></a>六、相关疑惑与调试</h1><p><img src="6.0.png" alt="6.0"></p>]]></content>
      
      
      <categories>
          
          <category> Linux驱动 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux驱动 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RK3399使用日志</title>
      <link href="/2023/04/11/RK3399%E4%BD%BF%E7%94%A8%E6%97%A5%E5%BF%97/"/>
      <url>/2023/04/11/RK3399%E4%BD%BF%E7%94%A8%E6%97%A5%E5%BF%97/</url>
      
        <content type="html"><![CDATA[<h1 id="1、fbtft屏幕出错"><a href="#1、fbtft屏幕出错" class="headerlink" title="1、fbtft屏幕出错"></a>1、fbtft屏幕出错</h1><p>向往常一样想在RK3399上点亮st7789v屏幕，但是报错如下：</p><p><img src="fbtft-debug1.png" alt="fbtft-debug1"></p><p>从信息来看应该是在：drivers&#x2F;staging&#x2F;fbtf&#x2F;fbtft-core.c –&gt; fbtft_probe_common中出错，最终定位到：</p><p><img src="fbtft-debug2.png" alt="fbtft-debug2"></p><p><img src="fbtft-debug3.png" alt="fbtft-debug3"></p><p>我们的内核是开启了DMA的，也即开启了宏：CONFIG_HAS_DMA，所以问题出在DMA空间申请失败，手动关闭LCD dma，重新编译烧录即可。<em><strong>这里没有深究为什么DMA申请空间失败。</strong></em></p><img src="fbtft-debug4.png" alt="fbtft-debug4" style="zoom:200%;">]]></content>
      
      
      <categories>
          
          <category> RK3399 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RK3399 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深入浅出C指针</title>
      <link href="/2023/03/19/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAC%E6%8C%87%E9%92%88/"/>
      <url>/2023/03/19/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAC%E6%8C%87%E9%92%88/</url>
      
        <content type="html"><![CDATA[<h1 id="1-指针基本介绍"><a href="#1-指针基本介绍" class="headerlink" title="1. 指针基本介绍"></a>1. 指针基本介绍</h1><p><img src="1.%E6%8C%87%E9%92%88%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D1.png" alt="指针基本介绍1"></p><p><img src="1.%E6%8C%87%E9%92%88%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D2.png" alt="指针基本介绍2"></p><p><img src="1.%E6%8C%87%E9%92%88%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D3.png" alt="指针基本介绍3"></p><h1 id="2-指针类型"><a href="#2-指针类型" class="headerlink" title="2. 指针类型"></a>2. 指针类型</h1><p><img src="2.%E6%8C%87%E9%92%88%E7%B1%BB%E5%9E%8B1.png" alt="2.指针类型1"></p><p><img src="2.%E6%8C%87%E9%92%88%E7%B1%BB%E5%9E%8B2.png" alt="2.指针类型2"></p><p><img src="2.%E6%8C%87%E9%92%88%E7%B1%BB%E5%9E%8B3.png" alt="2.指针类型3"></p><h1 id="3-指针的指针"><a href="#3-指针的指针" class="headerlink" title="3. 指针的指针"></a>3. 指针的指针</h1><p><img src="3.%E6%8C%87%E9%92%88%E7%9A%84%E6%8C%87%E9%92%881.png" alt="3.指针的指针1"></p><p><img src="3.%E6%8C%87%E9%92%88%E7%9A%84%E6%8C%87%E9%92%882.png" alt="3.指针的指针2"></p><h1 id="4-传值与传引用"><a href="#4-传值与传引用" class="headerlink" title="4. 传值与传引用"></a>4. 传值与传引用</h1><p><img src="4.%E4%BC%A0%E5%80%BC%E4%B8%8E%E4%BC%A0%E5%BC%95%E7%94%A81.png" alt="4.传值与传引用1"></p><p><img src="4.%E4%BC%A0%E5%80%BC%E4%B8%8E%E4%BC%A0%E5%BC%95%E7%94%A82.png" alt="4.传值与传引用2"></p><h1 id="5-指针与数组"><a href="#5-指针与数组" class="headerlink" title="5. 指针与数组"></a>5. 指针与数组</h1><p><img src="5.%E6%8C%87%E9%92%88%E4%B8%8E%E6%95%B0%E7%BB%841.png" alt="5.指针与数组1"></p><h1 id="6-数组作为函数参数"><a href="#6-数组作为函数参数" class="headerlink" title="6. 数组作为函数参数"></a>6. 数组作为函数参数</h1><p><img src="6.%E6%95%B0%E7%BB%84%E4%BD%9C%E4%B8%BA%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B01.png" alt="6.数组作为函数参数1"></p><p><img src="6.%E6%95%B0%E7%BB%84%E4%BD%9C%E4%B8%BA%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B02.png" alt="6.数组作为函数参数2"></p><h1 id="7-指针和字符数组"><a href="#7-指针和字符数组" class="headerlink" title="7. 指针和字符数组"></a>7. 指针和字符数组</h1><p><img src="7.%E6%8C%87%E9%92%88%E5%92%8C%E5%AD%97%E7%AC%A6%E6%95%B0%E7%BB%841.png" alt="7.指针和字符数组1"></p><p><img src="7.%E6%8C%87%E9%92%88%E5%92%8C%E5%AD%97%E7%AC%A6%E6%95%B0%E7%BB%842.png" alt="7.指针和字符数组2"></p><p><img src="7.%E6%8C%87%E9%92%88%E5%92%8C%E5%AD%97%E7%AC%A6%E6%95%B0%E7%BB%843.png" alt="7.指针和字符数组3"></p><p><img src="7.%E6%8C%87%E9%92%88%E5%92%8C%E5%AD%97%E7%AC%A6%E6%95%B0%E7%BB%844.png" alt="7.指针和字符数组4"></p><h1 id="8-指针和多维数组"><a href="#8-指针和多维数组" class="headerlink" title="8. 指针和多维数组"></a>8. 指针和多维数组</h1><p><img src="8.%E6%8C%87%E9%92%88%E5%92%8C%E5%A4%9A%E7%BB%B4%E6%95%B0%E7%BB%841.png" alt="8.指针和多维数组1"></p><p><img src="8.%E6%8C%87%E9%92%88%E5%92%8C%E5%A4%9A%E7%BB%B4%E6%95%B0%E7%BB%842.png" alt="8.指针和多维数组2"></p><p><img src="8.%E6%8C%87%E9%92%88%E5%92%8C%E5%A4%9A%E7%BB%B4%E6%95%B0%E7%BB%843.png" alt="8.指针和多维数组3"></p><p><img src="8.%E6%8C%87%E9%92%88%E5%92%8C%E5%A4%9A%E7%BB%B4%E6%95%B0%E7%BB%844.png" alt="8.指针和多维数组4"></p><h1 id="9-指针和动态内存"><a href="#9-指针和动态内存" class="headerlink" title="9. 指针和动态内存"></a>9. 指针和动态内存</h1><p><img src="9.%E6%8C%87%E9%92%88%E5%92%8C%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%981.png" alt="9.指针和动态内存1"></p><h1 id="10-函数返回指针"><a href="#10-函数返回指针" class="headerlink" title="10. 函数返回指针"></a>10. 函数返回指针</h1><p>从栈底向上传一个局部变量或者一个局部变量的地址是可以的，但是反过来不行；如果函数要返回一个指针，要用堆。因为栈是自动释放的，而堆需要手动释放。</p><p><img src="10.%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E6%8C%87%E9%92%881.png" alt="10.函数返回指针1"></p><p><img src="10.%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E6%8C%87%E9%92%882.png" alt="10.函数返回指针2"></p>]]></content>
      
      
      <categories>
          
          <category> C语言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C语言 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深入浅出数据结构</title>
      <link href="/2023/03/19/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
      <url>/2023/03/19/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<h1 id="1-链表"><a href="#1-链表" class="headerlink" title="1. 链表"></a>1. 链表</h1><h2 id="1-1-链表基本介绍"><a href="#1-1-链表基本介绍" class="headerlink" title="1.1 链表基本介绍"></a>1.1 链表基本介绍</h2><p><img src="1.%E9%93%BE%E8%A1%A81.png" alt="1.链表1"></p><p><img src="1.%E9%93%BE%E8%A1%A82.png" alt="1.链表2"></p>]]></content>
      
      
      <categories>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>嵌入式题库总结</title>
      <link href="/2023/03/10/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%A2%98%E5%BA%93%E6%80%BB%E7%BB%93/"/>
      <url>/2023/03/10/%E5%B5%8C%E5%85%A5%E5%BC%8F%E9%A2%98%E5%BA%93%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1 id="一、C语言"><a href="#一、C语言" class="headerlink" title="一、C语言"></a>一、C语言</h1><h2 id="1-inline-和-static-inline"><a href="#1-inline-和-static-inline" class="headerlink" title="1. inline 和 static inline"></a>1. inline 和 static inline</h2><h3 id="inline的优缺点"><a href="#inline的优缺点" class="headerlink" title="inline的优缺点"></a>inline的优缺点</h3><p>inline是c99的特性。在c99中，inline是向编译器建议，将被inline修饰的函数以内联的方式嵌入到调用这个函数的地方。 而编译器会判断这样做是否合适，以此最终决定是否这么做。</p><ol><li>好处：减少调用函数时的开销，如：减少传参时可能引起的压栈出栈的开销。减少PC跳转时对流水线的破坏。</li><li>坏处： 以空间换时间，代码所占体积会更大。</li></ol><h3 id="static-inline和inline的区别"><a href="#static-inline和inline的区别" class="headerlink" title="static inline和inline的区别"></a>static inline和inline的区别</h3><p>显然我们希望它们被其他文件访问。那么我们的inline函数原型就应该定义在头文件中，注意是函数原型而不是函数声明。因为开发者决定不了一个函数是否被内联，开发者只有建议权，只有编译器具有决定权。这就造成了一个很困扰的事情：除非你看到一个函数的反汇编代码，否则你很难确定他是不是内联函数。试想，如果头文件中的Inline函数在没有被编译成内联函数的情况下，被include到了多个源文件中，势必会产生函数重复定义的问题。 因此，我们要再加一个关键字static，才能避免这个问题。</p><h3 id="static-inline使用时机"><a href="#static-inline使用时机" class="headerlink" title="static inline使用时机"></a>static inline使用时机</h3><p>static inline什么时候用比较好：</p><ol><li>所修饰的函数语句较少时，尤其是只有一两条语句的函数。 </li><li>所修饰的函数不是递归函数，因为递归不支持内联。</li><li>内联函数定义了但没有使用的时候不会和普通函数那样warning。</li></ol><h2 id="2-struct和union内存对齐"><a href="#2-struct和union内存对齐" class="headerlink" title="2. struct和union内存对齐"></a>2. struct和union内存对齐</h2><h3 id="内存对齐的原因"><a href="#内存对齐的原因" class="headerlink" title="内存对齐的原因"></a>内存对齐的原因</h3><ol><li>平台原因：<em><strong>不是所有的硬件平台都能访问任意地址上的任意数据的；</strong></em>某些硬件平台只能在某些地址处取某些特定类型的数据，否则抛出硬件异常。</li><li>性能原因 ：数据结构( 尤其是栈 ) 应该尽可能地在自然边界上对齐。 原因在于，我们在访问结构体变量时，是按结构体中成员所占的最大字节数对结构体变量进行读取的。为了访问未对齐的内存，处理器需要作两次内存访问；而对齐的内存访问仅需要一次访问。<em><strong>这里归根结底的来说就是以空间换时间</strong></em> 。</li></ol><h3 id="struct对齐的规则"><a href="#struct对齐的规则" class="headerlink" title="struct对齐的规则"></a>struct对齐的规则</h3><ol><li>结构体中的第一个成员在与结构体变量偏移量为0的地址处。</li><li>其它成员变量要对齐到一个名叫“对齐数”的整数倍的地址处。补充：对齐数&#x3D;编译器默认的一个对齐数与该成员变量类型中的较小值。</li><li>结构体总大小为最大对齐数(每个成员变量类型都有一个对齐数)的整数倍。</li><li>如果存在了嵌套结构体的情况，嵌套的结构体对齐到自己的成员变量类型中最大对齐数的整数倍处，包含该嵌套结构体的结构体大小为其成员变量类型(包含嵌套结构体)最大对齐数的整数倍。</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//结构体内存对齐</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">s1</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="type">char</span> c1;</span><br><span class="line"><span class="type">int</span> a;</span><br><span class="line"><span class="type">char</span> c2;</span><br><span class="line">&#125;; <span class="comment">//32位平台为12字节</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">s2</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="type">char</span> c1;</span><br><span class="line"><span class="type">char</span> c2;</span><br><span class="line"><span class="type">int</span> a;</span><br><span class="line">&#125;; <span class="comment">//32位平台为8字节</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">s3</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="type">int</span>  d;</span><br><span class="line"><span class="type">char</span> c;</span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">s2</span> <span class="title">t</span>;</span> <span class="comment">//结构体嵌套，32位平台为20字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="1.2.1.png" alt="1.2.1"><br><img src="1.2.2.png" alt="1.2.2"><br><img src="1.2.3.png" alt="1.2.3"></p><h3 id="取消内存对齐"><a href="#取消内存对齐" class="headerlink" title="取消内存对齐"></a>取消内存对齐</h3><ol><li>#pragma pack(1)  …  #pragma pack()</li><li>一定要在结构体末尾加上#pragma pack()进行取消自定义字节对齐的命令，如果不取消可能会导致整个程序存在问题，因为会影响到其他结构体的字节对齐方式。</li><li>__attribute__((packed))，GNU C特有的编译机制。</li></ol><h3 id="位域存储规则"><a href="#位域存储规则" class="headerlink" title="位域存储规则"></a>位域存储规则</h3><ol><li>若相邻的位域成员的类型相同，且其占用二进制位数未超过该类型可容纳的范围，则后面的成员紧接着前一个成员进行存储；</li><li>若相邻的位域成员的类型相同，但其占用二进制位数超过该类型可容纳的范围，则后面的成员从该类型占用空间之后的内存单元开始存储;</li><li>若相邻的位域成员的类型不同，则取决于编译器的实现。对于GCC编译器会尽量利用空闲的位对数据进行存储；</li><li>若位域之间定义有匿名位域成员，则匿名位域成员指定的空闲位不用于后续成员的数据存储，注意，他也要遵守条件2；</li><li>特别地，如果匿名成员占用的位数为0，当前类型的内存单元剩余空间都将不会被使用；</li><li>混合使用位域和普通成员变量，也要遵守结构体对齐的规则。</li></ol><p><img src="1.2.4.png" alt="1.2.4"></p><ol><li>对于成员a、b、c再加上匿名成员占用的总内存空间并未超过unsigned short类型空间的大小，因此在unsigned short类型可容纳的范围内，这些成员可以紧挨着存放；</li><li>当后续存放成员d时，前一个unsigned short类型数据剩余的空间已不足以容纳d，因此选择下一个内存单元进行存放。</li><li>整个结构体的总大小为最宽基本类型成员大小的整数倍。所以总大小为4字节。<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//验证匿名位域也要遵守规则2：</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">foo</span>&#123;</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span> a : <span class="number">3</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span> b : <span class="number">4</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span>   : <span class="number">9</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span> c : <span class="number">3</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span> d : <span class="number">5</span>;</span><br><span class="line">&#125;; <span class="comment">//匿名位域9，当前类型剩余空间刚好放的下，总空间为4字节</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">foo</span>&#123;</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span> a : <span class="number">3</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span> b : <span class="number">4</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span>   : <span class="number">10</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span> c : <span class="number">3</span>;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span> d : <span class="number">5</span>;</span><br><span class="line">&#125;; <span class="comment">//匿名位域10，当前类型剩余空间放不下，从byte2开始放匿名的，总空间为6字节</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//验证位域的规则5：</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">foo</span>&#123;</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> a : <span class="number">3</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> b : <span class="number">4</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span>   : <span class="number">5</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> c : <span class="number">3</span>;</span><br><span class="line">    <span class="type">int</span> d;</span><br><span class="line">&#125;; <span class="comment">//int d内存对齐，从byte4开始存储，byte2、byte3不用，总空间为8字节</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="union对齐的规则"><a href="#union对齐的规则" class="headerlink" title="union对齐的规则"></a>union对齐的规则</h3><ol><li>找到占用字节最多的成员类型；</li><li>union大小必须是占最大的成员类型字节数的倍数，而且需要能够容纳其他的成员。</li></ol><p>举个例子：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//x64</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">    <span class="type">long</span> i;</span><br><span class="line">    <span class="type">int</span> k[<span class="number">5</span>];</span><br><span class="line">    <span class="type">char</span> c;</span><br><span class="line">&#125;D</span><br></pre></td></tr></table></figure><ol><li>首先找到占用字节最多的成员，本例中是long，占用8个字节，int k[5]中都是int类型，仍然是占用4个字节的。</li><li>然后union的字节数必须是最大的成员类型的倍数,而且需要能够容纳其他的成员，为了要容纳k(20个字节)，就必须要保证是8的倍数的同时还要大于20个字节，所以是24个字节。</li></ol><h3 id="综合的栗子"><a href="#综合的栗子" class="headerlink" title="综合的栗子"></a>综合的栗子</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line"><span class="type">char</span> m:<span class="number">3</span>;</span><br><span class="line">    <span class="type">char</span> n:<span class="number">5</span>;</span><br><span class="line">    <span class="type">short</span> s;</span><br><span class="line">    <span class="class"><span class="keyword">union</span>&#123;</span></span><br><span class="line">        <span class="type">int</span>  a;</span><br><span class="line">        <span class="type">char</span> b;</span><br><span class="line">&#125;;</span><br><span class="line"> <span class="type">int</span> h;</span><br><span class="line">&#125;__attribute__((packed)) data_a;</span><br><span class="line"><span class="comment">//此处的总大小为11字节，因为取消了内存对齐，否则总大小为12字节</span></span><br></pre></td></tr></table></figure><h3 id="判断机器大小端"><a href="#判断机器大小端" class="headerlink" title="判断机器大小端"></a>判断机器大小端</h3><p>小端存储：低地址内容存放在低地址，高地址内容存放在高地址<br>大端存储：低地址内容存放在高地址，高地址内容存放在低地址</p><p>方法一：联合体union</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="class"><span class="keyword">union</span> <span class="title">w</span>&#123;</span></span><br><span class="line"><span class="type">int</span> a;</span><br><span class="line"><span class="type">char</span> b;</span><br><span class="line">&#125;c;</span><br><span class="line">c.a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(c.b == <span class="number">1</span>)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;小端存储\n&quot;</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;大端存储\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>方法二：指针方法，将int强制类型转换成char单字节，p指向a的起始字节（低字节）</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span> <span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="type">char</span> *p = (<span class="type">char</span> *)&amp;a;</span><br><span class="line"><span class="keyword">if</span>(*p == <span class="number">1</span>)</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;小端存储\n&quot;</span>);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;大端存储\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-attribute-机制"><a href="#3-attribute-机制" class="headerlink" title="3. __attribute__机制"></a>3. __attribute__机制</h2><ol><li>GNU C的一大特色就是attribute机制。attribute可以设置函数属性（Function Attribute）、变量属性（Variable Attribute）和类型属性（Type Attribute）。</li><li>attribute书写特征是：__attribute__前后都有两个下划线，并且后面会紧跟一对括弧，括弧里面是相应的attribute参数。</li></ol><h1 id="二、ARM架构"><a href="#二、ARM架构" class="headerlink" title="二、ARM架构"></a>二、ARM架构</h1><h2 id="1-异常处理"><a href="#1-异常处理" class="headerlink" title="1. 异常处理"></a>1. 异常处理</h2><p>硬件自动完成：</p><ol><li>保存CPSR到SPSR_mode</li><li>设置 CPSR 对应功能位：<br>①切换处理器进入ARM状态：T[5]<br>②根据需要，禁止中断位：F[6] &#x2F; I[7]<br>③根据异常切换到对应的异常模式：M[4:0]</li><li>保存返回地址：把当前 PC 保存到 lr_mode</li><li>设置PC &#x3D; 存放跳转到对应的异常向量表的固定首地址。</li></ol><p>异常处理程序(手动完成)：</p><ol><li>保护现场，将r0 ~ r12寄存器压栈</li><li>真正的异常处理程序</li><li>恢复现场<br>①恢复 SPSR_mode 到 CPSR<br>②恢复 lr_mode 到 PC<br>③操作sp将栈中r0 ~ r12寄存器数据恢复</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">software_interrupt:</span><br><span class="line">@保存现场，连续压栈，lr先入栈，再是r12，r11...</span><br><span class="line">stmfd sp!,&#123;r0-r12, lr&#125;</span><br><span class="line"></span><br><span class="line">@执行用户代码</span><br><span class="line">mov r0, #0x5</span><br><span class="line">mov r1, #0x6</span><br><span class="line">add r3, r0,r1</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">@恢复现场:&#123;r0-r12,pc&#125;，连续出栈，先弹出给r0，r1...pc</span><br><span class="line">@&quot;^&quot;会自动将SPSR恢复到CPSR</span><br><span class="line">ldmfd sp!, &#123;r0-r12, pc&#125;^</span><br></pre></td></tr></table></figure><h1 id="三、Linux内核"><a href="#三、Linux内核" class="headerlink" title="三、Linux内核"></a>三、Linux内核</h1><h2 id="1-不同情形能否schedule"><a href="#1-不同情形能否schedule" class="headerlink" title="1. 不同情形能否schedule"></a>1. 不同情形能否schedule</h2><p>①中断、软中断、tasklet、timer、hrtimer 执行环境下、或者“内核线程、普通线程内核态环境下调用了preempt disable() &#x2F; local irq_disable() &#x2F; spin lock后”，能否调用schedule()函数 (包括usleep()、wait event等系列函数)?</p><p>答：不能调用schedule()函数，否则违反了linux kernel的设计理念，导致schedule出去后系统各种不稳定的异常。</p><p>比如内核能否抢占的条件就是当前没有持有锁，而是否持有锁的判断依据是preempt_count值是否为0，调用preempt disable()后preempt_count++，本来已经禁止抢占了，但是又主动调用schedule()，精神分裂症无疑了！</p><p>再比如spin lock成功后，spin lock内部调用了preempt disable，所以spin lock后，不能调用schedulel()。当然spin unlock会调用preempt enable，由于usleep()、wait_event等函数内部调用了schedule()函数，也不能使用。</p><p>为什么local irq_disable()后不能调用schedule()，我的解释是：根据《linux内核设计与实现》所述：“如果在调用local_irq_disable()之前就已经禁止了中断，那么该例程会带来危险”。因为schedule()中也会禁止中断，所以可能会导致系统不稳定。</p><p>②workqueue、kernel thread、普通线程的内核态这些context下，在没有调用preempt disable禁止抢占和local_irq_disable禁止中断等操作时，能否调用schedule()?</p><p>答：可以调用schedule()。前提是没有调用preempt disable禁止抢占和local_irq_disable禁止中断等操作时。</p>]]></content>
      
      
      <categories>
          
          <category> 面试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>uboot源码情景分析</title>
      <link href="/2023/02/25/uboot%E6%BA%90%E7%A0%81%E6%83%85%E6%99%AF%E5%88%86%E6%9E%90/"/>
      <url>/2023/02/25/uboot%E6%BA%90%E7%A0%81%E6%83%85%E6%99%AF%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="一-UBOOT打补丁"><a href="#一-UBOOT打补丁" class="headerlink" title="一. UBOOT打补丁"></a>一. UBOOT打补丁</h1><p>uboot的源码在官方都能下到，但是每个厂家会根据自己的实际情况对代码进行修改，那么很多时候就会把修改后的补丁文件发布出来，用户只需要将补丁文件打入到官方源码即可。</p><p>打入jz2440的补丁文件: patch -p1 &lt; ..&#x2F;u-boot-1.1.6_jz2440.patch</p><h2 id="1-补丁生成"><a href="#1-补丁生成" class="headerlink" title="1 补丁生成"></a>1 补丁生成</h2><p>当前目录创建原文件：1.txx</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">this is a test</span><br><span class="line"><span class="keyword">for</span> patch file format</span><br><span class="line">so let us go!</span><br></pre></td></tr></table></figure><p>当前目录创建修改后的文件：2.txt</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">this is a test</span><br><span class="line"><span class="keyword">for</span> linux patch file format</span><br><span class="line">so let us go!</span><br><span class="line">learn it</span><br></pre></td></tr></table></figure><p>当前目录创建生成补丁文件：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diff -u <span class="number">1.</span>txt <span class="number">2.</span>txt &gt; diff.patch</span><br></pre></td></tr></table></figure><h2 id="2-补丁分析"><a href="#2-补丁分析" class="headerlink" title="2 补丁分析"></a>2 补丁分析</h2><p>生成的补丁文件内容如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">--- <span class="number">1.</span>txt       <span class="number">2023</span><span class="number">-02</span><span class="number">-27</span> <span class="number">04</span>:<span class="number">00</span>:<span class="number">38.833368403</span> +<span class="number">0000</span></span><br><span class="line">+++ <span class="number">2.</span>txt       <span class="number">2023</span><span class="number">-02</span><span class="number">-27</span> <span class="number">04</span>:<span class="number">00</span>:<span class="number">53.506331049</span> +<span class="number">0000</span></span><br><span class="line">@@ <span class="number">-1</span>,<span class="number">3</span> +<span class="number">1</span>,<span class="number">4</span> @@</span><br><span class="line"> this is a test</span><br><span class="line">-<span class="keyword">for</span> patch file format</span><br><span class="line">+<span class="keyword">for</span> linux patch file format</span><br><span class="line"> so let us go!</span><br><span class="line">+learn it</span><br></pre></td></tr></table></figure><p>补丁头：补丁头记录了原始文件和修改后的文件的文件名和创建时间。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">--- <span class="number">1.</span>txt       <span class="number">2023</span><span class="number">-02</span><span class="number">-27</span> <span class="number">04</span>:<span class="number">00</span>:<span class="number">38.833368403</span> +<span class="number">0000</span></span><br><span class="line">+++ <span class="number">2.</span>txt       <span class="number">2023</span><span class="number">-02</span><span class="number">-27</span> <span class="number">04</span>:<span class="number">00</span>:<span class="number">53.506331049</span> +<span class="number">0000</span></span><br><span class="line">“---” 表示旧文件（原文件）</span><br><span class="line">“+++” 表示新文件（修改后的文件）</span><br></pre></td></tr></table></figure><p>补丁块：补丁中的块是用来说明文件的改动情况。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@@ <span class="number">-1</span>,<span class="number">3</span> +<span class="number">1</span>,<span class="number">4</span> @@</span><br><span class="line"> this is a test</span><br><span class="line">-<span class="keyword">for</span> patch file format</span><br><span class="line">+<span class="keyword">for</span> linux patch file format</span><br><span class="line"> so let us go!</span><br><span class="line">+learn it</span><br></pre></td></tr></table></figure><p>@@ -1,3 +1,4 @@</p><ol><li>-1,3表示这个块原文件是从第1行开始，到第3行结束。</li><li>+1,4表示这个块修改后是从第1行开始，到第3行结束。</li></ol><p>块会缩进一列，该列有三种情况：</p><ol><li>以 “-” 开头的行， 表示该行只在原始文件中存在，也就是要删除的。</li><li>以 “+” 开头的行，表示该行只在修改后的文件中存在，要加上的。</li><li>以空格开头的行，表示该行在原始文件和修改后的文件中都存在，也就是没改动。</li></ol><h2 id="3-补丁使用"><a href="#3-补丁使用" class="headerlink" title="3 补丁使用"></a>3 补丁使用</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">patch -p0 <span class="number">1.</span>txt &lt; diff.patch</span><br></pre></td></tr></table></figure><p>-p是指打补丁的时候忽略几层路径，假如生成补丁的时候不是在当前目录生成的，那么在补丁头的时候就会显示要将补丁打到哪里去的路径：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--- test/<span class="number">1.</span>txt <span class="number">2023</span><span class="number">-02</span><span class="number">-27</span> <span class="number">04</span>:<span class="number">00</span>:<span class="number">38.833368403</span> +<span class="number">0000</span></span><br><span class="line">+++ test/<span class="number">2.</span>txt <span class="number">2023</span><span class="number">-02</span><span class="number">-27</span> <span class="number">04</span>:<span class="number">00</span>:<span class="number">53.506331049</span> +<span class="number">0000</span></span><br></pre></td></tr></table></figure><p>test&#x2F;1.txt就是补丁显示的原文件路径，也就是要打入补丁的地方，但用户的原文件路径和补丁显示的原文件路径一般来说是不一样的，所以用户打补丁一般进入自己原文件的目录，并查看补丁头显示的路径，用-p去掉不属于自己的路径。</p><p>比如现在用户在hhh&#x2F;1.txt，那么他就要去除test&#x2F;这个路径，所以他应该用：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">patch -p1 <span class="number">1.</span>txt &lt; diff.patch</span><br></pre></td></tr></table></figure><h1 id="二-UBOOT配置"><a href="#二-UBOOT配置" class="headerlink" title="二. UBOOT配置"></a>二. UBOOT配置</h1><p>make 100ask24x0_config 配置板级信息，我们搜索Makefile查看具体执行什么：</p><p><img src="1_make-xxxconfig.png" alt="1_make-xxxconfig"></p><p>@$(MKCONFIG)   $(@:_config&#x3D;)   arm   arm920t   100ask24x0   NULL   s3c24x0</p><ol><li>@ 是指 make 时不输出 make 信息（一行以@开头，则该行命令的输出被抑制）。</li><li>$(MKCONFIG) 变量表示 MKCONFIG :&#x3D; $(SRCTREE)&#x2F;mkconfig（源码目录下的 mkconfig 文件）。</li><li>$(@:_config&#x3D;)，$@是指表示目标，即：100ask24x0_config，_config&#x3D;是指用空替掉换$@目标中的“_config”（_config&#x3D;后是空）。则$(@:_config&#x3D;) 就表示 100ask24x0。</li></ol><p>最后：“make 100ask24x0_config”便相当于执行下面这个脚本：</p><p>mkconfig       100ask24x0       arm         arm920t        100ask24x0       NULL         s3c24x0</p><p>打开mkconfig脚本，根据入参简化后如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh -e</span></span><br><span class="line"></span><br><span class="line">APPEND=no       # Default: Create new config file</span><br><span class="line">BOARD_NAME=&quot;&quot;   # Name to print in make output</span><br><span class="line"></span><br><span class="line">echo &quot;Configuring for $&#123;BOARD_NAME&#125; board...&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Create link to architecture specific headers</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="built_in">cd</span> ./include</span></span><br><span class="line">rm -f asm</span><br><span class="line">ln -s asm-$2 asm</span><br><span class="line">rm -f asm-$2/arch</span><br><span class="line">ln -s $&#123;LNPREFIX&#125;arch-$6 asm-$2/arch</span><br><span class="line">rm -f asm-$2/proc</span><br><span class="line">ln -s $&#123;LNPREFIX&#125;proc-armv asm-$2/proc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Create include file for Make</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="built_in">echo</span> <span class="string">&quot;ARCH   = <span class="variable">$2</span>&quot;</span> &gt;  config.mk</span></span><br><span class="line">echo &quot;CPU    = $3&quot; &gt;&gt; config.mk</span><br><span class="line">echo &quot;BOARD  = $4&quot; &gt;&gt; config.mk</span><br><span class="line"></span><br><span class="line">[ &quot;$5&quot; ] &amp;&amp; [ &quot;$5&quot; != &quot;NULL&quot; ] &amp;&amp; echo &quot;VENDOR = $5&quot; &gt;&gt; config.mk</span><br><span class="line"></span><br><span class="line">[ &quot;$6&quot; ] &amp;&amp; [ &quot;$6&quot; != &quot;NULL&quot; ] &amp;&amp; echo &quot;SOC    = $6&quot; &gt;&gt; config.mk</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Create board specific header file</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$APPEND</span>&quot;</span> = <span class="string">&quot;yes&quot;</span> ]        <span class="comment"># Append to existing config file</span></span></span><br><span class="line">then</span><br><span class="line">        echo &gt;&gt; config.h</span><br><span class="line">else</span><br><span class="line">        &gt; config.h              # Create new config file</span><br><span class="line">fi</span><br><span class="line">echo &quot;/* Automatically generated - do not edit */&quot; &gt;&gt;config.h</span><br><span class="line">echo &quot;#include &lt;configs/$1.h&gt;&quot; &gt;&gt;config.h</span><br><span class="line"></span><br><span class="line">exit 0</span><br></pre></td></tr></table></figure><p>可知执行了如下：</p><ol><li>在include目录下建立了一系列软链接，如：ln -s asm-arm asm，链接文件asm指向 asm-arm。这样做的原因是避免每次都要配置。如#inclue &lt;asm-arm&#x2F;type.h&gt;是包含 arm 下的type.h 头文件，若是#include &lt;asm-i386&#x2F;type.h&gt;是包含 i386 架构下的 type.h 头文件。配置时建立链接文件到相应的架构下，这样直接写成 #include &lt;asm&#x2F;type.h&gt;即可。</li><li>在include目录下创建了config.mk，里面有我们单板的信息。</li><li>在include目录下创建了config.h，里面#include &lt;configs&#x2F;100ask24x0.h&gt;，该头文件包含板子的配置情况，所以增加一个板子，在 board 目录下新建一个开发板<board_name>的目录，在include&#x2F;configs 目录下也要建立一个文件 <board_name>.h，里在存放的就是开发板 <board_name>的配置信息。</board_name></board_name></board_name></li></ol><h1 id="三-UBOOT编译"><a href="#三-UBOOT编译" class="headerlink" title="三. UBOOT编译"></a>三. UBOOT编译</h1><p>配置完毕后，直接输入make即可编译，我们来分析Makefile。</p><p><img src="2_make.png" alt="2_make"></p><p>包含 include 目录下的 config.mk 文件，这个文件是就 make 100ask24x0_config 与 mkconfig 文件一起生成的。include&#x2F;config.mk 中定义的东西在 Makefile 中用的到。这就是配置和编译结合的过程。包含了 include&#x2F;config.mk 配置文件后，export 导出这 5 个变量给下级的 Makefile使用。</p><p>我们make是要生成uboot.bin，uboot.bin是由uboot生成的。make 编译时，若不指定目标，则 make 就找第一个目标去生成这个目标。all 是这里的第一个目标。</p><p><img src="3_make.png" alt="3_make"></p><p>我们可以将上述变量一一展开，但是现在使用一个取巧的办法，直接看最后编译的输出信息：</p><p><img src="4_make.png" alt="4_make"></p><p>上面的信息可以知道，使用board&#x2F;100ask24x0&#x2F;u-boot.lds链接脚本，链接地址为0x33f80000，将很多的文件链接在一起形成了elf文件u-boot，最后这个elf格式的u-boot再转化成二进制的u-boot.bin。那么我们来看看这个链接脚本：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">OUTPUT_FORMAT(&quot;elf32-littlearm&quot;, &quot;elf32-littlearm&quot;, &quot;elf32-littlearm&quot;)</span><br><span class="line">/*OUTPUT_FORMAT(&quot;elf32-arm&quot;, &quot;elf32-arm&quot;, &quot;elf32-arm&quot;)*/</span><br><span class="line">OUTPUT_ARCH(arm)</span><br><span class="line">ENTRY(_start)</span><br><span class="line">SECTIONS</span><br><span class="line">&#123;</span><br><span class="line">. = 0x00000000;</span><br><span class="line"></span><br><span class="line">. = ALIGN(4);</span><br><span class="line">.text      :</span><br><span class="line">&#123;</span><br><span class="line">cpu/arm920t/start.o   (.text)</span><br><span class="line">board/100ask24x0/boot_init.o (.text)</span><br><span class="line">*(.text)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">. = ALIGN(4);</span><br><span class="line">.rodata : &#123; *(.rodata) &#125;</span><br><span class="line"></span><br><span class="line">. = ALIGN(4);</span><br><span class="line">.data : &#123; *(.data) &#125;</span><br><span class="line"></span><br><span class="line">. = ALIGN(4);</span><br><span class="line">.got : &#123; *(.got) &#125;</span><br><span class="line"></span><br><span class="line">. = .;</span><br><span class="line">__u_boot_cmd_start = .;</span><br><span class="line">.u_boot_cmd : &#123; *(.u_boot_cmd) &#125;</span><br><span class="line">__u_boot_cmd_end = .;</span><br><span class="line"></span><br><span class="line">. = ALIGN(4);</span><br><span class="line">__bss_start = .;</span><br><span class="line">.bss : &#123; *(.bss) &#125;</span><br><span class="line">_end = .;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>可以看到链接脚本将cpu&#x2F;arm920t&#x2F;start.o放在了最前面，并且ENTRY(_start)声明了第一条语句的入口。</li><li>链接脚本的链接地址是0开始，为什么最后的链接显示的链接地址是0x33F80000？这个地址是TEXT_BASE，在board&#x2F;100ask24x0&#x2F;config.mk定义。我们的SDRAM为64M，地址从0x30000000开始，0x33F80000就是在SDRAM的最顶部空出512k来存放我们的uboot.bin。</li><li>__u_boot_cmd_start 这个段是用来存放uboot定义的命令，后续会分析到。</li><li>接下来的任务就是从cpu&#x2F;arm920t&#x2F;start.S这个文件入手，分析uboot的源码。</li></ol><h1 id="四-UBOOT源码分析"><a href="#四-UBOOT源码分析" class="headerlink" title="四. UBOOT源码分析"></a>四. UBOOT源码分析</h1><h2 id="1-UBOOT启动第一阶段"><a href="#1-UBOOT启动第一阶段" class="headerlink" title="1 UBOOT启动第一阶段"></a>1 UBOOT启动第一阶段</h2><p>第一阶段做的事情如下：cpu&#x2F;arm920t&#x2F;start.S</p><ol><li>进入 SVC 管理模式</li><li>关看门狗</li><li>屏蔽中断</li><li>做些初始化（主要是 SDRAM 的初始化）board&#x2F;100ask24x0&#x2F;lowlevel_init.S</li><li>设置调用 C 函数的 SP 栈。</li><li>时钟。</li><li>重定位（从 FLASH 拷代码到 SDRAM）</li><li>清 bss 段</li><li>最后调用 C 函数 start_armboot：执行更复杂的第二阶段</li></ol><h2 id="2-UBOOT启动第二阶段"><a href="#2-UBOOT启动第二阶段" class="headerlink" title="2 UBOOT启动第二阶段"></a>2 UBOOT启动第二阶段</h2><p>第二阶段的start_armboot在lib_arm&#x2F;board.c：</p><p><img src="6_start_armboot.png" alt="6_start_armboot"></p><p><img src="5_start_armboot.png" alt="5_start_armboot"></p><p><img src="7_start_armboot.png" alt="7_start_armboot"></p><ol><li>分配一个类型为 gd_t* 这样的结构体指针的内存空间给 gd全局变量，并且gd全局变量是保存在寄存器中的，使用了__asm__ <strong>volatile</strong>(“”: : :”memory”)。这个结构体贯穿整个uboot。</li><li>使用函数指针数组，完成一系列初始化。包括nor flash，nand flash，环境变量初始化等。</li><li>最后跳转到main_loop函数，处理命令。</li></ol><p>main_loop函数在common&#x2F;main.c中：</p><p><img src="8_main_loop.png" alt="8_main_loop"></p><p><img src="9_main_loop.png" alt="9_main_loop"></p><p><img src="10_main_loop.png" alt="10_main_loop"></p><ol><li>获取bootdelay倒数计时变量。</li><li>如果在这个倒数计时到达到 0 之前，没有输入空格键，就会启动bootcmd命令。</li><li>否则就进入等待命令输入，然后处理命令的死循环。</li><li>UBOOT 的核心就是这些”命令” run_commnd()，分析了这些命令的实现之后，才能明白内核的加载与启动。</li></ol><h2 id="3-UBOOT的命令实现"><a href="#3-UBOOT的命令实现" class="headerlink" title="3 UBOOT的命令实现"></a>3 UBOOT的命令实现</h2><p>UBOOT 接收串口输入时，会根据串口输入的字符去查找相应的处理函数。最简单的方法就是做一个结构体，这个结构体里面有名字，还有相应的处理函数。即cmd_tbl_t。查找函数如下：</p><p><img src="11_find_cmd.png" alt="11_find_cmd"></p><p>这就与我们的链接脚本对应上了，uboot会把所有的命令做成一个cmd_tbl_t结构体，里面有函数名字，对应的处理函数，并把所有的命令结构体都放到__u_boot_cmd_start段中，以后要执行对应的命令时就去该段根据名字查找到对应命令结构体，最后调用其处理函数即可。</p><p>究竟是不是如此。我们分析命令的定义即可：</p><p><img src="12_uboot_cmd.png" alt="12_uboot_cmd"></p><p><img src="13_uboot_cmd.png" alt="13_uboot_cmd"></p><p>最终展开后：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">cmd_tbl_t</span> __u_boot_cmd_bootm __attribute__ ((unused,section (<span class="string">&quot;.u_boot_cmd&quot;</span>)))= &#123;</span><br><span class="line">    “bootm”,</span><br><span class="line">    CFG_MAXARGS,</span><br><span class="line">    <span class="number">1</span>, do_bootm, </span><br><span class="line">    <span class="string">&quot;bootm - boot application image from memory\n&quot;</span>,</span><br><span class="line">    <span class="string">&quot;[addr [arg ...]]\n - boot application image stored in memory\n&quot;</span></span><br><span class="line">     <span class="string">&quot;\tpassing arguments &#x27;arg ...&#x27;; when booting a Linux kernel,\n&quot;</span></span><br><span class="line">     <span class="string">&quot;\t&#x27;arg&#x27; can be the address of an initrd image\n&quot;</span></span><br><span class="line">    <span class="meta">#<span class="keyword">ifdef</span> CONFIG_OF_FLAT_TREE</span></span><br><span class="line">    <span class="string">&quot;\tWhen booting a Linux kernel which requires a flat device-tree\n&quot;</span></span><br><span class="line">    <span class="string">&quot;\ta third argument is required which is the address of the of the\n&quot;</span></span><br><span class="line">    <span class="string">&quot;\tdevice-tree blob. To boot that kernel without an initrd image,\n&quot;</span></span><br><span class="line">    <span class="string">&quot;\tuse a &#x27;-&#x27; for the second argument. If you do not pass a third\n&quot;</span></span><br><span class="line">    <span class="string">&quot;\ta bd_info struct will be passed instead\n</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>故在代码中，所有用 U_BOOT_CMD 宏定义的东西，最终都会定义为：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">cmd_tbl_t</span>  __u_boot_cmd_#<span class="meta">#name __attribute__ (...)</span></span><br></pre></td></tr></table></figure><p>这样的结构体特别在于有一个属性。就是将它的段强制指定为 .u_boot_cmd 。所有的命令结构体最终都会被集中在这个段内，很容易根据名字遍历查找。这和RT-Thread自动初始化段类似。</p><h2 id="4-UBOOT的终极目的"><a href="#4-UBOOT的终极目的" class="headerlink" title="4 UBOOT的终极目的"></a>4 UBOOT的终极目的</h2><ol><li><p>uboot的最终目的是去启动linux内核，假设我们在bootdelay之前没有按下空格键，他就会执行bootcmd中保存的命令，该命令一般有两条，第一条去flash的某一分区读取我们的linux内核到SDRAM中某一地址，这个地址可以随意，只要不破坏我们的其他内容即可。</p></li><li><p>uboot是不能识别linux直接编译出来的zImage的，他要经过uboot的脚本给zImage加上64字节的头部成为uImage才能被识别，这个头部包含了内核镜像的信息，内核的加载地址等。</p></li><li><p>从flash读取linux内核到SDRAM指定地方后，调用bootcmd的第二条命令bootm addr，该命令最终调用do_bootm函数，然后会分析uImage的头部信息，如果现在的地址不等于内核的加载地址，则还需要把内核重定位到他的加载地址去，最后调用do_bootm_linux跳转到内核真正的入口地址处，然后uboot就一去不复回了。</p></li></ol><p>do_bootm_linux函数如下：</p><p><img src="14_do_bootm_linux.png" alt="14_do_bootm_linux"></p><p><img src="15_do_bootm_linux.png" alt="15_do_bootm_linux"></p><ol><li>首先定义了一个函数指针theKernel，让他指向内核真正的入口地址处。</li><li>最后调用theKernel (0, bd-&gt;bi_arch_number, bd-&gt;bi_boot_params);</li><li>他有三个参数，第二个参数是芯片ID，内核根据这个ID判断自己是否能够支持该芯片，第三个是uboot要传递给内核的一些信息所在的首地址。</li><li>uboot可以将板子的一些信息，按照内核约定的格式存放起来，这个格式叫做tag，把所有的tag都集中放在一起，跳转到内核的时候把这个地址当作参数传递给内核，内核看到该地址就知道了，哦，原来uboot给我“留言”了，放在了“xxx”地址。</li></ol><p>至此，uboot的使命就结束了，还有很多细节没有列举出来，不同芯片的整体流程都大同小异！</p><h1 id="五-SPL为何物"><a href="#五-SPL为何物" class="headerlink" title="五. SPL为何物"></a>五. SPL为何物</h1><h2 id="1-SPL-名字由来"><a href="#1-SPL-名字由来" class="headerlink" title="1. SPL 名字由来"></a>1. SPL 名字由来</h2><p>SPL 全称叫做：Secondary Program Loader，看名字，像是一个什么二级加载相关的；实质上，也是二级加载；众所周知，u-boot 是用来 boot 我们的嵌入式系统的，那直接使用 u-boot 就行了呗，为何还会多出一个 uboot spl 呢？那我们从系统启动开始说起吧；</p><p>站在芯片厂商的角度来说，硬件系统一上电，一定是要去某个地址取指令（一般是 0x00000000），然后软件便开始很欢快的运行起来了；通常来讲，SoC 厂家都会做一个 ROM 在 SoC 内部，这个 ROM 很小(成本，你懂的)，里面固化了上电启动的代码（一经固化，永不能改，是芯片做的时候，做进去的）；这部分代码呢，我们管它叫做 BootROM。</p><p>换句话来说，上电后，先接管系统的是 SoC 厂家的 BootROM，他要做些什么事情呢？<br>他要负责最原始的初始化，这个 BootROM 叫做一级启动程序，而排在后面的就叫二级启动，这就是 SPL 名字的由来；</p><h2 id="2-SPL-拿来干嘛"><a href="#2-SPL-拿来干嘛" class="headerlink" title="2. SPL 拿来干嘛"></a>2. SPL 拿来干嘛</h2><h3 id="2-1-铺垫"><a href="#2-1-铺垫" class="headerlink" title="2.1 铺垫"></a>2.1 铺垫</h3><p>为了讲清楚 spl 的用处，我需要先铺垫一点其他东西；如果是大芯片（不是单片机），外挂了存储设备（eMMC、Nand、SDCard 等）和内存 RAM（SDRAM、DDR 等），通常情况下呢，我们要让系统跑起来，需要先烧写代码，这个烧写代码，其实是将可执行的二进制文件写到外部的存储设备上（eMMC、Nand、SD Card 等）；系统上电启动的时候呢，去把他们读到内存中去执行；</p><p>前面我们说了，上电后，先执行SoC 厂家自己的 BootROM，其他可执行的程序（u-boot、Kernel）都放（烧写）到了外部存储器上；那么BootROM 的代码除了去初始化硬件环境以外，还需要去外部存储器上面，将接下来可执行的程序读到内存来执行；</p><p>既然是读到内存执行，那么这个内存可以不可以是我们板载的 DDR 呢？理论上是可以的，但是，SoC 厂家设计的 DDR 控制器一般会支持很多种类型的 DDR 设备，并且会提供兼容性列表，<br>SoC 厂家怎么可能知道用户 PCB 上到底用了哪种内存呢？所以，直接把外部可执行程序读到 DDR 显然是不太友好的，一般来说，SoC 都会做一个内部的小容量的 SRAM （又是成本），BootROM 将外部的可执行程序从存储器中读出来，放到 内部SRAM 去执行；</p><p>好了，现在我们引出了 SRAM，引出了 BootROM；那么 BootROM 从具体哪个存储器读出二进制文件呢？SoC 厂家一般会支持多种启动方式，比如从 eMMC 读取，从 SDCard 读取，从 Nand Flash 读取等等；上电的时候，需要告诉它，它需要从什么样的外设来读取后面的启动二进制文件；</p><p>一般的设计思路是，做一组 Bootstrap Pin，上电的时候呢？BootROM 去采集这几个 IO 的电平，来确认要从什么样的外部存储器来加载后续的可执行文件；比如，2 个 IO，2’b00 表示从 Nand 启动，2’b01 表示从 eMMC 启动，2’b10 表示从 SDCard 启动等等；</p><p>当 BootROM 读到这些值后，就会去初始化对应的外设，然后来读取后面要执行的代码；这些 IO 一般来说，会做成板载的拨码开关，用于调整芯片的启动方式；这里，多说一句，读取烧写的二进制的时候呢，需要注意一些细节，比如，SoC 厂家告诉你，你需要先把 SDCard 初始化称为某种文件系统，然后把东西放进去才有效，之类的；因为文件系统是组织文件的方式，并不是裸分区；你按照 A 文件系统的方式放进去，然后 SoC 的 BootROM 也按照 A 文件系统的方式读出来，才能够达成一致；</p><h3 id="2-2-SPL具体作用"><a href="#2-2-SPL具体作用" class="headerlink" title="2.2 SPL具体作用"></a>2.2 SPL具体作用</h3><p>铺垫得够多的了，这里我们回归主题：spl；前面说了，BootROM 会根据 Bootstrap Pin 去确定从某个存储器来读可执行的二进制文件到 SRAM 并执行；理论上来说，这个二进制文件就可以是我们的 u-boot.bin 文件了；也就是 BootROM 直接加载 u-boot.bin；</p><p>但是这里有一个问题，就是 SRAM 很贵，一般来说，SoC 的片上 SRAM 都不会太大，一般 4KB、8KB、16KB…256KB不等；但是呢，u-boot 编译出来却很大，好几百KB，放不下！</p><p>放不下怎么办？比如，我们的 u-boot 有 300KB，SRAM 有 8KB，外部 DDR 1GB，有两种办法：</p><ol><li>做一个小一点的 boot 程序，先让 BootROM 加载这个小的程序，后面再由这个小 boot 去加载 u-boot；这个小的 boot 就叫做 spl，它很小很小（小于SRAM大小），它先被 BootROM 加载到 SRAM 运行，那么这个 spl 要做什么事情呢？最主要的就是要初始化 DDR Controller，然后将真正的大 u-boot 从外部存储器读取到 DDR 中，然后跳转到大 u-boot；</li><li>放不下就放不下呗，BootROM 加载多少算多少，但是这部分uboot要完成初始化DDR，并把完整的uboot搬运到DDR去运行；u-boot 的前面 8K 被加载进入 SRAM 执行，u-boot 被截断，我们就需要保证在 u-boot 的前 8KB 代码，把板载的 DDR 初始化好，把整个 u-boot 拷贝到 DDR，然后跳转到 DDR 执行；</li></ol><p>方案一：SPL流程如下：先假设，我们的“货”，都已经放置到了外部存储器上，也就是绿色部分；</p><p><img src="16_SPL.jpg" alt="16_SPL"></p><ol start="0"><li>上电后BootROM 执行最原始的初始化，根据 Bootstrap Pin 来确定启动设备，初始化外设；</li><li>从存储器读取 SPL；<br>—————- 以上部分是 SoC 厂家的事情，下面是用户要做的事情 —————-</li><li>SPL 被读到内部 SRAM 执行，此刻，控制权已经移交到我们的 SPL 了；</li><li>SPL 初始化外部 DDR；</li><li>SPL 使用从外部存储器读取 u-boot 并放到 DDR；</li><li>跳转到 DDR 中的 u-boot 执行；</li><li>加载内核；</li></ol><p>方案二：可能会涉及两次重定向；</p><p>第一次：</p><ol><li>第一次在lowlevel_init返回后，进入board_init_f函数之前，lowlevel_init设置好了时钟和ddr，为uboot的第一次重定位做好准备。我们的bootrom只拷贝了uboot的前几k代码到sram执行，而大部分uboot的代码还在SD卡中没有载入内存，没有载入sram的原因是之前我们使用的是内部SRAM，容量不足以放下整个uboot，而现在已经初始化好了外部DRAM，拥有了512MB内存，是完完全全够放下整个uboot，所以这里的第一次重定位就是将SD卡中完整的uboot.bin载入到ddr中(链接地址处)，然后绝对跳转到ddr中board_init_f函数去运行。</li><li>在重定位到链接地址之前的代码只能用位置无关码，也就是相对跳转，不能绝对跳转，因为绝对跳转是跳到链接地址上，但是重定位之前链接地址处那里我们还没有放代码呢。</li><li>重定位到DDR链接地址并跳转到board_init_f后，就可以使用函数指针等全局的变量了(board_init_f中使用了函数指针数组完成一系列初始化)；注意这里不是跳到DDR中uboot开始地址。</li></ol><p>第二次：</p><ol><li>第二次在board_init_f函数最后会调用汇编实现的ENTRY(relocate_code)，在前面第一次重定位将u-boot从SD卡拷贝到DDR中时，是拷贝到链接地址的，也就是说那个时候u-boot的运行地址就和链接地址一致了，可以正常运行完整个u-boot，这里又再次重定位，只不过是为了将u-boot搬到内存的高地址去运行，是因为防止内核解压的时候覆盖了u-boot本身。</li><li>但是要注意，如果这次像第一次那样将uboot复制到DDR高地址，然后绝对跳转过去执行，后续函数中如果有函数调用或使用全局变量的时候，还是会回到链接地址处，也就是DDR低地址处的uboot，这就与我们本意相悖，所以relocate_code最后还要修改DDR高地址的uboot.bin的rel段的数据，那是所有需要重定位的变量、函数的地址信息，加上DDR低地址到DDR高地址的偏移量即可。</li><li>relocate_code结束后使用绝对地址跳转到DDR高地址处的uboot.bin的board_init_r函数入口，也就是在DDR高地址继续执行Uboot，注意这里不是跳到DDR中高地址uboot的开始地址。第二次重定位也称自举，形象的说就是把自己举高高。</li></ol><p>你可能存在疑问，为什么要两次重定位呢，直接第一次就复制到DDR的高地址不行吗？其实我也是这样想的，可能具体芯片其自己的考虑，一般来说是一次就重定位到DDR顶部的。</p>]]></content>
      
      
      <categories>
          
          <category> uboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> uboot spl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>代码重定位</title>
      <link href="/2023/02/23/%E4%BB%A3%E7%A0%81%E9%87%8D%E5%AE%9A%E4%BD%8D/"/>
      <url>/2023/02/23/%E4%BB%A3%E7%A0%81%E9%87%8D%E5%AE%9A%E4%BD%8D/</url>
      
        <content type="html"><![CDATA[<h1 id="1-重定位的引入"><a href="#1-重定位的引入" class="headerlink" title="1. 重定位的引入"></a>1. 重定位的引入</h1><p>S3C2440的CPU可以直接给片外SDRAM、4K的片内SRAM、Nor Flash、发送读写命令，但是不能直接给Nand Flash发送读写命令。假如把程序烧写到Nand Flash上，即向Nand Flash烧入bin文件，CPU是无法从Nand Flash中取代码执行的。</p><p>那为什还可以使用NAND启动?</p><ol><li>上电后，CPU检测到NAND启动，会自动把Nand Flash前4K内容复制到片内SRAM;</li><li>CPU从0地址运行SRAM;</li><li>如果程序大于4K，前4K的代码需要把整个程序读出来放到SDRAM(即代码重定位)；</li></ol><p>如果从Nor Flash启动，会出现什么问题?</p><ol><li>将拨动开关拨到Nor Flash启动时，此时CPU认为的0地址在Nor Flash上面，片内SRAM的基地址就变成了0x40000000(Nand启动时片内SRAM的基地址是0)。</li><li>Nor Flash可以像内存一样读，但不能和内存一样写，因此需要将全局变量和静态变量重定位到片外SDRAM中。局部变量不需要重定位，因为其保存在栈中。</li></ol><p>例如执行如下几条汇编指令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MOV R0, #0</span><br><span class="line">LDR R1, [R0] @读有效</span><br><span class="line">STR R1, [R0] @写无效</span><br></pre></td></tr></table></figure><p>当程序中含有需要写的全局变量或者静态变量时，假如是NAND Flash可以正常操作，因为此时其实是在片内SRAM中执行的，但如果是在Nor Flash则写无效，因此我们需要将全局变量和静态变量重定位到片外SDRAM中。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;s3c2440_soc.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;uart.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;init.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> g_Char = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> g_Char2 = <span class="string">&#x27;B&#x27;</span>;</span><br><span class="line"><span class="type">int</span> g_A = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> g_B;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">uart0_init();</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">putchar</span>(g_Char);    <span class="comment">//串口输出g_Char</span></span><br><span class="line">g_Char++;           <span class="comment">//Nor中g_Char++无效</span></span><br><span class="line">delay(<span class="number">1000000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>链接：arm-linux-ld -Ttext 0 -Tdata 0x800 start.o uart.o init.o main.o -o relocate.elf<br>烧写在NAND中启动显示ABCDE…。<br>烧写在Nor中启动显示AAA…，也即说明了Nor不能正常的写。</p><p>我们的bin文件大小是2049字节，也就是我们指定的-Tdata 0x800后只存放了char g_Char &#x3D; ‘A’ 这个变量，<br>其他的变量呢？查看反汇编文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Disassembly of section .data:</span><br><span class="line"></span><br><span class="line">00000800 &lt;__data_start&gt;:</span><br><span class="line"> 800:Address 0x800 is out of bounds.     //数据段开始，-Tdata 0x800指定</span><br><span class="line"></span><br><span class="line">Disassembly of section .rodata:</span><br><span class="line"></span><br><span class="line">00000474 &lt;g_Char2&gt;:                         //const放在只读数据段内</span><br><span class="line"> 474:Address 0x474 is out of bounds.</span><br><span class="line"></span><br><span class="line">Disassembly of section .bss:                //未初始化的和初值为0的变量都放在bss段，不保存在bin中</span><br><span class="line"></span><br><span class="line">00000804 &lt;g_A&gt;:</span><br><span class="line"> 804:00000000 andeqr0, r0, r0</span><br><span class="line"></span><br><span class="line">00000808 &lt;g_B&gt;:</span><br><span class="line"> 808:00000000 andeqr0, r0, r0</span><br><span class="line">Disassembly of section .comment:            //注释，调试信息等，不保存在bin中，会保存在elf中</span><br><span class="line"></span><br><span class="line">00000000 &lt;.comment&gt;:</span><br><span class="line">......</span><br></pre></td></tr></table></figure><h1 id="2-链接脚本的引入"><a href="#2-链接脚本的引入" class="headerlink" title="2. 链接脚本的引入"></a>2. 链接脚本的引入</h1><p>前面程序发现在Nor Flash启动和从Nand Flash启动的效果不同，这是为什么呢？</p><ol><li>假如现在是从Nor启动：</li></ol><p><img src="1_Nor%E5%90%AF%E5%8A%A8.png" alt="Nor启动"></p><p>Nor Flash就被认为是0地址，g_Char被放到0x800后面。CPU上电后开始从0地址运行，它能读取Nor上的代码执行（xip，execute in place），打印出A，但执行g_Char++的时候，写操作无效，所以下次打印出来还是A。</p><ol start="2"><li>假如现在是从Nand启动：</li></ol><p><img src="2_Nand%E5%90%AF%E5%8A%A8.png" alt="Nand启动"></p><p>上电后Nand Flash前4K的代码被自动的复制到片内SRAM，此时的0地址就是片内SRAM，CPU上电后开始从0地址运行，读取片内SRAM上的代码执行，所以g_Char++能够生效。</p><p>为了解决Nor Flash中变量不能修改的问题，可以将变量所在的.data段放在片外SDRAM中试试：<br>链接：arm-linux-ld -Ttext 0 -Tdata 0x30000000 start.o uart.o init.o main.o -o relocate.elf<br>编译出来的bin文件很大，因为从0地址到0x30000000之间有一大块空白区域在代码段和数据段之间，称为“黑洞”。</p><p><img src="3_%E9%BB%91%E6%B4%9E%E5%8C%BA.png" alt="黑洞区"></p><p>解决黑洞区有两个办法：这两个办法的区别一个只重定位了数据段，另一个重定位了整个程序；</p><p>第一个办法：</p><ol><li>把数据段和代码段靠在一起;</li><li>烧写到Nor上，运行时把数据段复制到片外SDRAM，即0x30000000（重定位）;</li></ol><p>第二个办法：</p><ol><li>让文件直接从0x30000000地址开始，全局变量在0x3…….;</li><li>烧写到Nor上，运行时把整个程序从0地址复制到片外SDRAM上，即0x30000000（重定位）；</li></ol><p>要实现两种办法需要引入链接脚本，先来看看链接脚本的语法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SECTIONS&#123;</span><br><span class="line">...</span><br><span class="line">secname start BLOCK(align) (NOLOAD) : AT(ldadr)</span><br><span class="line">&#123; contents &#125; &gt;region : phdr =fill</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line">解释：</span><br><span class="line">secname：段名</span><br><span class="line">start：起始地址，链接地址，运行时地址(runtime addr)，重定位地址(relocate addr)</span><br><span class="line">AT(ldadr)：加载地址(load addr)，省略时：load addr = runtime addr</span><br><span class="line">&#123; contents &#125;：这个段要放的内容</span><br><span class="line">&gt;region : phdr =fill：可以不写，我们用不上</span><br></pre></td></tr></table></figure><p><strong>我的理解：</strong></p><p>就嵌入式系统而言，程序通常编译和链接为在一个特定的内存地址运行——这通常是SDRAM的起始地址。这个地址就是链接地址，因为它被用于编译时解析程序内的地址。然后，这个程序的镜像（二进制文件）被烧录到了Flash存储器中的一个位置，这个位置被称为Flash的烧录地址，也就是加载地址。在系统上电启动时，引导加载器（Bootloader）会将程序从Flash复制到SDRAM中，这时它被复制到的是预先设置好的链接地址。</p><p>换句话说，链接地址是程序预计会运行的内存地址，加载地址是程序实际存储在非易失性存储介质上的地址。当系统启动时，Bootloader负责将程序从Flash（加载地址）复制到SDRAM的链接地址处。</p><p><strong>总结：</strong></p><p>链接地址：是程序在内存中预期运行的位置，也是链接器在生成可执行程序时使用的地址。</p><p>加载地址：在嵌入式环境中通常是指程序存储在非易失性存储（如Flash）中的地址。</p><p>启动时，Bootloader负责将程序从其在Flash中的存储位置（加载地址）复制到SDRAM的链接地址处开始执行。</p><h2 id="2-1-分体式链接脚本"><a href="#2-1-分体式链接脚本" class="headerlink" title="2.1 分体式链接脚本"></a>2.1 分体式链接脚本</h2><p>我们来实现第一种办法：让数据段放在0x800，运行时在0x30000000</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SECTIONS &#123;</span><br><span class="line">.text   0  : &#123; *(.text) &#125;//所有文件的.text</span><br><span class="line">.rodata  : &#123; *(.rodata) &#125;//所有文件的只读数据段</span><br><span class="line">.data 0x30000000 : AT(0x800) &#123; *(.data) &#125;//加载地址为0x800，链接地址为0x30000000</span><br><span class="line">.bss  : &#123; *(.bss) *(.COMMON) &#125;              //所有文件的bss段、common段</span><br><span class="line">&#125;</span><br><span class="line">//链接：arm-linux-ld -T relocate.lds start.o uart.o init.o main.o -o relocate.elf</span><br></pre></td></tr></table></figure><p>重新编译烧录程序发现打印乱码，这是因为我们会从链接地址0x30000000获取g_Char，但在这之前并没有在该地址处准备好数据，因此我们需要重定位数据段，将数据段的加载地址0x800处把数据移动到链接地址。在start.s中加入：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/* 重定位data段 */</span><br><span class="line">mov r1, #0x800</span><br><span class="line">ldr r0, [r1]</span><br><span class="line">mov r1, #0x30000000</span><br><span class="line">str r0, [r1]</span><br><span class="line"></span><br><span class="line">bl main</span><br></pre></td></tr></table></figure><p>这种写法不太通用，只能复制0x800处的一个数据，而且加载地址还需要自己确定，并且因为bin文件不保存bss段，所以我们的程序还需要将bss段清零。改进如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SECTIONS &#123;</span><br><span class="line">.text   0  : &#123; *(.text) &#125;            //所有文件的.text</span><br><span class="line">.rodata  : &#123; *(.rodata) &#125;            //所有文件的只读数据段</span><br><span class="line">.data 0x30000000 : AT(0x800) </span><br><span class="line">&#123; </span><br><span class="line">data_load_addr = LOADADDR(.data); //使用宏提取出加载地址</span><br><span class="line">data_start = . ;</span><br><span class="line">*(.data) </span><br><span class="line">data_end = . ;</span><br><span class="line">&#125;</span><br><span class="line">bss_start = .;</span><br><span class="line">.bss  : &#123; *(.bss) *(.COMMON) &#125;</span><br><span class="line">bss_end = .;</span><br><span class="line">&#125;</span><br><span class="line">//链接：arm-linux-ld -T relocate.lds start.o uart.o init.o main.o -o relocate.elf</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">/* 重定位data段 */</span><br><span class="line">ldr r1, =data_load_addr  /* data段在bin文件中的地址, 加载地址 */</span><br><span class="line">ldr r2, =data_start  /* data段在重定位地址, 运行时的地址 */</span><br><span class="line">ldr r3, =data_end      /* data段结束地址 */</span><br><span class="line"></span><br><span class="line">cpy:</span><br><span class="line">ldrb r4, [r1]</span><br><span class="line">strb r4, [r2]</span><br><span class="line">add r1, r1, #1</span><br><span class="line">add r2, r2, #1</span><br><span class="line">cmp r2, r3</span><br><span class="line">bne cpy</span><br><span class="line"></span><br><span class="line">/* 清除BSS段 */</span><br><span class="line">ldr r1, =bss_start</span><br><span class="line">ldr r2, =bss_end</span><br><span class="line">mov r3, #0</span><br><span class="line"></span><br><span class="line">clean:</span><br><span class="line">strb r3, [r1]</span><br><span class="line">add r1, r1, #1</span><br><span class="line">cmp r1, r2</span><br><span class="line">bne clean</span><br><span class="line"></span><br><span class="line">bl main</span><br></pre></td></tr></table></figure><h2 id="2-2-改进链接脚本"><a href="#2-2-改进链接脚本" class="headerlink" title="2.2 改进链接脚本"></a>2.2 改进链接脚本</h2><p>硬件的访问是很耗时的，2440的Nor Flash是16位，SDRAM是32位。假设现在需要重定位16Byte。</p><p>采用ldrb，strb命令每次只能读写1Byte数据：</p><ol><li>内存控制器收到ldrb命令后访问Nor，需要访问Nor硬件16次；</li><li>内存控制器收到str命令后访问SDRAM，需要访问SDRAM硬件16次；</li><li>复制16Byte一共访问了32次硬件；</li></ol><p>采用ldr，str命令一次能读写4Byte数据：</p><ol><li>内存控制器收到ldr命令后访问Nor，CPU发出4次ldr，需要访问Nor硬件8次；</li><li>内存控制器收到str命令后访问SDRAM，CPU发出4次str，需要访问SDRAM硬件4次；</li><li>复制16Byte一共访问了12次硬件；</li></ol><p>继续改进代码：此时要注意地址对齐，否则清除bss段时很可能会意外清除掉data段的数据，使用ALIGN对齐。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SECTIONS &#123;</span><br><span class="line">.text   0  : &#123; *(.text) &#125;</span><br><span class="line">.rodata  : &#123; *(.rodata) &#125;</span><br><span class="line">.data 0x30000000 : AT(0x800) </span><br><span class="line">&#123; </span><br><span class="line">data_load_addr = LOADADDR(.data);</span><br><span class="line">. = ALIGN(4);</span><br><span class="line">data_start = . ;</span><br><span class="line">*(.data) </span><br><span class="line">data_end = . ;</span><br><span class="line">&#125;</span><br><span class="line">. = ALIGN(4);</span><br><span class="line">bss_start = .;</span><br><span class="line">.bss  : &#123; *(.bss) *(.COMMON) &#125;</span><br><span class="line">bss_end = .;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">/* 重定位data段 */</span><br><span class="line">ldr r1, =data_load_addr  /* data段在bin文件中的地址, 加载地址 */</span><br><span class="line">ldr r2, =data_start  /* data段在重定位地址, 运行时的地址 */</span><br><span class="line">ldr r3, =data_end      /* data段结束地址 */</span><br><span class="line"></span><br><span class="line">cpy:</span><br><span class="line">ldr r4, [r1]</span><br><span class="line">str r4, [r2]</span><br><span class="line">add r1, r1, #4</span><br><span class="line">add r2, r2, #4</span><br><span class="line">cmp r2, r3</span><br><span class="line">ble cpy</span><br><span class="line"></span><br><span class="line">/* 清除BSS段 */</span><br><span class="line">ldr r1, =bss_start</span><br><span class="line">ldr r2, =bss_end</span><br><span class="line">mov r3, #0</span><br><span class="line"></span><br><span class="line">clean:</span><br><span class="line">str r3, [r1]</span><br><span class="line">add r1, r1, #4</span><br><span class="line">cmp r1, r2</span><br><span class="line">ble clean</span><br><span class="line"></span><br><span class="line">bl main</span><br></pre></td></tr></table></figure><h2 id="2-3-一体式链接脚本"><a href="#2-3-一体式链接脚本" class="headerlink" title="2.3 一体式链接脚本"></a>2.3 一体式链接脚本</h2><p>分体式链接脚本的代码段和数据段的链接地址是分开的，一体式链接脚本的代码段、数据段等都是连续在一起的，我们的嵌入式系统一般都采用一体式，原因如下：</p><ol><li>分体式链接脚本适合单片机，单片机自带有flash可以xip，不需要将代码复制到ram中。</li><li>单片机的ram资源很小，所以将代码复制到ram是很浪费的。</li><li>嵌入式系统ram很大，没必要节省这点空间，而且很多没有nor flash这种xip的flash；</li><li>所以嵌入式需要使用一体式将Nand Flash或SD卡中的程序全部复制到ram中执行。</li></ol><p>修改链接脚本和start.s如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">SECTIONS</span><br><span class="line">&#123;</span><br><span class="line">. = 0x30000000;</span><br><span class="line">. = ALIGN(4);</span><br><span class="line">.text      :</span><br><span class="line">&#123;</span><br><span class="line">*(.text)</span><br><span class="line">&#125;</span><br><span class="line">. = ALIGN(4);</span><br><span class="line">.rodata : &#123; *(.rodata) &#125;</span><br><span class="line">. = ALIGN(4);</span><br><span class="line">.data : &#123; *(.data) &#125;</span><br><span class="line">. = ALIGN(4);</span><br><span class="line">__bss_start = .;</span><br><span class="line">.bss : &#123; *(.bss) *(.COMMON) &#125;</span><br><span class="line">_end = .;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>AT(ldadr)：加载地址(load addr)，省略时：加载地址 &#x3D; 链接地址<br>按照这个理论，上面这个链接脚本生成的可执行文件加载地址为：0x30000000</p><p>烧录工具会读取ELF文件的程序头（Program Headers）部分，找到加载地址，指示烧录工具对应的段需要被烧录到什么地址中。2440设置为nor启动时，CPU的0地址就是nor flash的0地址，而加载地址：0x30000000这是外部sdram。</p><p><strong>疑问：</strong>烧录器看到加载地址是0x30000000，不就会将程序烧写到外部sdram了吗（也烧录不了，因为没有初始化），而我需要烧写到nor或者nand中!</p><p><strong>解答：</strong>我的理解是，韦东山做的那个2440的oflash烧录工具应该有他自己的一套烧录机制，即：他的烧录工具不是根据elf中的加载地址来烧录。比如烧录时要通过oflash选择烧录到nor还是nand，烧录到nand的哪个bank，以这样的方式设置了加载地址，烧录器再将代码烧录到对应地址去。</p><p>正规的链接脚本写法是rtthread的stm32 bsp：<a href="https://github.com/qingOOyuan/RTT_STM32_HAL_ZET6">https://github.com/qingOOyuan/RTT_STM32_HAL_ZET6</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">/* 重定位text, rodata, data段整个程序 */</span><br><span class="line"></span><br><span class="line">/* nor和nand的加载地址都是0，注意：是flash自身视角的0地址，而不是CPU视角的0地址，</span><br><span class="line">(虽然对于2440而言，nor启动时：CPU视角的0地址 = nor flash视角的0地址)。 */</span><br><span class="line">mov r1, #0</span><br><span class="line"></span><br><span class="line">/* 第1条指令运行时的地址 */</span><br><span class="line">ldr r2, =_start</span><br><span class="line"></span><br><span class="line">/* bss段的起始地址 */</span><br><span class="line">ldr r3, =__bss_start</span><br><span class="line"></span><br><span class="line">/* 此处只写了nor的重定位，nand不能像nor一样支持RAM般直接读取，需要操作nand控制器，</span><br><span class="line"> * 从nand flash的0地址处(加载地址)，开始读取内容，重定位到链接地址(运行时地址)。 */ </span><br><span class="line">cpy:                           </span><br><span class="line">ldr r4, [r1]</span><br><span class="line">str r4, [r2]</span><br><span class="line">add r1, r1, #4</span><br><span class="line">add r2, r2, #4</span><br><span class="line">cmp r2, r3</span><br><span class="line">ble cpy</span><br><span class="line"></span><br><span class="line">/* 清除BSS段 */</span><br><span class="line">ldr r1, =__bss_start</span><br><span class="line">ldr r2, =_end</span><br><span class="line">mov r3, #0</span><br><span class="line">clean:</span><br><span class="line">str r3, [r1]</span><br><span class="line">add r1, r1, #4</span><br><span class="line">cmp r1, r2</span><br><span class="line">ble clean</span><br><span class="line"></span><br><span class="line">//bl main      /* 使用BL命令相对跳转, 程序仍然在NOR/sram执行 */</span><br><span class="line">ldr pc, =main  /* 绝对跳转, 跳到SDRAM */</span><br></pre></td></tr></table></figure><p>最终整个代码的流程如下图所示：</p><p><img src="4_%E4%B8%80%E4%BD%93%E5%BC%8F%E9%93%BE%E6%8E%A5%E8%84%9A%E6%9C%AC%E9%87%8D%E5%AE%9A%E4%BD%8D%E5%9B%BE%E7%A4%BA.png" alt="一体式链接脚本重定位图示"></p><h1 id="3-位置无关码"><a href="#3-位置无关码" class="headerlink" title="3. 位置无关码"></a>3. 位置无关码</h1><p>为什么我们的链接地址再SDRAM中，在Nor Flash中的0地址还能够运行呢？这就要引入位置无关码，当我们访问全局变量或者函数指针等数据的时候访问的是其链接地址，但我们用bl等指令的时候，使用的是PC值+offset的方式访问的。也就与他的链接地址无关，所以我们重定位以及重定位之前的代码都需要用位置无关码来编写，查看反汇编文件：</p><p><img src="5_%E4%BD%8D%E7%BD%AE%E6%97%A0%E5%85%B3%E7%A0%81.png" alt="位置无关码反汇编"></p><p>尝试更改链接地址，bl处的机器码eb000106都是一样的，机器码一样，执行的内容肯定都是一样的。因此这里并不是跳转到显示的地址(链接地址)，而是跳转到: pc + offset，offset由链接器决定。<br>假设程序从0x30000000执行，当前指令地址：0x3000005c ，那么就是跳到0x30000478;<br>假设程序从0地址运行，当前指令地址：0x5c，那么就是跳到:0x00000478；<br>跳转到某个地址并不是由bl指令决定，是由当前pc值决定。反汇编显示该值只是为了方便读代码；</p><p>怎么写位置无关码</p><ol><li>使用相对跳转命令b或bl。</li><li>重定位之前不可以使用绝对地址，不可以访问全局变量、静态变量，也不可以访问有初始值的数组(数组的初始值放在.rodata里，使用绝对地址来访问)。</li><li>重定位之后，使用ldr pc, &#x3D;main，跳转到链接地址去运行。</li><li>前面的一体式重定位程序如果最后还是使用bl相对跳转到main，程序仍在Nor&#x2F;SRAM执行，要想main函数在SDRAM执行，需要使用绝对地址跳转。</li></ol><p>写位置无关码，其实就是不使用绝对地址，判断有没有使用绝对地址，最根本的办法就是查看反汇编。</p><h1 id="4-C语言实现重定位"><a href="#4-C语言实现重定位" class="headerlink" title="4. C语言实现重定位"></a>4. C语言实现重定位</h1><p>C函数实现和汇编实现最主要的区别就是链接脚本中变量值的获取，假设lds中有一个abc变量：</p><ol><li>汇编中访问链接脚本变量的值，直接使用abc即可；</li><li>C函数中首先声明该变量为外部变量，extern abc；</li><li>使用时要取地址，int *p &#x3D; &amp;abc，此时p的值即为lds中abc的值；</li></ol><p>为什么C函数要加&amp;？</p><ol><li>C函数定义一个int g_k，程序中必然有4字节来存放这个变量g_k;</li><li>如果lds中有非常多的变量，而我们的C程序只用到其中几个，所以完全没有必要存储lds里的变量，也就是C程序是不保存lds中的变量的；</li><li>在编译程序的时候有一个symbol符号表，保存g_k的地址和lds中变量的值；</li></ol><p><img src="6_symbol%E7%AC%A6%E5%8F%B7%E8%A1%A8.png" alt="符号表"></p><p>如何使用symbol符号表：</p><ol><li>对于常规的C程序中的变量地址，使用&amp;g_k获得；</li><li>为了保持代码一致，对于lds中的变量，如a2的值，也使用&amp;a2获得；</li></ol><p>结论：</p><ol><li>C程序不保存lds文件中的变量，所以lds再大也无所谓；</li><li>C程序使用symbol中lds变量的值，使用时加上&amp;，并且申明为外部变量，类型无所谓；</li></ol>]]></content>
      
      
      <categories>
          
          <category> Linux驱动 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux驱动 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>同步与互斥</title>
      <link href="/2023/02/20/%E5%90%8C%E6%AD%A5%E4%B8%8E%E4%BA%92%E6%96%A5/"/>
      <url>/2023/02/20/%E5%90%8C%E6%AD%A5%E4%B8%8E%E4%BA%92%E6%96%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="一、原子操作"><a href="#一、原子操作" class="headerlink" title="一、原子操作"></a>一、原子操作</h1><h2 id="1-1-产生起源"><a href="#1-1-产生起源" class="headerlink" title="1.1 产生起源"></a>1.1 产生起源</h2><p>我们的程序逻辑经常遇到这样的操作序列：</p><ol><li>读一个位于memory中的变量的值到寄存器中</li><li>修改该变量的值（也就是修改寄存器中的值）</li><li>将寄存器中的数值写回memory中的变量值</li></ol><p>如果这些操作是一个串行化的操作(在一个thread中串行执行)，那么一切是OK的，但是世界总不能如我们所愿，在现在的多CPU架构和支持抢占的内核系统中，总会出现各种奇怪的现象。比如要实现同一时刻只有一个进程打开驱动文件，可以想到用标志位来简单的互斥，但因为CPU的调度是随机的，就会有问题如下：</p><p><img src="0.%E7%AB%9E%E4%BA%89%E5%AE%9E%E4%BE%8B1.png" alt="0.竞争实例1"></p><p><img src="0.%E7%AB%9E%E4%BA%89%E5%AE%9E%E4%BE%8B2.png" alt="0.竞争实例2"></p><p><img src="0.%E7%AB%9E%E4%BA%89%E5%AE%9E%E4%BE%8B3.png" alt="0.竞争实例3"></p><p>所以处理器在访问共享资源时，必须对临界区进行同步，即保证同一时间内，只有一个对临界区的访问者。当共享资源为一内存地址时，原子操作是对该类型共享资源同步访问的最佳方式。随着应用的日益复杂和SMP的广泛使用，处理器都开始提供硬件同步原语以支持原子地更新内存地址。</p><p>从ARMv6架构开始，ARM处理器提供了Exclusive accesses同步原语，包含两条指令：LDREX和STREX，将对一个内存地址的操作拆分成两个步骤，同CPU内置的记录exclusive accesses的exclusive monitors一起，完成对内存的原子操作。</p><p>LDREX与LDR指令类似，完成将内存中的数据加载进寄存器的操作。与LDR指令不同的是，该指令也会同时初始化exclusive monitor来记录对该地址的同步访问。例如LDREX R1, [R0]会将R0寄存器中内存地址的数据，加载进R1中并更新exclusive monitor。</p><p>STREX的格式为：STREX Rd, Rm, [Rn]，STREX会根据exclusive monitor的指示决定是否将寄存器中的值写回内存中。如果exclusive monitor许可这次写入，则STREX会将寄存器Rm的值写回Rn所存储的内存地址中，并将Rd寄存器设置为0表示操作成功。如果exclusive monitor禁止这次写入，则STREX指令会将Rd寄存器的值设置为1表示操作失败并放弃这次写入。应用程序可以根据Rd中的值来判断写回是否成功。</p><h2 id="1-2-原子操作的实现原理与使用"><a href="#1-2-原子操作的实现原理与使用" class="headerlink" title="1.2 原子操作的实现原理与使用"></a>1.2 原子操作的实现原理与使用</h2><p>所谓“原子操作”就是这个操作不会被打断。Linux有2种原子操作：原子变量、原子位。原子变量类型如下，实际上就是一个结构体，特殊的地方在于它的操作函数，如下(下表中v都是atomic_t指针)：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line"><span class="type">int</span> counter;</span><br><span class="line">&#125; <span class="type">atomic_t</span>;</span><br><span class="line">函数名  作用</span><br><span class="line"><span class="type">atomic_read</span>(v)读出原子变量的值，即v-&gt;counter</span><br><span class="line"><span class="title function_">atomic_set</span><span class="params">(v,i)</span>设置原子变量的值，即v-&gt;counter = i</span><br><span class="line"><span class="title function_">atomic_inc</span><span class="params">(v)</span>v-&gt;counter++</span><br><span class="line"><span class="title function_">atomic_dec</span><span class="params">(v)</span>v-&gt;counter--</span><br><span class="line"><span class="title function_">atomic_add</span><span class="params">(i,v)</span>v-&gt;counter += i</span><br><span class="line"><span class="title function_">atomic_sub</span><span class="params">(i,v)</span>v-&gt;counter -= i</span><br><span class="line"><span class="title function_">atomic_inc_and_test</span><span class="params">(v)</span>先加1，再判断新值是否等于0；等于0的话，返回值为1</span><br><span class="line"><span class="title function_">atomic_dec_and_test</span><span class="params">(v)</span>先减1，再判断新值是否等于0；等于0的话，返回值为1</span><br></pre></td></tr></table></figure><h2 id="1-3-原子变量的内核实现"><a href="#1-3-原子变量的内核实现" class="headerlink" title="1.3 原子变量的内核实现"></a>1.3 原子变量的内核实现</h2><p>SMP就是Symmetric Multi-Processors，对称多处理器；UP即Uni-Processor，系统只有一个单核CPU。原子变量的API都在Linux内核文件arch\arm\include\asm\atomic.h中。</p><p>atomic_read，atomic_set这些操作都只需要一条汇编指令，所以它们本身就是不可打断的。问题在于atomic_inc这类操作，要读出、修改、写回。以atomic_inc为例，在atomic.h文件中，如下定义：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> atomic_inc(v)atomic_add(1, v)</span></span><br></pre></td></tr></table></figure><p>atomic_add又是怎样实现的呢？用这个宏：ATOMIC_OPS(add, +&#x3D;, add)，把这个宏展开：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> ATOMIC_OPS(op, c_op, asm_op)\</span></span><br><span class="line"><span class="meta">ATOMIC_OP(op, c_op, asm_op)\</span></span><br><span class="line"><span class="meta">ATOMIC_OP_RETURN(op, c_op, asm_op)\</span></span><br><span class="line"><span class="meta">ATOMIC_FETCH_OP(op, c_op, asm_op)</span></span><br></pre></td></tr></table></figure><p>从上面的宏可以知道，一个ATOMIC_OPS定义了3个函数。比如“ATOMIC_OPS(add, +&#x3D;, add)”就定义了这3个函数：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">atomic_add</span></span><br><span class="line">atomic_add_return</span><br><span class="line">atomic_atomic_fetch_add 或 atomic_fetch_add_relaxed</span><br></pre></td></tr></table></figure><p>我们以ATOMIC_OP(add, +&#x3D;, add)为例，看它是如何实现atomic_add函数的，对于UP系统、SMP系统，分别有不同的实现方法。</p><h3 id="1-3-1-ATOMIC-OP在UP系统中的实现"><a href="#1-3-1-ATOMIC-OP在UP系统中的实现" class="headerlink" title="1.3.1 ATOMIC_OP在UP系统中的实现"></a>1.3.1 ATOMIC_OP在UP系统中的实现</h3><p>对于ARMv6以下的CPU系统，不支持SMP。原子变量的操作简单粗暴：关中断，中断都关了，谁能来打断我？代码如下(arch\arm\include\asm\atomic.h)：</p><p><img src="1.%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C1..png" alt="1.原子操作1."></p><h3 id="1-3-2-ATOMIC-OP在SMP系统中的实现"><a href="#1-3-2-ATOMIC-OP在SMP系统中的实现" class="headerlink" title="1.3.2 ATOMIC_OP在SMP系统中的实现"></a>1.3.2 ATOMIC_OP在SMP系统中的实现</h3><p>对于ARMv6及以上的CPU，有一些特殊的汇编指令来实现原子操作，不再需要关中断，代码如下(arch\arm\include\asm\atomic.h)：</p><p><img src="1.%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C2.png" alt="1.原子操作2"></p><p>在ARMv6及以上的架构中，有ldrex、strex指令，ex表示exclude，意为独占地。这2条指令要配合使用，举例如下：</p><ol><li>读出：ldrex  r0, [r1]；读取r1所指内存的数据，存入r0，并且标记r1所指内存为“独占访问”。如果有其他程序再次执行“ldrex  r0, [r1]”，一样会成功，一样会标记r1所指内存为“独占访问”。</li><li>修改r0的值</li><li>写入：strex  r2, r0, [r1]；如果r1的“独占访问”标记还存在，则把r0的新值写入r1所指内存，并且清除“独占访问”的标记，把r2设为0表示成功。如果r1的“独占访问”标记不存在了，就不会更新内存，并且把r2设为1表示失败。</li></ol><p>假设这样的抢占场景：</p><ol><li>程序A在读出、修改某个变量时，被程序B抢占了；</li><li>程序B先完成了操作，程序B的strex操作会清除“独占访问”的标记；</li><li>轮到程序A执行剩下的写入操作时，它发现独占访问”标记不存在了，于是取消写入操作。这就避免了这样的事情发生：程序A、B同时修改这个变量，并且都自认为成功了。</li></ol><p>举个例子，比如atomic_dec，假设一开始变量值为1，程序A本想把值从1变为0；但是中途被程序B先把值从1变成0了；但是没关系，程序A里会再次读出新值、修改、写入，最终这个值被程序A从0改为-1。</p><p>在ARMv6及以上的架构中，原子操作不再需要关闭中断，关中断的花销太大了。并且关中断并不适合SMP多CPU系统，你关了CPU0的中断，CPU1也可能会来执行些操作啊。</p><p>在ARMv6及以上的架构中，原子操作的执行过程是可以被打断的，但是它的效果符合“原子”的定义：一个完整的“读、修改、写入”是原子的，不会被别的程序打断。它的思路很简单：如果被别的程序打断了，那就重来一遍“读、修改、写入”，最后总会成功的。</p><h3 id="1-3-3-原子变量使用案例"><a href="#1-3-3-原子变量使用案例" class="headerlink" title="1.3.3 原子变量使用案例"></a>1.3.3 原子变量使用案例</h3><p>使用原子变量实现：只能有一个APP访问驱动程序。代码如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">atomic_t</span> valid = ATOMIC_INIT(<span class="number">1</span>);</span><br><span class="line"><span class="type">static</span> <span class="type">ssize_t</span> <span class="title function_">gpio_key_drv_open</span> <span class="params">(<span class="keyword">struct</span> inode *node, <span class="keyword">struct</span> file *file)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (atomic_dec_and_test(&amp;valid))</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">atomic_inc</span>(&amp;valid);</span><br><span class="line">    <span class="keyword">return</span> -EBUSY;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">gpio_key_drv_close</span> <span class="params">(<span class="keyword">struct</span> inode *node, <span class="keyword">struct</span> file *file)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">atomic_inc</span>(&amp;valid);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="1.%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C3.png" alt="1.原子操作3"></p><h2 id="1-4-原子位的内核实现"><a href="#1-4-原子位的内核实现" class="headerlink" title="1.4 原子位的内核实现"></a>1.4 原子位的内核实现</h2><p>在ARMv6以下的架构里，不支持SMP系统，原子位的操作函数也是简单粗暴：关中断。以set_bit函数为例，代码在内核文件arch\arm\include\asm\bitops.h中，如下：</p><p><img src="1.%E5%8E%9F%E5%AD%90%E4%BD%8D%E6%93%8D%E4%BD%9C4.png" alt="1.原子位操作4"></p><p>在ARMv6及以上的架构中，不需要关中断，有ldrex、strex等指令，这些指令的作用在前面介绍过，还是以set_bit函数为例，代码如下：</p><p><img src="1.%E5%8E%9F%E5%AD%90%E4%BD%8D%E6%93%8D%E4%BD%9C5.png" alt="1.原子位操作5"></p><h1 id="二、Linux锁的介绍与使用"><a href="#二、Linux锁的介绍与使用" class="headerlink" title="二、Linux锁的介绍与使用"></a>二、Linux锁的介绍与使用</h1><h2 id="2-1-自旋锁"><a href="#2-1-自旋锁" class="headerlink" title="2.1 自旋锁"></a>2.1 自旋锁</h2><p>Linux内核中最常见的锁是自旋锁，自旋锁最多只能被一个可执行线程持有。如果一个线程试图获取一个已被持有的自旋锁，这个线程会进行忙循环——旋转等待锁重新可用，要是锁未被争用，请求锁的执行线程会立马得到它，继续执行。</p><ol><li>持有自旋锁时会关闭内核抢占，他内部会调用调用“preempt_disable()”，防止当前CPU的其他进程抢占当前持有锁的进程，然后又去获取自旋锁导致死锁。</li><li>持有自旋锁时不能睡眠，不然会有死锁风险，由于不睡眠，可以在中断上下文中使用。</li><li>自旋锁最初的设计就是为了SMP系统设计，实现多处理器情况下保护临界区。如果UP不支持抢占，spin_lock是空函数，若UP支持抢占，这时spin_lock的实现就是调用“preempt_disable()”。即：单核没有“取锁动作”，只有多核时自旋锁才存在“取锁动作”</li></ol><p>自旋锁最应该防止的就是死锁，不同情况下可能需要禁止本地中断，或者禁止本地下半部：</p><p><img src="2.%E9%94%81%E7%9A%84%E4%BB%8B%E7%BB%8D1.png" alt="2.锁的介绍1"></p><p>举例介绍一下，上表中第一列“IRQ Handler A”和第三行“Softirq A”的交叉点是“spin_lock_irq()”，意思就是说如果“IRQ Handler A”和“Softirq A”要竞争临界资源，那么需要使用“spin_lock_irq()”函数。为什么不能用spin_lock而要用spin_lock_irq？也就是为什么要把中断给关掉？假设在Softirq A中获得了临界资源，这时发生了IRQ A中断，IRQ Handler A去尝试获得自旋锁，这就会导致死锁：所以需要关中断。</p><p>我的总结是：锁是用来防SMP，禁止中断和下部是防止本地死锁。注意，需要禁止的只是当前处理器上的中断和下半部，如果中断和下半部发生在不同的处理器上，即使在同一把锁上自旋，让它等待当前处理器释放锁即可，不会导致死锁。</p><h2 id="2-2-信号量"><a href="#2-2-信号量" class="headerlink" title="2.2 信号量"></a>2.2 信号量</h2><p>Linux中的信号量是一种睡眠锁，如果一个任务试图获得一个不可用（已经被占用）的信号量时，信号量会将其推进一个等待队列，然后让其睡眠。这是处理器能重获自由，从而去执行其他代码。当持有的信号量可用（被释放）后，处于等待队列中的那个任务将被唤醒，并获得信号量。</p><ol><li>信号量适用于锁会被长时间持有的情况。因为睡眠和维护等待队列以及唤醒有一定的开销。</li><li>占用信号量的同时不能占用自旋锁，因为在等待信号量时可能会睡眠。</li><li>信号量不会禁止内核抢占，所有持有信号量的代码可以被抢占。</li><li>信号量可以允许任意数量的锁持有者，而自旋锁和互斥体一个时刻只允许一个任务持有。</li></ol><h2 id="2-3-互斥体"><a href="#2-3-互斥体" class="headerlink" title="2.3 互斥体"></a>2.3 互斥体</h2><p>mutex的使用场景相对而言更严格，它是计数为1的信号量（有区别），注意事项如下：</p><ol><li>同一时刻只有一个线程可以持有mutex，当进程持有mutex时，进程不可以退出（有争议）。</li><li>只有锁持有者可以解锁，不能在一个进程中持有mutex，在另外一个进程中释放。</li><li>不允许递归地加锁和解锁，不允许在中断处理程序或者中断下半部中使用</li></ol><h2 id="2-4-选择合适的锁"><a href="#2-4-选择合适的锁" class="headerlink" title="2.4 选择合适的锁"></a>2.4 选择合适的锁</h2><ol><li>低开销、短期锁定优先使用自旋锁。</li><li>中断上下文中只能使用自旋锁。</li><li>长期加锁使用信号量，优先使用互斥体。</li><li>持有锁需要睡眠，优先使用互斥体。</li><li>信号量和互斥体：除非互斥体的某个约束妨碍你的使用，否则优先使用mutex。</li></ol><h1 id="三、内核中锁的实现"><a href="#三、内核中锁的实现" class="headerlink" title="三、内核中锁的实现"></a>三、内核中锁的实现</h1><h2 id="3-1-spinlock在UP系统中的实现"><a href="#3-1-spinlock在UP系统中的实现" class="headerlink" title="3.1 spinlock在UP系统中的实现"></a>3.1 spinlock在UP系统中的实现</h2><p>对于单CPU系统，没有“其他CPU”；如果内核不支持preempt，当前在内核态执行的线程也不可能被其他线程抢占，也就“没有其他进程&#x2F;线程”。所以，对于不支持preempt的单CPU系统，spin_lock是空函数，不需要做其他事情。</p><p>如果单CPU系统的内核支持preempt，即当前线程正在执行内核态函数时，它是有可能被别的线程抢占的。这时spin_lock的实现就是调用“preempt_disable()”：你想抢我，我干脆禁止你运行。</p><p>在UP系统中spin_lock()退化为preempt_disable()，如果用的内核不支持preempt，则spin_lock()什么事都不用做，spin_lock函数定义如下：</p><p><img src="3.%E5%86%85%E6%A0%B8%E4%B8%AD%E9%94%81%E7%9A%84%E5%AE%9E%E7%8E%B01.png" alt="3.内核中锁的实现1"></p><p>对于spin_lock_irq()，在UP系统中就退化为local_irq_disable()和preempt_disable()，假设程序A要访问临界资源，可能会有中断也来访问临界资源，可能会有程序B也来访问临界资源，那么使用spin_lock_irq()来保护临界资源：先禁止中断防止中断来抢，再禁止preempt防止其他进程来抢。如下图所示：</p><p><img src="3.%E5%86%85%E6%A0%B8%E4%B8%AD%E9%94%81%E7%9A%84%E5%AE%9E%E7%8E%B02.png" alt="3.内核中锁的实现2"></p><p>对于spin_lock_bh()，在UP系统中就退化为禁止软中断和preempt_disable()，如下图所示：</p><p><img src="3.%E5%86%85%E6%A0%B8%E4%B8%AD%E9%94%81%E7%9A%84%E5%AE%9E%E7%8E%B03.png" alt="3.内核中锁的实现3"></p><h2 id="3-2-spinlock在SMP系统中的实现"><a href="#3-2-spinlock在SMP系统中的实现" class="headerlink" title="3.2 spinlock在SMP系统中的实现"></a>3.2 spinlock在SMP系统中的实现</h2><p>要让多CPU中只能有一个获得临界资源，使用原子变量就可以实现。但是还要保证公平，先到先得。比如有CPU0、CPU1、CPU2都调用spin_lock想获得临界资源，谁先申请谁先获得。</p><p>举个例子：餐厅里只有一个座位，去吃饭的人都得先取号、等叫号。注意，有2个动作：顾客从取号机取号，电子叫号牌叫号。</p><ol><li>一开始取号机待取号码为0。</li><li>顾客A从取号机得到号码0，电子叫号牌显示0，顾客A上座；取号机显示下一个待取号码为1。</li><li>顾客B从取号机得到号码1，电子叫号牌还显示为0，顾客B等待；取号机显示下一个待取号码为2。</li><li>顾客C从取号机得到号码2，电子叫号牌还显示为0，顾客C等待；取号机显示下一个待取号码为3。</li><li>顾客A吃完离座，电子叫号牌显示为1，顾客B的号码等于1，他上座；</li><li>顾客B吃完离座，电子叫号牌显示为2，顾客C的号码等于2，他上座；</li></ol><p>在这个例子中有2个号码：取号机显示的“下一个号码”，顾客取号后它会自动加1；电子叫号牌显示“当前号码”，顾客离座后它会自动加1。某个客户手上拿到的号码等于电子叫号牌的号码时，该客户上座。在这个过程中，即使顾客B、C同时到店，只要保证他们从取号机上得到的号码不同，他们就不会打架。</p><p>所以，关键点在于：取号机的号码发放，必须互斥，保证客户的号码互不相同。而电子叫号牌上号码的变动不需要保护，只有顾客离开后它才会变化，没人争抢它。</p><p>在ARMv6及以上的ARM架构中支持SMP系统。它的spinlock结构体定义如下：</p><p><img src="3.%E5%86%85%E6%A0%B8%E4%B8%AD%E9%94%81%E7%9A%84%E5%AE%9E%E7%8E%B04.png" alt="3.内核中锁的实现4"></p><p>__raw_tickets结构体中有owner、next两个成员，这是在SMP系统中实现spinlock的关键。owner就相当于电子叫号牌，现在谁在吃饭。next就当于于取号机，下一个号码是什么。从取号机上取到的号码保存在spin_lock函数中的局部变量里。</p><p>spin_lock函数调用关系如下，核心是arch_spin_lock：</p><p><img src="3.%E5%86%85%E6%A0%B8%E4%B8%AD%E9%94%81%E7%9A%84%E5%AE%9E%E7%8E%B05.png" alt="3.内核中锁的实现5"></p><p>arch_spin_lock代码如下：即使不同的个体去同时取号，也可以保证取到的号码各不相同。</p><p><img src="3.%E5%86%85%E6%A0%B8%E4%B8%AD%E9%94%81%E7%9A%84%E5%AE%9E%E7%8E%B06.png" alt="3.内核中锁的实现6"></p><p>假设第1个程序取到了号码，它访问了临界资源后，调用spin_unlock，代码如下：</p><p><img src="3.%E5%86%85%E6%A0%B8%E4%B8%AD%E9%94%81%E7%9A%84%E5%AE%9E%E7%8E%B07.png" alt="3.内核中锁的实现7"></p><p>释放锁后，假如有其他程序正在spin_lock函数中循环等待，它就会立刻判断自己手上的next是否等于lock-&gt;tickets.owner，如果相等就表示轮到它获得了锁。</p><h2 id="3-3-信号量semaphore的实现"><a href="#3-3-信号量semaphore的实现" class="headerlink" title="3.3 信号量semaphore的实现"></a>3.3 信号量semaphore的实现</h2><p>信号量的定义及操作函数都在Linux内核文件include\linux\semaphore.h中定义，如下：</p><p><img src="3.%E5%86%85%E6%A0%B8%E4%B8%AD%E9%94%81%E7%9A%84%E5%AE%9E%E7%8E%B08.png" alt="3.内核中锁的实现8"></p><p>初始化semaphore之后，就可以使用down函数或其他衍生版本来获取信号量，使用up函数释放信号量。</p><h3 id="3-3-1-down函数的实现"><a href="#3-3-1-down函数的实现" class="headerlink" title="3.3.1 down函数的实现"></a>3.3.1 down函数的实现</h3><p>如果semaphore中的count大于0，那么down函数就可以获得信号量；否则就休眠。在读取、修改count时，要使用spinlock来实现互斥。休眠时，要把当前进程放在semaphore的wait_list链表中，别的进程释放信号量时去wait_list中把进程取出、唤醒。</p><p><img src="3.%E5%86%85%E6%A0%B8%E4%B8%AD%E9%94%81%E7%9A%84%E5%AE%9E%E7%8E%B09.png" alt="3.内核中锁的实现9"></p><h3 id="3-3-2-up函数的实现"><a href="#3-3-2-up函数的实现" class="headerlink" title="3.3.2 up函数的实现"></a>3.3.2 up函数的实现</h3><p>如果有其他进程在等待信号量，则count值无需调整，直接取出第1个等待信号量的进程，把信号量给它，然后把它唤醒。如果没有其他进程在等待信号量，则调整count。整个过程需要使用spinlock来保护，代码如下：</p><p><img src="3.%E5%86%85%E6%A0%B8%E4%B8%AD%E9%94%81%E7%9A%84%E5%AE%9E%E7%8E%B010.png" alt="3.内核中锁的实现10"></p><h2 id="3-4-互斥量mutex的实现"><a href="#3-4-互斥量mutex的实现" class="headerlink" title="3.4 互斥量mutex的实现"></a>3.4 互斥量mutex的实现</h2><p>mutex的定义及操作函数都在Linux内核文件include\linux\mutex.h中定义，如下：</p><p><img src="3.%E5%86%85%E6%A0%B8%E4%B8%AD%E9%94%81%E7%9A%84%E5%AE%9E%E7%8E%B011.png" alt="3.内核中锁的实现11"></p><p>这里要注意一下：《linux内核设计与实现》说mutex中的owner是用来记录获得mutex的进程，以后必须由它来释放mutex。但是从上面的代码可知，owner并不一定存在！应该是内核版本不同，书中的版本是2.6，此处的版本是4.x。</p><p>owner有2个用途：debug(CONFIG_DEBUG_MUTEXES)或spin_on_owner(CONFIG_MUTEX_SPIN_ON_OWNER)。</p><p>什么叫spin on owner？我们使用mutex的目的一般是用来保护一小段代码，这段代码运行的时间很快。这意味着一个获得mutex的进程，可能很快就会释放mutex。针对这点可以进行优化，特别是当前获得mutex的进程是在别的CPU上运行、并且“我”是唯一等待这个mutex的进程。在这种情况下，那“我”就原地spin等待吧：懒得去休眠了，休眠又唤醒就太慢了。</p><p>所以，mutex是做了特殊的优化，比semaphore效率更高。但是在代码上，并没有要求“谁获得mutex，就必须由谁释放mutex”，只是在使用惯例上是“谁获得mutex，就必须由谁释放mutex”。</p><h3 id="3-4-1-mutex-lock函数的实现"><a href="#3-4-1-mutex-lock函数的实现" class="headerlink" title="3.4.1 mutex_lock函数的实现"></a>3.4.1 mutex_lock函数的实现</h3><p>mutex的设计非常精巧，比semaphore复杂，但是更高效。首先要知道mutex的操作函数中有fastpath、slowpath两条路径(快速、慢速)：如果fastpath成功，就不必使用slowpath。</p><p>比较复杂，未完待续……</p>]]></content>
      
      
      <categories>
          
          <category> Linux驱动 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux驱动 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux卡片电脑</title>
      <link href="/2022/12/20/Linux%E5%8D%A1%E7%89%87%E7%94%B5%E8%84%91/"/>
      <url>/2022/12/20/Linux%E5%8D%A1%E7%89%87%E7%94%B5%E8%84%91/</url>
      
        <content type="html"><![CDATA[<h1 id="一、Hardware"><a href="#一、Hardware" class="headerlink" title="一、Hardware"></a>一、Hardware</h1><h2 id="1-1-整体框图"><a href="#1-1-整体框图" class="headerlink" title="1.1 整体框图"></a>1.1 整体框图</h2><ol><li>Top1层</li></ol><p><img src="Top1.png" alt="Top1"></p><ol start="2"><li>Gnd2层</li></ol><p><img src="GND2.png" alt="GND2"></p><ol start="3"><li>Sig3层</li></ol><p><img src="SIG3.png" alt="SIG3"></p><ol start="4"><li>Sig4层</li></ol><p><img src="SIG4.png" alt="SIG4"></p><ol start="5"><li>Power5层</li></ol><p><img src="POWER5.png" alt="POWER5"></p><ol start="6"><li>Bottom6层</li></ol><p><img src="Bottom6.png" alt="Bottom6"></p><ol start="7"><li>3D视图</li></ol><p><img src="Linux%E5%8D%A1%E7%89%87%E7%94%B5%E8%84%911.png" alt="Linux卡片电脑1"></p><p><img src="Linux%E5%8D%A1%E7%89%87%E7%94%B5%E8%84%912.png" alt="Linux卡片电脑2"></p><h2 id="1-2-阻抗匹配"><a href="#1-2-阻抗匹配" class="headerlink" title="1.2 阻抗匹配"></a>1.2 阻抗匹配</h2><p><img src="%E9%98%BB%E6%8A%97%E5%8C%B9%E9%85%8D1.jpg" alt="阻抗匹配1"></p><p><img src="%E9%98%BB%E6%8A%97%E5%8C%B9%E9%85%8D2.jpg" alt="阻抗匹配2"></p><p><img src="%E9%98%BB%E6%8A%97%E5%8C%B9%E9%85%8D3.png" alt="阻抗匹配3"></p><h2 id="1-3-手工焊接"><a href="#1-3-手工焊接" class="headerlink" title="1.3 手工焊接"></a>1.3 手工焊接</h2><p><img src="%E6%89%8B%E5%B7%A5%E7%84%8A%E6%8E%A51.jpg" alt="手工焊接1"></p><p><img src="%E6%89%8B%E5%B7%A5%E7%84%8A%E6%8E%A52.jpg" alt="手工焊接2"></p><p><img src="%E6%89%8B%E5%B7%A5%E7%84%8A%E6%8E%A53.jpg" alt="手工焊接3"></p><h2 id="1-4-DDR3位宽说明"><a href="#1-4-DDR3位宽说明" class="headerlink" title="1.4 DDR3位宽说明"></a>1.4 DDR3位宽说明</h2><p>K4B4G1646B 4Gbit 256M x 16bit内存芯片，A0~A14用做行地址，A0~A9用做列地址，这款芯片同时含有B0~B2用来选择bank。bank address有三个bit，所以单个16bit DDR3内部有8个bank。</p><ol><li>表示行的有A0~A14，共15个bit，说明一个bank中有2^15个行。</li><li>表示列的有A0~A9， 共10个bit，说明一个bank中有2^10个列。</li><li>所以单块16bit DDR3可以寻址2^3<em>2^15</em>2^10&#x3D;2^28&#x3D;256M个地址。</li><li>我们的位宽是16bit，也即访问一个地址，内存认为是访问16bit的数据，所以单个内存颗粒的容量为512M Bytes</li></ol><p>我们的H3用两片16bit的K4B4G1646B拼成了一个32bit位宽、总容量为1G Bytes的内存：</p><ol><li>第一片16bit DDR3的BA0, BA1, BA2连接到了CPU的BA0, BA1, BA2。</li><li>第二片16bit DDR3的BA0, BA1, BA2也连接到了CPU的BA0, BA1, BA2。</li><li>第一片16bit DDR3的A0~A14连接到了CPU的A0~A14。</li><li>第二片16bit DDR3的A0~A14连接到了CPU的A0~A14。</li><li>第一片16bit DDR3的D0~D15连接到了CPU的D0~D15。</li><li>第二片16bit DDR3的D0~D15连接到了CPU的D16~D31。</li></ol><p></p><p>再来看看两个16bit是如何组成一个32bit的。这儿所说的两个16bit组成一个32bit，指的是数据位宽，与地址没有关系。</p><p>每一块16bit DDR3中有8个bank，2^15个row，2^10个column。也就是有256M个地址。看前面的连线可知，两块16bit DDR3的BA0<del>BA2和A0\</del>A14其实是并联连接到CPU，也就是说，CPU其实认为只有一块内存，访问的时候按照BA0~BA2和A0~A14给出地址。</p><p>CPU发出地址，两块16bit DDR3都收到了该地址。要么将给定地址上2个字节送到数据线上，要么是将数据线上的两个字节写入到指定的地址。</p><p>再看数据线的连接，第一片的D0~D15连接到了CPU的D0~D15，第二片的D0~D15连接到了CPU的D16~D31。CPU认为自己访问的是一块32bit的内存，所以CPU每给出一个地址，将访问4个字节的数据，读取&#x2F;写入。这4字节数据对应到CPU的D0~D31，又分别被连接到两片内存的D0~D15，这样一个32bit就被拆成了两个16bit，也就是两个16bit组成了一个32bit。</p><p>CPU可访问的内存地址有256M个，每访问一个地址，将访问4个字节，这样CPU能访问的内存即为256M x 32bit &#x3D; 1G Bytes</p><p>原理图可以看到我们的CPU的A15接到了K4B4G1646B的M7，但实际上M7是NC，我们A15接上去是为了兼容大容量的有A15地址线的ddr3，同时ddr3的ODT1，CS1#，CKE1，ZQ1都不接，我们的K4B4G1646B对应的引脚J1 L1 J9 L9都是NC，方便布线就不接了，其他的ddr3有些用到了这几个引脚，也即他们不是NC，所以省略不接的缺陷就是不能兼容其他的ddr3，我们这里就用K4B4G1646B颗粒，不接没事。</p><h1 id="二、系统移植"><a href="#二、系统移植" class="headerlink" title="二、系统移植"></a>二、系统移植</h1><h2 id="2-1-安装交叉编译器"><a href="#2-1-安装交叉编译器" class="headerlink" title="2.1 安装交叉编译器"></a>2.1 安装交叉编译器</h2><p>①下载交叉编译器arm-cortexa9-linux-gnueabihf-4.9.3.tar.xz，然后解压编译器:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/YuanPi-Plus/toolchain</span><br><span class="line">tar xf arm-cortexa9-linux-gnueabihf-4.9.3.tar.xz -C /opt/FriendlyARM/toolchain/</span><br></pre></td></tr></table></figure><p>②将编译器的路径加入到PATH中，vi ~&#x2F;.bashrc，在末尾加入以下内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export PATH=/opt/FriendlyARM/toolchain/4.9.3/bin:$PATH</span><br><span class="line">export GCC_COLORS=auto</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行一下~/.bashrc脚本，让设置立即在当前shell窗口中生效，注意<span class="string">&quot;.&quot;</span>后面有个空格：. ~/.bashrc</span></span><br></pre></td></tr></table></figure><p>③这个编译器是64位的，不能在32位的Linux系统上运行，安装完成后，验证是否安装成功：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arm-linux-gcc -v</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示出gcc version 4.9.3 (ctng-1.21.0-229g-FA)即成功了</span></span><br></pre></td></tr></table></figure><h2 id="2-2-编译适配U-boot"><a href="#2-2-编译适配U-boot" class="headerlink" title="2.2 编译适配U-boot"></a>2.2 编译适配U-boot</h2><p>①下载U-boot源码，并切换分支：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/friendlyarm/u-boot.git -b sunxi-v2017.x --depth 1</span><br></pre></td></tr></table></figure><p>②安装Python库：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install swig python-dev python3-dev</span><br></pre></td></tr></table></figure><p>③使用nanopi_h3_defconfig配置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改DDR3频率为768M，经过测试我的硬件最大支持这个频率</span></span><br><span class="line">vim configs/nanopi_h3_defconfig</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将 CONFIG_DRAM_CLK=408 修改为 CONFIG_DRAM_CLK=768</span></span><br><span class="line">make nanopi_h3_defconfig ARCH=arm CROSS_COMPILE=arm-linux-</span><br></pre></td></tr></table></figure><p>④编译U-boot：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make ARCH=arm CROSS_COMPILE=arm-linux- -j12</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译成功后会生成文件u-boot-sunxi-with-spl.bin</span></span><br></pre></td></tr></table></figure><p>⑤更新SD上的U-boot：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dd if=u-boot-sunxi-with-spl.bin of=/dev/sdX bs=1024 seek=8</span><br><span class="line">sync &amp;&amp; eject /dev/sdX</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/dev/sdX替换为实际的TF卡设备文件名。</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">sync</span>命令可以确保数据成功写到TF卡中，eject命令用于弹出TF卡。</span></span><br></pre></td></tr></table></figure><p>⑥SD卡运行系统时，可以先用scp命令拷贝u-boot-sunxi-with-spl.bin到开发板上，然后用dd命令更新SD卡上的U-boot:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">scp u-boot-sunxi-with-spl.bin root@192.168.31.134:/root/</span><br><span class="line">dd if=/root/u-boot-sunxi-with-spl.bin of=/dev/mmcblk0 bs=1024 seek=8</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">root@后面替换成板子上的IP地址，EMMC也可以用此方法</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">H3的启动设备的设备节点总是/dev/mmcblk0</span></span><br></pre></td></tr></table></figure><p>⑦成功效果如下：</p><p><img src="2.%E8%BD%AF%E4%BB%B6%E9%80%82%E9%85%8D1.png" alt="2.软件适配1"></p><h2 id="2-3-编译适配Linux内核"><a href="#2-3-编译适配Linux内核" class="headerlink" title="2.3 编译适配Linux内核"></a>2.3 编译适配Linux内核</h2><p>①下载Linux内核源码，并切换分支：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/friendlyarm/linux.git -b sunxi-4.14.y --depth 1</span><br></pre></td></tr></table></figure><p>②默认配置先跑起来：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">apt-get install u-boot-tools</span><br><span class="line">touch .scmversion</span><br><span class="line">make sunxi_defconfig ARCH=arm CROSS_COMPILE=arm-linux-</span><br><span class="line">make zImage dtbs ARCH=arm CROSS_COMPILE=arm-linux-</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编译完成后会在<span class="built_in">arch</span>/arm/boot/目录下生成zImage，在<span class="built_in">arch</span>/arm/boot/dts/目录下生成dtb文件</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">当完成某任务后，可以保存当前的配置：</span></span><br><span class="line">make savedefconfig ARCH=arm CROSS_COMPILE=arm-linux-</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">目前我已将最新的配置文件保存在：</span></span><br><span class="line">arch/arm/configs/YuanPi-plus-defconfig</span><br></pre></td></tr></table></figure><p>③更新SD上的zImage和dtb文件：假设SD卡的boot分区挂载在&#x2F;media&#x2F;SD&#x2F;boot&#x2F;</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cp arch/arm/boot/zImage /media/SD/boot/</span><br><span class="line">cp arch/arm/boot/dts/sun8i-*-nanopi-*.dtb /media/SD/boot/</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">也可以用scp命令通过网络更新：</span></span><br><span class="line">scp arch/arm/boot/zImage root@192.168.31.134:/boot</span><br><span class="line">scp arch/arm/boot/dts/sun8i-*-nanopi-*.dtb root@192.168.31.134:/boot</span><br></pre></td></tr></table></figure><p>④bootargs与bootcmd：全志H3使用boot.cmd生成boot.scr来描述配置，boot.cmd：</p><p><img src="2.%E8%BD%AF%E4%BB%B6%E9%80%82%E9%85%8D2.png" alt="2.软件适配2"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Recompile with: mkimage -C none -A arm -T script -d boot.cmd boot.scr CPU=H3</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">OS=friendlycore/ubuntu-oled/ubuntu-wifiap/openwrt/debian/debian-nas...</span></span><br><span class="line"> </span><br><span class="line"> echo &quot;running boot.scr&quot;</span><br><span class="line"> setenv fsck.repair yes</span><br><span class="line"> setenv ramdisk rootfs.cpio.gz</span><br><span class="line"> setenv kernel zImage</span><br><span class="line"> </span><br><span class="line"> setenv env_addr 0x43000000</span><br><span class="line"> setenv kernel_addr 0x46000000</span><br><span class="line"> setenv ramdisk_addr 0x47000000</span><br><span class="line"> setenv dtb_addr 0x48000000</span><br><span class="line"> </span><br><span class="line"> fatload mmc 0 $&#123;kernel_addr&#125; $&#123;kernel&#125;</span><br><span class="line"> fatload mmc 0 $&#123;ramdisk_addr&#125; $&#123;ramdisk&#125;</span><br><span class="line"> setenv ramdisk_size $&#123;filesize&#125;</span><br><span class="line"> </span><br><span class="line"> fatload mmc 0 $&#123;dtb_addr&#125; sun8i-h3-YuanPi-plus.dtb</span><br><span class="line"> fdt addr $&#123;dtb_addr&#125;</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash">setup MAC address</span></span><br><span class="line"> fdt set ethernet0 local-mac-address $&#123;mac_node&#125;</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash">setup boot_device</span></span><br><span class="line"> fdt set mmc0 boot_device &lt;1&gt;</span><br><span class="line"> </span><br><span class="line"> setenv fbcon map:1</span><br><span class="line"> </span><br><span class="line"> setenv overlayfs data=/dev/mmcblk0p3</span><br><span class="line"><span class="meta prompt_"> #</span><span class="language-bash">setenv hdmi_res drm_kms_helper.edid_firmware=HDMI-A-1:edid/1280x720.bin video=HDMI-A-1:1280x720@60</span></span><br><span class="line"> </span><br><span class="line"> setenv bootargs console=tty1 console=ttyS0,115200 earlyprintk root=/dev/mmcblk0p2 rootfstype=ext4 rw rootwait fsck.repair=$&#123;fsck.repair&#125; panic=10 $&#123;extra&#125; fbcon=$&#123;fbcon&#125; $&#123;hdmi_res&#125; $&#123;overlayfs&#125;</span><br><span class="line"> bootz $&#123;kernel_addr&#125; $&#123;ramdisk_addr&#125;:$&#123;ramdisk_size&#125; $&#123;dtb_addr&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>boot.cmd –&gt; boot.scr：将boot.scr也放入SD卡的&#x2F;boot中即可</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkimage -C none -A arm -T script -d boot.cmd boot.scr CPU=H3</span><br></pre></td></tr></table></figure><h2 id="2-4-文件系统"><a href="#2-4-文件系统" class="headerlink" title="2.4 文件系统"></a>2.4 文件系统</h2><p>①文件系统解压到SD卡：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -xvf rootfs.tar -C /media/qing/rootfs/  </span><br></pre></td></tr></table></figure><p>②编译和更新驱动模块：更新SD卡上rootfs的驱动模块:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make modules ARCH=arm CROSS_COMPILE=arm-linux-</span><br><span class="line">make modules_install INSTALL_MOD_PATH=/media/SD/rootfs/ ARCH=arm CROSS_COMPILE=arm-linux-</span><br></pre></td></tr></table></figure><p>make modules_install命令的作用是：</p><ol><li>将编译好的内核模块从内核源代码目录copy到&#x2F;lib&#x2F;modules下。也可自己指定ko安装路径，在交叉编译的情况下，需要将ko模块安装到rootfs。也即：INSTALL_MOD_PATH&#x3D;&#x2F;media&#x2F;SD&#x2F;rootfs&#x2F;。</li><li>运行modules_install的另一个作用是会运行depmod去生成modules.dep文件，该文件记录了模块之间的依赖关系。这样当modprobe XXX的时候就能够把XXX所依赖的模块一并加载了。</li></ol><h2 id="2-5-Wifi模块驱动"><a href="#2-5-Wifi模块驱动" class="headerlink" title="2.5 Wifi模块驱动"></a>2.5 Wifi模块驱动</h2><ol><li><p>如果是江师兄和稚晖君的版本，他们使用的是RTL8723bu，友善之臂的linux工程没有RTL8723bu驱动，我目前使用的是稚晖君基于友善之臂添加后的linux工程，RTL8723bu驱动代码放在了：drivers&#x2F;net&#x2F;wireless&#x2F;realtek&#x2F;rtl8723bu，并且稚晖君的配置文件：linux_card_defconfig已经使能了该驱动，编译linux工程会将RTL8723bu编译成模块。这份驱动代码会依赖其他的一些驱动，所以按照上一节操作，将驱动导出到rootfs，然后：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wifi驱动的目录：/lib/modules/4.14.111/kernel/drivers/net/wireless/realtek/rtl8723bu</span><br><span class="line">装rtl8723bu驱动的时候先depmod一下，再modprobe，下次开机会自动装载。</span><br></pre></td></tr></table></figure></li><li><p>如果是友善之臂的h3 M1 Plus，或者是我做的版本，使用的是AP6212，友善之臂已经适配了ap6212；YuanPi-plus-defconfig配置是我基于友善之臂的sunxi_defconfig修改的，直接使用我修改后的配置编译出的zImage启动即可。当然，也有可能ap6212驱动代码不在linux工程中，是友善之臂的文件系统里面有适配好的ko文件，然后启动时脚本自动装载了，具体代码或者ko文件是啥我没去找过，能用就行。</p></li><li><p>不管是稚晖君还是我的设备树，都是友善之臂的复制过来修改的，所以设备树没有区别，区别只在配置文件和有无RTL8723bu驱动代码。RTL8723bu是usb wifi，ap6212是sdio接口，他们可以共存。</p></li><li><p>连接wifi</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">开启Wi-Fi：</span><br><span class="line">nmcli r wifi on</span><br><span class="line"></span><br><span class="line">扫描附近的Wi-Fi:</span><br><span class="line">nmcli dev wifi</span><br><span class="line"> </span><br><span class="line">连接到特定的Wi-Fi:</span><br><span class="line">nmcli dev wifi connect &quot;SSID&quot; password &quot;PASSWORD&quot; ifname wlan0</span><br><span class="line"></span><br><span class="line">重启网卡设备:</span><br><span class="line">sudo ifconfig wlan0 down</span><br><span class="line">sudo ifconfig wlan0 up</span><br><span class="line"></span><br><span class="line">连接成功后，下次开机，WiFi 也会自动连接。</span><br><span class="line"></span><br><span class="line">如果你的USB WiFi无法正常工作, 大概率是因为文件系统里缺少了对应的USB WiFi固件。</span><br><span class="line">可以通过下列命令安装所有的USB WiFi固件:</span><br><span class="line">apt-get install linux-firmware</span><br></pre></td></tr></table></figure></li></ol><h2 id="2-6-nfs网络文件系统"><a href="#2-6-nfs网络文件系统" class="headerlink" title="2.6 nfs网络文件系统"></a>2.6 nfs网络文件系统</h2><ol><li>ubuntu先安装nfs服务：apt-get install nfs-kernel-server rpcbind</li><li>配置相关文件夹为nfs文件夹：vi &#x2F;etc&#x2F;exports</li><li>在最后一行加上文件夹路径：&#x2F;home&#x2F;qing&#x2F;work&#x2F;nfs&#x2F;rootfs_friendlycore-focal_4.14   *(rw,sync,no_root_squash)</li><li>然后重启ubuntu服务：&#x2F;etc&#x2F;init.d&#x2F;nfs-kernel-server restart</li><li>被挂载的文件夹最好 ：chmod 777  xxx&#x2F;</li><li>在开发板里面也要安装nfs服务：apt-get install nfs-kernel-server rpcbind</li><li>重启开发板的nfs服务：&#x2F;etc&#x2F;init.d&#x2F;nfs-kernel-server restart</li><li>挂载：mount -t nfs <em><strong>ubuntu-IP</strong></em>:&#x2F;home&#x2F;qing&#x2F;work&#x2F;nfs&#x2F;rootfs_friendlycore-focal_4.14&#x2F; &#x2F;mnt&#x2F; -o nolock</li></ol><p>参考OrangePi，以太网要修改sun8i-h3-YuanPi-plus.dts：因为友善M1-Plus用了RTL8211E，我们是直连的。</p><p><img src="2.5%E4%BB%A5%E5%A4%AA%E7%BD%91.png" alt="2.5以太网"></p><h1 id="三、软件适配"><a href="#三、软件适配" class="headerlink" title="三、软件适配"></a>三、软件适配</h1><h2 id="3-1-st7789v彩屏-SPI"><a href="#3-1-st7789v彩屏-SPI" class="headerlink" title="3.1 st7789v彩屏(SPI)"></a>3.1 st7789v彩屏(SPI)</h2><p><em><strong>Frame Buffer设备驱动在另一篇文章已经讲解</strong></em>，这里直接在内核自带的fbtft框架上修改。</p><h3 id="3-1-1-修改设备树"><a href="#3-1-1-修改设备树" class="headerlink" title="3.1.1 修改设备树"></a>3.1.1 修改设备树</h3><p>①首先复制一份sun8i-h3-nanopi-m1-plus.dts重命名为sun8i-h3-YuanPi-plus.dts，并修改设备树目录下的Makefile加上我们的设备树。最后在sun8i-h3-YuanPi-plus.dts中添加：</p><p><img src="3.1.1%E4%BF%AE%E6%94%B9%E8%AE%BE%E5%A4%87%E6%A0%911.png" alt="3.1.1修改设备树1"></p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&amp;spi0 &#123;</span><br><span class="line">    pinctrl-0 = &lt;&amp;spi0_pins &amp;spi0_cs_pins&gt;;</span><br><span class="line">    cs-gpios = &lt;&amp;pio 2 3 GPIO_ACTIVE_HIGH&gt;;</span><br><span class="line"></span><br><span class="line">    st7789vw: st7789vw@0&#123;</span><br><span class="line">    compatible =<span class="string">&quot;sitronix,st7789vw&quot;</span>;</span><br><span class="line">    reg = &lt;0&gt;;</span><br><span class="line">    status = <span class="string">&quot;okay&quot;</span>;</span><br><span class="line">    spi-max-frequency = &lt;50000000&gt;;</span><br><span class="line">    buswidth = &lt;8&gt;;</span><br><span class="line">    rotate = &lt;0&gt;;</span><br><span class="line">    fps = &lt;60&gt;;</span><br><span class="line">    rgb;</span><br><span class="line">    spi-cpol;</span><br><span class="line">    spi-cpha;</span><br><span class="line">    dc-gpios    = &lt;&amp;pio 0 0 GPIO_ACTIVE_HIGH&gt;; /* PA0 */</span><br><span class="line">    reset-gpios = &lt;&amp;pio 0 1 GPIO_ACTIVE_HIGH&gt;; /* PA1 */</span><br><span class="line">    debug = &lt;0x00&gt;;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>②修改sun8i-h3-nanopi.dtsi，将spi0结点下的设备都disabled：</p><p><img src="3.1.1%E4%BF%AE%E6%94%B9%E8%AE%BE%E5%A4%87%E6%A0%912.png" alt="3.1.1修改设备树2"></p><h3 id="3-1-2-修改kernel"><a href="#3-1-2-修改kernel" class="headerlink" title="3.1.2 修改kernel"></a>3.1.2 修改kernel</h3><p>①make menuconfig使能fbtft框架，并勾选fb_st7789vw.c：</p><p><img src="3.1.2%E4%BF%AE%E6%94%B9kernel1.png" alt="3.1.2修改kernel1"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Device Drivers  ---&gt;</span><br><span class="line">    [*] Staging drivers  ---&gt;</span><br><span class="line">        &lt;*&gt;   Support for small TFT LCD display modules  ---&gt;</span><br><span class="line">            &lt;*&gt;   Support sysfs for small TFT LCD display modules</span><br><span class="line">            &lt;*&gt;   FB driver for the ST7789VW LCD Controller </span><br><span class="line">            &lt;*&gt;   Generic FB driver for TFT LCD displays</span><br><span class="line">            &lt;*&gt;   Module to for adding FBTFT devices</span><br></pre></td></tr></table></figure><p>②修改drivers&#x2F;staging&#x2F;fbtft&#x2F;fb_st7789vw.c：</p><p>我们的屏幕不需要偏移，将偏移去除：</p><p><img src="3.1.2%E4%BF%AE%E6%94%B9kernel2.png" alt="3.1.2修改kernel2"></p><p>修改分辨率：</p><p><img src="3.1.2%E4%BF%AE%E6%94%B9kernel3.png" alt="3.1.2修改kernel3"></p><p>最后修改初始化代码：将init_display(struct fbtft_par *par)中初始化代码换成当下屏幕的即可。</p><h3 id="3-1-3修改bootargs"><a href="#3-1-3修改bootargs" class="headerlink" title="3.1.3修改bootargs"></a>3.1.3修改bootargs</h3><p>修改boot.cmd –&gt; boot.scr，让屏幕作为console：</p><p><img src="3.1.3%E4%BF%AE%E6%94%B9bootargs1.png" alt="3.1.3修改bootargs1"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fatload mmc 0 $&#123;dtb_addr&#125; sun8i-h3-YuanPi-plus.dtb</span><br><span class="line">setenv bootargs console=tty1 console=ttyS0,115200 earlyprintk...</span><br></pre></td></tr></table></figure><h3 id="3-1-4-编译烧录找bug"><a href="#3-1-4-编译烧录找bug" class="headerlink" title="3.1.4 编译烧录找bug"></a>3.1.4 编译烧录找bug</h3><p>编译出zImage、sun8i-h3-YuanPi-plus.dtb、boot.scr，重新烧录后发现屏幕不起作用，但是在启动阶段发现有微弱的闪动，开启找bug之旅。。。</p><p>首先怀疑屏幕坏了，毕竟买了挺久了，用之前Frame Buffer设备驱动的程序在RK3399上测试，屏幕正常。</p><p>去掉fbtft框架，用以前自己写的Frame Buffer设备驱动的程序测试，还是只有微弱的闪光，那么问题应该是出在spi驱动能力上，给SCK时钟线接一个3.3v，2.2k上拉，再次实验，成功了。重新加上fbtft框架编译烧录即可。<em><strong>注：这也不是板子硬件bug，将来屏幕转接板上拉即可，同时要注意上拉的电流不能太大，不然时间久了会烧屏。</strong></em></p><p>经过多次测试，spi频率最大能到72M；此时SCK接的是3.3v，10k上拉，频率为50M，最终效果如下：</p><p><img src="3.1.4%E7%BC%96%E8%AF%91%E7%83%A7%E5%BD%95%E6%89%BEbug1.jpg" alt="3.1.4编译烧录找bug1"></p><p>最终发现不用外接上拉电阻，直接将spi0配置成上拉模式即可，并且spi频率也可以设置为72M，96M不行，屏幕大。</p><p><img src="3.1.4%E7%BC%96%E8%AF%91%E7%83%A7%E5%BD%95%E6%89%BEbug2.png" alt="3.1.4编译烧录找bug2"></p><h3 id="3-1-5-音视频播放"><a href="#3-1-5-音视频播放" class="headerlink" title="3.1.5 音视频播放"></a>3.1.5 音视频播放</h3><p>①安装mplayer：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install mplayer</span><br></pre></td></tr></table></figure><p>②安装alsa包：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install libasound2</span><br><span class="line">apt-get install alsa-base</span><br><span class="line">apt-get install alsa-utils</span><br></pre></td></tr></table></figure><p>③播放视频：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mplayer -ao alsa -vo fbdev:/dev/fb_st7789vw -x 240 -y 240 -zoom 被动-伍佰.mp4</span><br></pre></td></tr></table></figure><p>④alsamixer可以调节音量，声音太大到了高潮部分功率上不去会卡死。</p><p>⑤爱伍佰，做他一半就好……</p><p><img src="3.1.5%E9%9F%B3%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE1.jpg" alt="3.1.5音视频播放1"></p><h2 id="3-2-GT911电容触摸-IIC"><a href="#3-2-GT911电容触摸-IIC" class="headerlink" title="3.2 GT911电容触摸(IIC)"></a>3.2 GT911电容触摸(IIC)</h2><h3 id="3-2-1-修改设备树"><a href="#3-2-1-修改设备树" class="headerlink" title="3.2.1 修改设备树"></a>3.2.1 修改设备树</h3><p>GT911使用的是IIC接口，可以设置中断模式，当有触摸动作则会触发中断，在中断中读取寄存器信息，通过input上报坐标，因为板子上的i2c0在硬件上已经上拉，所以设备树不用上拉，修改设备树如下：sun8i-h3-YuanPi-plus.dts</p><p><img src="3.2.1%E4%BF%AE%E6%94%B9%E8%AE%BE%E5%A4%87%E6%A0%911.png" alt="3.2.1修改设备树1"></p><h3 id="3-2-2-编写驱动"><a href="#3-2-2-编写驱动" class="headerlink" title="3.2.2 编写驱动"></a>3.2.2 编写驱动</h3><p>电容触摸屏驱动其实就是以下几种 linux 驱动框架的组合：</p><ol><li>IIC 设备驱动，因为电容触摸 IC 基本都是 IIC 接口的，因此大框架就是 IIC 设备驱动。</li><li>通过中断引脚(INT)向 内核上报触摸信息，因此需要用到中断驱动框架。坐标的上报在中断服务函数中完成。</li><li>触摸屏的坐标信息、屏幕按下和抬起信息都属于input 子系统，因此向内核上报触摸屏坐标信息就得使用 input 子系统。只是我们得按照 linux 内核规定的规则来上报坐标信息。</li></ol><p>以上内容在前面的博文已有介绍，不再赘述，在实际驱动GT911需要注意如下几点：</p><ol><li>与其他的IIC设备不同，GT911的器件地址需要根据初始化时序来确定，地址确定后才能用i2cdetect检测出地址。</li><li>当输出中断后请在一个中断周期内读走坐标并将buffer status(0x814E)写为0，若未在中断内读走坐标，下次IC即使检测到坐标更新会再输出一个中断脉冲，但不更新坐标，如果一直没有读取坐标则会一直打脉冲，导致中断一直被触发。</li><li>我们的屏幕进行了旋转，所以读取出来的坐标也需要在软件上进行调整，如下：<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">我们的屏幕旋转了90度，对应如下：</span><br><span class="line">原先      --&gt;   旋转后   </span><br><span class="line">(0,0)     --&gt;  (0,240)</span><br><span class="line">(240,0)   --&gt;  (0,0)</span><br><span class="line">(0,320)   --&gt;  (320,240)</span><br><span class="line">(240,320) --&gt;  (320,0)</span><br><span class="line">所以对应的调整关系是:</span><br><span class="line">(X,Y)     --&gt;  (Y,|X-240|)</span><br></pre></td></tr></table></figure></li></ol><p><em><strong>完整代码如下所示，相应注释已给出：</strong></em></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of_device.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/slab.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/delay.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/mutex.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/mod_devicetable.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/bitops.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/jiffies.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/property.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/acpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/i2c.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/nvmem-provider.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/regmap.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/pm_runtime.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/gpio/consumer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/uaccess.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/fs.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/delay.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of_irq.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of_gpio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/spinlock.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/atomic.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;asm/unaligned.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/input.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/input/mt.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/input/touchscreen.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of_irq.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/interrupt.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GT_CTRL_REG         0X8040  <span class="comment">/* GT911控制寄存器         */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GT_9xx_CFGS_REG     0X8047  <span class="comment">/* GT9147配置起始地址寄存器    */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GT_1xx_CFGS_REG     0X8050  <span class="comment">/* GT1151配置起始地址寄存器    */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GT_PID_REG         0X8140  <span class="comment">/* GT911产品ID寄存器       */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GT_GSTID_REG         0X814E  <span class="comment">/* GT911当前检测到的触摸情况 */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GT_TP1_REG         0X814F  <span class="comment">/* 第一个触摸点数据地址 */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_SUPPORT_POINTS      5       <span class="comment">/* 最多5点电容触摸 */</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> u8 irq_table[] = &#123;IRQ_TYPE_EDGE_RISING, IRQ_TYPE_EDGE_FALLING, IRQ_TYPE_LEVEL_LOW, IRQ_TYPE_LEVEL_HIGH&#125;;  <span class="comment">/* 触发方式 */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">gt911_dev</span> &#123;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">gpio_desc</span>   *<span class="title">reset_pin</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">gpio_desc</span>   *<span class="title">irq_pin</span>;</span></span><br><span class="line"><span class="type">int</span> irqnum;<span class="comment">/* 中断号    */</span></span><br><span class="line"><span class="type">int</span> irqtype;<span class="comment">/* 中断类型         */</span></span><br><span class="line"><span class="type">int</span> max_x;<span class="comment">/* 最大横坐标   */</span></span><br><span class="line"><span class="type">int</span> max_y; <span class="comment">/* 最大纵坐标*/</span></span><br><span class="line"><span class="type">void</span> *private_data;<span class="comment">/* 私有数据 */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">input_dev</span> *<span class="title">input</span>;</span><span class="comment">/* input结构体 */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">i2c_client</span> *<span class="title">client</span>;</span><span class="comment">/* I2C客户端 */</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">gt911_dev</span> <span class="title">gt911</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @description     : 复位GT911</span></span><br><span class="line"><span class="comment"> * @param - client : 要操作的i2c</span></span><br><span class="line"><span class="comment"> * @param - multidev: 自定义的multitouch设备</span></span><br><span class="line"><span class="comment"> * @return          : 0，成功;其他负值,失败</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">gt911_reset</span><span class="params">(<span class="keyword">struct</span> i2c_client *client, <span class="keyword">struct</span> gt911_dev *dev)</span></span><br><span class="line">&#123;</span><br><span class="line">    printk(<span class="string">&quot;reset_pin and int_pin = 0 hold 10ms!\n&quot;</span>);</span><br><span class="line">    gpiod_set_value(dev-&gt;reset_pin, <span class="number">0</span>); <span class="comment">//设低电平</span></span><br><span class="line">    gpiod_set_value(dev-&gt;irq_pin, <span class="number">0</span>);   <span class="comment">//设低电平</span></span><br><span class="line">    mdelay(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    printk(<span class="string">&quot;reset_pin = 1 hold 10ms!\n&quot;</span>);</span><br><span class="line">    gpiod_set_value(dev-&gt;reset_pin, <span class="number">1</span>); <span class="comment">//设高电平</span></span><br><span class="line">    mdelay(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    printk(<span class="string">&quot;set int_pin as input!\n&quot;</span>);</span><br><span class="line">    gpiod_direction_input(dev-&gt;irq_pin);</span><br><span class="line"></span><br><span class="line">    printk(<span class="string">&quot;now gt911&#x27;s addr is 0xBA/0xBB, and i2c addr is 0x5d\n&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @description: 向GT911多个寄存器写入数据，寄存器的地址指针会在写操作后自动加 1，所以当需要对连续地址的寄存器进行写操作时，可以在一次写操作中连续写入。</span></span><br><span class="line"><span class="comment"> * @param - dev:  GT911设备</span></span><br><span class="line"><span class="comment"> * @param - reg:  要写入的寄存器首地址</span></span><br><span class="line"><span class="comment"> * @param - val:  要写入的数据缓冲区</span></span><br><span class="line"><span class="comment"> * @param - len:  要写入的数据长度</span></span><br><span class="line"><span class="comment"> * @return   :   操作结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> s32 <span class="title function_">gt911_write_regs</span><span class="params">(<span class="keyword">struct</span> gt911_dev *dev, u16 reg, u8 *buf, u8 len)</span></span><br><span class="line">&#123;</span><br><span class="line">u8 b[<span class="number">256</span>];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">i2c_msg</span> <span class="title">msg</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">i2c_client</span> *<span class="title">client</span> =</span> (<span class="keyword">struct</span> i2c_client *)dev-&gt;client;</span><br><span class="line"></span><br><span class="line">b[<span class="number">0</span>] = reg &gt;&gt; <span class="number">8</span>;<span class="comment">/* 寄存器首地址低8位 */</span></span><br><span class="line">    b[<span class="number">1</span>] = reg &amp; <span class="number">0XFF</span>;<span class="comment">/* 寄存器首地址高8位 */</span></span><br><span class="line"><span class="built_in">memcpy</span>(&amp;b[<span class="number">2</span>],buf,len);<span class="comment">/* 将要写入的数据拷贝到数组b里面 */</span></span><br><span class="line"></span><br><span class="line">msg.addr = client-&gt;addr;<span class="comment">/* gt911地址 */</span></span><br><span class="line">msg.flags = <span class="number">0</span>;<span class="comment">/* 标记为写数据 */</span></span><br><span class="line"></span><br><span class="line">msg.buf = b;<span class="comment">/* 要写入的数据缓冲区 */</span></span><br><span class="line">msg.len = len + <span class="number">2</span>;<span class="comment">/* 要写入的数据长度，总长度要加上两个寄存器 */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> i2c_transfer(client-&gt;adapter, &amp;msg, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @description: 从GT911读取多个寄存器数据</span></span><br><span class="line"><span class="comment"> * @param - dev:  GT911设备</span></span><br><span class="line"><span class="comment"> * @param - reg:  要读取的寄存器首地址</span></span><br><span class="line"><span class="comment"> * @param - buf:  读取到的数据</span></span><br><span class="line"><span class="comment"> * @param - len:  要读取的数据长度</span></span><br><span class="line"><span class="comment"> * @return : 操作结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">gt911_read_regs</span><span class="params">(<span class="keyword">struct</span> gt911_dev *dev, u16 reg, u8 *buf, <span class="type">int</span> len)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> ret;</span><br><span class="line">    u8 regdata[<span class="number">2</span>];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">i2c_msg</span> <span class="title">msg</span>[2];</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">i2c_client</span> *<span class="title">client</span> =</span> (<span class="keyword">struct</span> i2c_client *)dev-&gt;client;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* GT911寄存器长度为2个字节 */</span></span><br><span class="line">    regdata[<span class="number">0</span>] = reg &gt;&gt; <span class="number">8</span>;</span><br><span class="line">    regdata[<span class="number">1</span>] = reg &amp; <span class="number">0xFF</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* msg[0]为发送要读取的首地址 */</span></span><br><span class="line">msg[<span class="number">0</span>].addr = client-&gt;addr;<span class="comment">/* GT911的i2c地址 */</span></span><br><span class="line">msg[<span class="number">0</span>].flags = !I2C_M_RD;<span class="comment">/* 标记为发送数据 */</span></span><br><span class="line">msg[<span class="number">0</span>].buf = &amp;regdata[<span class="number">0</span>];<span class="comment">/* 读取的首地址 */</span></span><br><span class="line">msg[<span class="number">0</span>].len = <span class="number">2</span>;<span class="comment">/* reg长度*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* msg[1]读取数据 */</span></span><br><span class="line">msg[<span class="number">1</span>].addr = client-&gt;addr;<span class="comment">/* GT911的i2c地址 */</span></span><br><span class="line">msg[<span class="number">1</span>].flags = I2C_M_RD;<span class="comment">/* 标记为读取数据*/</span></span><br><span class="line">msg[<span class="number">1</span>].buf = buf;<span class="comment">/* 读取数据缓冲区 */</span></span><br><span class="line">msg[<span class="number">1</span>].len = len;<span class="comment">/* 要读取的数据长度*/</span></span><br><span class="line"></span><br><span class="line">ret = i2c_transfer(client-&gt;adapter, msg, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">if</span>(ret == <span class="number">2</span>) &#123;</span><br><span class="line">ret = <span class="number">0</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">ret = -EREMOTEIO;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @description     : GT911读取固件</span></span><br><span class="line"><span class="comment"> * @param - client : 要操作的i2c</span></span><br><span class="line"><span class="comment"> * @param - multidev: 自定义的multitouch设备</span></span><br><span class="line"><span class="comment"> * @return          : 0，成功;其他负值,失败</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">gt911_read_firmware</span><span class="params">(<span class="keyword">struct</span> i2c_client *client, <span class="keyword">struct</span> gt911_dev *dev)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> ret = <span class="number">0</span>, version = <span class="number">0</span>;</span><br><span class="line">u16 id = <span class="number">0</span>;</span><br><span class="line">u8 data[<span class="number">7</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="type">char</span> id_str[<span class="number">5</span>];</span><br><span class="line">ret = gt911_read_regs(dev, GT_PID_REG, data, <span class="number">6</span>);</span><br><span class="line"><span class="keyword">if</span> (ret) &#123;</span><br><span class="line">dev_err(&amp;client-&gt;dev, <span class="string">&quot;Unable to read PID.\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">memcpy</span>(id_str, data, <span class="number">4</span>);</span><br><span class="line">id_str[<span class="number">4</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (kstrtou16(id_str, <span class="number">10</span>, &amp;id))</span><br><span class="line">    &#123;</span><br><span class="line">        id = <span class="number">0x1001</span>;</span><br><span class="line">    &#125;</span><br><span class="line">version = get_unaligned_le16(&amp;data[<span class="number">4</span>]);</span><br><span class="line">dev_info(&amp;client-&gt;dev, <span class="string">&quot;ID %d, version: %04x\n&quot;</span>, id, version);</span><br><span class="line"><span class="keyword">switch</span> (id) &#123;    <span class="comment">/* 由于不同的芯片配置寄存器地址不一样需要判断一下  */</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">911</span>:</span><br><span class="line">        ret = gt911_read_regs(dev, GT_9xx_CFGS_REG, data, <span class="number">7</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">if</span> (ret) &#123;</span><br><span class="line">dev_err(&amp;client-&gt;dev, <span class="string">&quot;Unable to read Firmware.\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line">dev-&gt;max_x = (data[<span class="number">2</span>] &lt;&lt; <span class="number">8</span>) + data[<span class="number">1</span>];</span><br><span class="line">dev-&gt;max_y = (data[<span class="number">4</span>] &lt;&lt; <span class="number">8</span>) + data[<span class="number">3</span>];</span><br><span class="line">dev-&gt;irqtype = data[<span class="number">6</span>] &amp; <span class="number">0x3</span>;</span><br><span class="line">printk(<span class="string">&quot;X_MAX: %d, Y_MAX: %d, Touch Number: %d, TRIGGER: 0x%02x\n&quot;</span>, dev-&gt;max_x, dev-&gt;max_y, data[<span class="number">5</span>], dev-&gt;irqtype);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">我们的屏幕旋转了90度，对应如下：</span></span><br><span class="line"><span class="comment">原先      --&gt;   旋转后   </span></span><br><span class="line"><span class="comment">(0,0)     --&gt;  (0,240)</span></span><br><span class="line"><span class="comment">(240,0)   --&gt;  (0,0)</span></span><br><span class="line"><span class="comment">(0,320)   --&gt;  (320,240)</span></span><br><span class="line"><span class="comment">(240,320) --&gt;  (320,0)</span></span><br><span class="line"><span class="comment">所以对应的调整关系是:</span></span><br><span class="line"><span class="comment">(X,Y)     --&gt;  (Y,|X-240|)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">adjust_x_y</span><span class="params">(<span class="type">int</span> *x, <span class="type">int</span> *y)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> tmp;</span><br><span class="line">tmp = *x;</span><br><span class="line">*x = *y;</span><br><span class="line"><span class="keyword">if</span>(tmp &gt;= gt911.max_x)</span><br><span class="line">*y = tmp - gt911.max_x;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">*y = gt911.max_x - tmp;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">irqreturn_t</span> <span class="title function_">gt911_irq_handler</span><span class="params">(<span class="type">int</span> irq, <span class="type">void</span> *dev_id)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> touch_num = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> input_x, input_y;</span><br><span class="line">    <span class="type">int</span> id = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    u8 data;</span><br><span class="line">    u8 touch_data[<span class="number">5</span>];</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">gt911_dev</span> *<span class="title">dev</span> =</span> dev_id;</span><br><span class="line"></span><br><span class="line">    ret = gt911_read_regs(dev, GT_GSTID_REG, &amp;data, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (data == <span class="number">0x00</span>)  &#123;     <span class="comment">/* 没有触摸数据，直接返回 */</span></span><br><span class="line">        <span class="keyword">goto</span> fail;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;                 <span class="comment">/* 统计触摸点数据 */</span></span><br><span class="line">        touch_num = data &amp; <span class="number">0x0f</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这里暂时使用单点触摸 </span></span><br><span class="line">    <span class="keyword">if</span>(touch_num) &#123;         <span class="comment">/* 单点触摸按下 */</span></span><br><span class="line">        gt911_read_regs(dev, GT_TP1_REG, touch_data, <span class="number">5</span>);</span><br><span class="line">        id = touch_data[<span class="number">0</span>] &amp; <span class="number">0x0F</span>;</span><br><span class="line">        <span class="keyword">if</span>(id == <span class="number">0</span>) &#123;</span><br><span class="line">            input_x  = touch_data[<span class="number">1</span>] | (touch_data[<span class="number">2</span>] &lt;&lt; <span class="number">8</span>);</span><br><span class="line">            input_y  = touch_data[<span class="number">3</span>] | (touch_data[<span class="number">4</span>] &lt;&lt; <span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//旋转了屏幕，从软件上调整坐标</span></span><br><span class="line">            adjust_x_y(&amp;input_x, &amp;input_y);</span><br><span class="line"></span><br><span class="line">            printk(<span class="string">&quot;X: %d, Y: %d\n&quot;</span>, input_x, input_y);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//上报坐标</span></span><br><span class="line">            input_mt_slot(dev-&gt;input, id);</span><br><span class="line">    input_mt_report_slot_state(dev-&gt;input, MT_TOOL_FINGER, <span class="literal">true</span>);</span><br><span class="line">    input_report_abs(dev-&gt;input, ABS_MT_POSITION_X, input_x);</span><br><span class="line">    input_report_abs(dev-&gt;input, ABS_MT_POSITION_Y, input_y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(touch_num == <span class="number">0</span>)&#123;                <span class="comment">/* 单点触摸释放 */</span></span><br><span class="line">        input_mt_slot(dev-&gt;input, id);</span><br><span class="line">        input_mt_report_slot_state(dev-&gt;input, MT_TOOL_FINGER, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">input_mt_report_pointer_emulation(dev-&gt;input, <span class="literal">true</span>);</span><br><span class="line">    input_sync(dev-&gt;input);</span><br><span class="line"></span><br><span class="line">    data = <span class="number">0x00</span>;                <span class="comment">/* 向0X814E寄存器写0 */</span></span><br><span class="line">    gt911_write_regs(dev, GT_GSTID_REG, &amp;data, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">fail:</span><br><span class="line"><span class="keyword">return</span> IRQ_HANDLED;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * @description     : GT911中断初始化</span></span><br><span class="line"><span class="comment"> * @param - client : 要操作的i2c</span></span><br><span class="line"><span class="comment"> * @param - multidev: 自定义的multitouch设备</span></span><br><span class="line"><span class="comment"> * @return          : 0，成功;其他负值,失败</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">gt911_ts_irq</span><span class="params">(<span class="keyword">struct</span> i2c_client *client, <span class="keyword">struct</span> gt911_dev *dev)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line"><span class="comment">/* 申请中断,client-&gt;irq就是IO中断， */</span></span><br><span class="line">ret = devm_request_threaded_irq(&amp;client-&gt;dev, client-&gt;irq, <span class="literal">NULL</span>,</span><br><span class="line">gt911_irq_handler, irq_table[dev-&gt;irqtype] | IRQF_ONESHOT,</span><br><span class="line">client-&gt;name, &amp;gt911);</span><br><span class="line"><span class="keyword">if</span> (ret) &#123;</span><br><span class="line">dev_err(&amp;client-&gt;dev, <span class="string">&quot;Unable to request touchscreen IRQ.\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">GT911_probe</span><span class="params">(<span class="keyword">struct</span> i2c_client *client, <span class="type">const</span> <span class="keyword">struct</span> i2c_device_id *id)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">u8 data, ret;</span><br><span class="line">gt911.client = client;</span><br><span class="line"></span><br><span class="line">    printk(<span class="string">&quot;%s %s %d\n&quot;</span>, __FILE__, __FUNCTION__, __LINE__);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 1，获取设备树中的中断和复位引脚 */</span></span><br><span class="line">gt911.irq_pin = devm_gpiod_get(&amp;client-&gt;dev,<span class="string">&quot;interrupt&quot;</span>,GPIOD_OUT_LOW);</span><br><span class="line">gt911.reset_pin = devm_gpiod_get(&amp;client-&gt;dev, <span class="string">&quot;reset&quot;</span>, GPIOD_OUT_LOW);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 2，复位GT911 */</span></span><br><span class="line">gt911_reset(client, &amp;gt911);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 3，初始化GT911 */</span></span><br><span class="line">    data = <span class="number">0x02</span>;</span><br><span class="line">    gt911_write_regs(&amp;gt911, GT_CTRL_REG, &amp;data, <span class="number">1</span>); <span class="comment">/* 软复位 */</span></span><br><span class="line">    mdelay(<span class="number">100</span>);</span><br><span class="line">    data = <span class="number">0x0</span>;</span><br><span class="line">    gt911_write_regs(&amp;gt911, GT_CTRL_REG, &amp;data, <span class="number">1</span>); <span class="comment">/* 停止软复位 */</span></span><br><span class="line">    mdelay(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 4,初始化GT911，读取固件  */</span></span><br><span class="line">ret = gt911_read_firmware(client, &amp;gt911);</span><br><span class="line"><span class="keyword">if</span>(ret != <span class="number">0</span>) &#123;</span><br><span class="line">printk(<span class="string">&quot;Fail !!! check !!\r\n&quot;</span>);</span><br><span class="line"><span class="keyword">goto</span> fail;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 5，input设备注册 */</span></span><br><span class="line">gt911.input = devm_input_allocate_device(&amp;client-&gt;dev);</span><br><span class="line"><span class="keyword">if</span> (!gt911.input) &#123;</span><br><span class="line">ret = -ENOMEM;</span><br><span class="line"><span class="keyword">goto</span> fail;</span><br><span class="line">&#125;</span><br><span class="line">gt911.input-&gt;name = client-&gt;name;</span><br><span class="line">gt911.input-&gt;id.bustype = BUS_I2C;</span><br><span class="line">gt911.input-&gt;dev.parent = &amp;client-&gt;dev;</span><br><span class="line"></span><br><span class="line">__set_bit(EV_KEY, gt911.input-&gt;evbit);</span><br><span class="line">__set_bit(EV_ABS, gt911.input-&gt;evbit);</span><br><span class="line">__set_bit(BTN_TOUCH, gt911.input-&gt;keybit);</span><br><span class="line"></span><br><span class="line">input_set_abs_params(gt911.input, ABS_X, <span class="number">0</span>, gt911.max_x, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">input_set_abs_params(gt911.input, ABS_Y, <span class="number">0</span>, gt911.max_y, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">input_set_abs_params(gt911.input, ABS_MT_POSITION_X,<span class="number">0</span>, gt911.max_x, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">input_set_abs_params(gt911.input, ABS_MT_POSITION_Y,<span class="number">0</span>, gt911.max_y, <span class="number">0</span>, <span class="number">0</span>);     </span><br><span class="line">ret = input_mt_init_slots(gt911.input, MAX_SUPPORT_POINTS, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (ret) &#123;</span><br><span class="line"><span class="keyword">goto</span> fail;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ret = input_register_device(gt911.input);</span><br><span class="line"><span class="keyword">if</span> (ret)</span><br><span class="line"><span class="keyword">goto</span> fail;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 6，最后初始化中断 */</span></span><br><span class="line">ret = gt911_ts_irq(client, &amp;gt911);</span><br><span class="line"><span class="keyword">if</span>(ret &lt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">goto</span> fail;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">fail:</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">of_device_id</span> <span class="title">of_match_ids_GT911</span>[] =</span> &#123;</span><br><span class="line">&#123; .compatible = <span class="string">&quot;my_gt911&quot;</span>,.data = <span class="literal">NULL</span> &#125;,</span><br><span class="line">&#123; <span class="comment">/* END OF LIST */</span> &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">i2c_device_id</span> <span class="title">GT911_ids</span>[] =</span> &#123;</span><br><span class="line">&#123; <span class="string">&quot;gt911&quot;</span>,(<span class="type">kernel_ulong_t</span>)<span class="literal">NULL</span> &#125;,</span><br><span class="line">&#123; <span class="comment">/* END OF LIST */</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">GT911_remove</span><span class="params">(<span class="keyword">struct</span> i2c_client *client)</span></span><br><span class="line">&#123;</span><br><span class="line">printk(<span class="string">&quot;%s %s %d\n&quot;</span>, __FILE__, __FUNCTION__, __LINE__);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">i2c_driver</span> <span class="title">i2c_GT911_driver</span> =</span> &#123;</span><br><span class="line">.driver = &#123;</span><br><span class="line">.name = <span class="string">&quot;gt911&quot;</span>,</span><br><span class="line">.of_match_table = of_match_ids_GT911,</span><br><span class="line">&#125;,</span><br><span class="line">.probe = GT911_probe,</span><br><span class="line">.remove = GT911_remove,</span><br><span class="line">.id_table = GT911_ids,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">i2c_driver_GT911_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">printk(<span class="string">&quot;%s %s %d\n&quot;</span>, __FILE__, __FUNCTION__, __LINE__);</span><br><span class="line"><span class="keyword">return</span> i2c_add_driver(&amp;i2c_GT911_driver);</span><br><span class="line">&#125;</span><br><span class="line">module_init(i2c_driver_GT911_init);</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __exit <span class="title function_">i2c_driver_GT911_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">i2c_del_driver(&amp;i2c_GT911_driver);</span><br><span class="line">&#125;</span><br><span class="line">module_exit(i2c_driver_GT911_exit);</span><br><span class="line"></span><br><span class="line">MODULE_AUTHOR(<span class="string">&quot;qingqing&quot;</span>);</span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="3-2-3-移植tslib"><a href="#3-2-3-移植tslib" class="headerlink" title="3.2.3 移植tslib"></a>3.2.3 移植tslib</h3><p><em><strong>首先装载gt911驱动，自己的驱动成功效果如下：</strong></em></p><p><img src="3.3.1%E7%A7%BB%E6%A4%8Dtslib1.jpg" alt="3.3.1移植tslib1"></p><p>tslib 是一个开源的第三方库，用于触摸屏性能调试，使用电阻屏的时候一般使用 tslib 进行校准。虽然电容屏不需要校准，但主要的是 tslib 提供了一些其他软件，我们可以通过这些软件来测试触摸屏工作是否正常。最新版本的 tslib 已经支持了多点电容触摸屏，因此可以通过 tslib 来直观的测试多点电容触摸屏驱动，这个要比观看 eventX 原始数据方便的多。</p><p>①获取tslib源码。git 地址为：<a href="https://github.com/kergoth/tslib">https://github.com/kergoth/tslib</a> ，目前最新的版本是1.21。</p><p>②修改 tslib 源码所属用户，修改解压得到的 tslib-1.21 目录所属用户为当前用户，这一步一定要做！否则在稍后的编译中会遇到各种问题。我当前 ubuntu 的登录用户名为“qing”，修改命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown qing:qing tslib-1.21 -R</span><br></pre></td></tr></table></figure><p>③ubuntu工具安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install autoconf</span><br><span class="line">sudo apt-get install automake</span><br><span class="line">sudo apt-get install libtool</span><br></pre></td></tr></table></figure><p>④编译tslib：编译完成后在安装目录中，bin 目录下是可执行文件，包括 tslib 的测试工具。etc 目录下是 tslib 的配置文件，lib目录下是相关的库文件，将所有文件拷贝到开发板中。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./autogen.sh</span><br><span class="line">./configure --host=arm-linux --prefix=&quot;安装目录&quot;</span><br><span class="line">make &amp;&amp; make install </span><br></pre></td></tr></table></figure><p>⑤配置tslib</p><ol><li>打开etc&#x2F;ts.conf 文件，找到module_raw input，如果这句前面有“#”的话就删除掉“#”。</li><li>在开发板终端输入：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注意，下面路径是根目录，如果没有这些文件，运行时会生成</span></span><br><span class="line">export TSLIB_TSDEVICE=/dev/input/event2</span><br><span class="line">export TSLIB_CALIBFILE=/etc/pointercal</span><br><span class="line">export TSLIB_CONFFILE=/etc/ts.conf</span><br><span class="line">export TSLIB_PLUGINDIR=/lib/ts</span><br><span class="line">export TSLIB_CONSOLEDEVICE=none</span><br><span class="line">export TSLIB_FBDEVICE=/dev/fb1</span><br></pre></td></tr></table></figure></li></ol><p>⑥ tslib 测试：使用ts_test_mt来测试触摸屏工作是否正常，测试结果如下，一切正常：</p><p><img src="3.3.1%E7%A7%BB%E6%A4%8Dtslib2.jpg" alt="3.3.1移植tslib2"></p><p><em><strong>至此，从头写GT911触摸驱动就圆满完成了！</strong></em></p>]]></content>
      
      
      <categories>
          
          <category> 个人项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 个人项目 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rockchip之adc按键驱动</title>
      <link href="/2022/04/20/rockchip%E4%B9%8Badc%E6%8C%89%E9%94%AE%E9%A9%B1%E5%8A%A8/"/>
      <url>/2022/04/20/rockchip%E4%B9%8Badc%E6%8C%89%E9%94%AE%E9%A9%B1%E5%8A%A8/</url>
      
        <content type="html"><![CDATA[<p><img src="ADC%E6%8C%89%E9%94%AE%E5%85%B8%E5%9E%8B%E7%94%B5%E8%B7%AF.png" alt="ADC按键典型电路"></p><h1 id="一、设备树"><a href="#一、设备树" class="headerlink" title="一、设备树"></a>一、设备树</h1><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vi rk3399pro-firefly-core.dtsi +55</span></span><br><span class="line"><span class="title class_">adc-keys</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">compatible</span> <span class="operator">=</span> <span class="string">&quot;adc-keys&quot;</span><span class="punctuation">;</span></span><br><span class="line">        <span class="attr">io-channels</span> <span class="operator">=</span> <span class="params">&lt;<span class="variable">&amp;saradc</span> <span class="number">2</span>&gt;</span><span class="punctuation">;</span>               <span class="comment">//adc选用的是saradc通道2</span></span><br><span class="line">        <span class="attr">io-channel-names</span> <span class="operator">=</span> <span class="string">&quot;buttons&quot;</span><span class="punctuation">;</span></span><br><span class="line">        <span class="attr">poll-interval</span> <span class="operator">=</span> <span class="params">&lt;<span class="number">100</span>&gt;</span><span class="punctuation">;</span></span><br><span class="line">        <span class="attr">keyup-threshold-microvolt</span> <span class="operator">=</span> <span class="params">&lt;<span class="number">1800000</span>&gt;</span><span class="punctuation">;</span>   <span class="comment">//表示按键抬起，saradc通道2的电压（单位微伏）。</span></span><br><span class="line">        <span class="title class_">adc-power-key</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">linux,code</span> <span class="operator">=</span> <span class="params">&lt;KEY_POWER&gt;</span><span class="punctuation">;</span>        <span class="comment">//按键上报的键值</span></span><br><span class="line">                <span class="attr">label</span> <span class="operator">=</span> <span class="string">&quot;power key&quot;</span><span class="punctuation">;</span></span><br><span class="line">                <span class="attr">press-threshold-microvolt</span> <span class="operator">=</span> <span class="params">&lt;<span class="number">0</span>&gt;</span><span class="punctuation">;</span> <span class="comment">//表示按键按下，saradc通道2的电压。</span></span><br><span class="line">        <span class="punctuation">&#125;;</span></span><br><span class="line"><span class="punctuation">&#125;;</span></span><br></pre></td></tr></table></figure><h1 id="二、上报键值"><a href="#二、上报键值" class="headerlink" title="二、上报键值"></a>二、上报键值</h1><p>最关键的上报按键事件的代码：adc-keys.c：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">adc_keys_poll</span><span class="params">(<span class="keyword">struct</span> input_polled_dev *dev)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">adc_keys_state</span> *<span class="title">st</span> =</span> dev-&gt;private;</span><br><span class="line"><span class="type">int</span> i, value, ret;</span><br><span class="line">u32 diff, closest = <span class="number">0xffffffff</span>;</span><br><span class="line"><span class="type">int</span> keycode = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">ret = iio_read_channel_processed(st-&gt;channel, &amp;value);<span class="comment">//读取adc通道值</span></span><br><span class="line"><span class="keyword">if</span> (unlikely(ret &lt; <span class="number">0</span>)) &#123;</span><br><span class="line"><span class="comment">/* Forcibly release key if any was pressed */</span></span><br><span class="line">    <span class="comment">// 如果未按下任何键，则强制释放键</span></span><br><span class="line">value = st-&gt;keyup_voltage;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; st-&gt;num_keys; i++) &#123;</span><br><span class="line"><span class="comment">//st-&gt;map[i].voltage = &quot;press-threshold-microvolt&quot; = 设备树设定的按下时adc值</span></span><br><span class="line">diff = <span class="built_in">abs</span>(st-&gt;<span class="built_in">map</span>[i].voltage - value); </span><br><span class="line"><span class="keyword">if</span> (diff &lt; closest) &#123;<span class="comment">//找出最接近的键值</span></span><br><span class="line">closest = diff;</span><br><span class="line">keycode = st-&gt;<span class="built_in">map</span>[i].keycode;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//如果adc的值与开路电压的adc的误差比上面的最小误差都小，那么判定为未按下按键</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">abs</span>(st-&gt;keyup_voltage - value) &lt; closest)</span><br><span class="line">keycode = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//如果上一次有键值，并且这次的键值和上次不一样，就说明上一次的按键已经松开</span></span><br><span class="line"><span class="comment">//并且这次检测，又有新的按键被按下，就先发送上次键值的松开事件</span></span><br><span class="line"><span class="keyword">if</span> (st-&gt;last_key &amp;&amp; st-&gt;last_key != keycode)</span><br><span class="line">input_report_key(dev-&gt;input, st-&gt;last_key, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">//再发送新的键值的按下事件</span></span><br><span class="line"><span class="keyword">if</span> (keycode)</span><br><span class="line">input_report_key(dev-&gt;input, keycode, <span class="number">1</span>);</span><br><span class="line"> </span><br><span class="line">input_sync(dev-&gt;input);</span><br><span class="line">st-&gt;last_key = keycode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="三、使用实例"><a href="#三、使用实例" class="headerlink" title="三、使用实例"></a>三、使用实例</h1><p><em><strong>①修改设备树：</strong></em></p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">adc_demo:</span> <span class="title class_">adc_demo</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">status</span> <span class="operator">=</span> <span class="string">&quot;okay&quot;</span><span class="punctuation">;</span></span><br><span class="line">        <span class="attr">compatible</span> <span class="operator">=</span> <span class="string">&quot;firefly,rk3399-adc&quot;</span><span class="punctuation">;</span></span><br><span class="line">        <span class="attr">io-channels</span> <span class="operator">=</span> <span class="params">&lt;<span class="variable">&amp;saradc</span> <span class="number">0</span>&gt;</span><span class="punctuation">;</span></span><br><span class="line"><span class="punctuation">&#125;;</span></span><br></pre></td></tr></table></figure><p><em><strong>②编写驱动程序：</strong></em></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/iio/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/input.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/input-polldev.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/platform_device.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/property.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/slab.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/delay.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/err.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/gpio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/gpio/consumer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/iio/consumer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/interrupt.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/pinctrl/consumer.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">delayed_work</span><span class="title">adc_poll_work</span>;</span>  <span class="comment">//定义一个工作队列</span></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">iio_channel</span> *<span class="title">chan</span>;</span>    <span class="comment">//定义 IIO 通道结构体</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">firefly_demo_adc_poll</span> <span class="params">(<span class="keyword">struct</span> work_struct *work)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> val,ret;</span><br><span class="line"><span class="type">int</span> Vresult;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">使用标准电压将 AD 转换的值转换为用户所需要的电压值。其计算公式如下：</span></span><br><span class="line"><span class="comment">Vref / (2^n-1) = Vresult / raw</span></span><br><span class="line"><span class="comment">Vref 为标准电压</span></span><br><span class="line"><span class="comment">n 为 AD 转换的位数</span></span><br><span class="line"><span class="comment">Vresult 为用户所需要的采集电压</span></span><br><span class="line"><span class="comment">raw 为 AD 采集的原始数据</span></span><br><span class="line"><span class="comment">例如，标准电压为 1.8V，AD 采集位数为 10 位，AD 采集到的原始数据为 568，则：</span></span><br><span class="line"><span class="comment">Vresult = (1800mv * 568) / 1023;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ret = iio_read_channel_raw(chan, &amp;val);</span><br><span class="line">Vresult = (<span class="number">1800</span> * val) / <span class="number">1023</span>; <span class="comment">//Vresult = (1800mv * val) / 1023;</span></span><br><span class="line">printk(<span class="string">&quot;the adc channel voltage is %d mV\n&quot;</span>,Vresult);</span><br><span class="line">schedule_delayed_work(&amp;adc_poll_work,msecs_to_jiffies(<span class="number">1000</span>)); <span class="comment">//1秒后调用队列</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">firefly_adc_probe</span><span class="params">(<span class="keyword">struct</span> platform_device *pdev)</span></span><br><span class="line">&#123;</span><br><span class="line">     printk(<span class="string">&quot;firefly_adc_probe!\n&quot;</span>);</span><br><span class="line">     chan = iio_channel_get(&amp;(pdev-&gt;dev), <span class="literal">NULL</span>);</span><br><span class="line">     <span class="keyword">if</span> (IS_ERR(chan))&#123;</span><br><span class="line">    chan = <span class="literal">NULL</span>;</span><br><span class="line">        printk(<span class="string">&quot;%s() have not set adc chan\n&quot;</span>, __FUNCTION__);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (chan) &#123;</span><br><span class="line">INIT_DELAYED_WORK(&amp;adc_poll_work, firefly_demo_adc_poll);<span class="comment">//初始化工作队列</span></span><br><span class="line">schedule_delayed_work(&amp;adc_poll_work,msecs_to_jiffies(<span class="number">1000</span>));<span class="comment">//1秒后调用队列</span></span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">firefly_adc_remove</span><span class="params">(<span class="keyword">struct</span> platform_device *pdev)</span></span><br><span class="line">&#123;</span><br><span class="line">printk(<span class="string">&quot;%s %s %d\n&quot;</span>, __FILE__, __FUNCTION__, __LINE__);</span><br><span class="line">iio_channel_release(chan);</span><br><span class="line">cancel_delayed_work_sync(&amp;adc_poll_work);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">of_device_id</span> <span class="title">firefly_adc_match</span>[] =</span> &#123;</span><br><span class="line">     &#123; .compatible = <span class="string">&quot;firefly,rk3399-adc&quot;</span> &#125;,</span><br><span class="line">     &#123;&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">platform_driver</span> <span class="title">firefly_adc_driver</span> =</span> &#123;</span><br><span class="line">    .probe      = firefly_adc_probe,</span><br><span class="line">    .remove     = firefly_adc_remove,</span><br><span class="line">    .driver     = &#123;</span><br><span class="line">        .name   = <span class="string">&quot;firefly_adc&quot;</span>,</span><br><span class="line">        .owner  = THIS_MODULE,</span><br><span class="line">        .of_match_table = firefly_adc_match,</span><br><span class="line">        &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">firefly_adc_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">printk(<span class="string">&quot;%s %s %d\n&quot;</span>, __FILE__, __FUNCTION__, __LINE__);</span><br><span class="line"><span class="keyword">return</span> platform_driver_register(&amp;firefly_adc_driver);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __exit <span class="title function_">firefly_adc_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">printk(<span class="string">&quot;%s %s %d\n&quot;</span>, __FILE__, __FUNCTION__, __LINE__);</span><br><span class="line">platform_driver_unregister(&amp;firefly_adc_driver);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(firefly_adc_init);</span><br><span class="line">module_exit(firefly_adc_exit);</span><br><span class="line"></span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux驱动 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux驱动 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rockchip之pwm驱动</title>
      <link href="/2022/04/20/rockchip%E4%B9%8Bpwm%E9%A9%B1%E5%8A%A8/"/>
      <url>/2022/04/20/rockchip%E4%B9%8Bpwm%E9%A9%B1%E5%8A%A8/</url>
      
        <content type="html"><![CDATA[<p><em><strong>设备树的pwm节点：</strong></em></p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vi rk3399.dtsi:</span></span><br><span class="line"><span class="symbol">pwm0:</span> <span class="title class_">pwm@ff420000</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">compatible</span> <span class="operator">=</span> <span class="string">&quot;rockchip,rk3399-pwm&quot;</span>, <span class="string">&quot;rockchip,rk3288-pwm&quot;</span><span class="punctuation">;</span></span><br><span class="line">        <span class="attr">reg</span> <span class="operator">=</span> <span class="params">&lt;<span class="number">0x0</span> <span class="number">0xff420000</span> <span class="number">0x0</span> <span class="number">0x10</span>&gt;</span><span class="punctuation">;</span></span><br><span class="line">        <span class="meta">#pwm-cells = &lt;3&gt;;</span></span><br><span class="line">        <span class="attr">pinctrl-names</span> <span class="operator">=</span> <span class="string">&quot;active&quot;</span><span class="punctuation">;</span></span><br><span class="line">        pinctrl<span class="number">-0</span> = <span class="params">&lt;<span class="variable">&amp;pwm0_pin</span>&gt;</span><span class="punctuation">;</span></span><br><span class="line">        <span class="attr">clocks</span> <span class="operator">=</span> <span class="params">&lt;<span class="variable">&amp;pmucru</span> PCLK_RKPWM_PMU&gt;</span><span class="punctuation">;</span></span><br><span class="line">        <span class="attr">clock-names</span> <span class="operator">=</span> <span class="string">&quot;pwm&quot;</span><span class="punctuation">;</span></span><br><span class="line">        <span class="attr">status</span> <span class="operator">=</span> <span class="string">&quot;okay&quot;</span><span class="punctuation">;</span></span><br><span class="line"><span class="punctuation">&#125;;</span></span><br></pre></td></tr></table></figure><p>这个设备树节点会和pwm-rockchip.c匹配，调用probe函数：</p><p>根据设备树的信息，配置pwm的底层寄存器，把每个pwm通道都编一个index索引值都放入一个链表。以后我们要用某个pwm端口的时候就直接request端口就行了。</p><p><em><strong>pwm使用实例：</strong></em></p><p><em><strong>修改设备树：</strong></em></p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol"> pwm_demo:</span> <span class="title class_">pwm_demo</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">status</span> <span class="operator">=</span> <span class="string">&quot;okay&quot;</span><span class="punctuation">;</span></span><br><span class="line">        <span class="attr">compatible</span> <span class="operator">=</span> <span class="string">&quot;firefly,rk3399-pwm&quot;</span><span class="punctuation">;</span></span><br><span class="line">        pwm_<span class="attr">id</span> <span class="operator">=</span> <span class="params">&lt;<span class="number">0</span>&gt;</span><span class="punctuation">;</span>      <span class="comment">//使用pwm0通道</span></span><br><span class="line">        min_<span class="attr">period</span> <span class="operator">=</span> <span class="params">&lt;<span class="number">0</span>&gt;</span><span class="punctuation">;</span></span><br><span class="line">        max_<span class="attr">period</span> <span class="operator">=</span> <span class="params">&lt;<span class="number">10000</span>&gt;</span><span class="punctuation">;</span></span><br><span class="line">        duty_<span class="attr">ns</span> <span class="operator">=</span> <span class="params">&lt;<span class="number">5000</span>&gt;</span><span class="punctuation">;</span></span><br><span class="line"><span class="punctuation">&#125;;</span></span><br></pre></td></tr></table></figure><p><em><strong>编写驱动程序：</strong></em></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/iio/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/input.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/input-polldev.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/of.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/platform_device.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/property.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/slab.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/delay.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/err.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/gpio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/gpio/consumer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/iio/consumer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/interrupt.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/pinctrl/consumer.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/pwm.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">pwm_device</span> * <span class="title">pwm_device</span> =</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">firefly_pwm_probe</span><span class="params">(<span class="keyword">struct</span> platform_device *pdev)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> ret;</span><br><span class="line"></span><br><span class="line">    printk(<span class="string">&quot;firefly_pwm_probe!\n&quot;</span>);</span><br><span class="line">pwm_device = pwm_request(<span class="number">0</span>, <span class="string">&quot;firefly-pwm&quot;</span>);</span><br><span class="line">ret = pwm_config(pwm_device, <span class="number">500000</span>, <span class="number">1000000</span>);</span><br><span class="line">ret = pwm_enable(pwm_device);</span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">firefly_pwm_remove</span><span class="params">(<span class="keyword">struct</span> platform_device *pdev)</span></span><br><span class="line">&#123;</span><br><span class="line">printk(<span class="string">&quot;%s %s %d\n&quot;</span>, __FILE__, __FUNCTION__, __LINE__);</span><br><span class="line"></span><br><span class="line">pwm_disable(pwm_device);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">of_device_id</span> <span class="title">firefly_pwm_match</span>[] =</span> &#123;</span><br><span class="line">     &#123; .compatible = <span class="string">&quot;firefly,rk3399-pwm&quot;</span> &#125;,</span><br><span class="line">     &#123;&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">platform_driver</span> <span class="title">firefly_pwm_driver</span> =</span> &#123;</span><br><span class="line">    .probe      = firefly_pwm_probe,</span><br><span class="line">    .remove     = firefly_pwm_remove,</span><br><span class="line">    .driver     = &#123;</span><br><span class="line">        .name   = <span class="string">&quot;firefly_pwm&quot;</span>,</span><br><span class="line">        .owner  = THIS_MODULE,</span><br><span class="line">        .of_match_table = firefly_pwm_match,</span><br><span class="line">        &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">firefly_pwm_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">printk(<span class="string">&quot;%s %s %d\n&quot;</span>, __FILE__, __FUNCTION__, __LINE__);</span><br><span class="line"><span class="keyword">return</span> platform_driver_register(&amp;firefly_pwm_driver);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __exit <span class="title function_">firefly_pwm_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">printk(<span class="string">&quot;%s %s %d\n&quot;</span>, __FILE__, __FUNCTION__, __LINE__);</span><br><span class="line">platform_driver_unregister(&amp;firefly_pwm_driver);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(firefly_pwm_init);</span><br><span class="line">module_exit(firefly_pwm_exit);</span><br><span class="line"></span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux驱动 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux驱动 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mmc子系统</title>
      <link href="/2022/04/10/mmc%E5%AD%90%E7%B3%BB%E7%BB%9F/"/>
      <url>/2022/04/10/mmc%E5%AD%90%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<p>Linux kernel把mmc、sd以及sdio三者的驱动代码整合在一起，俗称mmc子系统。源码位于drivers&#x2F;mmc下。其下有三个子目录，分别是：card、core、host，其中，card用于构建一个块设备作为上层与mmc子系统沟通的桥梁；core抽象了mmc、sd、sdio三者的通用操作；host则是各类平台上的host驱动代码，包括如TI Omap的omap_hsmmc，三星的s3cmci等。具体的SOC，会根据实际情况再次封装(比如rockchip采用新思designwave的IP)，就重新封装为struct dw_mci。DesignWare是SoC&#x2F;ASIC设计者最钟爱的设计IP库和验证IP库。它包括一个独立于工艺的、经验证的、可综合的虚拟微架构的元件集合，包括逻辑、算术、存储和专用元件系列，超过140个模块。</p><h1 id="一、mmc子系统涉及总线-SD为例"><a href="#一、mmc子系统涉及总线-SD为例" class="headerlink" title="一、mmc子系统涉及总线(SD为例)"></a>一、mmc子系统涉及总线(SD为例)</h1><h2 id="1-1-整体框架"><a href="#1-1-整体框架" class="headerlink" title="1.1 整体框架"></a>1.1 整体框架</h2><p>①Host驱动相应的driver和device挂载在Linux内核内置的虚拟抽象总线platform_bus_type。设备树指定compatible属性与源码匹配后调用对应的probe函数来初始化对应平台的host硬件。</p><p>②Card驱动相应的driver和device挂载在mmc自己创建的虚拟总线mmc_bus_type下。该总线的结构体定义在driver&#x2F;mmc&#x2F;core&#x2F;bus.c；因为是统一的协议，mmc_driver在内核已经写好并已注册：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">driver/mmc/card/block.c</span><br><span class="line">--&gt;mmc_blk_init()</span><br><span class="line">--&gt;mmc_register_driver(&amp;mmc_driver)；</span><br></pre></td></tr></table></figure><p>③SD卡中extended CSD寄存器中存储分区信息，上电检测到了SD卡，或者上电之后的热拔插操作，触发mmc_rescan查找检测到SD卡插入后，会通过读取该寄存器的值，获取mmc card的分区信息等，然后注册对应的mmc_card device，因mmc driver仅有一个，因此针对mmc bus而言其match函数直接返回1，表示匹配成功(因为是统一的协议)，而不需要像spi&#x2F;i2c总线的match接口那样对设备和驱动进行匹配检测；随后调用mmc_driver的probe函数（拔出卡则反之操作）。</p><p>④mmc_driver的probe函数针对该mmc card的每一个分区，均执行如下操作：</p><ol><li>为每一个分区，创建对应的通用磁盘设备gendisk；</li><li>设置gendisk的fops为mmc_bdops；</li><li>为每一个通用磁盘设备，均创建request_queue及其处理方法；</li><li>为该通用磁盘设备创建mmc block块i&#x2F;o请求机制；</li><li>将该分区的通用磁盘设备注册至块设备i&#x2F;o，以便应用层可通过块设备访问该mmc card 分区；</li></ol><h2 id="1-2-设备-总线-驱动模型"><a href="#1-2-设备-总线-驱动模型" class="headerlink" title="1.2 设备-总线-驱动模型"></a>1.2 设备-总线-驱动模型</h2><p>在分析MMC子系统的设备-总线-驱动模型时，可以借助已经分析的i2c驱动模型、spi驱动模型的实现，来学习mmc子系统的驱动模型，通过与i2c驱动模型、spi驱动模型的对比，也可以加深我们对mmc子系统驱动模型的理解（从已知去学习未知，可提供我们的学习效率）。</p><p>我们知道针对复杂的设备，则需要借助控制器进行通信，而针对i2c、spi、mmc而言，均需要对应的控制器实现与该类设备的通信。而针对这三类控制器，其模块都进行了抽象。</p><p>i2c控制器抽象为i2c adapter、spi控制器抽象为spi master，而针对mmc控制器，则抽象为mmc host；而针对这三种类型设备的抽象，i2c设备抽象为i2c client、spi设备抽象为spi device、mmc device抽象为mmc card。</p><h2 id="1-3-三类驱动模型的异同"><a href="#1-3-三类驱动模型的异同" class="headerlink" title="1.3 三类驱动模型的异同"></a>1.3 三类驱动模型的异同</h2><p>①均为控制器创建了对应的class，用于将对应的控制器设备链接至对应的class上</p><p>②针对i2c adapter、spi master这两类而言，其驱动模型中均创建了对应的链表，将所有注册的控制器设备链接在一起，而mmc子系统并没有为mmc host创建类似的链表；</p><p>③I2c&#x2F;spi设备不属于热插拔设备，因此在具体系统的板级文件或者设备树中，需要针对系统中存在的i2c&#x2F;spi设备定义注册信息，从而在LINUX系统初始化时完成i2c&#x2F;spi设备的注册；而针对mmc子系统其属于热插拔的，因此在系统初始化时不需要单独进行设备的注册；</p><p>④针对mmc子系统而言，针对mmc card的注册，mmc子系统提供了rescan接口，而该接口作为延迟工作队列的回调函数。针对mmc card而发起rescan扫描的时机如下：</p><ol><li>在mmc host添加的时候，执行一次mmc card的扫描操作。</li><li>热拔插过程执行扫描。</li></ol><p><em><strong>这里大概分三个情况来描述热插拔识别流程：</strong></em></p><ol><li>SOC带卡检测引脚，即mmc控制器部分带专门的中断寄存器位（MCI中断）</li><li>SOC不带卡检测引脚，即用普通中断引脚做检测（即sdmmc_cd引脚）</li><li>没有专门的寄存器，也没有用cd的gpio中断，采用轮询POLL</li></ol><h1 id="二、mmc子系统函数调用流程-SD为例"><a href="#二、mmc子系统函数调用流程-SD为例" class="headerlink" title="二、mmc子系统函数调用流程(SD为例)"></a>二、mmc子系统函数调用流程(SD为例)</h1><h2 id="2-1-设备树mmc节点"><a href="#2-1-设备树mmc节点" class="headerlink" title="2.1 设备树mmc节点"></a>2.1 设备树mmc节点</h2><p>关于SD卡的HOST最初始设备树节点在rk3399.dtsi</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">sdmmc:</span> <span class="title class_">dwmmc@fe320000</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">compatible</span> <span class="operator">=</span> <span class="string">&quot;rockchip,rk3399-dw-mshc&quot;</span>,</span><br><span class="line"> <span class="string">&quot;rockchip,rk3288-dw-mshc&quot;</span><span class="punctuation">;</span></span><br><span class="line"> ............................</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="2-2-Host驱动流程"><a href="#2-2-Host驱动流程" class="headerlink" title="2.2 Host驱动流程"></a>2.2 Host驱动流程</h2><p>Host驱动相应的driver和device挂载在Linux内核内置的虚拟抽象总线platform_bus_type。我们设备树host device与driver匹配后调用对应的probe函数来初始化对应平台的host硬件。 </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">drivers\mmc\host\dw_mmc-rockchip.c</span><br><span class="line"><span class="title function_">dw_mci_rockchip_probe</span><span class="params">(<span class="keyword">struct</span> platform_device *pdev)</span></span><br><span class="line">--&gt; <span class="title function_">dw_mci_pltfm_register</span><span class="params">(pdev, drv_data)</span>; <span class="comment">//解析设备树信息，用来构造一个dw_mci *host；</span></span><br><span class="line">--&gt; dw_mci_probe(dw_mci *host); <span class="comment">//将上面构造好的dw_mci *host结构体传参进来；</span></span><br><span class="line">--&gt; setup_timer(&amp;host-&gt;cmd11_timer,dw_mci_cmd11_timer, (<span class="type">unsigned</span> <span class="type">long</span>)host); <span class="comment">//设置一些定时器，定时发送一些命令</span></span><br><span class="line">--&gt; host-&gt;dma_ops = host-&gt;pdata-&gt;dma_ops;</span><br><span class="line">--&gt; ret = devm_request_irq(host-&gt;dev, host-&gt;irq, dw_mci_interrupt, host-&gt;irq_flags, <span class="string">&quot;dw-mci&quot;</span>, host);</span><br><span class="line"><span class="comment">//这个dw_mci_interrupt中断函数会被注册两次，一次是emmc(irq=25)，一次是sd卡(irq=26),所以源码虽然只注册了一次,但是实际上注册了两次，用的都是同一个中断处理函数</span></span><br><span class="line"><span class="comment">//这个是mci寄存器的中断，我们的这款soc可以根据这个寄存器来判断发送，接收，SD卡热拔插的行为，都会触发这个中断，在这个中断处理函数里面再细分是什么操作触发的中断，进行处理，比如热拔插：</span></span><br><span class="line">--&gt; dw_mci_init_slot(dw_mci *host, i); <span class="comment">// 定义了mmc_host *mmc;，用我们封装了一层的dw_mci *host去填充注册他</span></span><br><span class="line">--&gt; mmc = mmc_alloc_host(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> dw_mci_slot), host-&gt;dev);</span><br><span class="line">--&gt; INIT_DELAYED_WORK(&amp;host-&gt;detect, mmc_rescan); <span class="comment">//初始化工作队列，里面有扫描SD卡的函数</span></span><br><span class="line">--&gt; mmc-&gt;ops = &amp;dw_mci_ops; <span class="comment">//mmc_host_ops类型的变量，用于定义本mmc_host的操作接口(包括与mmc card通信的接口request、卡检测相关的接口等)</span></span><br><span class="line">--&gt; mmc_add_host(mmc);</span><br><span class="line">--&gt; mmc_start_host(mmc_host *host);</span><br><span class="line">--&gt; mmc_schedule_delayed_work(&amp;host-&gt;detect, delay); <span class="comment">//上电添加mmc_host的时候，先主动执行一次mmc_rescan函数</span></span><br><span class="line">--&gt; dw_mci_enable_cd(host); <span class="comment">//cd = card detect ≠ sdmmc_cd 引脚中断，主要看函数内容，像这款soc就是在里面开启mci寄存器的SD卡热拔插中断</span></span><br><span class="line">--&gt; temp = mci_readl(host, INTMASK); temp  |= SDMMC_INT_CD; mci_writel(host, INTMASK, temp); <span class="comment">//开启mci寄存器的SD卡热拔插中断</span></span><br></pre></td></tr></table></figure><h2 id="2-3-热拔插中断流程"><a href="#2-3-热拔插中断流程" class="headerlink" title="2.3 热拔插中断流程"></a>2.3 热拔插中断流程</h2><p>假设热拔插SD卡引起了中断： </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">dw_mci_interrupt()</span><br><span class="line"><span class="keyword">if</span> (pending &amp; SDMMC_INT_CD)</span><br><span class="line">dw_mci_handle_cd(dw_mci *host);</span><br><span class="line">--&gt; mmc_detect_change(slot-&gt;mmc,msecs_to_jiffies(host-&gt;pdata-&gt;detect_delay_ms));</span><br><span class="line">--&gt; _mmc_detect_change(host, delay, <span class="literal">true</span>);</span><br><span class="line">--&gt; mmc_schedule_delayed_work(&amp;host-&gt;detect, delay); <span class="comment">//开启工作队列</span></span><br><span class="line">--&gt; mmc_rescan() <span class="comment">//最终会调用此函数</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 重点看看mmc_rescan检测SD卡热拔插的函数，我们在设备树中的SD卡定义了 supports-sd 所以：</span></span><br><span class="line">drivers\mmc\core\host.c </span><br><span class="line">mmc_of_parse</span><br><span class="line"><span class="title function_">if</span> <span class="params">(of_property_read_bool(np, <span class="string">&quot;supports-sd&quot;</span>))</span></span><br><span class="line">host-&gt;restrict_caps |= RESTRICT_CARD_TYPE_SD; </span><br><span class="line"> </span><br><span class="line">mmc_rescan()</span><br><span class="line"><span class="keyword">if</span> (host-&gt;bus_ops &amp;&amp; !host-&gt;bus_dead &amp;&amp; !(host-&gt;caps &amp; MMC_CAP_NONREMOVABLE)) <span class="comment">//上电第一次调用这个函数时候，还没有设置host-&gt;bus_ops，所以会执行后面的语句来设置host-&gt;bus_ops</span></span><br><span class="line">host-&gt;bus_ops-&gt;detect(host);</span><br><span class="line">--&gt; mmc_rescan_try_freq(host, max(freqs[i], host-&gt;f_min)) <span class="comment">//以各种频率给host发，选择最合适的频率</span></span><br><span class="line"><span class="keyword">if</span> ((host-&gt;restrict_caps &amp; RESTRICT_CARD_TYPE_SD) &amp;&amp; !mmc_attach_sd(host)) <span class="keyword">return</span> <span class="number">0</span>; 所以就会调用mmc_attach_sd</span><br><span class="line">--&gt; mmc_attach_sd(host)</span><br><span class="line">--&gt; mmc_attach_bus(host, &amp;mmc_sd_ops);</span><br><span class="line">--&gt; host-&gt;bus_ops = ops; <span class="comment">//这里的ops就是上面的mmc_ops参数</span></span><br><span class="line">--&gt; mmc_sd_init_card(host, rocr, <span class="literal">NULL</span>);</span><br><span class="line">--&gt; card = mmc_alloc_card(host, &amp;sd_type);</span><br><span class="line">--&gt; mmc_add_card(host-&gt;card);</span><br><span class="line">--&gt; device_add(&amp;card-&gt;dev);</span><br><span class="line">--&gt; bus_add_device(dev); <span class="comment">//Add the device to its bus&#x27;s list of devices, 会给mmc_bus注册一个devices，会和系统自动注册的mmc_driver匹配，调用它的probe函数</span></span><br><span class="line">                        ......</span><br><span class="line">                        --&gt; mmc_driver-&gt;probe</span><br><span class="line">                        --&gt; mmc_blk_probe() <span class="comment">//如上分析的，会读取SD卡的寄存器获取分区信息，根据分区信息注册block等。</span></span><br></pre></td></tr></table></figure><p>放一张图中好看些：</p><p><img src="2.1mmc%E5%AD%90%E7%B3%BB%E7%BB%9F%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B1.png" alt="2.1mmc子系统函数调用流程1"></p><h1 id="三、mmc-host相关数据结构"><a href="#三、mmc-host相关数据结构" class="headerlink" title="三、mmc_host相关数据结构"></a>三、mmc_host相关数据结构</h1><h2 id="3-1-数据结构关联"><a href="#3-1-数据结构关联" class="headerlink" title="3.1 数据结构关联"></a>3.1 数据结构关联</h2><p><img src="3.1%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%85%B3%E8%81%94.png" alt="3.1数据结构关联"></p><h2 id="3-2-mmc-host"><a href="#3-2-mmc-host" class="headerlink" title="3.2 mmc_host"></a>3.2 mmc_host</h2><p><img src="3.2mmc_host.png" alt="3.2mmc_host"></p><h2 id="3-3-mmc-card"><a href="#3-3-mmc-card" class="headerlink" title="3.3 mmc_card"></a>3.3 mmc_card</h2><p><img src="mmc_card.png" alt="mmc_card"></p><p>mmc_card结构体变量的定义如下，主要内容如下：</p><ol><li>host完成mmc_card与mmc_host的绑定；</li><li>dev完成将该mmc_card与系统中的设备、总线、驱动的关联（即完成与系统设备驱动总线的关联与绑定操作）；</li><li>卡类型与卡状态记录；</li><li>卡相关的寄存器信息记录（主要从mmc card中读取），包括cid、csd、scr、ssr等内容；</li><li>Mmc card的分区信息，主要完成块设备的创建（由mmc driver实现）；</li><li>若为sdio设备，则有cccr、cis等（关于sdio的部分，请参考sdio协议相关的文档）；</li></ol><h2 id="3-4-mmc-ios"><a href="#3-4-mmc-ios" class="headerlink" title="3.4 mmc_ios"></a>3.4 mmc_ios</h2><p><img src="mmc_ios.png" alt="mmc_ios"></p><p>该结构体主要定义mmc总线相关的参数，主要包括时钟频率、电源、总线模式、电源状态、总线带宽、支持的信号电压值等等这些参数的设置可通过mmc_host_ops-&gt;set_ios实现。</p><h2 id="3-5-mmc-host-ops"><a href="#3-5-mmc-host-ops" class="headerlink" title="3.5 mmc_host_ops"></a>3.5 mmc_host_ops</h2><p><img src="mmc_host_ops.png" alt="mmc_host_ops"></p><p>该数据结构定义了mmc_host的操作方法，主要包括如下：</p><ol><li>若mmc_host支持enable、disable，则需要实现这两个接口（可参考mmc_controller的用户手册）；</li><li>pre_req、request、post_req主要定义了mmc controller访问mmc card的方法，mmc controller驱动至少应完成request接口的定义；</li><li>set_ios接口主要用于设置mmc_controller总线相关的参数，mmc_host需要完成该接口的定义；</li><li>get_ro用于获取mmc card 的读写权限，若mmc controller提供检测mmc card读写权限的功能，则需要提供该接口；</li><li>get_cd为卡是否在位的检测接口（该接口非必须），可查看mmc controller的用户手册，确定是否支持；</li><li>init_card为mmc card初始化接口，主要是对mmc card&#x2F;mmc controller一些特定的初始化参数，若没有特殊对待项，该接口不需要处理；</li><li>剩下几个接口大多数驱动也没有实现，这几个接口可参考具体的mmc协议，大多数的mmc host驱动基本上不需要实现；</li></ol><h2 id="3-6-mmc-bus-ops"><a href="#3-6-mmc-bus-ops" class="headerlink" title="3.6 mmc_bus_ops"></a>3.6 mmc_bus_ops</h2><p><img src="mmc_bus_ops.png" alt="mmc_bus_ops"></p><p>该结构主要是针对mmc card的sleep&#x2F;awake的操作，因mmc card也需要进行sleep&#x2F;awake等接口，这些接口类似于设备驱动的电源管理（suspend&#x2F;resume）相关的接口。该结构体中的成员，不需要我们进行实现，mmc子系统已经完成，mmc子系统根据mmc各协议版本针对sleep&#x2F;awake的支持情况，实现对应的操作：</p><ol><li><p>若为mmc 4.3及以上的协议，则支持sleep&#x2F;awake接口；</p></li><li><p>remove接口实现mmc card的移除操作，主要是解除mmc card与mmc host的绑定，并将mmc card从mmc 总线上移除；</p></li><li><p>detect&#x2F;alive主要是卡在位检测以及卡是否移除检测；</p></li><li><p>针对suspend&#x2F;resume接口，针对mmc 不同版本的协议，其功能有所不同：</p><p> 4.1. 若card支持poweroff notify机制，则进入poweroff状态；<br> 4.2. 若card支持sleep状态，则进入sleep状态，针对mmc rev&gt;&#x3D;1.3的情况；<br> 4.3. card不支持以上两种状态，则向card发送deselect命令;</p></li><li><p>power_restore接口，即为mmc_power_restore接口，该接口目前即调用mmc_init_card，根据mmc 协议，完成mmc card的初始化操作。</p></li></ol><p><em><strong>参考这位博主：<a href="https://jerry-cheng.blog.csdn.net/article/details/104717742">LINUX MMC子系统分析之一 概述jerry_chg的博客-CSDN博客linux mmc子系统</a></strong></em></p>]]></content>
      
      
      <categories>
          
          <category> Linux驱动 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux驱动 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>platform总线驱动设备</title>
      <link href="/2021/10/20/platform%E6%80%BB%E7%BA%BF%E9%A9%B1%E5%8A%A8%E8%AE%BE%E5%A4%87/"/>
      <url>/2021/10/20/platform%E6%80%BB%E7%BA%BF%E9%A9%B1%E5%8A%A8%E8%AE%BE%E5%A4%87/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="想白嫖，没门！" data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="a5f2d157f7921c2f0e4c522ddd6603fc42d3f2293b69891774dfa6b5033b9949">571d5de1f5a053f5c86199ac456cb1a43eb166bd6254c6c81e96bfa55ef337b3dd8cedb383ade860226e2b77d7ee960897af809984652b457c0f2b75e550e32141e1228e2570478c1caedb298e95b899b030d4b5129d1542b2591f933aa330c84a3c3faa5ae6722db982d54aa91a41ca9f28c9c11c9b0d9da0cd81124772c5da80af58d0c5d0858c49b92ebb81d6cf4ccc21fbd64e3b604fdeea9fb8c592be149f6fc0dd9d973837c5bd5463a6c6cef89c6cabf95861917ea6d64d4b6a2baf87521d4489a3f03dd2a1ccc83b47e54e1585b5a46da37afe4de837c7f68ee6d71214775d7216fb13174a36a3a5ac1e8802c2142bed6f5ef0e44797ba9d15e75fcf437142cf3fa5c8f224c77256a2bf676dea868a4cbe744fc3856c866917657ca132752f1b761283f98555af559a6c2d92fec84b92a9f8377e6f1617f90ce85a611cdd6598a5ddd36a27c5cc22ee4fbbd7601455d23c2fd58c16037963a4e10a4bd949c4b9667aafc12361ccf4694940a3c77424928d53369b561404c6c2df77b3b9dc519d4001291b44813e43575777b15921b9a9436fad95525d7bdb6738a1a5b170ce1f88a86db8acd5cf28b7d072129905a75e11bac9def0fa0666dfc4eb208e7f5c55bd54a6f60347f5aa701d8ad7aa16f6acaec747a6c14f2b6899a6445d6b5a93480586fdccac7be875fb6f2ccd734575c3cabb2bd12821b1872511e3886adcce3c5471671bb8ecf10b9686884b3f0f5deb84576c6500cbe759a09967db88b2313c80eb1e08746ebc36922089cc16d0264e92e59dbbe90fdf16e4f145ca1d62f7b2f60775d6ca841bef84f915c7c28fda5586b5f1c0acceccb3e4dcb05d142570c992f630b29bb43a753f2bae7b5655e1b85a8eb7d294e9b5e0c268bbdc167c0867662fc4ee36e517605a4972b107acf7e5404b239d47c167d2e10ecc5ae4e8d4df29da677f087f648c6f7485459aecb39cc01676c08d8deeb4e35fe1aa2a240c581fdbdcaf16893939cec7de8b2943c300d43ed4eab3ee70cb0e7906f20bf1925df74af4b97a9333997e529e3caf8175ca7ad67d94e3abdcf4f25b9d6947cf79bc40bc60a71ab308fabf611586749741d1bdc2a3095db0c3c890663a00db60a2f9c19659c9784514e871f2de46f157b2e04fb8a3b54c4e72e849e14dc881dd67a3ab249e8f425441ea9380fef7955c251529a4a643c31414e0a20761df1d0423764c92a3d23e3851e197e0f27f21dcb538b268ce58458a0113f6618d79c90f8a94b8a493988aa0d19edf46a26d3451c6ae83e04f120cbc1d2acd77d7ee813e0042be073dbddfbe00254ac2e38f6bd0ac5e8f71d6f2f2c34209265eb15313747ae17030bcbd0723327c26b79874a5bcb51d51685d241ec3fe6e8e498b70129129d404e95e84116ceb258a00386b01a52423212f9c8ee3b051db2ed134a9febcf3838dc1394e8b15b745056b1b9d5b5189f35ce702ccf391ca4407e35b336fd89795ae9ba5cec3e689e69369edc860dc619c04ebb43b9cc4c281fedd20a338cf152eed35592553a7f3d8d63ba2310d733c93897bd8e85433ce17aab163502fa07409c771dcb8b2670f7a4d622e31da7cbf0f9b7c80ae623d0c79983a8048caf21f28ec3df899bf34963a22fe704917971a083344a4733fd6a0a1bbd182d8dd8d464cb5bc45c178fff9788cdc866a88d4420e7e6a54cc8d912504d166fa4b0d833379123dcbc693cc0d541da07c3c909c67ad0313af5bc0f549a5d6c9da0a1f0dc3d61c36c75b75f886025e69ea9342b399a73cdbde35e601c5f2eb59a44c999e5a3de6ad97352001ef81e2f834aeb17cdd1903cdf472dc4498ef42572f4820bc2ba4442adbf64d92b9fcb7558213806e1b9cdc8742c103d6c1934034125a9384d6677b132a6b4d50e1c6f0ed6bb96cd9e3530870834fe579a2aa1ba3fa6fc9fc3ac15c9bff3626228c0102bc7e4b560097a84b4893532f3aba82e0304af1e4904ce16ca01c8afe4b8d40475d90846727bb6f7f805a2471790e9369eb7300444bbdfb16d9647bd9b827c106f122afb2e41c875d0e445b5fe163c2448d37d218435588bbc51e0ac1b14d9559ccad7b91c7a01108c8054987e507a608d03c3117da18720e83307f6019d600d23548eed407c26a906614f804e803637e26bb1bcc97e7a24f81d054db1bd1f75ce14cd077b9a971cce2c3aa87edd35a263fd26cc5ad482310bfeb1e21c562e24f4ac217662e2cfc2f09c105447883643216692083bb682c7f3d6f950c47b151070af74bb85bc061d42d51d0c72a03c201fcbc3935ced5fb4c80688bf074074724f62eb879d75e3ce791d69ee18105199359a5457f2eda53a601344fdaf45a2f66f419dc6d7a4e7499197852bafa0cfec825adc62d67d564165186217f1a2d8c49e62c4a0d5f37037639397f8a3b3f9b507e29051c24d25a79351b5181db5fb710df240dfee2005f5d43b56bc5ef89257640b6e66fcc8ee869984e35e156d2d0186648f9a6686884479f3fd267189dfd2ddc8ddb275381cabe77f7b9394108469a4cc0e12d872f3dd662695bc0a60de8e600c691b29b3460afcc1a0593ab4124998f1fdcd7fa7c421223e59b559e00937c14cef720df4ba48b83dd56b7241dc337c45d09e7f13dcb841721d3a77caf82cf0f49a60e308e04a6e3359712b1794531a67c3420b47b53ac3dbb15eab9c4e49b8f9fefa26a4f6a3efe58b644460f055b2e656a428e91476771b5138ba7a314cf19d5e4a2e4e45c8432bd144960584fd6174181e702001fb14ca205b858f44eac0d18e6532cfc32982b1d6f5c5572694bd710ef35354ef1f7212228ce1bcfebab610db548302c7d1e2ab08576af01cf44acb21ca1ba0fa56d0847483d7c1dda193434e4727b98518c02a3f610ad324e83a5538a9000761db0920c3e2af221b7e3b711cb6bee5c081b5352ed5665452e9487349bf99443e9de5f12a54cfd2237e64cea2d543c41b6eb54851db4abc9289f7c9cbd79a9354271419c787fd47d11dfa9fbae177957f9e38c24fabaa9536d755f069846ef43d92ccb7cbe8749de480a79738906cac6529c2d107aec979745368d4f1fcc785b323e92f54f6b2bd26e5726e761b77cf4ad133c4797dce8c384a9277edf2a230e2a856da4dc8f917733344a077e9d776638915a1ae031c058a255b8dc22c42bde3caad97c50ef4657fc712926a163629cb5af29046841398cce3154c01f7f9dc8e3d1c4abab6253ef724cab3bd23ea82721f6e9256683b897806d4386c034c2fa3cab5d787abda20e54988afddbad0e57275da352bd6bf942b0b344185e460f24f5db11d72f1f720ef0d16e667f92bc6ccae847902d88fc24b3ee131c9993a686e4e07f1cbc2d18e14d8b4feb39c0cbb145c7e4f658a347b40bfe9881898dd0a553a803aefb13177f09d0d6645d948704446ea3b2d03f12f8c34420e2d4a81bea3cbab20c2eb9d9354ff127ad3d88d7c8701313c5f22af9a24f0ed0cdd9dfd8827086827f42bb01811f4bd23834ba13ab745e32301d8a89a0a1e43e66cef0ccf2fda6f5994cf9ede33a46038a555d7077a42f9ee22ff698759ee51db723ac7badfb49db5192d4f262ceec5650a4c6593eeedc2e69e312f356d460803a29362b91c9529becfbb57bd77b4a84efa13574a4c223ecde8f181ceaf7c1427375fd0c14d04c5b32cca8c185232e39021252a45fb64a44590a843d5b6eaec378a1c0e79c8306fe3e8f2b528bafdb8e79fa981d6f5b1774c99d4c398e182353e7654c10df7794252af0b3c390d8908ccfff26521779bdcf38d29fa6222ab0a1054b179384383ba14fb8295bcb9462a030cb706bc23fcec2da9d179ccf30813375341f7381eb452cf271654dc6714dced003794f873ce8a6a7e35f380c569bd76c3d92c882f7ac6a1f0ec273a99a613606b0e408f88067c09784013e2c8ca3800357a08f4f2dac2ebc7109c408bf8331e337449b6b31b23ccd668c925321879fd49ea91cdabc5dd3bd7c36cfb97882342f84ddc2fd9b827af974d0db2d0ecf61ff4187dd06d272a0c7c6114e335c0b7e3b6b22c4c0209ec004d6473ab6837cc91815e32a4b9155a3ab84f32ad054589dc56bff6bb1af95a3e4443066d6cc71f56355f4eeff1b091339db2e611efb9aa9887ea396961deffc166169b99614401765087ee73eaab7d3786005ac88fcd22a52a5b88ddd22bde8da66456f7f221695d5f9473d9c408b6bb3cd2da0f314d634dfc05df0aea82b669df423483689e30704a56b9342338a36dfb3d6729f7282662d13900966daed10a1a9e87f1549b87de490d5956eace0207d68a8e0839034e100f0abcc71724d70a3b2ad27a3fb510b00c46bf12b2d44423cf98f681905fcee7eb88657f0e6457cc97d97fff6d57a203b6470cc0c308d8c7f121a3ac26e729d2ab60db2d1bbe81c893b6b76f938a5c01648105550a55b1b8cd389b62100f49f3090d958cc57cdfc959bda86276475a5d4a4cfc5d589385add895b3e80261464cdb18db42608a055f36ff6b4cfcc8c038b5ec5622878e7955397d4a62252bc399a0e4b09afed87ab1dc91147de082d1ff7210039878d69c7b5fd1584148def4a5c64675006adc9e3500ad7ec37fc247b8d33dab82594ac900ad98b24d124e5b9c185e046bfefb857718729427bebc2109c371688dff5d4e6825f0f08ce35a827d9e224840b9d7a4b538912337b0758936d88e6f934fcc5225f495d4f092b8a9d733dd16b2b14d521e5e2d0f3f40a3b8d1682412e0d10e89b71335c948dba9dd9c18de1e5f06832699eede58a0591beb9a5686dee80a3feb4550285d3046d93026602139b2a3897b3926720dd03fe8d2dfba8b0883e483179ba668f77b9097742604564f540b95368bc3733c8413369a4f20de44d3c95575b8eac09676477b7bb1c8098f70ec30da45537c4faf1f55571f523272daafa522d1bb6adf3e91532b41d7fde1735ea4f07dacf3f4549f21eea0fb1fdf0974751db3e93a85e63dc53108f65b519aa933568865d3d6804b449fa15c4ad2373f0bb282e03486a9368e629be6544870a8c66c91370d1114c884903f80c10bd30168bcd0d73173954a13d7a83d9a79efcf11c6c3ee0c71826ae4ace81798c13d72b7f6498680cf31fa36338109d36ff658f4f1e560f2ec760fc4ad5f7c978c0c494234acbfda0fcc8977791cf96b678ff7608e6308fdab83f78fa05f410f94ecf1ba7419ac1f62d5c748d85d6ccccee2c26b6e2ca473ad3ef06cc77f398d8c20c8235e8f36245ca8ef16caaa2d55d663dba02ed8eafb7e590015ea9f963d56b2ffa90c65494001255bb9bc135d41b3c6453b43ecfb3dae048327668c8780a210557ee4d7dfbd45c86147f685c2881265bffdf29d7fb39a7cf41b874b374d213a296cf183635300c00926831d9e72aa31b27b74dc1a209404bd4ede7e09a75dd64223ddf7e7394f30afad7c8c71206dd1fa34031ed48097ef8e9965b86afe7fa4bbc45fbed15587740a8ebb4ff8f409a381b849d3de46a2294ab77dad0d010995fab6aa88f32f5cf6dc435382e484e8adb62b9cb99890e127644fd9539a0bdcae5491c46d5db53e119d05a4628e8659123927a4a7320da4d6cff5dbe3db3c3899647de6a0ff73b4684b8680fdd6a4e24464120ff3fa0a6cb18ed3a1e3585d3f05a2b07ea44d900fe4a66477d3b7a33d7147256722674373183099cc9dcb31f2c3693a08592320c2c01f9218a920de7ec5ec9eea4cd34495c28c0a8bdfd3509f3ab7f913bb5b641a1824d03082e6b0942003eb1d77b1df6fdd1f45542e02810d0c502baf738a4e6cbc8a8d361f783cbf4bb5b25e848d9952be6968e30c0698f2a34205ad623493a61c815a700dd8822ffa7e81b695abff65bdf0878e9d51a7a62d125b2a5fe827907f2036a93024c93fcefe145be8e390b18ea2854e242a7361788c6f2da34a2387793312b23712af000a2c5a5f2e4a64726de8ce9568cd2a17a8b1c76cdbc443fbc08876f0ea383f33e83d973be4237963088f899cf51c471a10e50abcae268103eb023184d238caa21636fe47fce4781247c51f51da9506a8bfccbc99c06a26359513b78b06f5f9f4947d40d188f76e892b463167a2177dfdefc83f71727f7ce6005fbba094531488904397ceb9f342802b9912950a9fee880ff65a657d7fbe896f84e7a1a700161a5c9503198e891bba3299c190aa673f54b0137017795321f83f9d59dc79e461eb971e2459a1d22e09696a09c54feb492cfabdcab12e29b7ca72748e90f4f7e02d337e5986f9e070b1ef7fecfa52a1d3ae8e1e476c4e9871a8dd9558d45276cac281ac86583474194ecdd761e015483e253dd4fdb67ed94ec8ca2b4df1c43f2024a7238915c0c38554ec0e746c230ccfebdc49c057ebc06bf9fbf440b02aeba5f2b96f644a868edf630917e3bb2fd1dc4da64039d2b49752c547f0ea44efbc6ec41e1aa72d76d5ba13d8d735b57e071f33fb554957af6dc1929a420036ac6ab6d4f300ab9c7bb9f752821398fcd48cbbf164b0ce5dba7f1678f8b34bb1ebb0aa24f66ce1973b8fbb9fcd2bc1e0226816dc769f2fc639678ce132cf3b0b86c24c0addd8e91089cb475340c2eddc79aae0f190d5d97e830124f8582bd45b6dc60b8a964fec6dcc58af65476583081e7a509287b35a649981394239d679b45a42391483c1d524bf689700d02c5b2c3f2c014b85c3fd653f81a4a46650bc7ee77fa4910f37c47836babd63b2697db8141d87468d175c59e8fee309ae62305de06a602e4852b1675677f5ade11af5fad9c4d01c850cc0acda71b469d67048706a490bcb34137dc8ec51f40e1580ac1581c22e4ca90506e8a5d4c32abdf24a94af7a904ebd4fdc4178c8f8a57d1ef57688d3db469f87b5916269570ed234cc4b089a9c261250baf15361815aa613507f4aa98b4a14fa7f77c8e000ae0ecfd71287ce7d052a42db3662a752a6826ba4b44ad15f7041efbdaf62400e42e7dd586724a10b0a413c23e9ccccf2384192d92ebbb7d31da031896cc814c70c2cd2d8b2d784c6727102adc911bf69acdbb529499dfcf5af8b4ae72f252529fdfc78dca77a0955c16b38ad762075b24d39964e8720a26f9d16a43d19295b5aa1b838f6e53fb8f56d0263fe986db830e7d946f9dcce8e276ed6c5b6045ab166d37e64625a4c00b948fbc8e05aa855adcf6669f03f286fb7eda9f9151b76af111d7dbacae4f9f1c580e2e81c425070796435a51a0e5d2aa366c7d8b057157736d89aef335e7bc3b1b45dbc3bc828cb468e897109ae36673c1878d548bbd491bd557e5c0f3c48c73df132e82d636f2a67ef3c1e7f48f418b19581397d5ed9a59a5a62e12fc1dffd44a40bd6dd03e1cd9bf773be8d556b262f07fe51eda4dd0d4ac48ddfec36a6317f730d46f7d63161ff5418379483477a1ea27aa0f7d628fc9b43ed388b95a72ed79c27b9b48e31506f63931faa4b39a6df1b5e0af1bec42d0f5d094bd7add6429407161dba019174ea29db8d045c193a82c64152fa660f830bea9267fd5d0d88f941d028219be76a514a5276f655e191aefaf5727ab9eeee6bf7bdaf3de12d19004e96da366945d867bb863039436254a80dd1fd1edbc6412eae64054db03331acdf17196d3308fce8f8a3005128386e2bf121840025eded2a454c126ec2befae5b01dfde1a775fcec54674f741a4d5e3e46f584512670b4829de297fd4f8e635422e9f24cd12c4229cb29ae39c78c65ab742322738cd035c450fc4eb562f1406de5ea9a26ba5f7edc03d8d1b9bc3b7fef6851596f8d8055dfdcf64c296ce0f9a33851274e7e5505057a04db3aa06983ea818e8594fd8c0bec077e4dacfdfa6ea35a88fc051bd0b312549fda543044af982d4feac12862289e57ce756fa6987d9b557728acba9d060eeb000d96a28142328cef29bdfd883f50caa181a4db483f5d815f6b1efd3b4b8c0d3602a0788536fa63cceb91cc88874e6d9211b4f5cf06949d7eb252eef97ba9d287e7f04b9c6f3e7f184beb6b2c4b8382abe2c495c62fe471c31addeafa786eaff2c12165c7af1dfefad0c37dbeff6bda210e32c1a6c84a98b6b8dea206566b61c8135c63473cb12cfff64a1072c76940db096aeda8b6a85ee863ebab5fdd41e8b86a982b5083758998e7b02ef81d57c715ffd9e54ba3415201cf0e6e21aeaad0d15f243146292d3618c4002e1ed577e8825633fedb0947f0ba9c88eb1613b30ec5bbe919d506e69796d302a07a3536fad8e337e59e3d49a19a20d55ab695e1ce1d9c7090a62fe99e79942748d371ad56e211832afb4389bdd7862f4b260c33076778c7ebe9ae8fa620fb0f133b081598d4d4f349ec9c2baa66ab94d2b4f2527a8adcc1f61f102828d50e705a1dab26320129741ea0e51a1341b397c5ac745ec9630c5295bb4457a5f33a61ee96916383206555075039325395ac96ea568278458070d99a342823444d823e2744c4f441ffa5c2954bcffecf6fe6fb37f9bd2da96116a52ecb24251d4ebe1ab5dbc0552a6bd135f38b601eb85fb8bd1d44ce7dd49b2f1b2871291afac122cc49ca9fa1c9b403544d2e577474af1d15521a158ddd30500f993bc5a29a901799f6e47403cd02cc802a7aa60726e15db92891c088a0cf67f9ea934db8deceb1c47c4e049c4d31d2ca977a47e9a62afe2221a2617d81cfe91cdd18dc1ed5ba2cd0ed6fc8e69bbff38407d931e2910f7bdc5206dd8a0bdc613fc8704b4662ed0d56f4d569c51002770ea6b7b3109080dfe3e8b15ae808fd060be7de35b104a614ad575f3a5c5376666e17ccc331c922e6b529f877df579431e5ec37c0b398fe91d3ff9136383d1920d96d314e791a5760669ed1f80551d96d56a4db5b5443540ce616a3ee8965d8cc72cfd717f55b4dd857507d126735a346268b5d411f8aeae69dcb313448f7d7042d0aba855451e912b688efcc3120ef856b825212b2e315975336dcfa2ee946b1f015ac52dc6942ea9c64b94e6a45345a4a2afc57b4e5db332217625db0306eac2e1ca9f2f8859c6892f580b161bcb26e9039453850ea4f7580851fe7004fb60293fbe6c30d6cac8d3842d3ceb411a869b74a1dc803790c545ae9173d0f9ee2207cf0a7f6093120f6fd5a7ef38250d57411e24e40afd529841b2dae6907c2981132d301769e51a326c572d494fa2c41039772d01293acc6160229e286e9478a4af6e4eec5b202eb312a7c77c0810a49cb40ea9a994ea6d86c4cc8bc85eb0fbf11de364da8ec9e3f3d121d3d8f3bea341d53dd922c3703b69c9e4ec4a391be30bf689ba5852c1d762d29c0f12be35ba230eb416d216a241b36b80a2365162feabe54152a6c1bb4421e8557bc59319f68bfcde958a5e76367dbf793e477046d55b377c596380b6f9cd7e115dc71432a1fb20b88a3580ce0cf65433848d69e686f4f8619e392c0952183c47f696a9f000ec90c494834791771d7a8eb94a60fef8d9d22e599f60723c8e12d054f379752fc0bece0fbe9753523d59da27b69c10a0e0abb9d142399fd05f0ba1d4ce1a3ca6f9389ff2019b2708328eef761c2e322c056401bc94bbd7d50916653b026baa498c3013148a1202a6f37f75a6c0036be1708611339d73b7c2b706f558f9d62fa2d53583f9c656f8316b3e0bd5952f343efce820adcd0e34b0945e3fa12f4b43bd635533f8a7ac08376cba141d0d21b5fbeec243f8cf9c0a30b412155864b8d63c79cd390413c80580beb61d9de77c82867c1a3f7ab065f4d9101291561b6e550500f8650076f7effb7fe8f27695b57c6c1f559e224a4de3a649519193cb06695c883f1f302d9ff214ce5684e24200291e3238d97d8d131455e8d1ad66a8d154c417645c157894cfa70445205502667347fcd5df8325040e22e732dcc9f69d9fa0c09071751277c6cd131a3909c701f0599a5ccd60c8dc473c68113e72f73bb696aba48382c5e2b20bb29a306faad33500bddc6b9045f3dec164d3201d8b864b573738d89b3ef4d00c885b1cc274337c17103f68cb522eedf5025b821420da9528e7bbd284bd766e5db5ad306540388dbc0413fde30aecc0556ed69394d6c35b9313235cabdc5cb85a8dbfdf52f9afa8763f76e50e019f29b658823ab4652a42445b7b427a71a1126bd0ec3d0ff6bd927f55039b9070f9b59a5e8adc8d081c11588c2d8b56c1624fac0b9d92301ba3002b49390ed50851d035e945bb572bdbe64eac4efe9f4656fd619249ac33791b623ee7fc176b73b09d01c37ec8e787d036ca554496b3ab6fe2f72ad96718beefe6038a05923c4db515643780ea75c915e9dc90ef49d543ede8778de5b911ececa5335a090041b9b918dd124830d1634c6d649613249a3b589889696a6f17ede9907711293a99210855e4142962dbbbc43fee1fa7a1eb4a3df13540953567ae0a498ed58ee59944c52a562e33ffb58ce9964a0d4f72701c838a30dc1dd3c4da85d9aec1ef63dbfa95e831f4cfe07346acb5b384258c2559990e522a21784c3387704e81e64df59305287c9716ec1e9af04f955288e256da4f35a8033792a062b6a95c4b43adb18583919f1ea9552a55741b18cf43d2665f1da36ed17f3409914b489a3bfb4aa91affff512c789e06045b29d2785c896e00b674f3621330c30cb07cc8a0fe6a007e150c18350dbec74e27f16c9878853d9fb1c3a5f03457f396419599ebebffab79a8b9daf620e168b2edfdfcffc8e7709f0bad69fe15f50c3d49ed8a7c597cd75a337526c771ffca6357f71131d4f690a4d5e2836bb3f00e38b58e7723aeed08193f4e905c8e05c1dd13008479be2581f4d588c603ce191860edf9a698b78a46d296b370a0e909ebe46460af531ce42d93d5ecd9764777ba558c5bc11a6ba66edd43e9a27e889a3c16aa83ab8ab46f5f5a2ac76bcc36ab2a1cdec3a843a8794dbc1e1fee8d2c3028ec0afd3d599accebbd6d32ec39405b334ab71728d8993fe2f3d3a9a43955048368a9201d56b9a90d4691706f6f1b35182e84cfc27e0054b09afde89a16ac27c4081e6017a26e9866b19d2638c29bdfcba5ad5fef118ec64b8c09614586200b8ce17a6f6a555231be964e4aebb8b59776467d0d6c923e3b7fa8ba01e1f7f57c0388ad40cf3934ae138e3f812e6c1a34fdebe34b2b9f3aba4879e13b84aee36f97fd5de84eb58cfb5496ca6ef07f2f7cec3a4d4488100b766a50db182231d6815c02ee610d748f5bd4d5a3a17ae3ebefe9afda2683788bf3280c86cef61df5e15fdd6d52351535a03d5b35b252a94838f448531d7b0d161f7736d0bf3c2d41131b3874cc45922346b51c611b04afc0c473316df3ff9c90a776eba6673304abe1e7bb51212bc2205fb6c6cec1193f88d85a3478774b20a9aeb1f3970a88f69ee832befd79521a7718e5ae068037f629ef1b19df078c20d3147908fe1f2a5197714b9f82ccc5e3b4bab91109aed16b89228f2f5ca965815a89c291663461efbda21789f231aaacc6e17ec82afd2e644efb9c017f90e1a83213aa867b6fc500dbc13b6ec874883eef93f75c5c97eec729efbfbe31d4c54021269f68a5ee1677e135b101d242273a4c400a829848dc196bb6145cf2ee1f1d3c9c60dd96095edb81aa79ba64b40860f9f39df9be9ddce42ae6ef879c3a8cbd0f73ebb2bc20bed44bf848bf54223fee13d63e03d7ec4e6eeb8cda54fcacaf478851cafb47fa4f166afc371a06c47385df09b6718c79b10954a95d66ee9470c25c217e8718184e19cd6915d22107da386bf0900923260228d836887258792ab2d6f4780bd50a5d750a5da7a750a53629a7596841f5e8f99dedb80b47b1b1fa1fa508288d1b1e306ab9cc9c8dcd495f54997f72e0e7832f11b3595a46e722d85abe90eb22195eab690f5963ba105bf1d0bab99643c06f855677354f7b85ad880371cac3b87c35bf7d054075538c5b80dc9006d15cb1e8d6c2aad31bd9271b937afb27e32e7e1ca2420db690124b7ae41d4b6f8dee362be3f96ba689e9784ace9ddd3c757fe0ace0e2848c6b5bd638f8ba42c5829148c01d5dbdd0e8d1d778e265e56d5da3bfe2aa6828968be8d166f888a9630ad9c0d69faa82e10796a1f291f2eec5bc8eea7a3149050a73f5ce24b661be6aabea827954c7fd7c40eec3020ab86e313a93f85b2de9c83baeea4dcc5b044c287ecfad5db10b678de31bed4e30250959438909a578837b910a6f864049ae312ecfa306244812fe8125fe968479e69a7365dae6b3dc81915dea49e85cddf437dcece8e0ff9a4ef39d2ce6cb7d5be7021c83f220349f67d8e55257d076592729be5a242b77d8a179f32d34e1fa7ef19c697dc38dd944815b4080c957ccc5924b076f886a871fe0f86116c90a798e353090afef938461d32b1bc701a2a1f63d681210b86fcc58ca1dd5af70e30742f0220143a575c4e9811441442f9ae19b55c3be86380ec5cb44317bd78bfaee5179ae7dcb6f2a1691ed1660e56d2b577bd7a9c51141a2f05bb41db3cb85b61bca23a50d9ef4188541ba74a39e632ae2d7bbc2e76618adebe18224a761e2edcdda63cfb76b2da768ce9bdf6a36678b03e9a05a3ada95713815c106bf32c22bbbd058341326956f58eb36cc0af9e4770f2e42cb0d1a4e5565608783e072f332bc52849854bc986ecd38f1a04c03918d49352f74a5e669fc3026708a0e8ea67771e057c8b2f3567e5e9101bc95b47a669b174a97c373ec58a6e951624bc1cb109aec26d34ed25e6e31ea903228323999a4c69bbd17735b78491bf28db675a665e1b26693055cfe6fc5c00462ee319d96aae27b1730c666c35e59ed4b1f98928b26d88e616cb00d803b67b13af9b4003245fdb0fd6baebc6c1a90e4c183945fd2ace637cc2d33fc939fa2f24be1f793131e07d4f84312b6b06669fe8fc99b09a06eda9e90c8e47efc67ecefe4d374aea38e4ae42852b954eceaa9fe56c36455d974d590518c8dac12a96ebb15aedbbfd401353927859f3279120a3ea85bc241b81f2dab5d4f4db8f5377d6c5209270d810419f93bbcca06154a52c52e7a241d816bd7887ff854fab2398064bbcad4403977edb0ce61705f02ae097d602b843e29eee721fb0f6727c24dd94b8a4c0cde997da6b36c1a950bd6e04038ac8a83389a369c8eedc6913ce59022430ae4d2cb2cd4d44af79ad4b18fee5734df05431802f0ed733066c9895c66e3940d81a4a8e1bd9369cea4dd664296eb03f144512a8723dde860d3fdeeb257e8bec1db52a268392ccefb5930af66f64827e083c8d16feb54014449bdc751a11ffe171f83e8259f14406f850688e4aac71e9dc25b32c952b569d78ff689ee75b1c3fafe7384edee03173446c820f46506f468fdf3f997de5b2043712d18cdf27b7ac7e3df9fb3566322c6a2ab60b770bbb7efc531f6bea7e7b6a7b49a998069dd7ec3f25b20dfc9926fdcecd43da9ed336db6152d279671666cca455a37cae3851cf8b7c66f228a7ffb2bdb81c91534586497fdf712f0e67e271bb61833b8d4ab6915d5f5a8b45638b55d58b3a3b875b0a23137ee686763fedb00d0d6ff6489d4a3414611e269c14f7ebc040d507859cb8be31d27cab1531eeba57b92279c94181bccb33921aea98a6ccbce7b34cdab181494fb8cfbb0597a9d22bbc4a66c99c33c9c1366ded385995e80e00f3370439242cb448465a71e5187f66eee0f86bf5d3a5d5f38b7b6c1b27ac62bf7bca7b619b1a40baf3716c25ef0eb26452204eff989f10873376c0f7dbea30497a74b6d14e74deb587d6ce3dc845c882d9237a7c07310ac350c41419610ca7a8a19d7a03db6155585bf59682dfda6c801337fc0cf74f8494a47cf4ea9d5a592a29e9e9212844b324cec2721b2831fb48645d96dfd10bd6c9275b58af34e96728665156b76d833df1e83771ce2f9343bf9f9e8131dcd0011a998f01623d0f4ffe06a7bfa04607192135903a904a158107e7959eea4277745f66cd4181f1301a39bef36add093acfc8ba7aa2337c0c4b631a17e811e893262a9149c2342ea0c7df063d7206b478968d650a44267c240e8cabca6f5a2b98201fc23f4b8dcdb3169cbda8403869e6e2473c6e8dc5d28f9beeb7b0ffe26ceb0b5521caec2de8e34d4faa48ba66d3f3a460e8b0ed33af952319f5603331dc4559c81058d4ad64e1e9fe22376b3a0ff24100b9b53841ac92bb1fec6994e7f39f0a59dd8d91685c1ed60e9e335163be98bd4c2bf26cfa1809531fb840322ea451930eb07b8d886df76956860381e0fb26c39dffb36c5e649cee515d7eb0c4ce23f240e0e2e46eaa4bb74fff2fcc020f9e24b0d3b97fc85e9ca4c1101d60165171aba853b08e742ae9c08d3b06981a0b8e6f4b8529ff412938026a3354e130aca8db7d7227e906d1d7ebc1e1e1f88abf3eecfb8c81ebb8d8e9f41426f46e50610d69c485592b7ad1b640dab505cf8e871ea7f49ea27651b96d7440c90b9e293c1ffc7d7ae3eca3d881345722ca2d80d4fc7a89892c82ced4858fbae58c401b056d300a5ed63c3648ee8882ff23b953f57a5a6143830aba4c16d8ddb6b3ad34be7765cf0b15cbcdad3dfebb33a5a3c6698bb7ad1b6ba4877b33e6be813499150f28d349c29b443d0550aa731f943573823c354e8f013890a0b9ba77e84447682ffe2046d80a2d1ac86dfae4e7fd99413098346f1c66b8d4500dcf15757a6cfe6be915eadca4c28edb86baa3e88914bc3507a2f69fb4f51077b713ace57214c764541b6b27d6197247d27a6ba1bf442a6a7a357c0d9bbc69c0af0caf83c3970173561134e45907616d328bf5548fbac7ea68f99fd15b2559def587e9c702de208ca26cbda488a99ab1225936dac64c7d4ff60d6710776660159313f5211425bb9615f3271e0963353f3814da9ed7264948e31c6fee316169822e999e524a565ac8f889e6b35d2cbcf66e6a1b800624f3601e843af0b1135befc4555c1fbe2a971757b1094e3362f6995f9bfcc2017c9fefd77c6a8d429c3d1de9f85f24a8b83fb98f730693232b0d4c2272f0d5185541e57b6876a2626a30c2d1e39b057aaece124bc63f88822d66a308be442b64a60ef719fbfe8fc44009df70c90bf77ef10579d7b1269bfabfc95364030329974d274572709d27940da154fe4e08842220e138d69169b10c54b8e36a8ce70b27b340b1fd28fde0e073e82283dfd1fe7c3008ee8d165cb677e58b8c1656bd2383ece244d7cd10381b6e3003db282692cb3b799d6abcf0ce44328098a18ad01b4581db4a5a04177b904354e6833656e9affea7c0647f55b923b1334fd54e91dd3c376bed4743d38591e005c4c2c884f7703e17e40879e07f75bc1f0ecd8cd2f84dff09ca1ebaa6f61e2b1d66030ed9ed88e5d2e008cc5987a27308af97924f6327fa3094514e3a478834ea42dd276111d0e1782ec1644e2f7ece57d55c314f7ba9c02492440f1c77c1af1197e0c4b1eee817205029e0849f8c80c45e9a18463d98f07e0361fbdca1c8b0dda6d61b5b4e3b786c7384a5fa749737ae9eee897a1c42a128f8e904f11114e2aac0d12259bc5d17825cfde6990ed94accb70012732617fdc8d040f138e987590829a4ae257d3f04a319e01cfd158b05f13a1f3a450d29108a751f5fe11e79a08da3c6e08eb13c1817a215064b0f8320de1c6747197e888ac91fdafb0a24802bca8239cafc99792203a062789cb3a1d2cd7b5bcc26d331abf66efbf47622421c12e8e782d534562fe7509b20f396c8cb3adbef83dda7ff2bd188a32d78ed8ede22d6f8a307eb0c4489b96a0216d361b5c8d957a95e941a1fddf09113f461918828754e96caec64963150ce9183508dbc7afd517031583cd0b21a426bf2ee8e41b5b1702761f3c6759c1f4538af4d63d7b9a855a3250f5eb5c48230c6475ca2283e2be281b5b9529298fbfd8900360fd18b8c8a223269b5d2499b098c259b4a46d97b12abf4605f8841175d60e61efaf68e3c715141eea0cbe1403a08c3059f6192dc9050ae0dee6a10d4522f74d31c9ccbaa6786e558cfd9dae8f7cf6e9a8d4683dd701ec9ee59243583abfbbd4e5e556b471b24767cecd91ece784ed75e3f49688f75fdc908f98e9f54222cc298ab1e288d845fc2f8d613676f6dc5659759bcb49661c4c9d8c55409c24b5b6be3a10f7244bc6779fab0be18c59b7ffe036153d294a9a89a4152ddb5d973fc89044a9e2edbe6af7692c1bf8b2748936fa666911b0d081a668c5ec00ee8b3103bcabcee6a0aece74a47a4fe12cf9b4125c0e75596ff48ed981f5c2cba770c2569cb9ac7cd9c149f6b8ca4bbe64b3765716acd39f13a99132ae1c2f85a219c7a142d1f50aee7aa3fda64f59ac6d30cc05f9a461eaf937054ba037f8fe2afd602555c9b3c035d68b65797db503570ecc5189aa50a2462fc007110cc61902e271eccbdb456f68f74f6def12358dd4b529157187f6568751a25553482ecbf4760759ebbf0a0b0fd9dc04d6e37f3212b250e0ce6002f92c06db698457ee4e994aad2b2ffb2b0acfc1a4bc99a4bdc549388bff27edaf5866b9acfc0565e55524f74c8abcc217ce6d8e88e278942f904b52781281964e1ae473d2e3abaf2e9a8ecfafe032046b12458260dc777a2e70a5bd95736cbb3593949e31439c5fd577638f16a9f090d4ccc769807eb32ecd44562a2ffffb19f5ca59fbb4944e5a116a110c2f8f3369131912a2e6c4dff5ec13c7aa39a4bdc2299c850c4277dc1f08520c11d039b62b850adf204575a642869fc379aefcc048642b86426f35234157e2d10449476a779e6804b54a1504a1481dda5fd942e8e98993e90341daf44311bf4c4ac95db91daced2518a1b8d37e7a83d0f2294b7ea141eb55411eb283081e40a5b8ae68e44f4c0ca8f9aa02619c1543f19a853cde4aca7f0d054f59826de9df514394a35f7bc5ffd5d2117a7210a8b9e4009b958db56cae6fdfa14f5095564a00042892f4bcf300c6e972b4b64993cde0c408c3db847dcec4ed18a1897b5861878816073efd086c5e59cb9bcb50347f9968d4e916719499b1d5cef8ab16c76a51fc8aca1fc6e2ee9287522e798baaedfca40cff492b80d7479e323ec7ee99f6cc75c1cc507574e44f35518922166d7926d2eca57a2be965bc26b3df6b75db53b9567ebd40aa0becb89acc03e67260f9c978b8282164bb898913675fbfaa96af8552e30bb3a43e87368f03790a6c46c2df4d300453a73c8a4bac6aa12a525c51c9742591ecb89177a599c9c87e15cc399f0618992f8d2b8067a90951ef673934183b2bf7391719416d1e4ad8d403626beeba8bf2fa9446c702dd1b921c4a7256209ae4387cf5c2366ad7987ae57bb2018b5d672392d42b748e3df19048dc2f4930772eabf7768f5dbb62233efc7c3085a7f0df02828be07fc9948b9325af3be3b10fe1e5820966ec015653f8d134c72ea308784e8dd9ba4e6e14a12ece9cb028448721d808d0547edde3e9f4c5cb3133170037b073532aa8bcf56e9709a5de7ebb3c53d6207dc556fe0d28bba167f9328d4694a9d835774259f17fd693b27fcbf5ede92e854bc0bc943738ce9f1b95c119c01f3f884b0bdb69378e0a72e0b95ae92655d22fb95a83e27d221b692f71392ccb65edfc3a8765879bd1e8ca465d4049fa4ff34b0edc6725abbc38a0417a64da0557a4059bf7ad1227de64b49e98653845b9faa7a3a7df6965789fba1832f2f8ab61274461b9401dee2337d203f2e93141aae4f2f9f00e112b3125be7cec96fc1f126e27e0b23fa7f6055e28ffd0842a8da48088607d74300f063ae58bbf04b891a666809b2a0d70b840b57a4f36083e5e9ef14837183a01aacfa0758f8007ff52dfee18f63f33bfa0ff0732fc18545c6e592c8aa5b11d4576e307dbaea5da7cdfc16f3c2d0180136fa2f25e9e49c9e27aae90ba6c4d22241658c5907ebad81a54234504f2da090a6c59a3040c414a05fa5a0bd51eb89b827507fc0eb5db03968fecf2c3379a8e6f7cd37b8207af5e635bebe1973aebfa48b45534abdda14e019b8d8b2d0c72be6c51fc66f6920d4de95ef322995c887d92a3dfb2f1107730f1b09c0c58fa588e9efbae4c39c772d47b72a159d9a2a0b46a6e003d6664bd3e2ed52cdfa77a1d7f5803887b04642e08728c00390eb2adc65e9e0e6c10166a0d87baeac03104a97c87597e1439c4fee79b1a8b37790787c274e5a425ed15f8690014837d7e4b747e3d8cd6525eb90b0bc43f8e21bf9ce3ca55d909ec68d93b62e97efcf3eb541a3caaef933a132cc19d7f1f7395b78204f895fc168fc59facc6dd0d55dd1b34a806d69d8b6d93419b09ca5ffa72a0fa5796ad4dcd662afbdbd329f003d35a7f41264aa7738a90205778d3eff1e6accce934a257bf8ebac3c8ae4f187d0ce2dc1d91477d04cd5ba114247567e038f9f7d29078f35c1d2aa132bc161af76fa8e0146c2768ad9ba59c2b39805cc86f7934d37a229ce4e2782287c3585f0a0cf83c92231b1f4a43589ba5d29880ed55200e928f57f696863bc3ba2bbeaf316f5cfba0fedf3fba6ea1c5d1236b8e5df0b3556e9c564f7b6f5da9d8b505ded7cee9c7a55fa9c9b50556c1e44fb18402e32e6e26d913af011061d38788c4d66227513a25343f313eb4499502d1b4cbd29268f504d10d2dccb0251836a49f8e926e6d97a2558069b26b859a7ca510cee3de3510095d97ad5c5e54f9aafd4d6d3867f06fa0952a0bf808a70cb45fdaa93522a245954acd20e791d4d79b80894ba4d3246f30f299da0ccf9df7f6c82c420c93f11e3ad7b15af566c3bb292bd188a1fce8b750299fd20ca4cc63dbcbdd6cbf7d83a46c0e0325e4105ea5f9b084181aef9bd2485bb532157bd994931b7a9a2904b1863d2706e4e588cd3d5dd4b04afba26403e6749675090afecc3df24ca5262ee56c6e0b185cee163454e7e04a206be7714ae4469217226f3ddb3c500a88fe183fff294c7c3e2193ed647c360ca2e9e68d2c8dc470d911a114c43701d1afd7f46854ee7125278169ef62774f6efbc1b3d8dc0366f9639351732014c520c08d6dc2b8acd5620bdffb50d4b42d9a1b23713af1b8058a46b8c29f440026421d6376987e84a7334d4ef73e495b05c8e873e398fecebf41eb8521df9990bd04476814a9a125afaddb8dfddeefbaed4e28ea75ce2158e55e38b2d3b26a337e4a4f9ca274c68b062bd8c74b036dd07dbec44602b94ead0db014794309d0ec367880c5013650c3a9988b6c5884f1264b1b103f6536452e9f0ecf038838f8dc3c808ae7132cb58eddf4ba427c29aa76e9b0c9d21e3329b63cc23b8d4ac1c56e90c13f3d4a91b022303cd528018fec01380c1fd6245af0b0907cfc50c8f6c3e08d2072b6ff80c782f86ef826a860ebf28d00175cc1b0d98c722cb773574f7b63e8bb8258d0eeb84b90136faf527165c67524243c719647f876c18f7b0b7e3876d96b6ed41c5f94ecab712df4fc80131985d7088b4f9f887f25556b3f8596a03dbb74dc83d2a96a40077829901170f4b6fe82332f8baf050f2ba2d6d97a8e1d209f4336f235862cb8c6981dfe7aa6b945c7e2904d1ee7aa9f35e44f665d0f3f2a215e0182eb53010e5c0ee5aeaafb30fd2fbc082b46376cf5ec4960d650669b98258069378acdf72cc5fa05d1b8c15593f115536fb4d3ad285c612bbbfd21435dce44a56f42e6bc8089c9ea520b5c05df0de19399d608791042d2f3602905c8414a10b4aaf7824d754fca450469d539795d1a850c5ed9e08c658daff1ea3d9040276dc1e2de7583ebcf52638d6830adec8d6669320087fe196728575d0fbf1a439a563eb6c96075fcfc4b481f06a012aeabb5ba66ce8c3bea1837d14843ee78ce7ea5f7c293e737d6256690c591433dddea624efa8c65e3859ce73f17e5e8c91d52ec8a377f6340da73cc2cbf82147f4e045f509b14deb5693324ce142b7946c5f284cc977382d43863985e603017926c30ce0e07405fd372ab5e81ce4301164706b21fad1e764b508175e5b03255215c5407cbbbfd687ef4a1e122717ebd1b6e45dcbd4050b18d3b6fffb8f345ef5c46e522053330ee3cc3e11b0fb126ebeb57b3436fe9bcefd6347f5fda945628007ce9109b747d5216d6450a7adaf3a67034637e29200e645f14a76bf6249f25096bfeccda8d42a5b94c45a64491082a2bdfb248d7476e1b9be90cbc81affb92843551278365455ed1cb441b8542989ac22ec944a0f89cc996f46dfccb7fcffa066265dd6385dd2a58ff99570b160f7a238d3813352f6e6a336778e2bd994417f5f7ff4528b07c004956a5839f327e8b1a8b643034160b079f86f2a5489368a01bc88d33a31aaf5c34cbe1a9896c27300f89e6c56624a47a834d940d9eb284de2f9ac07ae0e53d2711cd28b3c4726b074727cfbdc41c61eb3d97ddb9ba10cfe104e7c9d08b1a86ed745188045f93bf6e2b4bcac0a6529dc7f0ea060211f8852cddd9ee470e4c73368748dcccaf2aea3574f6f99b74c75eb1322d7d2515f8b57482a882724f4c22af408a1faf9f78c0229f84bf6fce278b24037a0b1be93d077d5603b62fc3eb63680a27b13a3999ce84a3b110fd82f3fc79f083d16738245b0c7b33b080870a9bcde60d712b44550e6885a9ab34412e0ce868a7df7a4a596117cbc32d3519b52743c9b74d2fbaf9b26f2115291e808d6c4e7fa1f80bf48eedfee4c7821b171cd22d829d6ff964861edf13e3291e4a2de51a9902e97fe1c8b4c04be0d8120531e74554798fdf604ab0dcbcf9a0e6e3da75daa04192c9e977d4fe45d7be6b81170479ef543353898b3548097a62dbb35cba5a06d2f94c31d94d02103b31131d7558659652754c027077a5d04334e1ed21ebf7b71b794bd1ac846c54824b5e4d0c3373ec416d03eda65a4ae81066a399c2a53be9d90dc440b1028f3b290a60af39f659767dd51616b2c0e2468b7da74a54794b910c2400baf2d15242d932f833a6bad0bda45765c99926d7a53c0aad7bba055c05e8f59a6f585219301d620a4627aa8ace0ba170df17869587f0c820b70de16e65099e3b941d904b5a43e3ecd7a44a87ca5aff9e2e0b20f31fe9438edfd09fcb0d6f2071e22b274581ef43f71a94f1aa55885cbbda25a15372e183b6f2fe43cb184906a2e2b567de70f7c091745105412f2375df7fa0be5d8373953f743e85be1065fc6a39a6c6e331d8c482543885f39879c9f107f17942c93502f34c87610552709be0000a559281e6eb3dbc7853e4b1a5f0ab5760b78ce636891af49513d4ff5740b83305f113d0b30ab81bbc87dff34a7ec5300f8989269a30954ee0214d3f08ca57b8114f8446432a29afaf5997ba103e5806d34f9efaa99eb368e5ea411f31d40a863dac6148d535856d43869b133d66b9d1c34993c7d64537677647715c6e35266cc51bfbe34f1b3b39c787f653357a767e7bf89af7b57c5fdd516910c6101864bb73134c8e3206c93b4689d783331820bab954e33aacfafd71fbe25ed5d559795be480e33e8ab56577db5649cba3fd478d7f55c960fb0c39b40a1ebfad5016d6a034867b1058d554841349a0e0d71ab9d0c35fce5a92fb7769b1617dc96c47dafcfbf2793ca665c88176ce6b93537b2075f4f48f45a01f011f7f18326a15eab1ad6de7d93c744eb5c10a1e4ab85ae68318d5ba500ffa555dca6fdefffd20f6e443cd750f7d1b492f1bccabcde9c3f35fe874d4f7e42596c4d987e6144b29a85fb121c49a27b4d57509071258c356b341190b2fe29c1c17f28b617a69e37d62bfacc399797037b4fa264392f6309cc0bb84188b7d57fcf61a44a6f271a89a24bf778b088876736a22662b2d5c79ef3fc55442c88e0ebac1c8b3b5c7f62feab9f58ac500a1c91079e65daa9e883c61a23223e994db88b9dab747a1e07f8b0c63631e2ea2cc89e3d4681c260aa2b3ac014400b3c6f6b050b98cf413de376e7d2da5b20cdb4ccd9c2eef6d63cc209ca35a019df37a8da5fc98d892e57467062905968a34d40e051abfd9ac9cc10b0e75a2ddc114da4ba0b9114e4269ab01ba4c2817923104781222ef1b9ace47ac7ae7ca9a302bd91d3e7c38d154fadbedc60150feb4916568228d8da3b6e1e47a8e0f2060f054d5bfdd5deda934aa7f19ed2935604d2d2f5d671a067c91b217f740e400399e4ca2c25991274b1de418e9e9817139187a22d0d8ee86c62b16ef9e4a0c6e37007c8341176cf25843570e11a3a6aa83a79b205ff5b13b4272f06cb0f8272990827d219aba402d5d8062f01581f282db71568b85eb5a086e4e2402a885bdf48b3ecbac4fc286708831cc688c675d138b1e4a05ecb19ffb4983beacd1701af3f7d15e3f557b13d2b398e59ffe5d17dded64d2b1e552f2b8991e19ebaf24421ae705b240700fc29220cbe8762b44cbf2d3801c664496e8a4c8975782c8b1e4caf1828422dc1a4fe39783489c2af102d8647f061f02ffc65cf9de186bff4573c58760ae37b28a151cdd4f3206af34cfb344340b637d820da0790e877098d11e518a97a729657be6d0270b8635d0110990a9f699c7f57a973c1fc55e75c2109354f082416b9075c8def58beb19bec74498f417224e6159b3400633ff5b1bf976cd44c09c2125347fb09dd736f5a9ab7866ade942ffef2a204900a22b6b538328b255760b22fc880f78ef5ad4fda492b49b3ae36f32a19abf27d474684c7f7176277bad3f438cedfc9e3d170f58e1259bfef166bc1f82a8a377d454220c57b92bdd5ad1798e04067a1cf12249d85607f549dc1646011a07c168e13795cd311026de678e9392991b69d231e652e253adf0580154c7ca6f96c8ea7ea9ef13be5df882dd7e80ce6c70e1cb44c03843527b514205e79f424ca1cb5f7cf5a31c9a57e196c42d8350316dbd6f85fd4ed466e488134dd0d3c412e9fdf3f594d488f73c3440eec3da5dd7842f26eb41994176f4322375c5237d68daf4a9eeda3af630e12202f905e3cd7e32da10550f7d72237b97fb493730a771e87acca7239bdb638e5ad8bc618fdae99a40c61e47049f9a0071852412551b04957fdc25ae3f39ccf91ad36aa2996d0ea06614b61403fd60fe684f1114592c1dba6b63320abf07dbe5f1037797a428a71d3ee9b3e3b23f8922061e265be905bb6e2d2e085f042e890ee130dda76846c5489f2debe6f70771a9cde486af5e80c0baf9ce9e7363accb96f142cd7c9f0684f253c83ed515532494f58957ff83cf3795650a25286f77bd7b2dbf19a5cacf455126359045d40dd6615cdf5b9bca0697ec37c3389b4f16a77d28fdff08d20cf960b18153d8d1998b739b71b7013d730d981ec1b56c154bda65d8635a3e2d696160ce1094080848f5bfeb44cc312961334247bc66ef5fb4b4080bf9e06f1fbdf219008b86aeaddff3141a6e66fb452bf3ed5bd2f082b2bea0ca41daeb1d54e2f3b5bdfb314a8768222d4121111baa63f5c778414568eebed2d8def83a5468932a949221a8e95b16e5a15424f527b8d538d6348235e665cdb2b16b0b0b4f1b778d34731dc685477d35157b6121076f140e1335326ce257a2850098f584a3f6e3e6eb3ae20f8789f7bbab1b9d3e7c8a3853b1e18f5797cd2c465a94f201f60ffbd17ef5f2fd1bd1c11b6464e04a6982959c01859fbad510516e89ea0e8783214fc678edbce981d7fa41ea358f77f2ad7a3d4ca02a9dc165db7619a4a34549b79c74457c68fa930ff27b49552c6ca3fcc87fa0e8d6e3882586a86d23be3a500e6acc17ca62a22eaa379614e12f2d020ee3c07960f90b228330c5cb02ad7ee1478de2df258affc29e57b35ba3764831a411fe5ea3aa388f1265c0109ba1df1fd4c289af23c5ceed3ae315e97d427aa1455ed8614a5e9a9cfa7139d5aa07672b9e239f5df8e88d95ae8550d792113b0b7a3334ea2c92603b2825c68f1179eddea48cfd73df6d43f7949755d409f7dec04f9f7350cf207d7c3440bbff99b9ae9b089afd5b18ee294ad0d5417e9fb8d80daa3236887b44eaca2ddf147eab04c72217a94875bb301f81e215e8566f7ff6d5bc4da4489ca617841c9fe88d1efdde4e38021d5aa696177bfbcbef0f06b5b9a3f88d5bd02c1cd880692d4a81e5d3530d961b2ab448126716002e770edef7a1dc31b376fc0bda3c172982326a7b4abe65232693829179ee0d026bc2920c95463113e1715c11795af9ecfe333827a609e72053419e6e92dcba2e2fbf28aca6731b6eee683c8ad2a7431d7ceb53bbc1cd7509a81a84cb6401545190e69ead017fbd38399f6def5f48e950a1a0ca59673e8acefcba5c29c44e1ec34e3374aaf153dbdb7e78621b20b065002b9344341a0dc9dd9cd543271b499d35282a76b2c103edb8dc0607b5b91f097b3723dcf8ccc9bb2641d1a830b57e13a048b12ce8495ed8749cd435893bdcac035a1c06799625398c01e184233501f10e75aa7907cef082c8f67348c3a877586019d47304b4723c58d5593fe79111418899ab0205d733aa2dcce4f55ecc6cf858e1811328feeb7433116fc0b706bb22b7d1323734db8bfed320e9a2219f3a94df1dc717b5d1300726b35e4bf582cd326d4ff4d358933852d64e280d42373f1cf6f716ba0a84bb2371e5211b1eaf48bac802767ede5ffa98edd8be96dfbaab45dd68899f0340eb8c7259a9286113ae6a9ab1602a5b1552693eeea09065e696ae67f2c36c634a69f2c0abd3adf36702816b8177fbd1e682e83454076b3c5d9e586219849af4a1f801e278c8ecf804aedce17d8cff0a3548493fdddf62fe4c745929b494028bf4458bb93bd40161d8425c8973df594eed4a9e1026b6fbd0e9fc9bc3e774b6a5f39200fa2ab65d70c57a3b78ca2a233bc603af6482beb8970a3c987586080cdaec1319da3d7afc450945df2dd83144d035c715af90e23e0ec3ed1fa5b1bf750ae24dd989f49a4b74ddc23c0f10a54f30c37fbd442444221422919b7014e7f954862c50d17b5ee0c8d20e9a01410e11aa6f8362c5da18a04984b4228e2de35fd2fe82511dbf5ec7969cd8aacdc890804553f927381724f38c5fd14558034def838d9ee2f1259ded9ffc06cf6a82fc3ad6c278c2492f76b18fa495e37d0695cb09b015f4260772fc05a3ef2ce90a902d5cc412abeb2d5fcc0b5188dd2735c1a501f18b4deebf4af187e90d97893123d5253c93652847bcd83d8e117da48f68a709603520b2deca631cbfce2947c500c36b3df9c5c3a73d532d779ca5d424a06c1c180e45d89079eabeac741e3abe1d5ffcc7bd0065b2b269821385b0fb6dabe18838e2201ddc107ce8558ffca7011c84063cf2d9ceb64ad7a19f9de2a53c23685865dac1f1a2e78efa30e5b38cca89295fd1c483e8b2b705cd6700918b8e697be0277a30cb55fb0e69c4b7115454bea3bcd25232faf2f412169534fdc7040dccf75fe85a51f93507ded98ebe86e37ac4fc1203b27f0753a7356a03a8edd509b1bca601245e82332c175026b44e3384f4a380fb8c7303ac4e6b63246bf58d6caa05587b9512f3e65178442bf2937e9c26f10750d37197d2bb0ac2876fcbc9ca7a4c5e9d630d2335bd71866bf1547501d66bf999350581f7c6475946939b5130a144cc8f8f790cac7c8bbc080045eceaca49fd317065e090d8d750e950df2c9b02ec029d467ee15798aea9c3ec6399f1a8cf48a847dd7512db895377f512ce437af4faf25e680bc617365ba7bc7e41b8ed08c4a91b8c0befe0183dfabe42b8ae8903ee47e74b520cd69571fbe61be94b94300604ac441ccc66e7cf858a8e98fff3fa5f39626be265e2b2a9b0ae8a90df9157c305797baa6e4cd727064f2600f8252499a75df8cbe4fb632b062bbe6ef9a3b1cec506fc248a31c470399e1306169ddd491c24ae847546860b7a4bc966b500fce561212158debf679ef4e630992893de61688552463ab3870839e6a3edca68476a6d1b5cbf4f13ed87a66b9fda0e9ed56a80d4de837d36e2ec2bf5bb4fd189b0589ddfbbc9a4dffc485256a966bcaa46a44b96679af4223cf6793c982f195a454ce1092d45d828ed568e3f8aecf56a4949ff88ad54c2106a2609c80d173f7311417b9be28381c537c34459281f0dcb9dd252a5eb1fdd76cf82bda4e7d3735c14bb8a87669eb99495944f647f40aacb23edcc88abc3079413920b6a33e461aed8fa454876dae03965dd30019232350643fcafc7932c702c98d41548bafd12f525b9efb04e478eab9cf1339b9af5f1a46901af315548ec35fc21d8a18b6f9be401a30cc1e4c00185651e1b5d307670a30c86d6cc95858f0f6fae6315083ac16116424c1decc353b593c6011526b526e77083b2fb6e2107fb8338119abc44ffa69f4d5bbe5ff8b043c90a9fd9da2693fa67a4441ca4f7bf1e175435e43f8dc7b083cbe861ab0111c599b49af1c3209cebd593c71b98b35525269bca07e659456cb2fb82f59e2a10018385a958f895d597d47732075508f61f47a171afe123a7be820c512c6ca04b818b21b17b6780e58e9a78dfc851ba55a8ca9490d618b2756e923fc701974951394e896c8c30c65562dfe418386afd0c06f8dd0aa1f8c24bdeb7b211eb4b108a71d336de1eb5423190350e4a514de37eda590f1260cfd46aa8e3bbc1532e3675254d0c71104f0946dc1482f42f084c84db5a1da5003376ff5307377f738ae99c3a9e799c2abeef7d702698c242585c5f3c44b15db7e5b1be3dc5f6fa463cccf3402450fec3211649cca6e534c9ce5545ce56c53b3f2663c3a1a2a423759808cf4fa6b5b7f454b2ceba7e4623035fb2c3d8eb4cc04fa9d424a41c4b5f8332a9740485734f9771a4f8250f46a846bb44abc6474eb6d22dcd88ec9212654ed3df02b1a371aaf0d3fe2bb05ff9c9f68e8305bac2260bc9c56c9425ad51c356d04e5f1b38664788f64db37ff1e1936013e7982b0a7f99748f5e99133ae514dc6e84ffb0d3c1d962ae208ab1f46fa118bdee448d8356cd2c1713db88ccc4e61f962296991d857a8ed94be21829732c6b345229ee7e693512329c4c333dae559fc4ba12d0e6a38a6eab9d0ab605babdaa5106297e55f49355bfea628656ff12d6c2533b0ed38b139c861091685e187dc9bfb56a36f33d24afe54be5fcd448b0e84eb484f15b2c454bf79947d17d50963508da60692d6c44e3c0e6f2646f686df18ce6794c851b551cc3d6b5e4b57daaeed6e1ec8d084762619fcf12a2cab0e9db7314028ba5a412adf83ba38a8453ccc310ca27ae55f52faac6dba74e40d3d37fe90b8c644eb4c7a6dfccd71840f6dadff99a26b24286d498604e6cb43d9c4ca762cb4bc2c4fa3955d7f43f75908fae47bb7bca7c1031cd71b4436d28c7f0a267f82de993204e8bc23ae69b4d5eb107ca52ade2183bfc3be8ac4eb0f56865346985cbfa6da8ccb7b6c0406ca41410d2e2a3d9ce5f9a12cfea1433a57656fe0399b71141899b17778cc05c8be859317c7f8cddf971c517d6bb3fc07ee5d741a0ee6562149a62a1f94b549efd2ccd4c1df453406c0dd24e0d2c00201bbd253bd21b07559f1121ad1dcfa502b97d48768a244f1f1b902fdce97ed10c71da4226becb51ef9c4efa425558ada5cc5fcb0743383f04cf7f9e25115ff4a60d813fa2377649a79cf774fe8e398e6ea38c6608f77f91b4f4637674ac78af9bb61d1e8fa3413322280f76580465e9200a81a2f48d3ae8db291b7ffa16b11869f9b55a9e765ffb3c038a0c19c0f90e2bae7e4a598a8df71002de43b3190eaed5a00eec9003fa0cbd8d67356c0569709653bad0f39f5d2db07d3dc78f55be46401e5846b38353b5a9cdba99097c903b7f8b2abce53d36cd1a81f0d032a3afb9447b8be82327c7856a44697ed4479b0217bebfb1860984a1c8f0e74986edf23c63e712e77d90f369cae693018f8e033079746d37c28f2b79619365deb2d76073b92be0fa626c917dd8c190958f3de6b81d7e01099c2446f1250005c517af44daf2ff1e10844a0f69db7b8dd4b714c28b7f75f43258a6e802f79fba0622dec1edc9646cac806b87cd25e1d0a78ea101e380868a0990136a1279626512e3768b4d3e38c5c3cdf58ff99f4eac329e09d0e1591f7277c0ccec6d4902de03e144884a03c2958ab73d60405e8cb638f51dad48088ab8bf2903a8df54f501e6eb6e4ce6addbd671518dac2ea5ed9e7d85d1f066f0e8d5448097b8908c9de08362964b102c01e6555e50ab8611b7cc7e8a95bbb7ac20a1813d4d96fc8c10acf9cb58142900b8d6192b3b4af117a3811953baad55a109a42e50cda3f75e47a29ef9a20d43b2c0bd135f0c895d27ddbf89a2c181784da5ec51dd1dded9196cdbbee31b3a263effa669a7a79db5fdf58cc8235f1a818bd4de14f8004fa4bc4efa1edb99cb5d0596e4507b0f78060d301fe4941799b64434699ea6677969577428a26930da9822a1250e8b794038ea18a2a3fb0f2ca3cb47078f6a70af4b5ba51898c77eeb2d0c0ce1ce316497fbbd9f52734f7a41b4871c1fd5370499da9a489f901450ab9b8dd6c457a0a7182b0934a6cce2dd0c57f0d984383ed5dad7d18637433b35e176c508b1beeb1ea25fd6c445f0b90f42c46778dd3aa5cb265b59081eb733a6f6fd802c7da9cc7e0f062ba73352e72f4edb0ab53dfcbb90997dc308486a7d72a8e5ed0a74dd8776126ae4b435c70a9c86c52059273d54da7212c9ea275e263802654c8dfee82270e7278bae5e05143e224d004c1d0b4bb11e1b09f635766c87ad0fc48b8e5df8e7f8fae341553ae3edd10c716baae3f89ab503f033a1d74a853ce5454b9a9738527a319b9f5f8629b8af51177a4f1f78b6628ded1658b30b6ba2892bda0acb6b1bfd14cb655452e8d5fbb2478774106eadea555db528cdb2bb3c9cc2afd34ba9bc48bf298a32b697bfde0462d6d07708c2252141a0f6bbc217c945b9e63ffa36f7ea15032b588421032eebc0ba72fa2584a828b60fb87777aa68636d201827a0c38c85dff21e593bcbb389995b9795f1e7b2c0493dcea75e73b7ab1d8d9834817b7958a7c5f5596701a8a8ddf1346d71bd7e3739877388495382b55095bada81cda28e012c609df779fa8dce28b405d199df53ee308e4d1b58dd58836f3f8265421e385d61f5c06ae1eb83ef1119fb59651d5bf94cb6117e81fe9af086addaecc6671bf8b341dbba4ca734ae19b4cb48c42307d5d50a21d60a5cd465bcc8c632a300644029f775b7b4eaa0c7645a987f8c80b20f04dd5be8381342a52b65ff51a729f6804717e71611cfa7b003d9bb5a041cb33bce6ec6dfe30a137576aa7e67987fd6436b5c390b0f67c8139a682f98634c0f221a372a29e9eaecf2529a6e24a0746015839b834f04be8420d22cf0aad6858c3cb71e4b3fdc864dbe8191c51fc989f287726dcb8b9b8c8ec02e3ea4747a7a4d41e34917e4d8e12d01c3e36d4ce87c7dab44056fb67019d8adcb7fdddb946357057c23cda70fc62deace48c825ba8ae9b6621ba19f5b95ca5edf8ba2cf5fa4115d8725ad1a4c512ac6fbe81d9d06dd6e0bd8dc730bb78eabed523e6f7c52c7d023de4f954204dcc73f0ec5643ecb8da8d39dc389b1f1c513b0201de88658111cbf381f5887ed42b6cddbdd7f8cb1aa7b3785d76891e58d70f77e78218f202c151f03266c451973778f897d8a63fc7bad222e3b9fb247b9353e36897d55436e07997e44ed7ab3e3a3c58885d4de4a59a5cf42b26f58da3a8d64dfa3f1fbd520a94bc8a47f990f9dda089948071b00635e455500029ed9b70ce1b00f467f91a7daca3c19cdca7c10446ba089c56bb141eddebfefb296c9413dff316388c448ec6d3c67fed0d4203782434f2c399d12f7d70784ab1b4fc082c5c4bf7d75f885a11d23e317078bc6d6d1408c735418c19a4cbef135ea38c75cd381c300e793c2af124e8d6b0f7aca25c1a6403c57afe8be101b1e1fa8467326fc58ea29f4fb056973fa3fc4a7e25b00eacc6c67e9e825d1f7fb5b23e84c6bd332c3d357d8d9ef90ce34d271b5254a0705770e4fe4b1aa2c49c8515b9db6dce98fc750af8f632b143a9715c2dd11fb9bf0d10df527eae10a0321be2c350f403879ecb2a6326aef2835e632dbcd6fd00b3f6ef2716b464d57ea57d74fd2c7edac0238b6fe4fa54cd7ceb6f4c4fc920847f8b68203d37f0c245df8ab2e3a5b364ffc5ca53032200ec73db0bd8530884393818e195f16b6d2461ae4b807e85d56978acbf141a018564d220f127b75e598be28fd040fbfa562bd1ecef09f0e19b430875f9a1fc79308fbb1445da66551ad491589ac20db77d1f93b7bf0d5d133f5d03a092a105c7107de8ab01ffc0b3761b5d237a350c75732dd03919dd42965873a761d86b9a49ad99171d4715371901ed16510b10896a9b2bc51ef2ce38bcaddbb7a8be7800bf2967f57309be73d6253780ac03206150aef47c7f26b82a9f9e0643688da11e0dcbacee263e73abcd0d2041c03c29f17f7f8e87d0c887ec243fe86c9cff3cc416969f060f4516ec7252c8bb5b60f0b3127f57253fc704d6957ab01954b5d4ecb64d7401a6248be78ecbc16d1f6c852943e6f0b00c87c9afdb89355fba94b58911a56ee30256abadd7240952c917012e6f712f7dec426a2a496337565b4f52410ec4c41db5ce449c93f7e8b40fa6d11fdce5ad4cd5d697cb290719340cb053eb503d870b4e79657bcc64bb7a6811af1e46dd50328e2f84a0ec21eb86c2c2edeb49bbbc7bc48bccd86b56f899394e4813393c1cded5fe8ff2d5cf10693ef79da1ef3079ac75dec336a473b43cdbe57bdf606f4dbcb078bfa4781f06cea63f6090910fcb3c11a5aaa165b39f0d3b1d98a684934858f93e2ac4013daed6f634d92a953c58cdce8701f6473036b258a28866bee74953d86d79d69a1527aec077909e9c6696e7c0f9b62d1a449b7ba1c220f51d0309adc29753dff1d174f60e02b763a2385ffd45540037dfedaae7f013fb3504337fa602323e889304ef5ba964defb1862733a490ae92d7c239464b5f38f2435150b749f404769f9c3eb469b828b95362966200f614110e2d025ff37de990e6079f5a7aa933025d6f0c892eb8f39813f8ab08275bd03c02d10bb67562ff30bb769ed9edc7aafb95fa641d42604e7e8f3eea748d6631ae2e2c973ed83beea899d9758f789deb2dbdd43ba733700e641a52283f65655df835e58512ea5df8cd039bd26585cc4f10d667a4cab2d9482e8d0161fb2bf89301cae1d80be846f81f89292915927c7c88ce19418739e8957d39091099c40f8270d8dcfa5e97df5755adbfe0e0ec475ffb0c67c38cddc3cbe4bd6cfba8812bebd7bdf3dd5d78ca32ae1bb7475bd79cf8eaede0f7541837f762e45e8b3bc958c63468ce8ce884b3ffa0b1c918733fa3412ec236f98b0fa5409d9a2e852211b21c76509991af9608e84c6a33c8928746ec9a30a5f77bf1083f5eab8b2eb096de3ca4c2d91040593e10209991197d629eb400af0a9e05b6c18dcd5838f0481fe02fefbe8415e192b937e02f5bfd1a08994581b7ddd56721ea7571c4203f46ac5935b956b31e357e56b0dfce6453cfc6cdf4546c71972da7d26270f74a19100f72714b53fb5fba6fc2ab1cdae4592ba737c826bea1256a1a18a74486186dddcc178efb4d42adef8ba1a1dfcae7429c8f80151c532d31182d199e47f2a08a9d094212e35342fd1ed333fa1b022f351e91c35bed5eff116c22ae90bec9a5cd49f9a525bca598a23cb779cabe0e16b994909069027f1264597fffd82cd07223354e3fd136cc54924bb666e3903b08ff070f25023f39f7e87012b04c72a1668c56adb5e7d4ac004e0954e9fcbeee1b8f8db94ab83ed0a14483370fffb936599682952c6a925ff439ddb6d66e9ec0d1f4d37dc02f8d280b6b9d0abce9f25278944d3e1d7060ea593766ecac7d7507df82c9e91814e393938905421fa9e46751b6e182fb7065f361ef7df848879a15865badb3309384f62c9459ba375cc49e6dca456cee83e1b3f7892f98b8e733155eb27071de5c9a0c2b5e9cbdb59fce0c5ca8f539edf46c56842400f3ce3208e3ded5caa22d3f8d8a12ecf62780f2a2e77a47ad7ef22576d64f47b910b3cbc8e71783040c7d45595e2fdbbf2ed6e214c3eeeea3930e17b0dff6807e0ca644581ac4ee6d7d84bee06dd027097f65cc75a9491dc6f7c3793cb0da12e6104f25a8de4f1ec213029e43973c2081079e302f82828ed20a9e1ce4622cd2f1a12b72e16789b6755010f5be696718b3866edc01d11cca4b0d8d7db19996928846b8d204237390a61dc944d14e3717ff438d5ccf747f7c44f1e7ad2b34832f0cad6c59e7ea41ed569360ddeddac9ca0b450420b4d96fc45ed4ed603028b06c14a3bf4522eae6919c0a65c861b89940e165339af93f06e3a532774a1963070f73273ae378b9066e6e23acd1c4351343b2af474f83789f1f36368660282ff46caa959cc5ca1e61981bc42c33f40ce72afcbc9d1a632374bd04f4044cce77a80c234c69bddd4f76aff52c13d686f5b8c1e8c81c626f783d0586fa5edb21e8bfc6958998a9b7a2745d813ae9c81cd76d652b0de4d446e7a556f5f27fea5aa86a5e4bfa364736d6becc2d9d7503f51b77aa9fd2539e49a022212179f14971ecd09faf1f8c8c54b34b9eb03badba2d87cbd4db49ff5d118304abafcf1ec827137da4ecd664e8282c4845e93cc7da1ee85abdbc5a4cd02218377a14b08275c5928998782102b2aa8766638b7f3a26fb17feac6b0ca3eb454899ee3d4895e3b05965c7c01af6f43b3e09a7411107f4e3f5233cad1abda4c83d4534a02b539049e8e7b2f438e118f45adf0167e8926d7aae4624e6c9753ead4a05727c2de07a71979cfda255a108e85f0b47cba0b18394de4c958d1eb91479c952a7780dd492611cee8adc02a4b7816b77356394acf367187a409790d54df6014215644af1c195c92d6b412df72e13dbb5f3230186c86c6a69cd452f0267b72670bdfd0661135955ad334ccf94fa14d1f6aa507d7800f0408889936167ecf05ae75c32823474d7f2a38c5345d4e894b5ac2265387bd0ff7d2edde110bc93f933fb828d487d1aa4d0264b13858bc87d247044a89d70d72913d7edfae13f0977d62d6d87e31dfb006ced61d3ee7bbb6f1b5caa426570a4ec3dc23f81aef6017435c33054534624e2ebde88a90973e1c0a647648ee73fd1ec5e9c9b1bb5ba4de15cf8a0d25c1287a97aca6e118d74b215f0f2e9a6c817ce3a02cffe7da62c5dd302285d83252e5f5af659ab2347625c43b3dc70b2abfce8ee573822f359ac8500f93d4f5ba38c1f05c02e0ae0ae1ec27ebaccc42ab0ec65d7d1cf923d5239bb02dd787fb696b76a00cbb8152311628d25d1e406f0aa5383f865458907c7cf52ebac0c40d4c2b58cc69f6d681cd04b504d5e56a0dc9dc24d184cc873d4d66750e0e8b1cffdbb237063ea0f01d556dcaea1a07fbd416ded587da6062db953894d6988a3ddab4724916980cc6fb4e93cd6596de32aeec2029a5cb1b05bdaf2ddaf3aaa2ec0a0ed62aef1c4709ccbdb3f5874f44fe55b9af667559e4933daf5565ca8fde6dc0e49eb647c437b4af97ff8c494aa1818129b4440f67e0ece0a669afb4b0541f998222ac526d3f0a108181856929f56b8da6cd2b15192d1ff35948b7d6ad85ffe9ce626fd674e365fa7a2841b59b27e4e4667c3afc628ec9b84ff11e57cd882d0c0a5a451fc14d49f9e11286926973c45874521166eb817756ada7276a573d9c4083447c97ce0b591e522cca2d650a3ef605a2a97aa24e4789e3945c2e987d19fa388e215e648dbaf6d21c152c92cafede64aa3fd62e94597fafed53186cdd6464949397bba3205737d61ea2e37c0a08b63b0adbb0f53209b2435f0936cf5ee3a7279d7e4d3ae77f4c26e2dddedc37d6de13bfd687d48920be76b6b07343d3c5ecd8a58dbc20be675bb52b50fd8879075658f5b4540cdd90e066bee303d47826fce730279c58b96b1ebfc1989386f5de75ea6851385769f1084bb0fb5ca0037652d124272726d388aa6b4a8c26df06531f43c9843fde029b6a9eaba7e5d5227521d31484c93b37aec36febe995518d1f6bc9497828061d07c3133d7cdfb1b07c0fe6c5c93745ac8280ba55397ff33e6cc148cd910f2885a1bac42dd248d06b8a48dab16533fa39b3f2978fb7bc4278f6429bb586d1dd53751e3f55e1bc6518c80c81d44cc2d50ebf4333f1941e92a5544be6c7f745474f8439a5aea9093bae4fed357b6eccd6ec31e40edfa69def50d700258e3a24634f2e966711a622c5d6d5f2d92f6c627fb522ef8777415763dd3a136ada251a5af74cd143a3f9cefe5cc5b5ceb0d97b8ee819201c1ab7bf8a684c2828d3c6a92c4ad935717e6f3885ac1bb2440bcad01d89281b9fd4564356dd656e8dfc8fad1419513189b0b63344bb4dc0697d6144bdc99e2f9e6e03dc32c2b4d8abbc3278d1ab37ae7c6792ca0cb12d82ee94e2ae41b3b4c99bbaf29f95c76b1d60bce35ded71510b990c634fc341497189ce7e1c04b56bb9c15415bed4ffbc55f1f9cfc743fb4918e0ef8d71efb52ee5fa2b5b52e201e00ccdf633d45633c2b785582027ad18b5b3c6e09a154636d49979d564c5fb53e3a887e0b2bc06b86b399494615aad72ddf7ad330b69ad80cf1f87e06c502daa7f475e7dc9a89e89731d6a6006d5734a60782244256f93c765168b0819e652c271b49c4e5f3fa5aba873e9d103c3f7f2b8882c9615dc88416f5aed2c808b9818190b427688462d1f88bfa502e751fbdd30516385f30f0c3eb616f875ec3c2249a51454a7cedeb085b050f7b5ad64c6cdde528fe18661a1955b1a1d88bcda8ccc59c1cf18e87f9ec5fdd9116c438d77a30242325136f23803fd31f8588ad495953d6259fb0fd8b3a0098af990d5f4fe74455b9e4b879279f5ff7e7f187941aff8adc65dd6ab5fcf9ca436af9ee8cff083e7ddfc862c72a8f261292882eb8927d8342df8e313056d9572dbc20f1048ed8edf324cc7364bf44b8ec4182d5e1450cf79a9efc212bc92afc5ad3c357b939f168bb71073de0644d2c1b8477a9e753a023d81b25ab3ba70128a98e61f61307b5a9ba605c0f81d6a305510b1c1d65560bc68362550fca986e3ac09365901dc4d817b33b83ea081f6aab43ab6fb233c5fdf9a848d463cd710f6c4bdace305b8ccc890956b5603612da4e26e9ed161782eddb99860296429b23b12afeaae194d141a7b5f139dfa1b851d368b7193aff26d917b4b11a2ee1923ed4466628ed5e387df9f00f8beb794f08dee59fb373d2d06b873ccb6a66d6119b10290135bba4ea4cd698128d1e2628fd073cc062d343a246bdad40758b84ba26fdc2e7ccf7c211c2f9c0e151ee02935d9a40a81b88d7b758eeb7a5b6372b961090fefe5179a8814858548c46f7a0532ba866098695b41ec788118fb4f2a542386556f38432cc11b7b14bc240d36a5aec7ef2ec59e57aa2ef477bf31d8d456420b32c7a6ea8f5480fabf8cd449c5e159aad35b8f9f7e7a8f71a297156919a3471c128e778bd9959c9ef087212d0b7f16e484adef356ce466edde4e54519649393798e9d2c73cf66af9f2b6facc5debc7e2869581c029cf82266484ff1e19c4aadbafb3f52ea7b8b8f1b444ebdecf872ae9c74d9c11d8ee09cd141495a8992a673d2bdd859d759f5030091a3167e9495c5cac239b3ee27def4d1d2a428b9a03cb68cfb0e6933ef65f819cf55f83941c3acbdd9c6c7fc05d72bde61548669610b151e6fc42f0706f55944a8c80465d24992f85b063ac29d26d5e371eb34188e77b45aaee6f543d007b8ad14bf4eb04b5450fee2eeb39322476f40cf5c27324f3671023f8d066cd3f8025e948437f314e410653bc67e6976fd198127385a0fd6364df760882b0e0708686550df346a5ad256ad45e55fd5a2258bfe1a1c06b52aa9b7ec98abc2d67a5a387cd81fc13d19cd8dde957d1eb0ffeb6081e0b95704d50248cec3db0bfb848c876e81fb1f275db359aa0be2ed84a28f7a4f0f026c821aec1ad8ed5ac0822cec4c3f34a8ac02aec6babcdf8cc75ea533ac7e160747c4777880b2d83c56327116d0fb67b1a5e2156fe3968df6bac7e7b2c17a7abfec6f7eb5d09d0412e9bdf1bee671fa439dddf5fd55ea6d136da2ad45726c2b4b7f33b36e9bab50d37eeec9e2cde31cb43c9610337973830fa902ce7931071c4b4a38d81ed609a47069928e3e793d4f639bfe80433b34a22c58e7bb23f66608d833949457ab020f72c6e1ff2d568b6ed6e550c43cc117143d48f73fdb0f8af9e80eaa0c4252e4606881f1587aa78740e5413fcb860060936ab1aa050586b8f92bc50b45959056ccf9050bba0f29bbd08a0aef6192032f71855eaa94879f86c274f1ad20d1b090e3b67b00cf3b405ea21bce5eb4f63698db96ab83b58fb13141a6f1ab192618817d50f3270e23c68e0f754ad30a7d36a8f6ed81c9fa807252515c5bf5000df4f2c0fd7f6ca2ff9f45996ed8ea4d52bb17c2e581b9cc673df060cd7ac2ba5fcacb0b6164189ea0510d0c2cdb64cca322ec19f3fbcee6bcfad9e5e77488417ef7820251dfc467b80ef348ce22375193b25ece8b545342eec0403980f89be0a08ff635b6b3bd9ca6167049f9cb837fbdf1d775c2d071efd9cf804b7661061e380eb489b6b68e202b18f21ad81e2feeea7337fc8191499f0d01d93eb395b7acbb449b0a3369e791a1be30402830e6e7c2c5d74a040400829739ec6a322b9885b1e9ed98e92ebd7e7c1ccd54502aa1ab8e8b415edd6b1ff5f2a6403ba8072dc393ae446e6b513ee70f21b07550541a4b9f9ef92e8f105c0c305dbbba55c9203698e8c44ea9d6d3394e44ec1134ca005963a8fdfff8000a551dd2ac499e54a6dd3a0dacd0e7ab5810a5f9549fec02144792167cabbbdc03c8d5b26fb83e44c4bb9b1faaa7fe0b9fc0c872cec2824a0613f5a6a2fe20efb2dc8a35efe2e64f2c96431e38bcf5321b489baab37af94ad47e27884c1b2f9c8e5c303015356256ef1a15dc736a82b71c0e86bf9d8c6ad996340c79139062aba56e33fba6f2617beeb3114df6670bdcd35861169c742402a1796457d762cab3e8cca966b44756b0369fc678ec284af51e6507d7a04388e712029d719f486f6882e83f6e04708d5d69e6f23f11ac4e00192624584d0ec0347633fd27776478794a1ed2332326afc7b9bf2b44f5e5498852c9846181df129a49402b3365419a504c75b588fd41cc8eb8d088c4bcbd2f8a7027e3ba0763dc4d02e3b2a1822146d437b49e6f3e5cb114db999c7144425c6d1f5b46a8187056057eaf551f3eafad23c12c334b014a7679a22fa2160c22bd1f0262092b98764eb8f2214b568f76fc0b73d875473d327bee1cb2d4f20e7687669a8d3d29995eebbbb8b2d4f781404ad41237d34244f014b130df19ffad0c715465eea605f504e8b0c6de53512edf36cd67aaf37312832b8afe5a094b8d01b41ec0c4a02e3c9aa3797401c57f224b0dabd119e46ffbea5ac7e746e128bcf68e119abe0d05034d4cdf0b24806004f1b3a83526cabb8233d95ea2ae81f93794628e0227c0739eba5e3ea7e438a0949c6e0bf6efc855fe21a2b52e9b35ec8efde98e6e5e9b4fd218a10e493599b76ba95cb7a12ee9d76ba3314da0150c86494a4e55a018303dc227e9800f88dd97ea4e2ea3e83b5cd659094897677cc077a5e5c5c0aa31565b3aa6963eb7a742e143e8533cea4a2f7a947703558b18bbe2a13a476256205d65dc083ee40e344241b7c070121666397dda44777fb0139a6ccb261f906b5de9ce80827e691b2dcffb91286f99d421b2f3df15012c7657fe4eab61fdb1e6033aa6db9472ea3347f80221de7288ea32f5ae1d02f9bf7e5a36b887218177730803b614746d56ec6bfc8d127b5313a3d67f718a9e4bb924f2fdf7c5fc87fedcb4960acb54818023504f842b708e225115cbef9f397ae9666c0e43bd71dedc76f9d289096a6317f90e9a7dff6d0f3bf9692b11976f32aca24cf4c465b33c26f3696969e54c2726f05ec5a2691fb5a418a98a6bf5e7c84f585f3ef09e012dd7f25981dc61a6954d08305a4f94faf85c6a378f13df27109161df9be2c09977747b4a8c98b150582b562c5cadee28aa7c037cc215f59c99b330906da85b47fa9157bf0859b2cd6bd844cd1d8ff0dd34d41b1ee972edf157092934f1aad701636655f8d448b28dd5a2014a4c8891db5e0c884ab6fa501c2f2817a8b535370b323a08bdb7b7743c1bf77fdab63aed9cdf9e815c069dd696912ee1e24a67ca89160f7ba09c37b97d18f2b33e00d781d1e05e003bb74cfdcfd29abf442c29ba0becfdcd70dfa20c9e6c0a6a539a5ace1ebd39ca2cd29337ed4c306a951ae973d4c4b5c22fd02df269db07d0b8298c978c0b56b429b6fb503355fdb0c4a9e6b9eba21737a6f356096094c304f6f179e458d2e7049f9ab15fe6a35ffa288b13f345781cdd3ee445d39f709ed7e7d3daa5945da1bba8f8113971ef0d1a7974dd1a207beb52d395c971a7d5337f200980938fd12d44c280cd7f45bfdc8b9d6f284e29e246cd3ea603d7400fd09401e78919c481cbfd63b12641a1ec858fe245d8b9e14e766df8761df2f3dad39ed515efaba5ba5e14bdeb2b3910f487b56193167ce9c7604cb625e2812f00d1e366f0035030fb732520db2d161c3ad3307a8e90cfb72bf24d90304b9dfedadec30bbf3d64c8e0fa713eab243d0460e820666bfee2e60c05391be370ddcb43e8b607f49b89e8204007dd3c7c12b5253802f4248dc1ba7d232ca9a663c11947b8c825f8d3f59142b2ab2f88e3151030c5ba9426f83dc5a6315c1bd073a71d1c305c1abfeee0cb537670004527cf2f7ead0207e2ab57215d6927c18991dad35164d4a77b600d35c1ec4e4006e8f8ed06888cbfe2d0b5001cb2b8417d139c2aaf7c8194bc588aaf3bfe1e5529341c6730b32820c48ccf21a1bc3b299869d7d39698ba8863e4695334cb1d25024213c4ea71c91fff2d3779adad084359e161bdcefb658b59c49e7a1cf3938d152fab302a305488c739680701d35eee5a3f68b372a320a88c31d32e02400e56668bbb337e4cfc1dd2867715e269addef832f5a9d7604a17fa8de4742ec924d3b9d094f6c0c2813db5ec80eeaaf828c4b67b665458efcc717e734f75e02e9c33a36392bc18e8b3e64290fddb92caf6d5b83eda09e03cb440beb08c9d1c13eb7c80a8b6211b22937d5ec3bb272fc0592d6dd9c0d8b16efaba16255da4d504d1f57f8fa2eeb5ed42f928267068102f0a585b67a901609fada40d409a73ab97578e1aa7cf8c29602a9549483aa470f53876cc05fb67607d4a3f3cf78c6cf7fda83bc4db07aff5d1305bd5da06f8dd5e7e985f721f2211a2292280815009313cf620d123459ee0acb0348806229760a38fd03fcb247404a93a25855f08d10a95e3cbd08f445a3ff1f56ced316b4dd61922f845698333879cf01461e2cc8e79eb77361c3ca32e7894db17febbfe19107c4aa6399a967dea0159466e89a0321aac78ad0ab875845c42c5e3f855797a3bf38558d00939893b4875b8b2067843a68ec1f61cc8f8d5034a8f87f01b30adb83e928de430bb9377f58ea3fb4900f72f80a9c5ed40adb53e99c0d005965ded0aebb350f1a0bc015715fc4d4bdfa041072367b9b9c294fa4d3c006194395eb877b4367a6235dc019aaa77a897a34730f6900ae774c42b27ba23129f96a7c10c79b63be8080fb52d97f7c774f35c5434b9ec01cbe30d464d1acc81b8284fe1a59bfa79fcf8d62d30a4df49fd622062f764e1b377adc7f5a4c0d40c539befd081dbd38c67dd99e20b8d72a5d806804ca4de696b955d5a83d371c9f57a2066316be7c55502e862b44ca941774ce2089861d7abf2d9d09be287befc4cbcbd63f2e8537224a251734ee9ca9b04161070205cca79fdb072e5ffc3a8d3d41f241e6c9b1785fd68d4ef5571a1411fba36b86be15a98b5cbe18edf2e589a309bee7784e39aae137d369e73dee49eca120a9e7a1462d9240c18a1478be930a4b0f678ee44702f9a47800272fb3e0f5500ffd6774ac47ea69df87e7593df36e32ba908a595227074161b4ff5cadfc26ddb16db6c9f6374835a9d4843e06235a99cadbcff805fb972fdb6ed10c5246af30773a962a430550d52b674f5d4e2ce6d2ec24cc9805184be333326084cc205f5580bcb35029b4cf4546aa51a98b875779c5e7269607bd5661b88685c29502db0aabb866e5be834d6e75009a6cd43f5123f9d664b0182e9e0e99ddfb48dbe4aca789b97a690105407d875d596bd54cec658bf31a351f27d39c50c6430aaaa274abe47216e8e2551f29c0b463a61bb83be9845921c43b72864a3d98f33a719614eb1411a8e8cdd53b10744184de8bffa387d9df3d64a1f6159184095b72cc2efc9c64e4663e9a6ee7c1544e9e7bf5e33f2cbfc13dfe1fd3f6a8d4be58aef31e02a4b2e596cc617388daa22d25866a00a2c274f6d65f3722601e6957d488f7e84cb7f01fe914ec39f745fbca60f1939c05dee7051b7bc1a13b112d1730854c0d1a014cd395c9eba9a535b9bae3a5ab5169c12a7c8822896c954a527b5c4b395710eed4077bd21fc9c885b810f710804cdcb69958a1e52992aea9ede72ac5b1ec9970e347c16df118f4a38e78530bbdc2b0b1603f4e2e9bc674db2bf39810c450cb51f8a7957088c6ffafeb9bf6801e390b85212687faa471ba9b62d469cfd19fd3c62e9d2a5287e962701f3c3b32e3520b1fa6bfeea3c70813875411154cd298438e0c9e598693a61d505e5d19ef9d3bf08422c99714dd789c0b3b0cea5f4b35645ffb2521ce6fedb54d8beec72d768581196522313c066efcdc329a43920480ceb7c47a9eaaac9621806ec925b4b32ef013d2df29ddb82e9cee2c847bc2de5d536695d38321338f4d31b44b9bd942310ed943e6a507434ee624fa7e054be87fe5d845f7ab4237bb2659545ba726b2c857fff61cc2ab2145e82930fa3fda026789089b3ce817fc34f2e7fd4beca9f74bb8c488d24ade5628d7752c82f4c46cb44fdb11d30b2ef380c50fc7c694b63cfb36cc93d46a071bc6a535edb93af8950676d5096cef8bef1ff5f010a54166a5466ea2729e29bca1b2600bf77aab9fcd939f67b47c7885f9ea6ea1adb0d4ca5df65d0134f5a1c9e4b81072c4ca532bc99c91a8d3a120e82dc2df49411da3f5cd64d53bb8971d55a6c4c7ad7f8009fc0a6b2dbf5d9b1d4c7f7655a1795991016fde3bf3a239e7ef5b2e4a9d8f0894115d00c865ffb5818b3d2daaa3c537c89fb865469187b0170c71f2d1267a1702a283ad81cc18d28ad6c615ae65f0b113ecfde6834c3ee94db462a1f6fb725b197ba3c32b1c064c05d9e06257a7dcc9ab8a259fdc134a9f850e6e9918dc59f60c7962e3f8bfcf6815ee6058297f3d63e14a2a0438498a7216896d63b4ef9b237a11499a5990a2d2f23395a9afd9d759cbfc107f60c4b79b1855ecfb4b22a61f1d1fe67c756cec00c37cd97a87e739c3aea57b999e26577e774ad8b4c00df257f5d8766b730cdf8633dc5380b925f4e514a9d1dd2463d46f9bc619d79187bd65bd56563da7398f1391e59222e38a3597d746d1b8f0b1d59c7bd6fac03e34d9a2893ab475206cf3acad1a909ba778cb3c7bc3df39c3caa9195893ffea8c50c967799aac685fb1f73035c6a5bf92cad857a93d21a13aed80166786e1eeeec611bd224a35721d776032799b5051d0b48bea5fa3ccb8b40b5270a0a21bf1fc0b253a676d8434dd60c700f6acf73ed013e114266699df3d97abed31a5e0109b8a03538ffb991da7d6696323f3ee2babdb550523bc900371423845eda04d3d22c2767df210bd60456956ede696181ee5ba1f063bbdfdd9cd1ffd61397a22afbb5311ab47ed8b8e0c18ae275aac48135431d3cb27c67b7e299fd4777ea191deabf9d6fb43ed51afa200856e170c7a7ef64e16d19922979fdb048993fcc57b275a30017e446297971d42921b3e86d4f2aa7875ef07c31739470d5b86126c8b6240628bec4d39239a73bdd3bb5959687caf95173683cabacc0c16dee01efe3b69b5975537475fcfa4760eeed8c0856248a6a09bbe58270adbe0a4e3f5136606b47dec864c9becef19170166f64ac0dd95f023246eca1a561f0603369d10bd1ae4da2d38f9fd5b5924db19a6628342a525d45a6994a1e2e99060f79c586250fdc933fb86d0e4fd6a44562507a04a1b418663d47197e7694112ab0379e35fb05196793511b0362a440a9d4ea7829c129a66fb2d14e0e9b6d02ba8844399867b1dc3574fafff67ca97b45b06d0f63065e7b1c03645e99c50cf70d6bfc384003727997ee799caf6509669baabb82fdeb1d478ba6fb41b2baf7370532cab0d81b15fa94e83de6974cab1be35cea74b0f8d5a5f3d93e3a004cbc5320d3db20f1cfed0857db0c9cc7189180ff76d24fbd25d27a273717b8177daf8dcc5dead4b6b151cfd81128961ccc7c66da12598b4ce2da10d7ec4ae763feefad801e253d3434e7fe22371c3e0db6e26bac7276df75eca949a3faa78c7cf4bc8d07e25c70a46de004ce9e21269957c6c6fbe9c210c18c2c5c87eb23be615b40b4ac226fa4a0c507c34ad4f8c2ccd2b11abe611915c7521a234bedc91b0c897e68a08c5c0bafa8c76d14bb34e46a24b51e07661f307efaf93d51247fabca320db99f075af79486293a8abd32da6a037ba939f4e43af5312790674252a9c83286e67a591a1455353147f171e947ca4e8042e950403adedc576a79995fbde236e56af25e8aac493742d13428f1a18eb18346660a097ffdc600f642057788067c6e39d9d29b1f80ff36d43470cf7760cec1c0b14f379221535a2e3145962b745892acdfe72bf199b65c3735dfad4af611f70fa433739fed596f4b407efa1761121db658303db67a6e8240f438f41b7bada3a880b3dcc5a3caee151e497552c0699f7b7a565cc3c21a9b95ef9905b6bc24784c3ef559a02192bbc458a6a2df6f6d2cd0c67412ef3c88f1ed95d80f5444e59399b5b593892008ae5a708ace7210f6e26eba5a7093dabd90df68b792fc10d5462b965c4f1681bfb1061df63ec9d88f9e82c6c9460fd191a07a93b689d3c21694fa11e8e9b8b05ef317c8cebaeb0c522825b40a81b54013c65698df78691869068e3a23dd39c67481d1966e8dcb2f943a8465f1c009f31e3c6d4ed1d05321c1dc82d9cac6bbf9f26f5c31980dd5d5236f836dd44ed1778a592a59bb061f514bee3f28094d0be099cd9d381578aba70b7cef51080b5b6aef1d11b87e0e60528418b438e65f1dcc314d6a8f4e3fa2e56826bec6596b82cfff2aa3f0ea118855d24b344fb6a87236c0a9c05fad908c578ed5e06b1d39c7d667290f48b6a61ff16e5fb2ec90a3f5f9b6b67d5449dffe17c57666bbd8a1342b10fd3f73e2e877c8b53d9ce4873b769d93435c912f8e7120748872dec159a2cdec8c17d89e1dbc7040fbb8de2af5e512ac775db20639d147b11aefc41dda6be2051cf177e9adf14d6a6954ce076a607a7859e29064adb3cbb6907a3a6c57a25a1244480abee0c6aafb15841f332f638706d3591e8bd0bc9cf372cfe525a4466af580595eb13f43a40500ae44bb8bfd47a39250b4d5814fb42d3365398ba6c565a4886de6e93adc87467ad4489842ce87c62c75c9370605bd410bbefabeb14fe837a9b04af3bdd38500452216d70c97d1764a175ed2ec31f4d215255df4131ed89f07bdead53b4cb27e19c8de31a99a88d96d747370b5ac616a3625537709a3bf123c980d422dbf912935f52d4cc23862ebd427689dab432affdf9f0f6ba8619b6080b6023c45fdf0c3a56d97cde08714e03ba9da6ef33b6bdce3d41d32fede70b935046257b4ed86e9b3217b930a1c183fc1ecdb4b470a46228d9c1a5edd565db11fb44fa3e4851d20e392e58c3ccab79d1124a8e021efe68a31b8303785710a0906cdda36d8858a04a871c150b42dfae40c74125ab180823d032df8b87138f813f74dcaef21204109b7d347d115458cecb7d7c9efa9909225752d6ad739cf63b0346e5c567e326331a169cbfc2f5046d2ca97e8c9397c59378e216c49c7617b9c5ef488c746e7ddd8522be575cdc881db7ec2c879bb1b9f5e4bc2bf3a0864350dee978eb1ec3b0fefe20734c052e62cc8dcf8150d93d9a9ce2d9ab6e8ff04a98efe899d2536035f0734fc42594bed4e1aa895905be52eae4d91fd27e560e7948dccfbc83219c9f2fd17c1146b0752e992f209b5cb2ba1790235e5f74b56e2394f3c2162352de231305817dc1d0d8179558b14414a74269f945192730161dfe6b0dd6bee93a652296efe28d6f51016fba1c154082403c83fe47e040ca9263856074093e7f285aa61e2f2814097ca19e6be5bd6d03c2aed6c38b68a9c8184759a9340ca9d2bf7dde9eaaf82772463f4feeebeb1208b9c8be887f660482f52d3e6cdc36d7f3232327be15fadc41fa0cd26d728a53cc26b474eee9d7be0767a9b409c4b3d2c69517f1d70d23d06f46fddb91f69890e348bb99a35ba41499bc2f59df5164c91cbbe3f2f05ca013a6494878e444441f9fcd22cc6181c0abe039b01c002485b5e571a87baac5b8c637d17f936138c2bb93dfda8dba116fd73591f5c88dca4a36b818ce69d1a433892a0b5867ebdc30cea1cd7c9cae751fe325a5d55e26774cfa2def16a873f90aea753ee0bd13ae1efcecfe0558c3b030dd9116758350dfe47068d789d4031ecb19b461c8ddf4d25d53fb22afd90ee6bbb207f7f6bcf5febb693003ea3f7b859ee99d7ef4a9c1f9f1275cdbd502859f9075febcd5f325362bc532ed87754829fc9c8941e27f0ca375bac72457a71edc1b8c1e8c5e07c169839ed073af49152a91ef375915ac2e209c50993e236f3f27b0f91c003fe5894960888abd3ae803ee28181dc8c95cf564518b4decb39b190173e9b7c464669137869c319ad7324612ebd62b261964f043aade481d87e60392dd193b507a460c01fc3dd44d4830d6080cf1a8c4941e2008595dc08dcd5aeeb06eb1f7788cbf16f9f672aa2bda5415e6ac017aef4c327eac2b6d22fa0b97c5db2e4a7f5713d98b425ec2a916e8e9f77e8299f91c437a9b9390d430c205940f1d7e4a4e0ddc812660ff4a97b217a775d8b3b6b8f11b7106e7efe5451aec2f222871634b8df58b25acba84b5f1484fca4ffce41a2274830b47f43d8adf524c8aff834320131f1ad24bc599359ef1a4904a207f1f6a704d24c6ff3750fc44caa8055fae89a55e84e1485c5464ea5d3b4008abf24cdbbb862714546021065cd80e56a1697de8d20c896d23249e4fd7072d788ee52cf13ca2c08237cd9742e6aabac5d89a9c3be11c415c8a7c66aff302513e4b8ac17ab23661f2aa5085ec01360fb665b35bfc3ddc5632c211a6ad6843f8202e8ad32990db0aedff18252487e1172996e9227c2be150ae7f016460e14967be681df70e80a56b3d30b4712ab4d31e6142188236f510a112a4d3b09a950f27443c9f6fd504ff57de150c9311d9d27f74e7eaf9b6953f8aaa5c77148828276403ae5d1f6008b4273d6d681fc3c62689a5c8b68be033d33c3bfb630ea449769a4534ba84ce9a2e81995e444f6001afc8fde9bf6c26fa29f84d385cbb79b643f5e849942f5f04bd46426861dcacfc41b106475e6dbaaab25526d5234a79b0832cbec65725ccc5ffc1e80f4b425174e02300d5ccc6182a3b654b90a74b97fa88a330c0d7dd0a0c481d8a5621034a2a261126dec44181606e1619f0ad999d9d28806ab2569a89dff0173ef0bce4c1bb38987dca64e26c1f7b79bed0f20a1e88680d204526ecd71916dda5bc3136389fdcaa8dae9bd188a3365b397c3da868f11bb97ec1d3eda09c8f3cf25485024592d14df46568dbde6289cab0d7eece063ac6cf7599a429792ea68b46a20f5950b86f2624375295d5e8ec5aaed24a3895b58f382053e731b1c55e00e48986bec6b96ab22eebf755fd5e44121d6b48c5af82e83ec22c1df0695b43602734f94e0319f850e1bad5a959f7a593edbf0a71c12761d2b1a95eff5c09e38abad4f9a6c6b1eeaaa3323d1b54d039cd0301707efb12a3b7dd1437a3fd88196d0d2d8402ce563409ce70272765df1b61b98ccdbcd2fc23762a9ccdf31d28b874552be3fe528225ab1bb4c8bf35b8abd3678bc31365e1775f5a2bfd8889dd4b5f7b2d8faf793efcad2ef520ec52b8bf759df063fe1cf8c33ced8d3a31e50f0be09a941b1e700a1b4d94cc7dfda495631adc1b21e88a7ae88afff7689d611cb3a4603cb1faa1406b4daf1de2b4ea87135306df3a091d30fa85bfc630f75d294f69e90e0e4d850524467954f2cf1cb5c2eee835bb7521639765537b2a7af01b05a490c9a8f49152523b7ce17a7eb7d5a2cebd34a2fe1b82e300f791e4738a532a42111b846c8d8e2f4b7e4c08bed1a760928bc3f390c5b47e90b1acf990e47452762170db2a74fd7e3bf2a9ad267817232358431bdb99942501b1bd410ed17520ed849364e9fda3c1a366092b0446a6bebebdc52b4e1d80fc0790c203962fcf4fde517e80b6ed3131ecc0d3550ee89dfb53a0274bc6e02ae085288b93a7c55cc961930324e7c705aa599dc4e0fe1e21a2866bac90666c0a11dc49b721d34130ca67809e968da65fcc238e040661788f4f209410c7f878723e160d0ea60a84cf88e5e0737cb8a60b587dfeae8189e6228df79eb520d981681c1776d5db55f60e27179100a0039dc1f54317fe4d0ade263b54d96ef6136088710ec236852b583f54ea03c33b6c39d870cddaf07cdd0439be8a5bcd4ea8b253b3b4ab620db64d82425748105c557243c2bf69ff335ce96f2d2bdaa7bae973831548d12f2e9f6036c7397ae1b20ca37fd27aacf2e0ff5836265b81db446e795d495af059194b1d976149f3b1996e8d68d573856fa370a0c9fa0f62e140731fa863153befd2eb8067a930c4652c2f3a16a109cde5be355a2b009336dbbfd45a343e2ebbf3450c4bde9697da82345c2df691bfa5860cfeb8f76197e642a52e0f1bf83f9e6d8a0b51d10577f5637ba3b00e502be81a4fa3eb49b051ab1632a3893c1d7ba33db437ecd2de13504489a73682f779e54557293f87aad1d4cc38c73f1e8dcadeec2223b2c992c4039a7f2572897ac4573ca5f2f80c7bb5ac8910b053c4bb1558aa10a8f5d8f3a5928583e318883030a8355572f64cb95c0cc39c048145233f29d62cab1be2d511b5aca7bad37e9cf470f6fdf3aeb375a741119a820a52c44dabc78b1c0e52cb256be90bba657e6424e8c8de3cdb8e94b315c22b17d99304788dd905d1b61edee8bf444ec8560a18b0a73071fbc81d97f69550e27737be7fdf098d758af681a57ee7b328942fe910baba6d2de2c7f02cb38b2c76f90485ea7e831ca3e0d389125cb6f565808522a6179794fc994346b9d7b9bd300a06ccae025f1740a94407866bb2f441ce3c2690ab372a54db2d59a25c4df5222c9f054b01a1d2bf5654e40f6f6db88e4d3e79def7c1f5ef7df55e553969a62b4a211a64e63b1d38b021bdd3e6f895c947da82454d74a5955169fb27671d472a5c546dffd3c0de549efb03f0045fa36e4012f2799ba5e70a343c5cee80d321838280291aca9f07b7f824abf2ca6af56940753d90a7cf2b62a242e8898a97b9bbfcb0b096bba2851288ea36cdd05a3e750688b7bcf0078145cf8844f0fd77a90b794857d9485bb2639b942e59779904a7271e2c147b217b7ddef974125cadf2b4814b1c641615c75352822d7009c5f0c41402d3ed6365aebaeda0271838e2c7c3c13215468c30db4908489c85198ea496ec507aa64e7ea14e3d5bc07b547efebc1c69a3876ba838d2588050c0f7eeaca86bf19de39805c72c2ecdf7a766b0bf47b61d929a0be5b2a041527889ee60e0ea84c94ca30a53461ef4f9473d0540f75d1ecf29cb54d80183bfa7778d21a1d4dc129646b3ac723afcf2395b2c67803cc4ebb3e4025c0d3fe95728eb47e50129736e8fea9dae3d779c08aeef21363e10b087e0cc45c8e605f91abd33103c56ddab2647d9a4df256e67e08e35f360c272f4acddf0088426cfdae1a314a45f20927bfb2702c9f646f6126f4f18ddecb6d748d919efb1a723aac2b48c164cecbc05a8b187874d3f4912e9dd9b13f61d6b61305992da4b94a471e7f29b44eb07981387053dd7e3965e20c55e5674a4ad6950b58af586580f011171517264484fd051948795902763da77b207bf9e0bab12565ed246b7b3a8ed49a24776ef429335b8f2ba7b39684816eee1854da16b6b68155b7dbb37224211a2fdc7969cc46cf0188592bd6347c4de2634fb658089373b0f187f308510cbad77595347ddc142b3f500236860904a789cdc22635f1ff59f90a290797210a2dd781997144f08d717cea9c96e93a07c897462401190de4ee258dafb0671237def918c7e583859515beaceef9272958a69839b0dab9510bf725c617cf9ffd275af41bf1beb4511f6c3dcf59772be85e55213066c71afd3a578786d15462909e8e8dd2cba5a7a07dd4664f8302a36a3a5c11a9e4399cef69b3a4201ebfc77436142ac9409ab818cbc01f477dce5c56b3bdff7081836117ec084f868990a49a26614a662d698d6d7fa6013ed6e927c3b1579eb1f89c7a97743f94ea5dd517aed3429ff1a130b166a6d6b0545792120ddb51eeeca4493627b9265a43d46716891a3e4f75daf9b1ed2c1c62c95e8520d68d5f18a5fdb8f42066e525b37e9169146e95239603b2d063a5e84f5c6c32be04c365255eb707c8ef8c42c11b8ca9a77f72e3e4436c5f55a2602f01efac3d016203e3a255099265cacefcfa71806193518eb1ca61bca2b53755447d2637a64c0c6c3809eea7e2ab404a1295b3feafe3da85a40123e0f63b174c056a2a20a0c7a50f0fc60e42ea477d0760f7409fb6ccea12709abe078db67294e64209107c91e300af9cd061ef9cb06ca46f26ffd296553598537d36750f5fd227a76ca0e5244722f5fb0d31d04d3ac805f21fd7b3b331c9209d403d53b711311021b4e4835a2b61ac3de606797c9b8d872479bae95198e363a47e83eb992d3e0b741f3817c07ec1fdb32df107f2173c68df471125e046b69e4059593868143717a2f20fc99cb4ee76d97abd1b8a1f4ef1d6950d6ed4e40d75f1afc7fea0b6e122196ebebf7f5e68183549f21c1c0423576d11ce82126bb66e947874d708466d4c7efaf9402eec0814385f097e7024d18966f24807fb720197d832711e68661d877ae04d891480488eab70cfdec782c477e5f8ce950ae6329e1239905c0b4661fc374ab58208785926dc6368990e053564b3a11376eafb82d54aa1e21bb062dbf016316b4f32dcbf93838ca5ed0415dacba990267f8a00e8002f7eb62c2b1f97a31ab2daedf804764a7799396637d4d985c60293c9f50db4d30eb53ea7ff0bb0b4c2811bc4694f103d176962da677b6c71e299a96f66c9160c4ff4b1126192c45710e108f198925615a72ca8442c7f15de2637f8956816c269b1e3ffa05c7f0417b034ef1e14ff06eaf13df332f14cd314093a45c17feff11a52ff365fc16f381f52fc0f6f2cdc937e9e1b4104718b02b5a176aaf3cf245c3b6d3c8ac0252e88c65b97cf484c9d6a265dcdf456285fa1b051e3addc85d70480c9e3385e5fb9c2df18dc41c365287aa6f934d82da78e3c6404b6a98d061ee9566a7616c93475d919fde41a01f8faae6c1141f3a542fd4d66941d859e8581e699c35fb4f05b3e796789458c009e8669548791da03e33cef4ef683db2903b4d62dd465a130980d0ccfe3911901b6b7f3fa7094d3e426b69e7d85385021e91d456cccf71488fd8f87421f0adf5a9cf16572ebaf2ca2fab9ad56d6cfc365da359906cfeb2edcab934d3f0ef03e42f1ff6a8636931f4ea094b1d47bb9c379bb663d6854906a7f6fc6e72928497044176bba205e93c694dafcfc9f88a51a0101ab968b93067204b34aaf2bed11e5e4ea71d17d2f61d514e6040103b7bce50e2acb6dcbf1fbb2a41084993b2d1938057b7f5f57e70dc70f4974e1af99283c8af81d48f64ab2ca39c573abd6130538188a6b1a55a8873607df711695e1b5be983f0842bb0d541be1fbf615631932a0d5b2d521f65a0134d45eb5559e935936e3253517efd661478a80b1ba39e9da9a93e6e26ffa7de7c909bbaf99f8a1b1fcd5917f30b79838f80fdeb34c110f6f95c5be9654e7b3ba42968002edc3560d2bfff98f257060e6b84bd3e21ba5d837dedd29c3f289b3018de9f716ea491baada73bdaf5c180870bc199bd520abaab5459aca23dac9df9cf847e050e14f7d394d1a8f02d9aa6832ecb1b5420a5b174b7940fdd149ec057a95b0328090b5dc782dfea064b348eb00c609eb7c2156595954e7630f72f3de9940c74a59d723f230838687f4b35eab1a12cc62948aa799cc8a1ee3fe78bc09d82c3634359b22a24069e0d9a4abbe2572c4197f8151a97f5a449c05e60acfc322732f1d81cb542e912066730cf119c7dbe50f8df480983a80577cf7cf7fed6f3ea057df3d25733dae5f85dead8b1d732891bb79fd6291b5da80718674ded3dabc9bc6939fdea1d79050404511f09e2a9b85edbbf3107513f866ba0eca8fe3b9b71a21aac17f6098483e8b02eb9fff8344fd5d6d8eb49b44b0e2605418667783a57538f70421746d0b9a903be49902ef88112a3ed346a0cb8b57f60d2b1bf5d3eeaa2ec5839a910e58e3d7557c81e11f621b0c8b82999303c0399e2b245400233b82c79dd881907e4c2020521f31546145569aa18cb20ff3ec488fdfeed59f43abf401d1a941a34f7d1fd962986a9606e5574a7807903b8205480e7a61a9e111262887267d0dd1192430106143112fee57327ba79a98695c9c0e24df134ad23361cab7d9ac3395f3077558e98f849ab53df1df6d3bc4539f3398cbcce7d5be7383c5ac5a48baa16ce4e3682927db94dbea257596fbc9a6ae2416eadd6465db4642141696007d4cdc3ee94c95c1f49e4f3bb139d34dfbee575ad12c2ef331a3dc8237ee24672df54f39ab1d28af21078db5490254636440ba98ec9c70880d2d3debdc5d38277775f820547d3d07bc1783ba9b25fe50dcae6ffdb530690e75f37d0aa75fa7ce3ecc44681d81f2b77b4476981caf6733b3babc41a9c9d53b442e31f59071170c7559374bcb7a483fdda5699cb23777cb907564f74be8784397f456a560160ca824b7479904b156c807fc17dc2610b03087b9091a67562d31c717ca76e5c76c6fbbf3245bee902890b0e10889d02da6d7ec970a0ba8c86f9c9b780f3b2179369f67f19961447bd0618e994d6fe1694514a91f3967c4f2d9aa898e3722c345d58675f4ad1b129b24fac7fd47507659098a4b33ed13c7c81f74c88cf2df7576068674dd26d6ddaa6d0c4b0bfd6d8b82fc36d3719f31613bbd46510f9e6643c81aa23e8cfc1cb3367620d3eb400373954a0763791c3411d1bda225e12c370f51e06dcb630be8c6e48652e61fa591ceb4229b5aa9c8512cf350d8ac7359e75d3b33f2b028a36cab4737eca7d9524097c6deff27fbfc52ff772b3b36c77abc3e294389698af831c69a046436802390b67157501738949730ab2a15d3c95402cfafdfdefae3b7ccf8f17db4fe491b1f6687b164c43a2f997ba3ee5ab5c32b233d1da7e557b21e22a41c0ad8abf1a97d29cf5f306df79de03cd149c7f7b8dcdace560067e727ffa461c3aeda434432089ca28b4faadb34d8c365e9b4dee1ffa469ec2e8bf586e0417e542ad320d94bcd8fc9ae967bcf2591438c1a375420a2e537e684402250d73644af47d60325e68e9842d76de2a7d230ae669207393bfae9e12579e25ba5de9e81475a2dcff0f39d835113b9e6696b7eea66b7c0d618832ba1f92605af1329763ca2138eafc48d4e69f3a708e73f2635f070b9fff0ec1044691cc9c616c984536faea65e28aea203036025a9e33fd051a2c64505dbf5fbfb71eb7696391fb9d855eb7e39e48cad4a503d77e2bdaf84df80570e56bf94a1b790b6afffc7a7bfa6db79c19984b3492e9cf343453c2d8a1cd155947d488f623cdc41308a9dfe47a301ac8e6ae739ab69c28cb469888bb84999b2328b80432f0239fff5ea6763681e2ebec3dbd1e5ad5a0eecd5a6181e82f1561f0dfc34f5061b5d47750b534555b52e755d3426266c4d1ba9d1b2d6b94dd45a671d80bb9f75686e82d98a2b36d3345136d9521a88381e609b7222c6d705c76cf990418f42b82e0477effb88da6cf7c88751fb160f6be2ab56f2b8f9a118d40084dff6ce1ed7ec51433748ac8b67490d479fa6bb3bdd3983a46e0aefa8707a7ae1fe859d6f452170a64415a78e119378e47bc30272d14f738ba8acf8f4850609e14ffdd2f8238c7f3e181d18034a4aabf4bf8a81cf28a5613823a5335a83bed2221de59e627b688e9f78f8ce4a84c730183110c4a3cb56db5d1d78088119a30abfffbf338bcb55b97c2c1424dc46eb9d6218688c169bc3e6d3b8a42c658053b88483fc5679817296e6b57f00cfd2c3c7050b56fa9d228f18b0a72f2ef7b6f616f90463c1bb10d1bf0ba51e134a4a4cec5cb704bbd6dcecc94f5a059383adcf635e6e8528c76ea14d92411cbcfad2ce693225b19634e15107292b73bd4b09bb64de98243191ea3d1376ca97777c7c47b76e0d1d18a31b6aafe604ced2f96d6fb78b1e337cbe6fa69fb4b9c17e86725d0fce75ed61289ada174c0d4df1450d311a55d2ff539aeb04ed7af1cc372e635ec6c52994d75171a382ac87bf4709aef0ccfa0481eb6346dddc332fe8ffd04139f5c1d8d000f503b15517779749db3f042bd5e5272b6894e49910c3502414662f021600cae6332fe917a5fbea02981342e10cb1969e9a83e6818648d255c00305f751b9c9b21f3854ed684eb63f89ebc9470ea5da0f360a013197239879f829d8f98b3fab33c470d2a36d7e3ae55500fb50e4cd4e7343218fc47d8ae9cbc339bff8ce61d1cb8d15c744b35e2caabfcba24364535638eb3bbfc60bd4ebc3b29f17b4156bb8c91db02d7b6a6e05ec9ec3f6f298dfa56177efebbea08f8b0f36f4e38a610dda2433df2babfbd1ab3802f8ab37698ea89136daa0ee581918e0a56a279e93ac65fd9635f3dfa02a27ba189c07c682b263614819acb8fb73adc7699e18aa4a390c32197f9658cb5117e224e98e9ef212155316e9ff741e9e584c6f115a91f3ce3dbc3095176a80fb40528841a7f4bb8784a1c54d63479289499078089fe09a5320ade5c6e7f3ecc9e3461fdf6b35d1a7d8f4ee9152e250aee36316a637064d4720d73e4bb496d4e98d14ed096215bc72a7e64f63b4dc790821644d2a65f38b8c9be8148f3e8c97fe1c563c7c735df33d0107a4e341b3d70fa1a0da3773bcc732e3c1b9f3df8fde978d2bca3574f630e1ce74a5b4c6a77a94f957a38b8a9afb2b24bad9f87095226e0c46202296135438789bfc89549e006caf4f45ceab828891beae52199a1d99810e05602307d9fbce00cbb31788d65458deb3097f79b66227659b3eda1b2dbff8ab44a55ebda485330b9270bd876c91ee15648ea272897d169198102ebabb6a49e2051fe0cf34c2aaf9e7c8a2fbb4b248018fcebb2110dff6ff19f8baa4a0b3b3f67b7bce7cabd5b2bb3c790ea42829a321d61c4002bf68175df8c38a15f242bc2a99c6718fead383d2be639cb6f9602e2a2f21ff43be3736fd4229baf03d6258315bf2ea3cf1cdafe26ad313a04d6c056ce1a9f88f4d4d324b4c6ed6afbf4ab431c4294c9412315d6948461da2505ec5f9565c1997505ed99c8781ac94588bf82ec5d54d973b39800bd21b45573c82f851861ddd03f463df04bb27c610fe7ca96188e80f4a9f1d08f34497cba59710bac694bcf90122db3f1d18371304e8ae5d5b31599df1457835839fd84245a0c013de5f3ec83e02abd13dd0582259644dc1ca620de260da849f78ef9bf8cfb642cb5b7f96e2facb2bfc8108d6e3a4ea7a73525eda79d6a1fe8b1c3da777f6b49afd7a343d511f90c7df8197edb4f7a52553138b9afce59b9dac86f44ec6167abbc7b2d3c55058efd727a6b3d0d6a761b9c0b9fd64e51eb6265ecd09779bb8366ea30ae0d4a4c2d81c6c7d3fccc17d3ec4d486875c14cef78e14f4ae35fdb93a044dedc5c4c6bd2a4ecb47187219bbdf1f827409fa5771b14d0da34a75ded1edc7dd667a64c2b0d6a81a2ef555c4d3a8811b47bb89f0633d7c7f9b684cd08a9ef051f91c7199ec8d0da5081ef5bb0e1f94ea63a42c7f3c3a7c9e2d63d6409eed160354de40f4861d6250b26971e13c751e9192c0b251f13aa576c59d2cf826b4124b0891244cd45fc2a54a62d15418a2a5ae08c523945c7e2eeee1b7cf7ffec1cb11fe7722af9793328c7105e92a0860d7537e37a8ffc83ecf71f2d8638421e850e7a5ea1255bbce1cc1dbb7f99a16ef09027a1c2f5ab34867ca6a2988d9b61c00ab57962d7234a28f71a97649a3837c8f2c488c0f20d4829739957710d95ddcba893c6178619f055e8838cfa151da199fe1a4920f3a188d5b6a8495097cdd42573e6a94ec0b7b5e85e1284c93a842b2d7665164fa35c2cf513694ccbf64963449605db9c6deb577d16ec5d64f3ba8b707b0e04bbcb587d812d1e77c61cddb98505ee74d41775ac9d13048941154060d6d2cff83f8c8d05101570b1e1a0ff48e2169b370d5768b84f9ab18ddc7dd95d5f7b7801b8fcf0266f3d105c31c6ddaabc2a588c4560ff87890bf50470f7fabf72f062ab076784de905ac57d110af4befae8a3dbbd5cb53fdf574d1a571e94b0e7d41751caec8f5bfe197196426d3a1e443f042ed03895abd7f361b1ad920df93534fa0b8d4897f5429a6416b32277d0695993f5ecacbed8c87ab862a5f0f8a0c1cb6c73be8c81224b0e7cc704e3ef7acfe065460a905c50f3d3dcb599fea72be3dca9279fa39e1af4788cb7a64cd6e0765d8b1ae522b3dae2b2e4bdf5037b24b4fe50acdf2104db124df441a8af140f01d3f43eee7a2b5f44118acc76232e4a3dba66dc2e59b23aa6124f465e79caee789ca64227be0d296b6678acad6f2af446a5e1b82d784ababe3d1a5a0587fb2207617e4f030d25c1f495e7adede865b38b44750917b9f1965ea90a25e35a5152f3d6c8bf40f2ddfe1ec7693e04cbd3a43a7983bce6ea11fd622e3baf97ec89a115677796199e542132e8ef50b41c8adf2abf6c41b89836d4c7fe8fa2994095d1e10b11a0779836f5d7bc121976516375ec520aff60e96286b0ea3a1c7449aa78781f2422da9715865f5c42bf7d2d11603936555d3a0ea2e46394e020d1e21ee4ebd629ba9b73fe41e6c76b2013bbba925598c9fa77fa280ec04b0e3b3f84771173802ddb8fd8b63e4ea7be65af31158d389a2fde0e84789413906cf5aef7c409363015ce10fc02585bb135f4cf83e3f849261326fd8062cb47bce62b5f1a054a4527d1ddad9db19c3065036c28d69c6600855f4dcc32e376dc1affc7da132027c27e3fa23067e7b36f31f197bbbdfa82d379a2abb990fe5fdc47ca1870e91b439b2f79907856b96c1aabe2676</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">主页支付宝转账5元，并留言文章标题获取密码！</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> Linux驱动 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux驱动 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>input输入子系统</title>
      <link href="/2021/10/15/input%E8%BE%93%E5%85%A5%E5%AD%90%E7%B3%BB%E7%BB%9F/"/>
      <url>/2021/10/15/input%E8%BE%93%E5%85%A5%E5%AD%90%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="想白嫖，没门！" data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="d1e7b52d68d78b03c475b3c25921b25fcbef793c2f39febc40785cf9e85a51d3">571d5de1f5a053f5c86199ac456cb1a43eb166bd6254c6c81e96bfa55ef337b32acc9ab4364888f7630909f65cf36db563b093f291e096dcda4cdd8270e04046a5933418a042f4a350600baaf877112885f6438b40dabe07eb13c5fbd360761007df44b377742f2daf215e9ed1c1ec6754123475bc9656ea8230f53f08c4a5da903d38ff6c97f5afe3574d0c3cfb9ba3311b14be3eaeac99f4622321d1e61649d3c80f3ad83e138e3a06eae3c466886b1dcb13ddc0c86d9d972bd41081f4ba73bcb4f80f86c0251735b4e03a718471c674a68faadabde7a4ad772b72057402ed6f3dbd240bc8f49cf202e1ef0c42de51e4d0dd6a9c0200789b17c7562b1f0af2466155d86f4935fc4866ac6ecff6ba77963d67975deec7f991831096fe7e13f40e5cb727226cd8a5bc2261e93b98da407ff1cc947d7a6d0aabe2f5428f9d327dffb2cd983d03307f315af547223b0d64eb98d918bf692fcfe7104a04e42cc5fad77b4f1ee5c7b041b8414a12fe14a861fe103002b9b0a29a4c1a18f73a43fc5dcdc8c3610f6a0fbc982a3d19df16de04b90d9b64a77448d86ed4ff6cf29a909b5a23545f309164b1af7fbf53143b5289ad3ac5661e4fc1517074dc1b79bbdcde5d7a12646e2bcca6e95cdfb87e718e79d6d3f04c7204e92b55942d19f5e5c897e5c90b027519a6ff174001c32500dc5670c29a889b92947d180ff3992601d67a66c56f661c7ec39ed81b47614f3e12e1b3f8f37c0eb0a7b13913fe9b37c9b5bf7d89afcd4b0469ccdb00c66c03b0485ac0a7d1b2c6aef61944df321c918615fab58eeb11f29cff7c3b414daa457bbad097f6ecc284eb424735cabccc2364ec12e7f07a9b3932a9d9d1f256fea478f026b7e80340eda65c95bbdcdaa38713f07d0021e2e51410eb61bb99a9b78bb1a45709e8b31c425e37582f2f6d306be583e77f854fffd90ceb8d0e6297e0c3b003b1c3b9e5eb40ec951ebcd01cc540de123af85ffc1172214b876271a588a5ee4c91232cf54a9caa701546f52c1f5f2a7054087e3493eff9ff90fb8ff276ea9d5f370e92a270f71de966454879c24f2ecbf9c94c2444e33769f8c27de936fad8fb9c67631dfdb96454fb744e1afef3fd6ee1ab94fda4600b5cce0fa1a6a5f7056891f0c5ad161eda1bd7c749e0b23c031c31f0292332d27bd689af98abdbbe91ae1d7f5a877e7a102928d8711edfaaa27bfb9cf505771d49ef131d0db9c0e85e874839b95b081b2438136d80c81b10d98c6110c1af220755c76380761e1881e8e48172bb382f7c9874d03496bece7b49f39d7707ab10a25f007f779d4a76accab98a7cd25f3e1b8f72e016a776e756084de8a5f19baf6e76c606406b13626ac38167f9ed743dd075f66b87ceef0004c63842a275352498dc18fe41f4570f05d0d7fa7caa67643df013a04dcb03f0822d1f96a15f11cb090210e7e958fb163217f4e7179243942e90a536aefaf3a847ec895d8793efca62c23d7fa2f320cccd23807fae09043f581392317efd08d247f67540c04b95b35903d0b9d9428ecd87e30c5ceeccb1d60a9ae0e85ebe66971bf598cb3efe3610b1769813140729b7518484008206614daa5d2aa79487c88812eda195de2096afe16470ce7b96801ec8764644df07ddabf765d3ab524f058acedf5142def6c3d660d7b1e65b6e74909628034bdb6fc1e0957262189a83dd66649828fc90f9522f171db73a3182c0d8b49ad7e915ac9ca5bce20f78878df676057c1023b9974ab9f3c534a2c6de692515a82debcbd5d9aa768068575cc457ffb19fd1597a334200d20fc6c4e58edcaacd65737775a75119dee8d8c4071b88229d118e1e54a56363647c7beda762c14a75ef33013bd44429f08d9d102076e06752a2d93db5e4e72799ee8fb12c593981470b0e2b4ff2e6f177e92bcd75f5190440097253bfb968732f71d519843c6b241c43f1af120e0998ca28981fd37de02802d002389a8487850e93242558bab6957dccfa6bf0be6983323e2b4c85a1b2efe7fcddb3350832e5deb34cc15d1c8e5bfd4d83d5f9104b99b7feb8308754f472874e59598b654f0b72160d2f5ee8e02848c676ebb5a2d67cbf335ce22711a62baf387a34b6e3ae1c60da89b7b866411bf0da9332eb0646402355229654aedad2b1bc7bf862436ad1dc3a1ef4f11217492512a272bc68742208ce5b54584e90d075c6107a93d498b5f56abb415f81a08d94dde4118deebb4beb0cf75ad556cf55aace4eec5ec82874dbe54df81ca37b01b06c3ef2795fd113f144985839c167cdb117c774e41a720474d44719f5eea2c34959f3ce4a7a60cf0f907281e4bd0b0fde6c09cf2b9d3b2d856f85278d6c368fe95a563261d68545ab885aa83f433a748464ffe9e822498da8c36cea7342869cf9fae52e90e14d2343d194d12a97abbdfad1d89018354d4da53a5a9414d17118135a08f5c5e5ed78a6b08214a711e21ccb948dc95bedb52bd81ed49fc1a7d5e5f924320fd79539d5e2eadf04f29f725a72396cb6ba526ef4db7229a748dbb677cb25bd0e3bdd9e91b8e33315bcef10299f94c54e6136b728992f0304866df4f7c2213c6564414ebc8267b5f139e8d54dc60c825566471b6b62dcfab080b37c0d609f88e35f0025fd7e5165d9f5f25a26aa3104ff06e5257cf2abf5d6e06e87b03c1af539a77c0d299ca127bd8174636a38666e5562251a05e456b5d276c6eb9cc56861c4b5da64fe181fcb1e2a54e84e00ce6c457d11c964fcd9f0ce385ed1d144ae8edc4a5264acae11c4d5e3d3e4d076f858a51c9a7e02717d6c9a4c3e5cf6b7be5e1b15bf04e11990340062b31c5e966ccafa910934fb6430d840cbae986f1f2a471d4eaae9bc174f02a3ae6ead76c6b886cc7e8e865d650a8c350a2e6c57767d12418d422f6258bb9811f20a86108f0de28de9c45d8abac6861908af58cd312ed19cf65d97ff711f1227ef91baa276f2614935df4c0f2ef515a3b1bece810d9676f6b2c7e0e89427fd5a1ad2fab2254a0e461aab84f6fbc478582d6a036f34d8b8b67e90178454a229f9994d9090827ac33e2c58c87a9c2a22f0a792d1b775ad940f83acbb17927d09d68164de0d25667498f4136587cb0d3d417cb735f8ba50c44163ed382964e35030ec398361e79cc03f3db88b909292d74d14dffa7ae808c9719633f5f8ccb1b72bd254a683cb675ad97272ecbfe767720c6a13008f65a3837e4234b6aca5a68768662c5e1d76e3785ff03ce72d4d86e4c518847f32000e2c132a5687605bfbde88c4798f53a5df304cbf17d398f76b4abadaf8262cda44d869ef99d8f4400133dd383ffc57702b17bbb1b9f829081e162738bb0efcd85f0cace485356aa5eb47150bdee6ef29c4ec7f0d289d795c7d29f748cd09f02419ce0e02bbc24b02c9b261e164037e49cd1c415b95de641dcf998f20a959a1863f6a19024c4c1f11d05456a6f17366ca63efdb91eff633812087888fede0448ea5c8d1074e8cf2d7f7cac284e9375027d937df0381bcc0eaea31292a201bea4b7ee2d46f90f9eb518ec03858a35e8a3f0b1884244feb816d4d8d1a030c1de9a3284dc62997c12d6b2f6f9451926f7e03ce284913020dffb7476cac73f3f73cc3c2ef2f84896e6c686dbbfd18bc3a99d6322cc4c133d93749d24689dc521a8966330886c7b124c2ae2f965f52e232e75ba1743416260d609450e8dd6d74527933963a73329d6004031c012519800d6d40967243403960d82c92e7d2efed116b0374e8b196abac962a31ce09a1ef42784b55fbb088c0a6474d96257ee29f629597c5fb89d115ffec9f2fa3b827e140c333038f1c70988ff90b28776d6dfcc447ea70f7974e48098eb5121bcb415616e45153ae4655fd8ac0a2d71a38aac41a9ec706de8af507fb4eec17acf04c80906698a96aa49ccc1ba6d15d346863dfcb3682846d5eb832c7dc3164a0371bc01b35d1c889113e920d629eab8fcaddea3c307640d19c9bda11b55eb877c64ae8fb80e915ac765226b8338aa0ff79154bb3189b99f5d7d1e2b582cbb3e38967dd6f2c91dd6eba9d587b1e0338dbe9e16b6364b31b0285319ab22c49faac32bc465913ae573c2b71092e4dedc1a02c74ce6f4d9fb835ad6f834cd697a7309f1368c2880d81efccf52c8196458652a3403bd8ad35af0e3a09c03b0e426d0fdec00cb89d0bfc00e2f95baed4a2428e4a9c6a04b72103a5c0f6d122e0cc4d5c4a9fb6146878e0872e01ad8bbd38b03d9db4c5518c08a4ffd72371da4b6de6aa2679bee84f784e59f1c64a89817e42624fc86919ac5c1de34236833349cd39a82a629fa76dace0a806461f032ba07920947299e4049cb2e88b7b0178cd78c83fb9e9a44b5a12b4ae0cdbf45e31912ac306779bcf6991f4433d1abcdad61db8c92992feadeb4337b41a2cca92e69d61a81bbb8abba806a2d748c9af7ffd7f66a92a7a5134804af0a4f52bbe46b5ef8eb452c3ba185b91063e9ddc25733c672a06d1037e3bb47def284a1e28d78d436441f12981e0070c44df1b351923ece9641e1f9cb5b0e083aa7537207066ff6d303a95f2b62c816fe54bfdeb090c541b0fd5ac01c6b31a10bb3b031d4102058ca72bc742ec09feaeb822af959fef281adad17003657cbe72e309c55b3834e724f06777c64aed1ab2bb3aa10f4a27be5373b29734239c0c74341383372e3294f0a611a91f5236d0bbe6a18d7dca45db72df71cc681364f484f23b23caed28ea751fdbe20fd6559613236d3a8fa80e1680238d7a30d2ff1eb2854e9be8c0ed931f450a73bd718c15771bb8150ef10d90f79fa057586032174d39559e659a06787cee2474340f8a0ede80863d5aae8f5deaf3bf758af2039903526e856f61276482d156edcd62c820f36192899ceb5fa378063602230ccd906e6d93a5957406eaba5d5ee8653abd092e98a7b7338b17025cb9ce1247a95eec619b90eb31172ab5f4507fea8d3ff4fdf4301e8f6b72db72cbdb5288e1d9a8d2e1fa1b4d34622d40c1147b8f30b4baabf972b57ecc3021381af07131052ac9254b8ea5b3535eaebb14783f2c6173791cac32acaf31de43145d5173abbc4f8a9b080fe6ee3deeb5959da2df40495225ff158a02c5f75db226df80e9213d383b3fd723c22a34b6126bdd64fc002f2d4e1b795226f45ff6e9accfaccda0a68a47b58739151f89912361492f2d7877b371c46904c10a5159849338b77155fc3ded36a33a738b5af5bee26bcb87d1b28ad985755d796b69c4aa7e941a48edb0b1eb476a77e061ce0fb1b5a04caa9574d1e548f6fac0ae0e4cf668d47206fd3523952fbd48bc41666a5a0c416d7c022f965022e4496bfdfd6ab7b07d01ff195bb2c04f206e64f7e1c2b0cdc0bc59c1e9ed3cb168ab47eace6b9ff89c6dc36966689d2049ad767e50f2921f26dc57e6acea2ba2864ad89382d934c91d8a70de8cb72423db4917517a832eca185440e14c25ebf101558ca607ab64d30f68c84a38ef7d9ae09dc603820e6fec20837e9d10489f1f8046f7c361670a6cc2d173c61c90179f2a00f130cafa8597b662059df7f51f842bb1ca3518778b63842a9412c39bcef4a81fbe96a2bc014878ce623a85001165d12ea12e58ca6deb3b47ef1844bc6550f3cd6023be642dd3b2e99ec3de72c375d769a8e484430fef577818af177e848899f94df1f9e628caa95baa617a19173213a2d3ccb91e7455dfc86a6e221ea4ff96cff953490e7ecfeea3036bfe1ffc44f6514980361654ffcec1f3d8a4c63497d5c86efe5bd16e1abb93abddd1c4a47687ed106c4ce07bd1c545b725f4933720971d9a2a9e65306c0e289e0cc1526549c99702c8f660b97860fb532c174732b6b0d1696614372b2beea0d70985a1790007f517da31b83158331172e7246600ea88afee9c50f81f80fb5206611b5e06ab0c363ff33881a3a01f58a46942b5293410b16460d5ab8f55a5e1ee6c6b302b199904a21d10a402e7f4936369b92ab79a93925602884844fc6b4d06c5580cfa4ebe6aebfe2ced2b69acabc79e2e1a3a8ba0c1d6138c06ebc0f9b9f207bf794ad8555f19991bc828a9cfa0db1c138da80fd3ed90226ad73b145b7a4c2d6022f33fc3cc04b227505d89d1134bbe10942f361b7aa5fd64065e6a783e58c28664ec694b2dd1c951931721f2df5841e894bdefe74560205de1de7dce5710fc542a41f82894aae12cc395af97023d3d93044d82051328166aa9ed2ea4714660d8fe3c7464e189d61a10a86cf2c2646d6cc0acef284802733ead994d8d8c0d8de4aec6a489d28a7e3d03eb0343cadaaa754aa05d641c8006f0d9c9bad5a629dc10dd183b936df03ba6a52d23ebe9c802d8dba07f8df2276384496367735873640185a093ee07b8dd6c20c6427fcebac0235d17866a0453af81b6f51ce3268be16e78ab4613c861d42abe7c858bae8f22f5f7641e690b762bffeb9b5b870566b4ee1bb1eb3f535962767d1c897f4283fd85c445b19199ec4eb2f5883bbc34694c835bfa4c224c4cccf93a04c4c949083f1d4219a5bbfaccc11f73f2713a0eb2b80ed4d10f58a292a1427b4fa17ca1554e42b77e6cd0ceb6f21e619466b2e413b3abc93aa0cd47aa40713647c091ae432d7e8f443787d32c5ebf85f69f969176c3f978f0f7ff861a7b0ae17c3745fa5d3fce7cd7156c65d715dab8d44112212e035dd5a9d572e8bc05e65ef44e77fc6de499134ce6cd77a3387b98c74acef4d1e0783439ebcfb983fddd650267ea58fa75e408a9628b0e6bc52e43be479f78868c173271e027923cb854eee1830d3f4723d9b6a14b07addc09c9b13c107776e530bf07fda32c64722d116765bc427d38a72ebcfa1a709f1c07b55f882540cbdfc6e2c8a26415ff4b3b8ad338cec7f04b35803a614416d4ecd0be3a3a52ea58ea4773548d1d3e947dc5b985b98650b7299a7e4023d8493df176d58770dae72442c9b35005ffaefc40614d3afd3f5a06470531a3d15fea701e2deb34ff590c258a13f27ce3bf23311b34546baa45c45e25042a05142b11763f4fd451c253ad4a67d5cee26664ce10cd144af5c7d2b1ee1600d5173d885156de0aeb45f22673aef30b30f72f1867e2a03f20b17ec93d6598c973dd62dcf52455b1c1e7b8ab7f90d73e9f0196df99e8470693bb4b14af8dec4a23b113ec76096818fe2d8c5e42247678820c225fc87d306a3bb3bfbf768dc10c7adfc549715bb352a6caf83f08a3e656fef994fe34cb63f24b2e5391cb9fb552030b39af01e25d9cf0ac3eea6d4e8bf2a2512a8bb9e4899df979c01eb40f3acc48b5f634de40e7e11efef623cf75140ba29e6e4f23c245f5e44a6ef5c73749beefe281a1bd80bf5ff4fd67d3147a1479155050164bf89ae7de16d95191e5a1728588e903b613307578b4a8c348def7f8c79ed9d2f10ea4ec0e0629638d5b1bbc0e907f39f7e7abd181913b1f54525c97df1f488d20292519a2590d09fd7fbc9f528c0d7ae37ba68fb26a8ad683dacffd8ecd35379c1e40488967f4f3e218836a13dea7fdd52c1505612cba0112b3e98acd4799b789de7612fb1713af851bd5cd5e4747011888e77ea7d9d6b5a00873992fe94aa3d17e7715e4e42a7abb507bb0f789895ed780215b09f2a6e7ff35198b5be837cda16495dfbfc899c2a7083a380a4a95562dcaa571bfb49fe3ad261a443d62a9573093a4ce1164b7940427f8faac7a35577860c2f472fdbc8a90a61b86c5184fab11e20a02095e87534deb155a8d5931d5a6d943580a88e55d1a868f3e8f0a903cfbe9c316b7e9d8d0c93c51697dc371c3c8ef24979fd2d01fad045d45a81430d0f4faaeb394c70d417beeb49c71ce5d3b316d61e3c185ed4ab853678c699f307fd702ee41f1a7890f00de0ec836426e4a89eba75749014bef25f0810957ef0e4619bc3b46b6a11950603bbf82936b997656ae47ae570c384b77351a069c3cbb298a062f5a2d98bae384d2b0bb3ee3733fbea6b8fc4240191c8d34372a84fb58c94cd11c0c2d53fde8f64d5f5d3875338aad53564092897e50d593d3572dc4e00a817e5c37f28e710e09849349a3da17a586375aff874649ab9e245e8ceb420e34d12ef6230f5484e466f4baaeb57c6c28741ac77e981ef656ccc309cb4607d4e7a9b2761591b7435ae81218bbe6fec4ebdef0d44e59b26726b7ff9420a5f49622884d0d9116f44ea0e312817861ca2782be4589ee67857dcaad34cb6b7386ce625eebbb2fea93a6e5848721f13fe0f5dd1d4a073969d7c0f24ed31a9c2305558bcb1fcb0bf415d47272483b05b9ca3b2b68ac232e1ce3e07f26147e2bce66ee1146a8a56825a4f4dff6310281643aa2d492814c6fad9db6b475cb4fe1d57202de08b98980aacbdef341f2e86e678cb79a466dcee0683ff956ea5d22c46495de9e8cc8e74a112ef5e7826bfcdcdd438713eabf43ed7360bb8508730e418deaff2cf9e74e55476ac5c252d9b89f7adb6d501734fb5f99930c2aa34ae75f45dd8f5d19baac23091902a7b84feec17afffdba6d8b16435685f5620aa06cfad1a4dc43398a12162ef5bbe3cfa8995c27c7e862b89665acf00077177a4618bb2110286491fcf03a64894d3c86497cb7d225673097327d63de792b550ed6cfadc1f5915dcde20693a8d6f8a3329ddca21576b0f2d1147dda3944575914f747d84a932a345c0bdb001df2bf0cc047bc958e539f76a97aeafbefd4f2e812c190285f7becf911a527f1e94c4b9de3ae5c63ad954967d4670c33e09c4a57e680b6f3c18349b4771cb13c6cf5af501a60469b263cac35fa67c0f1ed2365bfd5dd4519a032c5574f1ce86b1613f9973a7870ac4a8dad3de1d8786b90d8d7d8a4fdaf380780bb880ed6b2f2e601548a8f5c8ffa8a68c5f7f75a656377871b5ddc875662f93d7e1a6848c4cfca7a12d7c036d794cc2e6a71bbea896862866f18474b33707c1d4b6d6f4e8c1ec40ccfbe85dc7128d9eb56bb2672c1324ab6271157c65b414123fe729cfe24da2904199e45583026ecd0e42af2a59669ad0f3f808b233670f8ad8b80fe6c8c6ebcd43e05969e5c51ecc9e4d776f6ebfcf84741b30fa1f56417bfba6b4dd8867c7bfea6b0d811a6208eb6590ea8f34150eff566a6784ade1f8c9a445b18f47288af0f49bdba15579b631d0c6fe8c36526eeff1fee2eb5a9cd7254b19095e69146b33f86f612fe4f60026a3d88d4801230dd654ca9547b8f419ae96d0099e6b6730eee22a8ec323d79fabd4ceaac16be461c467df32335f0e2fc3ee1a107abde9f239458fed3162b20c27e31d4bd24f2e5a18618c4afd3a207939a3cd27e5464786cc63350681801c81372db390b3042d9b9b90112f9d955409a99d831b680f320f37142739070f2f9640d57b5a3a4a9d4baeda9d419ea5e1916249f526492426985bd06bdb5cd33b34ba1581bbce71df27d129aa862b4c094683de63ddafba219735ef4a4b0d399701516b7ac7dab124e8d07c974732434b19338d97e40d703a06e4892e93b70f4796ec26ace279977a82d1b2672da60287537c4ca58efc38fda486d2d82b41075181530222a89ddf1af97f3683e126f4cc35e64f8272337a2620ca265bc944e609e763aa462005f9501d1e81da57caef0f180a32b02a888aed163078906f6912ceb0033393d19d072ff080ff7be38b6eec8d4ebba1f2dcecc4eb38019a8c949c4a94a0aaab008101f9527ce317937102fa51538a970b84eb9524e51bbf544a70e9353f80e2c8699e825d794128c8daf2d6ccd2dc09acd277cabb87faaabf98500369bb3a69fd0ccee814c62707e444c60a5bf5e89824cd0095c398f5c0899f99afaa427b1af78dd5b459f56db48ec7b042dea4c841adc95d6ef3553a29a163bc1aa49b5b47728d2eac1265bf1af9b86ddd02d18c1911cdc9d08031074d2b5e5b04b5c2d9fda4192a0cbf84b886e721519e9128e3e061968320e867ddc7088ed84f81819f6ee7f51587c138f3ae18442a6cd93ecec52aa79071b71bdaddaab6f29ef1f248c2c47e56313f7fdaaa58f58a84391db26d39c4f4c3baae000db1fac7ae9b5e77399b4c2ceba0f6b73c80cff365a3bebfd7de623f9b755c4240f620d1474f863518b893b59b79a77c99476f9f301d52c5c4c8240ebf6da2af108b692b5e99b617c8347a724023bfb83936f55f71d8a38c7ea6ac0fbd509ccb25d5b0d1b3535c81378655df066c7378cc54110092a1ba5fea4373ed3585689c26070104cf2a9758195344b3d0f2f0997c56bfd7ca5a34c99f286c727183d1061bd6ecc9c25b93ce7f8a2203f9761d560bd995580f384980ba59c12310a68b44bf3ac1a193f2a4c55518637154570a26fc9e09c423680cd9981e402327a8c65b4b3b44cfc06f597fc89bd1a11a24dea4586c884c25ac274bc09ffb33d271a1469bac0ae30f4189fb840f3d934f9f1c3dc62240b954e8fb0f7d04e2e57eb3a3e7ae1fdf3ffb44a6837691d6ff891db0d8894971931dc4cdc44e57fecf07fbba181a3870ff86c77adea16b28ebaa9317276b5d5a2c05fc3c8820cceb942c017981331ac64d48369da40ee716b2314c62fb103fb08b8f8ace243741dd1300c5cd527d5fca9948de97b98e03bc73da6e69e220ad050c6c49314be80173c362b71cb79962c2d470c3c1036c3abe634e66c60139925696efb22c11ca6447f13eaed1476852b9f5b537ac4865944557f5d95b360369c7661839841b36442bac5af56ccd9dd65f4caa2c78505eba7c90c5b5438f56e984f31562408e1e19109b06e2a2634ff2d3ce3eb344926f089eeef46e7442b5e47db736f8ea93f5004b738d0f7cc00044528352cac1c7ac42a6b3a9c7155598a3c9c32484af3c6206bc7899e7649564e2265492788438ad68a6cedde2224a6499b5fa57af4b1ee85735e9a2e47b420297e62f4b7da7a852d4a8af04274d160c4628d4ecc3e575d0e04cb64d539c43a2a248590898dbdef9a249923fd5645bac040e14c39e23822833742953f2553117141bf4b3ba99f2ceb81cdb22251536db6a5e9883ed413ae3a87371eb009311e95495aa078c66a6a94244278b8ce8684c0b97467c2f2028a8fc5321543b5f9b2100af5725faf6f0137ab28389721c96f81c97d0a2105e1bdf3fd05b55321b76c80ce808e74cf77558814489e80d64a552a8021fc1e680d29eb2e4c063e19721deb3970bda2ad75e21a59f7f30e50556af1b8b3274e1ce87989fdd5a26f4aa42ce94c148299a830d8e011dc0d46f6791ca01d9d74b74f5577ed9522cd9893b612e36804392bb71726b2a0aa30175a67a041890f020e334b9e3f3649a228e3956562abcb754279e41f99ebe63b099afafdf68b1068bf6d9ee68b11108652588c68933289413779fc14718a2402f3406b9e9e19ad74de5e3b88c3b10ddf4d7fd3ad4d75a3172ca6ddd7127f4deae1c7bfc26cc738550253d2955d36e47e04f083e08311deed2a19be757a16dba255df133692785e36c9986fb6e05ebad3db33339faa0f4a0cfef83cb7ce0131c4d24e47b3c9211f78a893cba56729ff321931a3e800778101abccc39a20df52112564fc7a822affd7c8bcfab3091647253c09bcd864749efe43ed8de0fd4fad1f3d20dce27194fcb62167ee01bb1a41f7073a242d038b4d8b08ede9e62db23740961de4dc744f3b90b6b59b504fe941e8dad4affea7755efd2cad4bf259782de9b5eade624690a7ca83c1b3fce228525f5d29a830e5f1f9c9b45643569526f30954a9bda174fe66bca80bbaa9368f785765ef9f1c8777cf7b9cffcb552887fe0d17bbd8872579de2e5bc67b54c95937f7651ad18019404834bf3f5c0545dc5e6ac3fae441b9e52d2cfbaf9d21717d1f2c82c53bd174eb1f43fd4f01b3318d70d1219d16cca09e33c1299e2a8fb50c7d3cc7e3e54649949c371d1689982e2aa168779855c909ba996cee71089017a1489a1738c9c476ed47cb24e0e02eca25d3f078d6a17c025c5656974f65077cb97e162e879018f7a33985ddfa40140d91e0707ced5a8ea713a3e93f9141082d2d63a380d4544c8cd9cd0fd3c47a65cc2668612711f53af33aec699d26ecbc9d4b5e733c414753304d6c919d971b1f2074864b0da69b8e7ff96133505170e07240299ccc9608612a382c66fb5ce9b1de2cab555817a8c403d04fe1ad9e5fc8369c1a544795a2faee16d0e8fab8c2c83c73c89abfb1fdc239ada8c8fbbc6bc05080e3591ba0329d34d362c4e3ae3a6f4976fea1ad8ddb2e6d422fda49c27c26f3219c7bd9550a06b8bc330d4333cda70746772cf15d13768c39298bcce08faf01dcbec406c84199c254f49cada5e46c6db513fa0f182ee7c9f9578ca233363805bf32fb0bd1751fe1131111c0464083fcc5efa67e3c776b8cb077fb96aeb58d35c0149634c8563c181032305e0c82d7e1423edbdf67a468453960676950c9ec3dd4185ae39566445f259ea59a03eea2593f5be70df94d3e61b8030afcb96791e984bae7c7546aae865592a64e4849e7d0f3bde9f98b003c453296ec6a43c5c9059c1bd8056412eebefff0d406243363b0bf363b9790639cb3e07cdbd126078fc878e5f3ac6515583ca80378d30efb28b945fb620ac939e0fdcac213e7ec3e4d11c1241a88ad12e6a995706e6c3a1c15ba27d38611d72dfedf8457f5421fc12b39d235fde8474b4e4130ad0ad604fd97d991fdbcb1b0b8d0d99f13f6f90a12a33ac93c9c1bca6ca2dfa5469ae683d362a31411df8e7b7f850b2c03947d320b89809bce800bba2686a1eb5b702434d1d8bbd5280a9ed9637b777b6b5d479a4a0f3042a6ac6c79f1bb124fdc55c1d3b0225649e85b84ba4f206bdeb1410c8872913281c139236ca0e2cba28fb0bf0a67ecbbdec08de5c0cc967cfc160281a4c1f9c8b34795708f888ea767b26ec11fdd326db8f24ebe17374dbbb11adb931f45bd01a3de5cb1167f81aad0130a3fd56b05650bff862c17e1aadfd2402cba5ea954b926abdb011f91317ffac12126935fe7af5bde45017f0f2c85d1d570e472acaae3fb26ef919017e29efa2d52d910e37fc2ee61966f2f363c0f59afab958175d3407b38f5d6d10b40a9dff91b6728df12f5e181dd4cc22c68274291dc2f94419ef8c00d7e76a4482c495835354272aa2991ce6b21ff0129b776947f613e141f7ac2535a6885c2d54d04fa316e516855a34bc02bfb83b4ef8ef1dd6b419f080bd5cb46d72366117a915780a5f04d783d576ed1bb18891dd4b4191ddffc94ead03acb784ff838b577a51f70977aa8396eece09463064c29ce173f2ad1bdfcfd99cec349645c9fbd2f8b9ab39495e2859ca5bcea67a5849797341d72da4c7a0cc60989a77bdea5f96e7cbe784e52bdf0c030081655910b6a34df55695543eea47e30e6a32fe31f26907ab96f3f2b7273903d44c3a6235ebafbaaa55ed632c143c316bd2fb97f0540fd74e6aea66a847353bc74ed44800b2f44b3e3764d4e49a8ceef9dc36c1f4ba46281357eb94b951788fc891053bd5be2c76eb484ce3374475eaf6719ce9488f2b4749a28940547bf87b3605fdecb7205de6b3736bb7a1c6c33d6d997dcd86f0476cc9823054dd10be58835bae542bc0a0646572aef2b6ac5566903991580312aad2de32fa18bd25245bca23d6ccd5e2f67f1c4ca17b718b9a7e0a767cc1e9c24a8bb11125df5191cbe3618927f9a55333b0ea2a188d06ce8d500333ddf4cac2b0cdc15294f950ea1ffb1f7deb292dac16104a8168577355379bc11fe70a4c126b04cf0794e9cb2a323dbe53a04ef471d589f99e4de3e9de74dcae5036d8f5cd853127e42ef636389c071753b619b28fc0a4d903a5de713592594dc054c244265ed9b1a31738033f2f22ca1eee55189714f672abf47e5d5cff953f04cb659b1ca6b9b10b5d6710dd3e05b5a48d32d7db059538c6ba2d040c8e93565a2fcd1ef1f50904810c8433c134af1a2daf54210c36fe5de7aaa4409d192e3d9f1ec66b005abe599e804497bd99f2dd0360f545478660634cb688bf2d2f3f24fc3f984b6fd1c19f2ab1ba29fef88900559aac133330853848b737fa3b4dba582d000bf2f92facbd53892a08da247db1108a3cfe6d6953b2988f1b8ea894e493d10a3c2c0aed580afd119b65fd1fab684dde4ca2907948a11c3f02319e90f57b9f41900a35f1760dc15f25abb28ba7b6a7cd0920a2ec4afe9be3350aa7ecfe797d69a81598af7af6f787629bb6aab6db470d4b5f6ef66f0ebe54a28f863f5e4a5656b59bb30d7f90a372258f29885b25fd98e549d3acb184115dc34f344d0e87b4f8bcc29996049a2a593793c692ce257915c3bae981d0e88cd07975a4c7a4c7c8a235d7559a6b544682a46b21a2fbec07f7a6ba26ef0f37207e4344755d708ef6fa19a9bae916fcb982c4f631aa796addc61049c413c9f34ed208940bdd02b9cba3d75ad2b7b9236a0a71e54bf8ae70a347ab1bcf6ab7dc279f97b2f4eed3c2ac86837874684ba96afc37e85d5d8b11e807df46f909e66154d1b901316308f71d5526e90bfd0fbe1e3ec4c0c4ac94773e89f1f6b28fb75ee24c230d2029f08800a43e97e974a1fadd0b9d711771aa6f4752cc7b3e1114aab199f1da216fea65ba1b0e799db4ef54f8c797c2f52296cf5d7ac694540b2e7ae00432bfc4c5e7ac2e8dbd6382d1af4656e6d88fdf7f57e9688c0a593da6ef07d6e5de550bb962665eff7c0f9e87dab7cfaea351054c15a32f4d1a6939186838e62bca495a5745046cbe64d7c8ea72e05deb4ebba2ea74f1efc85ee35dd8f4c04447a1dcbca99b91dc9f0643eb0d87300cb1d7fa54e17a10f311f8d73afe6aa61f46faf9d69335d1b47e8bdbc64db68fb99e7bd2166b0e7e3a40375a4b4b455b6dad3871a45c412cbcfae34eb502ea831b70388b06eb37e57c99946414df8245b380242068a8c00d25c41ac16408664b1d978f0ca10b60610ab2a8caf2cd7453c9f06638201851f27ef3c57fd1dcf0f4c55f5319f37c87fc2c9ef753223221808abd9475b4223e959e4f205fc490a4c2fd0c61a5319760285788b7d13dfe506b022e17347f8657fa0dbc87ee3a2c85128c513a431e51b8634c671ad35f4b73f7e4965f88a10cee61b80d9e12dd9028656825995ec53a96dbdb95ae7c9128253eb56464b0f102fdd2eca3975c80fa677b16fa27d8e66ce3949cc894e051d665ce28adaf26ddbd8d0029b10d146796d316857da963fc9b34860a945a876c7cec0a916585f2c58ae1ca9321bf0d1a6c9064be6db8c285da65d1c9364c38bb82163d03191a20935efcaf7f6e18dcf44217f3256058e6ef64d5a752389cba64e1513e68b0ebb201b5542d387b29d70d64bcff334d48e917b9c40c3cd692001fdf373c5616ce0fde871182724ebd71d5d16c7447adedee3c1e0a2ae9c56fcd48113d0731e2f431a49e0ad8200364fa3e6b81a86374ffe27b1f19c422befb5238b279380f71f465eea968a244361386ddcd5d86d678e68df86094d4da7a4b06a25bcfcb6f1e3cae21237ad0f333052cd9de22761008fe63d9dbc27572126d9830ec851d4b763b26d5bf1caa8ae5494d66f5aab278ec44ded7f678fc0b439188b8b3dcd26f9436dbfbc815bdfbb45692cef2d1ab02825ad165bc997de70704804f43f07d53250cfbf8145af47921fddd342ab02f322edad4810bc00bf499e249d7902bce47b723362d726bf44502184c391bb4188a51cfb2526ef9538381fc1fdf8cca89d4aa728d1e2f54668c6ae54bce797cc39e31b3536a9d3dc537c2eabbd43772be812c28acbb373e3f280515e6b903db49d44cdfee93f5daf2c46e3a05c023d5c599c931ad756cb0edebd6a2367f4ddae4fae422bc04b4122c9b203ee98fb02bc2cf1ffa326537a531bc1b0b90bcd348841e858ceadde24a7c120b34e03456306e139bcd140d7a3c90bd9da313aa5519fbe025252a2ac44952ea10647d60816b49366c9166b61385c6e9df80b765a7af45dbfdb8d0acbabb846075ccd4bc2d7652527ee9ea011ca2d2e1df29b36dd9f38c084f30ebb63f8d401d1d86c50f06462104024529ad319000da0e6e23cd71bb28d48b5f9cabb675a8ff4d31aafc3b93bd8a994a873951387bddb3bdf36dcb9904e7ee08be05a155e5ef0d2bbd1092ff59a6588ba7547e566932aa2d2b4253b09a381267ed8d6f7c343a0996e416a2ddf870729ebfb04feafb922650d729e11ca5f96c0a6fc6ea3fadad7d598a1a2b4b95a6313054246706047eae0a695d7603e813fb529035ace870a7c109880246bb74cb65f7d59d08fea7a900900f92876dffa6dbbd028f28e962dbe3c3c9e71fade5c4128b0694ba145418d34f11ff21a0dfef3990fc0c67d4a481b4221978a5ba00c530b2066ca29d8f79d0aed36f292b3c78755edcb902edb7a95a1f12c6030684b4834fa6865882adf6871987addfae8b140833af0bb91aacf07b61e735b537ad7c99a480e487f935f1ea157c4a5b2cce83c48e1fd368125cf8059721098d5f67bbc53ec70f9b6b2dd388c607e806c0500cd42fc0bf3dd9687d3bc39db897b41bd1ea27fa26f4ed87e880ba5e149243d835359d8f74f11c29493e8a2b7ca2f47db2f17be440e3b03c95a9fdc158541c8e43844db264e99f600bfa31edf1ae2453b7c56bde63ec66387f78d0c6908c9766de3f6b14e570d0d87f80a2ad26d875ebfa30beb8e247c7a419b7e03044cc16a546a03ce51d2b63ad9039b0c330a98fc3d8ad18b4270130d783ddb237cd1a4d8f7535f8b2e3c218deb22644cd73f2bdd2bda1e595515ee3eba76fbc288fcf76f75f942600f21b278e042bcb459ee4638c5ab9ee83ec7d4d100d2a8e31e814d975ff64b5715082358e523fb190a40f046f0dbdb90bc4dc2f29cb19ff8aaeb8c53c397f25f5ff292be2d734e568db166063d1828b439bd49754ffee43c8fb4f65efedf0dd6e541b7285319712e3de7f73343156703801d65ed6ace1c34e2ea9f8b729161391d0381f862c1e21abb787e9ed62a26a5cde5cf75c8e52a7adef897eb4e638ffcf199e6d0635c5968ee5a5c848a361e670fc79e6742952673f546befa7db4266f74e69556725b69a7884676db9b9ef19924198044e8d4096af412dad31abdd6f524873d091b58a04a85f72066c3d79ba98508e51351ace092703c01b44af0d7fda9ff091762bd1b07e10d153abf2913abd22a1eb33f7bf8e443d9d66b6d731c1f85cd1fcf6e09aa410046fe4854283455de4d7a3ae945af7cf609312e9acea88dff0dc7539692201ca2c216941cd66c2219c94d20bcbdec05c8615eee9fa2e364d7d22f0eb64dd69849f5fba3166ff60e991609410ce26cb897e6cc32e368da65468efde3aa3e2756694d52c03dc953b5a79d38a91482036537e843d0e47a7a5481fe5f412731dccd925d179b9f0f7a36be6d6ed0ec2f645e7cbcf1e775cda8f622374fce7395057886ef30f2b72a7ca22ea317c825794b9c11f932dade7e30c51ec4d7e55a4459afdb180b1154bdf345f7c6c7d45af7b9268a0b079c641b5cc3d2cf6649158cfe52a8ef0a3aa412a959f2c9b68968fa4e9296dafb46ada8eff3b0400970e3b8fe567bcde0b6f370f53f62581b3e32bf8c7e2b9e517cebe49d19718863b5be93cff948eb51e660f2cf3d2baf66192b87e8c02dc1b99e017ec9bc12ffff8783c3d5546acd92ef08d997160e954f6579a34ef177bca5b99a973ab33ac2774017662f88c10f992e33e1043b8e84774d9f956f04d10e611de5f406f7e50d1f3ca7796f343530f672ea24d33c3b7ff80d7ac416fbec344a2d0372f860bab90c3ed730acef360db3641535a6654dc4929de2a154314a134f97380da42e2fcced2f9dc8c0efdd35e3429c45a748e81b0d417039bbca470239308a388d2c50a09a1786aa2adfa60ab9d03d0d068d65703274461c343762e77b47c589036e8e93d754fec1f9534492d441faa24d048168cf66ed7b177170fac9babb14517bf4ded95f34a97cfef2e6c74cc2abb38d7f3b90c1ee8b2836432371a4ef68c61de1ca780f82813c13ac00ce0e509097bc04b30ef53f499088557a3c4ca1506fb2c495e28418373a4145ea11ea5deef4ab6dc1f0810c40bf593a600474c72ea823e8222951c7c499f93dffbda1774fc07a13a05f58711b6d7c23dc2cd635030727726dc39e152829be12fcb8bddc20bf3deb3c788ea4c3d342df87f50cbd742017a1e202455741f1d193e12302b2bfe39b8405108eac9853aaa59aa6531ef8ead785e359de470b964bfc1b5f6c66a6f88239bd36ab2b0cd418e9e26036d37d3e1bd261d6d57e23eaf36d3643801f40ee6a5cafdf25b6c78ab5d7efb630057c335a3dd5e38ccaf491cd13939d31b6d328782c62b7cd5495b160ef96e9ec28a8f0bd38596ca47b0a02c3b1e314e3393e81c9f77abd2dfe276bba647d94bdc4e1ee9c1974ed84834e18456a53b6a903e32644714a42b2d97c2d48fa6b8ecf4d3c9e4fe54d2cf5c8a06663bedb8e9a870680e456de8a07daf1c6286c563dc67c007c17f193c9d9dcee0fb8d60289273dbd86f44f9497162b3070f4a7265de82cca61d009bc093ba3882c1df0270ede884c6191a8288cd5e8bfbf8425c81d0df7c4ecb49615b56ff9c242001b2761445b3331b9ed94dd4d51058c4f409f26d0cd7ae869906a15cd15198d77047fb9065655a94ade9c91ee81e0cdd3f33780220f822b898c5c6ebc242739526ec3aa5c0595253cae95e609766721a6575d26cdf41249b2d89354fa1c9884bda2dd5251f2ef5c9012d75e94c8e39e36a02a937b42fc2bf79f59c9421715da51a61e131a5bf1a4af73d0cc73e036da03fe3937813a1b30ecf9eb8c579a2307e2f328da1d034289fb851e29c50cdb50b5cad0a37263cd3f775faf676fae192328da4d46937572c496cdf4d341ab3261d4f8643f1cc372491e46362a29dd1778fa856e29fd6aa1f4d0f8dfe2d654fb15a0a43ab6a7f2a451c71af13f6c38eb39ec62ef072ed8bb9e63a7e74211b25b2802873ee20f53d4007a45e4701da5e57ec9a02c661bdb03c294b4e1129a07fa16f2cdc988a6e663f36e267ccb24ab2123babdc191ca9b14f9528a8e0e84461d9378fd1ccf591320ecf3a0ea2037532bd1b27822ee36fa4feca5cd66b42b3d602ef4ee55308158a18cd5895fa5e97f75cb0a24aff476c8ca6d871bf3b1dff4b0120a192638b269b879e28aac401e4c187a364a005fc9380ac55e025b0f6c95d958576e2c5bf48a4c99421a9e748eeef55ab32796d13c0e5999f7c3e1fc6dba1af0b13b79a95ffc451ec2073c293b5c37ca96118c7d856eb363b863b936b26cad456587ac69d97f21d546cc57ae8bfb4e68c1593f19f4e8481678109ebb98f4d43a366b2c26efaf6cf45f2c174e7f65722925639b82c8256aa1231cdf1e541a80e888d39f8bb31ff85591a1a3146ed68b44e8fa92144c6dd8db169aa31daaec2d8bc6c8f6a47d14978d4a37e21da186039b874b22af320bec5da45710fe1c38d0f81c36e31567e39fa6c0a9f92497751a4963d79d90961cf09a8461fe1cf8f91688faa7431f9972ef0cdc94cc3c059d4a1e9591142362d5ae6a5577f93ffcc8bbec2f587ee00fcbb48c68541e97f15ef4e9b7464091362fdd0a40fff4a80d2cb0498b630b237d9d14779f0d42e4027ca8276904bedb9aeefed023ffb5bd7ac1bee5642fb0575b35905c363d4a579e79e483ff926ef91c483fb54a0299979c30e0e2390bdc6406ce3f3ef8d6d56eb9f9eb96e9126e93fc399e28e055252f34701712055d67229b75c74ecd5ff3feba98915ee11aa722bd9173408ef6f7be22431c4d32fea6a3fa528a86838651916cc80e18c98be4aed89f47b65371ac783378291bc964d5c479268def65bd6e2b73e677b009f348ca4c04c58622851e7a9cfcbbfad69530271ec7d701d1dde119f51b8cdd6385be6bf15a5346232ae5d85984d70a307e9a61e4b6bf6f5fb684462842f9140a9a6354f25dd37fa44619419e816c708d28a60f0cb8cb699d896a9677006bf83942ecbb04a0b01690c18700b638c4e2c426977cbae8519a571e6905fc1c562361ebab09c68ea572fa797194d7ad1651ec8def1c40625d760d8dcf41c93af2402bf8acdd70ec3ae818bc205ca7ffc913f7ece9a263187fadc37a1b7b8d8725de20099771956b9708b165ece2eba66a8a7896dff9938188f2011dd564d7a5446104766ce6752f59a05f725f31f93eea2399a39af3657937b369e2e5e42b0046c68af57bf46f97d823ab37320904c28c4bbe93f12b7785c95eaeeef8504305769303f3744a4fdf6fa4d3f820087e840f72bfb5dff7f3d925041c99a15c05d39a4126a2284c8cde3b759f62996bd8d16c8916ee352e66e014faef979137ecee7b42b87e1028dd474f2a98c6955bbb6b16993613b87153e0db54a5431b36e9c129f68bde7018e1d5ad04154f6cf8e94e9acea52b733de93fdf469f90da4b5b33b3ca524c54368a535003c4f1c3116a63ecc6e93ec57c55d24220008954967a71c3788597859d40979b9eb45784f652e1129b27aaff15be8f2e1286770e746fe7ff731250962700cd75eaa831959a433cbc50be2eb79a288a63f710d29990e02aba7f951d462dc85e59af005d32b031a82502b1d68daef777cceab8df73786c8d309afe6f573129c6d0080a0ad1747bdf821771d007624d16faef9007b82aae8cff8c13d4b1e30d336cd0a062ee7db0dda2b23bd1b791d55988d2d21a60bc894d8c74f4031e18e3483f53138811c9e2a81266e763c1c1e850a48982afa09c961cbec50c994013c642916d031a65ff4822bc4fee14e8e47ebc76b445081d01d0ce8b3e5f42bb84bab63fb04e70dcf941efea55b5ec2a321efa16e20813ad497257a64ff868f1c5b1fff96c031b6904700284d27bb24fd1a200da459a79ebb3b3d87c1716117fe0dc9ed097e7feaba58640140ed273c3d646317873cebee263d243765e0382ae052012dc4d34453aa8c13ce02868d7981f24c24379db94b9cd1bfadf68357217c33e44c8b17d4a4ebc732533497ce8f8d1c1537192f0f32242a106906e7567fcd4b3934af98039b60a0114c25de97bc9bd2fae3383e1f9eb5e99640c342c96ab7f7c218611cb71e6c60dea4145689b12306900cce9ab01a66b94156cfe348220129ff8fda8a75b1a09bf7e895a04599ba85daa2e181c01bb69b662c7335ae7697b13740a3e489bc048a4f485c0c39119ba173734c0ac784424d638aec0f5d8596b96f4384b5bbc8fd4e8221c6a4fa3ecb267bb6b35c936b10d2d5df176b9865117962d90dd48787a9051c42c460ca5688ef242fe2d2576742085b295f14ff58d95d21d436463ed35e8cce124b6724f02822952bc7a5a4c7a697c35d068242389693a3a827c7a8d156751964a3a8a7a0117d89ad45f7bf1bd573588411792e4e9ec22b8c630acb516b72d489b627d449e69695ddfb31b5bc6148a4c047a6ac1744c54a84a9d4da2eba5a2152472b3418bcf25643b7fb2f72986cb4f619e972ddf1a3b9016ae073be5b9c2e941c24b26a42f97e13f482bca34775770b39062c1e74fa784df4f380a2af7a5ef3366735e9d92cc23269bcd244f9e288ae68678aeade265a9a16f03d9e6aba88bea680a5df0ac9a1ddc7a902ece35e6f44aab036c6edc80bd61392ec57e86a6d7eb5a9c4c06af284b54e4d71c1f069a25b0c68af0bed633af3b8e4f6ff91847314edd6e66e48288fa3b8f6fabbdd92aeb7fc560dbc9b57fbcb2b3bc2ba281a7ee31c3748d0d300db647b4491a1ca5aa3dd41efc9476e31c286d58f28b87860b59c3043c0103e7fe3f4e7cdf2c301474359be8429ba1ac1661fed78c4d2f5515f4e7adb8d2b07e4af538f656b66fb4a095f2e1c1f87c3ba273157dad8e6a47657f88b70e98c885329f5ce447257b9ccfabbce2131cce15f4c1d92a3bb8bc3917859b027f7313df6968d8f896f8101a7fec2d5ff0f9bf7b1f9a66ebfb4242bdb368b53c49ae7c753939f3d7bdd1cfcb735cf46dfb7e6ab8cfd9902cd0e3c691cd297e2bac01477d731cb67c1a1704914b7c50bf4a25b09807c6a211e1e85e96fdfb3bb6090557571c7e5d31da5cfd4b4445b3768612d0b54a3ced38203c81f875ebe2aeaed5c47d8f5e38f146aa581e901b585f1a3731fe40ea8de20d137c4fced153c834f77c082a4fa8e50ff20af2045186717dfe330f89181a0bfcb5cf532161e5c626d1300c33433a511eb5951b3eac48300a2c257bb1e2a42daa22df4da74b22a0740af0741ec030a9f745790a37f4c318e1cb6bc261a35b2ee95885aed5cd665020352522be39143290ce0b9c072142329d59c8502f9eedeb643d3caf76e14e9994d892056fe723293d054dc9a53c762716473968ce989738aa405e2c32392f88e7952a69b07b3aba20601dce222aed858502b4755382c7194922b4ae1b80f990b9e9b9c202c321b3400f770132da210edfe9c455c0e443f50e60302d486b95b890b15272bb3defca31fa93a80d3845aa3d243b4abfdba1a86a26db441e930ebac2ba75aa0b5ee48658c6e8056aad65796b1449ddd2c92cef4999587e37884cd177ce0ede6ebbbcd1da9afdd0a552a5d5e7144fdb4ccb765b36f5785adb3a76db9cea35ec6c8d3aeefc1c7b09d8ae9de36a8ef062cf4d852eb48f8823d9f5fb0319047dcd2e07b4a69f2221c38c4ccb5df6390f0ec0a038be5b8d60379e000113d8544020c06d65fb3bb3a89acb1298213f1e3369b4089a5cb1d1e3e8e09ed1f89a3014047dd6da199a75d7fce61d0cdf391f4cd4cff53d11c7578dce864aee44e45ffd46d75debf6e7f6c6999405d74d6cbac8e6b0e8d918f694e498d3976c01d7a1796c88c5900fb1425ab01d2d2cc550f5f3f594b7ca939d913f3f8b1f412301a3c081d136e5ad2a6fc1a55a4e52b70a6b686f63b74022d8371c1e7f278664f197a98f5b1233715c27997bfa5797c922cceff8067f990b8ded57553069884a9b176c9fcd975b1ab36d897526a97b8f1ee7be2b01264fa520342fb6ef45b88a4867ffa872ffcf675f63f8a7c5b629950cf563082c7e21472c7bcee973af9d287ed3facb311200973c0867476e5acafe650951b9b84c31fb4913f8b2567f2270be9ac99e7994979045571491756c283ecf835abfe56d64ace235980054c306206da4e73802be531787e6ebbfc47e37dde3aaf9b0a78f8b9044ee0b23c7ed93efd453dced58c500f84ad6380090f26a98f45bae2ce1a3135b7aa3df2e14adc5e1cfe91a5f3a8fce35d3ea697bedfbae150c23c139200fe8afa32173278af733173c54ba4a8a96c122423a118284452542b0be69a36d565411bda3014709d0ee204a1aa6ae1924e9b844e263900817287c215c34f078d94a3908d183b6c378a3355a739882d385ae4843c4c58361460f32e70183ec7d2109f49fc124af9af79aa05b1fbf74ca012f9f47cb18d6d5390cd4cf5f2c3f2014ec2817d07de8bcba89ad37aa2e263c18d755712082de33536b456924756941d06113bbb983a4dd8694a217eb2d07c4014f9abb56e0173baef5edce7cdfe93493f1de4d53fd394e015fe8d1cf77dbd519df7348919e10ece2ca255e93befa375a05a68e8e8a2fe060ad1b3244c45b8b9707e4de981648af08422b5227b9c12a06c7e3d46a70a978d337788c101f12ca399ac79ead6efc6e469b6a96619ae5723d1f10b21fd4ca60e9ac916350ac953527014a833a01bc10f972ff680cb71da7a13776be660779b4f1e0cf8ce71f186bd3ed44450026e8d419d5478ba5fa5b2b71fa76ed901eda9f963b2c0f07da8f23ffade8b15a548ca74d0a066db8e7c9a434740b459eb399a8b474bdd4997dc7d867a2a1c15813a394801c2a5cfe72b1589883aecc006cfe3973b8c8d3ce1869bdd8dd1220cd9ded604af72f1d41293437f50d217a7a0a0577797655d2d5a58dc30bc0e382e9c1d2eb6c16fcf8670becb0edbdcbba42d43b33f6eae5bf2a98593499f0e640c07aa1322431862f350593fc4d7012d0a4d57b9751a12efb07831218ee3a368bc9b49e3444c519d57bd5b11db7e2be006987a1c17dd1e2b083cc2b9d32e26508fda406728b8bf9ffb6f97ff3297d3de4545f10541e1fe852eac6ffaafd99e6bbd58cc4b59de4528d180d17c6cd397fd74400f8595aca05b7c7ea179975d8ac7088e4444ba79c5b39475314d49368f636341b932f3ec7922ebac825bcc9f035813a8ed84822ee9f1b51e4ff7974fe14b2bb52ccd88ff5ad135acd9f30e32f64abb6c1781938f7edbe3a0d2e525b21f0b25259f71809590d7fccf56519c697c5d97a5e6fd60c8fb5fb33ef14b84327bbc72ce539e48c567ab41c8cefa64fa920818603735d5de6985c87f4d3f6ae16156fc5095a06eab045ad8d37c3143aaaf8432211bb9a35e5b8aba4ad50df80a341b67f74b6ea2bb63ab002882252dd93af9a6e866398e66a643fdcc611825d0b25e381110cdc7432646a5d9b8a019162c213015e2a76a3108d547917895f5ccd186560ada2c676c5b1d52499e5331ecbc513311e19dde4312e389c2eb50e2b3b212ce4961e88457c91e2eb34cb7ca4651f47d3625ca824a14664207b64d81b2be0cf361ecd5e6d1f6aef3a102a1834f13811f2802f9d786b068bd411d191b386d80b891dddbb3acd132f7c5c9b963fb5f4c59422809759dbbc8c221df72ce059aa3830262daeace9bc83c49f45d49be385afe9eb1871f09e720c597e692bdba603738264638e59507835ec1b4b9321bf712f139eb49e1d171d856f1026fb66203a5b92bcf3e14644e40183ffa61071546b0f61204f2862f47cea7fa514963d76c70e969878df18c6706731017cc82dcd7bcdb9c421695db7485d014fbfde3ff11aa6f33e2c432b9594f67855f5428a12998cf9d08510bd2f681b0fdc84b9a23308aa67ebaa15e71a0ce60dea8506e9d5c5ad68c99817dce00f1819234277e280b0b4d6e43e9a536f25cef4e8237c1d5538f76fa3dff33f17f897babbbf69ae947ea2080bb7af94c319031a9f99d1ef62b88d2e8840de967034ec9440c4ea7dbeaced7ae4d5aa35eeccc4b438765a418520af75b6281538a43bbe8a5d574a0786472c3eb61d299fb98ee20ea6a4cee391bce27e6232e7c57d6c8e3ccd52cb609d9eb6304d0cc4c3d6460d1875265ebf2f1c4c9d19b138dda2dd02e68e066ce52437edf42445a252e0231285b08123c6f87f62349d5dc823d50ce4e654fcdfe6fd078543c775945a2e8d326deb73ea93b17f003e4580ac65d82ffbcead2c93ac2d05e71ad71688bc6a25ac40149e01321d9f1a7dbdfcccb243c502c166b03c7196744b98d2b7c34bf910eeed87c9fb3fdd3848fb4274f0e8f6b78bc3590daecbec7090dc67dd7807eb8dc589f41fd9a9925e29c88031d7e2eb4ac5f491eda90a9cb6e8b4b22a0b8a9dded505e78a8a069cb0bb3d3708b508463f19fe46495318cb2dde3b0494fb410cc6f486f93e5a8ae24f9d982cc96a42b431f2228c713ebc39c459f6d8aace890d3bfb37039344e71b5b9a8eb452863127ba17f82c92e65b310edb86103dc1fa7f3bcfc7f1cff0300b57b9d45d48583fda7be65f99d642a19b20b76e85a822f4386d6c4bb10d588c6cc3e694f6ed28ac899314ce439ed8dbb387b056a4d7832ea07aa409b257848cb172afec3a69c54dd15808d05741d91f51f46a26b1e54ba4278352a71637d95083647b3619780b3e88f704f08e1665f4e2525652e23e6777f615383a248ec90b123e8bf1fa2070002e8beb402ba455a04893a7835be04695b6cdb89b725d3bf995bda8ad2e43db6ca6b627b89fa5e73a309907c52e449877e3b578b811ea01d6721029e96e9f07413c0f1210a24efe18539732dad666cc1b6a8bf8cae241c77b0c3dce803feb1995217b131d4d9cd8aab77d21970dd71be827199fe1a435ac1f033f0ddbb19bbb6a1df7888991525086f06cf5e093348cd868e0404a430485a8bfd1a4a44561556a3c6687ab52933ac72ddfcc862604dd561f955ff877cad53383462e66fd605934a45f65210803c56309453cfbeefff5f0e8e6438fb0d7838461fc351eeb67cce557cf087b4837aba45ec9085c24b560530dde2566b23b40d80c24b8f9515a6e7a464ef8bad90e602494eef8ea89313471d475ce25c54e8d85284d05a727247f0bfdf51337582c6a4a5de61dedef665472e113ad8e4f6d366ebcde61a6fc1b9c28378ee21d0b51e0ce39b2959dafeacdb9a24242978182005e143af617febc2617f27783df4d4a02fa1b2f7189a08599e99a3f6d9cf004c409a43f32b79585a6c3dc7bbf273b8fb537df5894f80c27096da2943c7a7cf091f484aee3cca4d971c8f6fc86997ced9843e521405c0093ab9d2dadc467c3a4cfcbcf15ade1a88d7aed8d082f5e9413dcd3afe9b85af0ee7fc881ff2ece6a1bdd8acfce5a2d6ae864d7b90c002135769fd67c8dad7d181b824b629400cf9ac6adc3eeccbc56c2db812e8cd3887ffecbbaf19c72768d14a24f7be99165c3e8024183e8646c775b2daa2f9cb807577d88d3c28d4dede1c42ce197cdee3088754f13fba4e65cb2777b06e675cb550347c4bca24140cd9172376bbe282dba6b4a2afb0ba8858604fec49e01159b799524ba416119625d9417f2047506a5459895fa22b6d0752fdb0d407acf11cbdd1245815f7fd6c4eab9c2034e6bac7f7d3452e8adf3fbaabebca0e909d923ba26cc8024634747ff65ecb51678280915286665155b4de3206ae4a2afd7862dafe2d3ac568b752bf3a65933b35a935be78234c020d40f0ade077c04369859375ab859d0eb688648867c8a1a82c8b8a831eaa009d3f4e881829c5575157a86e41de405299ee3d07eb5d2ff11f6c9cace3a32e2e3ade98fd58318de519fe63e8740faf61f412cbf612ccdef545bdd9f7dd92c4e04804dc6fc1281098c71567286e998557c8ca3a2e68045bc9329b54f3d8f532c35915e36506cc5273ee926fb2a358bdcbf9f56e7543af640dc5da60f715e1be7075894f47a0630bdd19d382e26def9579a708c6e9db0e8eac584d609b2609f2ba4a2ace43fa833cb4ad3f6d1b76391e457b73b48eebc253efeea9a7dab788add4a9c3a38041635c855719d3ae379949a4bcdcc399a1864985fc2322ca8d7a8a4c38aa7f1adbf91008335cacf1dc4d78766e6adf06c4f4a43dff468e0e0c51cca46cc0405b99498584e6701227b6118c019d5bf2a56b426c8faf2ae3d4131103bfb39b1036c19c6eb21f807bfb520b8be6299b2cf811bd91415aa919dac49f69e36a15641ba16bb6bec603221881f1c8359371f450946a4dc81db3b42c13bbb2fa03166d1bb2ed04fb2ac5fb764ca1c1af813254c605b55c013c36d6503dab10cec39837fc7169575195ffc1e9c730e60d6c394d15e46966c1660897796361bcf795ee8e9c540800498152db7985272985e6753508c51afb630c69284567451b8e408f2e998f65b17a135bb2c0058e1eae2a0cb84488c2611fdb63cb397a5e4810db81e67c10e3b3f5308bc135bf960a91ace1f075359060cbf01f8553c1701c20438586e97f9bb642179810e8ddaa96180c7f11a5dacf0ce8e5f8d74f25a67448d05545b6c7e4dd7d90da92a465c51ab917e9a694e0ab9b2648409fe000aa9d0edc5946a7223b3a7063756d2c80e77be20be0a82c5d3ba620253cb2c15f13be5aba04744b24e53c20ba19fd2bfc29aef64c3532b7c84f9619c51d2d276a240b129efced053af79be473e7d40a806da197f4c9dccd448110158ca275c461ca524d06cc626f8900aabd6d7281dfaabee6762f0a47146f1103df9833e3a29b2201d2ba776b36798fc52ef4219391c381ea5c9c71daa3ed114fba7709e2cff94d4686c83cb8bff2a0e5bcbc2563177cda43e08ed924873e7bd3f56e12e499616ca2b77ba281023137a2ef398b288fcbecb3375f916abca6dcf2b97c14ec64a5a4f6f0b0a5f07976f2695b26577aa3f0610badaa3ee6d304b295eb6628e0f02b84c12f2dd491249178b6373bee26e8364d4bdd99f09ae22722e16993d0ea0fa7f53a9d285a84feb3a654ebd03eb0ff53d648f88b3dbd85ff17b300f65fdb4709bab13085642baeffa392eeb22dfa8ec2f993edb66361a1038ead8aca2d55602da9dbb9d934a3a561a05c32d643ff61054be00cb81d6f7a5740d45047240bd44ae1942962cab512dfc264785a4ac1efbbd089bf90519aead23d438c905eceff0e8a6322dab9c751e9c38c2681f5917bf5dceb4408dfebe7f3d94660aa4c9eb208e263e6ed77951dfc1a1a68121b15ebefad9e97d6f94eaaab457f996c45b99273161a8d7b4d6c2d284d01df0a0bb3a4b5ca318772dd299888a53f4a2814f574b4d3d1ac495ab2e7b6c529716b250a8ffe376f50e938591ab955c0244d4f9a6427849b6d427e8b1413c5f9ee9ee89ee9a8ed2d83a7b5e466c77995ba705b0b0cb630eb248e447739e83e93b16f20459b3118439f9ad156a9c43f298f36438996a99ba732297f6d416e93b852391478f7b48e23d2ac52a08bef3523fd6d5a77af0cbd057eafe9bf536b50a0cd2495357225764a3c7da2b6e96cdd4ad785a71f3196690088c307321914b4efacc2d8fd14e2f057591b64d9d3418a44248e82a730d437f8cf3e0c8d8034d8d95f56996578e6e6129e9bd62873bcbb210f11acf8d6b2d9938a542c08e78ae6caddf228af185f5b8d52bdccf8beb4bcab16d32efbc9648d9588da30a7f6c30e50080b8a490479c90a96c94168dd15762f1d3881c11d16f31a02718ba8e812a976c61723eaf59aaa5b192b09e42436c43d25e4312a1adfc008fe274f53ba05427c7b1551001cdb691f31a87b459dcbf7ceba25bed8371663c99ca01f8a9a8126845745f8f822ddc5bcecd0c30c4f1dbe26db2b1f7465c59928b75e6bd059329868aa1bef0905a8fbdaf2ddb1997c9837ccf6b3764bceafbe5d9beeea3fcb921215bd6b2d56e0a0ba809364c046684b3c7e1f40ef213f3d4275bb9d19006140ae32c0e1a2e98e8402418754e11fecedefa86f6eb688497be346417b207ed27a33b6939bcb39880582207bd8f53a99e254588a5a8972af05d7545fd1db6ed7dda73411d0d6aa47899e1142702aa21b970d4935c680891410ba833b30d96f9e9bcc7816aae786648064b6a8543bda323213eda9d67d1c7186c13bbdcd2afe0d834633aacb5afbbaec9a32d42f1aae3d61bafa41d618f7ad92fca422fcb80d906faaaec7f04afdcbb869b78a3f611cf745e48b57fbfce80113e59ec4529eb1f7ea1db09fc68c48895cfc472227072784c72a73ec9a0bbdf50c5b1a18ce62e11b3a1da8e0cd00d591716cdf7f97fe0543354c88b626e341e1343cc072c50e22da5b0417471504d1e0950271e445a99b9bcf4c2db272f2f8f2c934e25737cc32dc3debb6d1770c2259cc1ddac857d67e9a5ae6e2eb5e2cb9ac996d5e51514ba982ef76925f9e2baa8db9e2e718a542c1b015710a5ace444292639965d5bc26ba24bf6b9721d8e7058fb39da8f8f3ffd8d99927ee60f5b286e46259fea4015b62ab0ea678c2514852e0d305983246a8f232c53c38ff2913d8fad01796bd6f38414423e14751f3d3253ede49d509cc9ba0d3d38b689e4a38c678eba927aac89ad2cb7f397ff92eb781c09fe8f41f37fafe089a0a7e2d85e1e4bf25bdf2dd60865d80a59ed2321ccffd0b3738390044208bcb949610ceb2863550651cebdd536414c76085582213d4e23ecf51b8c1ea8b01f709c3b0792dc42b0b07388616954e8fcbd739a640cb5634d1a9717294a09cbaba8a2dcd17b6003dcf29a1f2f1644e0eb64e00bcaf2d6fd2d181d44021450a21c274969576108b8f33dae1e094cab4f6510b1b0ab8e79c723dbf75249cf5a56423aac377b10c5aa1dc217b6321ce2ff1bf9d3c15e1158eaaed850dac1b7516839320bee5c8b66dfd5514c763a739fbb38f8236bbaac5462d48e71ea194ad8b1d05e1460f75c3673599c4a429579b0016a0e0f69d82022e11308bc1ccaba942197ddce6f6fac0e23e530209c027cbcf802729e8e167c515f82037834779bd73b0cb470b4dc0443f30847eacdc0593a169358333f457b3c0145e6964c832732ab7d29e9b6fdb950c0f4ec8615d4266e27bbbc3136d38b67fdfb68b4f376134ee3d157359115ab73e9c922575c54a5506b8514a00bf909ced5a84e0defe79d73f39b521af7ff8e136bde526655945d594793675bcba37502e9cbf3384541326c6f9e47a28cc37dc454ba078cafc84857dddf37ccce937570d2ead9be6a9e14fccf33e98bf0abf920fab9306b203c1e19b1842f52fc2014b3f0e8d28c6b879df120b3cb1869e26bfda034c47fda88abfc2714cebade4758fbe38d7a3584837602f124b1fff35df68babebb044e535a490b52277b9fa5fafe9f43edb88181a237fe4ad080dcb0f54a281e6328ba2b80dc3f4467c4b818a1f06c64a3f20368f8be3613a127af05f032c4789421a63241b06c8f0bd69b176b2528f7f01f5aa7f50674fe202f4541bcc29dbee8ad6d5956e5c64e63e1e29211a76f454903af91b425615bab60402c1ef818ceda920cb80ee4c73a6f4d9e8884e832ed7715563b446861c3623e09faf765f16fc9c68d6c68340c787e3746786e8c30b738f4ffb7dd680269b3d06d8676dc3dbb5fb5f6c08a0756453a4979d4c27e015d398e6d7693f6603d88d96d61fce6c14f97a10705f654c6d1b29069c1d35ea44fc20dacbd1efa2b47f9ed7a15594b84c67edb810d515bf143ad27cd8ba11e878c91e8e7fb3c326a6df2659760396f2c66a3e73e03737a0c8792fbd052e6c2c25d9c620bff3b0af6273b77a3ff8cd45c065415bdca4de90dab52ad98ece449a9b4b112bd4fea1afa2954f79d45c58a131602f1100fdc4cf2d2ca3939d744deebb1eebcdcece03471cde5ee0d10c0b1d5db48598bbafdad2771f403bfbfb63705ee88408219967b0cb560986902300e66119bc1898a8203d9e3cb77ab0f68b44ed710ab2f6b746407fcc198f0f3245da121aa9c363a0cc818a7b8cf87acde157e75770e65f92268db5ea32e1ed5a2d16bd2070f7a2469a4bdb7dc8f6e61e3245aa3cc1d90a5108b23b152071efeee1e7cdda636a6f5be41fcaa9c62dcc03dbae409ad3ee132f0a2a863db527faf87c43faac95a6afbc7167550e77eeef50d004ef15b1d50539da50470e00a3b4b0aef7054d4a7673389c4adabb1e181a0cbd3038d4f50b7eaa662ce16728b57ffa4aecd49a82af25cbac2e820390e76824f0216d5eba55b3e7ace9dd737be3addf53a053f35244a4ae3e610a8f8d4a6fe2d20ca82fee985fd5fa755d1f2cdb00f91f6c0e7d53b8dbcfcd6170c56bcd7bb8e7969a1341f5fe5f7ca5ed2eb78102fa80c5df9bdaab0b8d7dbe73d34176fcc0df880f1e261010b5e8af22e28da287a032675ee94adfe772b3e0750329466a79e9b86582f5f76f6dc52c6d488b275aed80fb594206292f62dee06d4f1fbebfb25e3afa0494bc409b0a172606ac277a461f07a9e828dfdd896f6cdf43ce65fb39da9c01b2e92767a8d089e417e2e699eea101c57f964bb4e2b9c5cb1e3b540668daa91798e38aa72bb89798d6c6320a30dfbcb4c1975c493f3beff9a99c52d10fce2a2e3b5b1c32687bbeb5519a13acd08d758b2c9fb06f0bd88772f806d77cfc3e539c229f49f0fe734db68e0237e8dec4bcb98adcd208daaaa6a004b4b7fdbdbabc12dc1eda6c12f43fee373970b5b93ef7fe3af1c7910c49fec8b32f37b8b8fa866be213c182a1b0f4d5aa2dcdb3735625111ff47f240ab31363f0900245eb739b285410792cb17da0e8f4b71f470ed10fa26741a25e1086328c1d82e5a79fa43b9356ee6c9b25c6824a47e1c7f30b63a9d3af001851382d91d9887e96a211cb6b18760d1f30fa05637a0495d47bf6479ea45bc5bcc4255858af7fbf7ba8d719a2b906a4e546938e449b1095e383cbcac5623624a0a5af18f9a44dab1e9b366ced488bbfa9dca236dc3e0a83e09142323684943f0e54144a696c9a3af6ee89c818b1be1a80af98df78a6aeb36226791762c1c9143654658a961b3edc2e201902a2f8e32f8085da1153b5ed9e498ffc6c63f2f8ca9c77fd7f68a9fcbff135fb74d94e3b6a2a1a62510b826025e446c0915fcb9361c843432be069d4f1165f4d1a1f12e317802fcb4943b6ac2e91bf8dab2546325a9d388d78d16fa39eaa0afda7528c52dbf0aef11e619daf6441e89a32eb786a23f3602793c2cc2a6049bf7338f05b39ecd9c26f1377a76eff727fab4ed32d22b26c0053d9fb8fdbefc3a3b6ca31e14f20ef5be4a2936286063bf74cf2f0ee2d7ab56f9af6ea5aeedad9da4dc9f3653edc7cbf6f453b7bb61653ecf975b8790cfd3adeb70176c00ee57dfa58c349d4516798417d04dbb8475bf0b1b0c0bb52a43e082a12044d833d18b7d885c41e196076dac6d2adf022871e5a65cae910ccf0f7d23efa0e81d4dcdccd24e85bb021f8e106e67fc99fde122d0a06b406107135a60c04e71af55da36466bbbef84d074f878776ec6b3a3231b5eb4f4c319d70f0cf6847995ba9deea0df43b9bdeb3317fc0f302d64695e68405ecee9efb87c3e1747669de63044c31abcbaff97bc9b1e1a31a95f35ded82af02f95c51235f5e032aeba85f3ef40baf581fa1dcd8e77be7e047dd6bc87940170bc02d2f58ce5b6ecfee675a439121215f93d448479c954beedbf4f42e08d7a73d32caa32f9eb842a77c7e1de33e36836b5a77f133bf0697d77b07367a7b56dc620eb517fdee757bd6bae740d82fe0bc97dd42a25e00e919aa444d3cd7b02fff7f19857e30bbc950f446e64362716cbaa61e63cb9d2ebe7bb636b29cc44411bc514a0a79923abaa53f3a89581a7d2fd78f88bc986c788fa0e03466283de4f02909919b83bfec35be23a46fcb73fe4d37eddaaaa7772777f3a5a1f0134a98e070388a508d43d42ae1040556b16509710bd7af49dcf67da0fff5f8dbb7bf8077e7e89f8d828a1d15e6c2334767d14e42234cde21f942e800e7b16ac910a02243eec4c99f386af0f6d794c911cf132a1302a2a4a854d663422e2add1081d9a3a61b8d9f78dd1c987cf731c70102e8c38928e0c2fde21662c40dedca81f07bdbe4040f76f35e9141ec2ad65fc87636ad322e6d30028da330baba9e25a76865d2428d1232af5fcc223f2278307ef723f7371c7f126b195286c76907c13f8800d7af9250a2c38b4ab035876915de65f3ea97701dc05b8ef166fd040ebb3bc841c621cd14c28d4d092300206177eb0de17d0b04f13d2da51b09404f3563c0e7d9d25f2201a2eb30e9db2c92864aeb7117c415a62d81b73545ef1582e755bc81aca2936b0128f802206e229acb9e27a8a8a3219466768e9a4e9ea75a6502f449cab08a2e17e3ebc9369ac82c6f9b8d903e07bd7aedbb41fb337f4b56d89ed03b96d1d554702ac0480cc0655773e1f6ba1ec6fb040f1381e1d229f48074c8f462639cb2c59189c5aa2d65e76f56e56d1e44b37d8e7217096a3688a9020df0aaad0284c4e9e9db7e37f25f6aea9ccd11294ffb4610e5fc7cc4824a2569714e8dd6ea1c7fcf5f254330c35b5794243e7ef9706cfcff77323a7074333a88a5b0abc871231b2116d81a91de5636438ed8c31a2bc513dc74472899a1ddd5c439ed82b32538331bbd785ab5c3cc0f3e2a4477608b323f9e5c4c8bda5b48e3a3a8d72b2192efe9dafcda1e8fd62c37efbb263228dc3627e863bd1c5dea6a624d06a7df570884a3be52473ff33d346df5e6c2b7c9989942cbf3425aff4f37b96a87ae5ff1617839b8a4358e504a3ea1a8953b9be666194840353794a93262a8fadfe9b75c36330bd685a64c94ae1322b158dee15ba77b08abbfd19c74a55388b1f487bed19158d83900e63852f804f915858716f558f709630693124abf808a76b81fdf9b56e614e548220edd86aa93733d59fd488a2932d002faf81109b303f282b5f5ca295024b0559e027dda55241de169f9b5942dfa8d00b1da5a1892f983a4d9b60b9cc324e1044d71ea1e067ca6d4d434bb6d7a9bd36ef91224fd1d75cb818c4808e4a16d763b23318cef02fea0e17a56127931910cd717b402dbc0dfbb4e03045890c3c649364b23458ab35dd565a11d9ef37b551bb7efbb1943af617583e53c931d2b1be37e5b1ecce1ea9b0a1214a8f22c9c2f125b57c0a55fe0d15f9ab575294286473bfba315e531e5a20a32fc11bd6736c78736f3b45718674e63056fe59cb73495319f03e33bd85458817f98ac36091af7d4c35448c356e557cab37b416971ae9c0973246826fe18d18cb74c9213f26d14ad21a360239b00fb00448c9476696b9384f68f33187daf05a29fb87d169c2a11f957047c5eeb7df6d6c39a8a7713c96f188279a685437cb43f6a0908b6a8be8fe41876fd0ad4cead7569ca68acdd6acfee9d78a72226cb83d6ca0809f8d3d7ee9d50481d21df15273340b33f1cafa1779ad95826202be6e6295eea06f4a9b90d56cc876c9e028fa50523f6a9fed427f1fb4eccc39af0dbfc8c3075f324d4a1312fec9b71d62449f01a485d1fd54139b7e8b9e5b4568f966d0265d4a218a76ef590d26c1012785beb1929093a4c87b0b486cc8f523ebf8c5fdaa6230be844f8049d420c449618c95552a0698383039a3564384360188221f012651764a0e2d4cf3214efb612a171893cd855fdf0ed9d02f88a96f212d637ff8291c46952e4df6acba1d271d11fa8377c2cc616bbc65e13c1945efcf525e330244f789dc74be08abe61a119a1857d8cc486e1bde573505f5aa1213e338be8eb351e15257e67dedb0c8a8abb03e0e8454934e408dc8f0a9bc6d5ef746b2b434b4f10df14861414311e644aa8da350b3776d7c08620924fc4ea305e6edb0d2404271f1a0d2df7d37e4255d103ce232086dd32533fdf98b289cf664701ec9fb89da4a53ab7d0778e3053db52151e35543d477f8064eb523b338f049fb2879caea6ffd937dd4744909b47f110835c939fc6cc22b8d496564a8d2bece3c53729c10e32be7ed22f4ef4fb6d751de7bf17ac1e3dc9804c0295c1e7be989d0b78fe1694aa79c718d64f152de1dcdb5e53b486eaa3a9dede5fc9f3772bc0634c6d407a290021387a7d3b974877f1242c9d6180cfc4e996c1efdaac980fda6f14828782610005224ce57b8914ae767e297d527ec8c90bffb7b3fa6e0c2eae0b56424c97d6dfab2480874ecc7f446322afe1a0303256fff9000a255e3bbcd94e0fe3b3ee1f45eb214218eb6f99467a16b73cf30f478f8698553bf47d7e4ee9f28ae6c10f970635cb811334ea1ffd9b929db782d5dfd88d6dcb4e2635d6ff07190467a8254bd183feaab208511cc1535fe82bd465635c7f9a340564e129df7c853fb68bfe5186ab4fdecda46e4cbf170e0fdbe6eb9b0c1fb326bf96216758b47a410f401c942a51e41d5925de6558778394d722594bf5a9e95a25ef0770faca2e7eca49d32746173e65b22fb6b42c85d5f26ae9603c6de363a36c89570739d883c0300593085957a965bf40d6996af35b3c6ca163e3f6898d0796bd2e637cca5c1cdc6c240de5d89a7391fca8f94486544df525b896ed310b9074ce33d96596f3a07842d33e98aade411605acb12bf7edfc48e698f4e012b173f79590d7ac46e6f1675da8de697c9102688721fe3a5e69265b840212d82a6809ed46af0244240d64407fc03f6f410757ed74f868bfae7e18083eb13e86579a97a70fde17dd37942762e66568baa830fdc7700f9d1519b35f5a6f7a3f134e9fa5bb8c02e8f7ed3242f52b7ed56fe57577de380c02e9e92a7d19f6ba9bccac9010bb7d07f131ddb66c9268cb7e9271681a492a93dccdf1206846b887543497e0a09f751b7ec7d16be972aa86fcd7c7cdcd0b344adacc2009437f9ac5ece4c01067ab7433e48bee5fe24a716a0a4bc8a07835298a395291f14499fc89707994fe61b382684baa3de2932c35bc60072ed4063033a61e960177867b4382aa91a650e011f300c122a80a6e6a38ace227f252c033383c877aa5f1309effa6ab7aaaff4ce7bd0390bf002baf3c8e6b0e05f297c129f9a9e8dc7f7c38c5a62d3efe203fa15df810bdfaf7d66390f55966b4ec4506e764386e8cf81a43bcbab925f34017e4aba41b9794ddecd59143766859543ac36b1b740e331bd918832c2a181fa682e125555b24d185833d39d95a10a4b5d9822e1c6c2bc11e08b784ea8ce355dab07feccb630878e198b015e1a1b96c33653cd4cd86d46d82f198d86c06b39898c75656a4c1c8fa8423d9e693a31390ac6cf19a25587be2f9bfc2efafa5984d702338db5578c921e4e714bfe42936168abaf95d984cd313da1a609377876e917946604ccccad7ae08f0decf9183f994068560da64f2c14f9c04aabd888dce4c1015e0ef065a8bcb12f8e85ec9d77e090b9f88808ffbf6b888a9c4dbb2ee5ba07d9ffb56ac3da7641aaba6ec2b44a699d7a7adb7624dffddf1a8877a4f3b75c8f76025fc6b0145e6a0a437d647dfddf4454e15914ed7ff5692d71eb6eb46a50a67942f36e18d0c68713e0887c7ebe952685cf5d7452b165186b9dfe257b74f02cc9d4b97129be020d57a20c5c183597fbfdcb10272f5bec6527f51ea8b6e84e1d21465c3f2aef390fc01913e06c6d1b3aa136d6ce2e12407ef528cbf6f2e43a35ff405607cf590e1ce4a15debff2aa296d04bf85824017daac5fc1652013f4772123e2c1a85fe5d4249c495606d3aef9b86d6034127f91f0280e4e6b977e4f6b527d34dc4c959eca0156512540904d0005778d8a62b756b64d7db986dd47704a2c3204689a11a549b90475c3492537c837f8505c65596636ab020a360ede15e12680d91dbb053ede29aa5a59462b13799e33230e978be2be8dbea5129b54b1f23f56ccd961a9ef19b83ad722d2ad7b6300d1bc770d51b59758ea7865733ea4e038cf90e6128d7b4e43edb5bdd245e7f94a1852d092f0c32c81f605f56caf73e26d6a6ef2b77888083095e9c2d5a5404dccc1d8fa775b2748487e9202d5446eea487157c1e12a6646504d99b71e638ee57250c7550d0a2bf29c6d4e11ff4aa5f85e7b803df594fe2f9e71b6bb7e05978a1b45d048a26ed2ffd41ecc0f9f628ea9ded7ec451f15e0c436aed2c17256660b1681bc20e7a430cdebd9f2d467aa473f7dc20411f2464ecbdddb3b41fc74ea8ac5592e748af3da8cdeb04b38773b255db7a4d0acf32fd343468c29e9792aaf5752119ecfb3efed7a062a086ff67e6bb1271a8ee103ea03ffee96fafd0f33b953708e21e333baaddc2ddcf49f6d3a87eb8afb3ebde33f67e8822a533012c3a82c2578b9258b0c71929cd7d39626dd199382f09e71605d13999e8987f42301a2edd3d4710d3a8676f2c9719c8e6913e7a4a9dc5424f46b5000b29d90e9519d04acc55477631fbbaaae1f9938d7304b883ca58c3a30a2613b5e9c529011f58b5693428e27a96dd110bb65f795f8e11b4aeabc232db036e65b76b7d8169ea4ae4055b3948aebc114b0dcf67c34427e3f8647a966f5517ea9145172bfac72812e27f3531d17d21fd7355596430ac962ea36adf0446541a489b3f84ba5d3c2fc9487af69a762b2ddfe099fde39f04aa48aee3380a8d2128b2d4e759bc940fbd42d10a824c6c17bdc00517e0f6e5fbfcb09b1012770310ffab2bebfe80865712506fdadbdce66d78decef6a06a2d28e6a3a0b9352a1a27eb858be6f1437409a2adeb454af5979a7230ef0af84ad92082c367ad33cf710fed941748929365d9c1147f3bc005bf5af8814f6140a23e60a92dea425add38d3dc8bb743afb595a75273ae5fb914cf128976c56733f84bfaee5103db1e09716989216a616de68f85f67c569c31a79f5b2fb3158ae8b2a1ec687fecbab50e0bc0bf77da8cbb8c1a294b25f8c2733b3bdadf65c0e671f24bf595df98833be3347cd3a7ca6bc844075f7186b202b97508191b331ccc106b1ead7fec86e5a77bfe9ae4bded7f87dfa937ce099d2ee3d8a72ed848e7e903b519e9e94d8a549b0edb1c7aaa0577d2366a7d779e88a1b39c2ab94fa8d793cc2792a927a5411378c6d4c48d9ea233b8b5ba00c70779aaabd599a7f59e87622cea710da0688d0473af73985472fc69fc8350754807dbdc684845c8ed7752668e0bb2fc5b48e0cf393448855c1da690093a4eecb10c89c69db71981489c0b3a338b71c8c1742be95097ba850b8b1e6cc50447b025d0df5b07c4c239c3f5a61dd9240ea4a9bab3d093cb0b014546db7eb31f12996730ede2c6c58c867b8661546ec618f8bfd631ae3fcb98d3ac3c52d00c0086cac26b9e75e26bf532af4bdd8f0f73fe431045ae1409863770c9e2dca0feeb7d7c3edfc4223e63f11daffbbf99e9fdacd20b5070738e212da3016085956d3da85237b8c01e2e2a8f7c5ece576f43d1c3005f114fa5096f85c3d99becebec52ddab77e738ff9437997051470b6f3dc8d7be5dce80a53909551ac283f4b073b94bcfb2c41e734991e2058ce36338892500422571acb63eada23178baaebd0cf5768e62f4728006a1f6cb897d5ba5500290637b6e369d0ee6c4f19957ea4fc8ad759b8ed7cd86755c3e58816893597532c9efe774bec81f20ff26278b435550592fd5060f68edeca67b800b5f7f9c450f7949e0d08c1bf3c9a90781f3aeeabe4c8aa99d20598b63786ef3bd7574e4e51cd3c4624152aee32d0c129b129c6f700a3d2226e8aec98cc9837266d91896e30084026e2ce98d7cdc44e503b2b245a7211eec9bbed26fba258ffcdf7d3a4254700fa4d7e48cadc7efd86d87049af1d14a66035931ec808f56011a8b350ae2c9bc53367fd4066d682df1afe46328720c6ec8be6267563a0ebc283384fd7df99f50bb25667ac9a0b602c688e0ec0926e75636452a4edfad932d49657c0308f5da11b365254e8e111be7489e1e4bcd5103ec7be30b74ef1ce1fe31f7f2dd555b51e1e22610de4b571b4d2911dc267595307c05e1c2a177fe5c1bc84a0cb5f5a95b3465671730bc077420152e393a0aec371de044e0e47917acab8e253a4b342df24cf309c904de56ced48e4684420cc2eb553d1469dd9d2af584a35fd87ecb8ce81f3ae86a30adf020c150d36925e8dda73d5d583bc8fbacc2eb2ddcac11371b823d7b1a9c959e11540b95b918db7358f90b6a7887164d99e92d9c80821a249ead5d41d39ec5c011709139f91516a4b68cba6ed5912ec85bbde249ddaa73bd32703e09ce3c46c6d0b246f75bd3a9d070447cfd9a6533acaafe946e1ff644f9db6ba38308c89bfa9302a36bbcc99e26c9b46e68c1e5467f2f182d7940de18f9905a8158e1dee2cf6e2f80012dea282dd74727da709f4c4b011cb92821f08f87527bbe75c57a5adc11955788d46f5e09e7062d9d9eb50f3ba47a3cce2c2c5156a9d3631e4bb2d01ddba1a27cfc0c858aea6b191e07106065d3777d997cc2e4c8391e973d8147c13df5f1cea526b4f33b93bf88894083a8d237dcdcdd1683a9a7118c9c58d5b828573393badc2536bf93bba65956dae316835600505a9063d8a3145610f1080fa4ff1cbcddc87332f3fb0a186015c8978b32987a19bf8fc6a3b6c27d094c6e9966d50fbd2886fa4aac330860bbc1d8800c5ca35878d966e5902711d5b631179b4578fce8b87401d442a18ba452bdc5f70679ea8bbae1c489d72701a44267474e7e9cac70b07a5b024764d3b314b57e912989c37e3f41a739dab0e65a0ca997d981202fa3d50ba72e0f2e181056d8f5fc9b76bf8ba2091c42f2fcfe299fcd91f2f4aba7d426c3fc1ef6cc62220cb56c0594516c73340b4d87606f886daa3eec9dbfee6210cf744bcb780baef5fe795cd3a4d8e698429775602d6b499330799c59cf115d6bec755e1622ece6c260e1f161c4219cb4062b853770b9a6f07e581bfec8b86c3cc7c3f442623e74e4a4fbbffb71c0853e871218271aad89f8a46b6f91ba75f2617a195f12599269d5473bbf703608bfed5ce60a3a4cd2945029f0999b7d0bf7dc71e6dd6998ff26e980f444aac2a0f0dacbca0a54a690720d779ce4130829016fa070affcf8783987cbe64ee99da384a1c791df193ee315a498639992bec600caa5f5c16f504abff6e1bbf22e38f79e7793a7bc58ebc0b16bed97bc144dd3aaf7e919cb5fd893165b37b3f0e320a977601600214c4af7f6b010f5914fdfee1e86250602d0d1a958e83ee4f7660b0debbd420cd1f950444536e24109385ece4182524155c82ad13c54ff1a69e2648880a77e1c354369ecfd57599cdbf8f5de983bbb6a3ad3ecac3c8b5a894e5adc6e3757588d1e3b52e552dc90535226e34cfd8ba6edc9127a9351091d6deb6fc65d7fbc65d9813222d0d216f576f626c07b7ab3c7774ebd05c7841dc5a7821443cdb381b1c83697b47a1133a4f1a27a8cbde2885576e9e365a71e8122dbdb9706665a751be3e47a29d6befd265b16c4f0eea31de37d0462ff7ff257578d8b27502107c6cb58b1d43fe00710ce74b38926a5289816f89f4d0f349360efcab9211cd0421bfa6294718a9956f1d0c48ddf5a6e58d144283e3a6b33e3eefbc0b030a999f5cc305b7b1769180e80a0a2f8a00c701448d6ada2e54ea573291276781ddfc98a697aaa151c145b9e11b54fae3d7c58632247d1a8f36eafefea753b737ca3d140aeb512adb4131c2e2fa928be948d98f4048f6be57bf0cc284cac09abde2643640472454ec06b6b4f8b3f472ec00d0eca0ad4106a8848562fc9f9ed125991fa89dc644dbf0a43e55ef654a5027f5057fddec7381790d01aba7445bb5709086fd56fe85d6f911d90d75f0aad8286e505113d11c07add61cf4f125aaea21e4131d3117f357f02bf629a5989a4b9c8e0ee60a8b0886bf49bb1f65bb252f317464f63ed782d09fe2603a44920c1d16f9c99c548ae8ca30fc558eb78d91fe4e4b3609cb3016c62bcd8949f8beeac7dc1c3b29ba8d8ff7425c0c1d7b49286961fc38c069fc2d061dfad3644de9c8c06f440d085a829b0a538d0e6dd9b44c9abdb6f64136dc8eb58de4eab92e5c00af8da047a09fd79c851e9cdcaed7aaca794d08a65d3e9acaf65871b56caf02bcdb845098e3d364b4984842e780a2e00b3fa1bdbf75f287f3affa59b18020c2b3c5d77572bb90196db88d0ad7aa521558b235e37c7dcf6945fd47bbaad06d3a675858b37a25bc9197d570e9aa9960181b606b5d5118d1bd1078f1808a0dc40c1446f3e1a50bd2b1e86a73900877352641337a99def21fc9be7b729a797447b54a51a1bf15eb2090d4b7e4a2b29f1b4be6e9e13eb7ac6b879d8b305f53dc9138a21d5c95e478e5b39621be7e203a71ac32952c93a6f630babaea24c9b0f488e6061f5c4556732a21f5623f9932f94b76ab04f629fcd5087fd4191b93af97b63afb3f867bb6a0fdcd85b12371b9deff28c026300bd565c4d59b0a5d8fbbe84006206cb3a77e90800e7250a5530df3c9a20abede86fec0e4f3c1a1cc9572027bee429a6980a1f9b734ec0dabfa897f66816bc55839204f3d786bc99cae4f86414ca90727039fe8338e1e9ffe17bf2c449fa99c0c4ecab07554cba606b86b66a0d0e4c52fe50d17284d9f765b0fc1626b06fddaccdafa50a0c2db3aa2ceb8226eff68430bd4f90f0e4cd4b70b96c240cfdab9093ca891a6a51e8b9f947c011a604ef58b890b2c599f373aa50bc53cc033860ab61744f4f243e74d0a8daf8d5e45ee18d7abdb862bd19191c9d73474ba70a48a8320f1694de2d0247688a9e3e77cc692b8802d1d29ae3a08e0a1f546d84cf17540e619df24c370a80de489705885b73ffd6fbec77a8667cca472a9bb4f38c5bd8da7a0a4ba749c38e52687739ef0c4f61c7b82189599aa48a60f4e6f65a5a34441a9a8c61a1218a6fcf5f93935b3e6657168f35052cbcfdc5f3361baf7d19d50b31cb184c6db34106eb948265c731d9e6bb55a738611b7f0e62e3bf81fd01f3b9d2df95f82abb2d366ea86aad1c7dd2af867331967353d1640698b022d568a522b9e6c7e3a7c60a74d28de571427bcbac3d290f77c901fdf63669c9ae513c03d99eae82d25a1316421c9a7c5ff26a7926dbd836308962368d24743d8f8d05a6bc2f493da0969871fb1e2a9580fd6c80f319b1bff937c5a403fbc8ebba0fb3bfd2f401ab5c8c917932bc97ae8a76070d800bb71d4867470b0724c0c1fe65a4d54bd5db1234cdb2f426c81d9230c4d366af1f19c626db0d36680b8bc9ea965642af9313dad0bb35685fcfcc98c4564e80346017e0932eb11142464725a957521fea96c85a47901d2fe8a4f1953889c6281d76d0c752d1a466c3db7a6acf27a78f2744a50393c7567b66500c8d9f85c87db3dbf6fd49fd9db63592bba78013a90576bdc8554877725bfe9b930c88e27f5cbdfed4f28cd4b07688aa58be06eda5d543915f842d781a286c2d35905f7aeddbeb044fa0d13e4e6ac9ad08a1bccd970faaa7c483fa14ea685905a4c00347b8dcb2a610f0af0873957af3d929ecf68e935861197d884145e1f494ad0567b916326ecdaf99ec9b3762d632846d4c462916a4fce9ef1836b949772bce6bf33d87dcfae4474d5dbba37940a43fac7ac4cb991700dcd8dcefc317c861c35c493b78456f2126fb78dcdf114a33277b97773cb6f383532ec8f3374477f3c4720e6e7fdc9f87f043b24f33402a5113209f4d3e788682371ca70b605c97a1131be9c46779907d248f6089922be588babc5f507eaddc9bfa94a12e1a5afd59eb6ed94f9f9c56306e577f672969bf14c0c14d9dace0cb3249c1e7d002997e8707947614ef6489a681af70cdbbc59ea9ad927d5aa2c855c21339ec3ae2fabe0c4dd7339a29fa7a41b7e3df9bef218f24615ebfa2b9130b84d7db996d2f719888632fa5df28cab11c38e0bb5895d9c97326e3c7441536fcaa34149800e69cdbe080e1be565d53284444e235a4e76c1b1837de6a96e6b08ca6689974b96dd89d03bcbc043db041846edc9d1ae869fffc95f15147450733c4678a38ef445b489a4c0c9b46035f8a183e0ff721c28a6c238541c93c61a859d600472ac9fa4dad5977b2044c1567a3f5f8fa013a7c1aae6f295ba482a26f47c5342ea64c6a54756c7d915b3833513788feaf25b4aaead63dd0e8efd0d61c72ed5f4e5b7baee9604bf5103b5ac9b710dc37f113ed70d90907bceee6af4c4d3b6775a6bd5e20e60b5ea46548fb458fadf421b14383b9672dc423a677df9373b00d62f1561682913a86539725a14812ee2da2c36f33189cbcafacc77f40a92fb57ebcdb412462972a3359a5fbd564fb11b4a45bd9fe9dd96fc163a71e9f1e9f2a185f4fec65a1f40af936f342eedf3f97966cad510c4e3a3c97d2888c7d0877dbd6253a6920cc99a9a45c60535d027c5cb851704932a3403413930fcbe1c3bf4b3846812b513bbe39b0f241e139fd02781484f83bd054b16df86c693df8d7c7f8a8a1e4e9cf892083a96d689eab5d97cef000ec556613f5f23178a39437db424b848adb6fb1ab20ba7916792e22f78a5945654c2e6df0f55fb2af8d13c669f316aedafab560bb7f10a6c0a224d67a062fa9df9dbd224d1f632506681b524d04b979e6a60c1f3f3246b359895fe37296fad2d675be33f7af80e1f87dbf711dc2b86889433aa5dd365e41cd3ebbc553c1c644b936e8186a4f8757cf806a28c43f57ca7e28cf3ac01d82d8f49142c46f5ff2a8eec2abb35fb894793280edcc2fd0acf3e151863aff850a0a74ae96c046791f51938c8bf6490886cfe8252422216b5e461b2e7fe368ae758832cd049f5e86d45fce2894fdd073ade95b0c42216d5eb985d071b16ce0cbdf9312d566b7074d6ab9cfd62162784c3f00b9bc58fac59f0f57167cf1a214342bc99acfec8ed00fbab19dd329396e860d76e42ba351d05f3fd96b9bef601bacedbde4e7202d185924176faff95062617ac1bb921c0fb36b1a164a79d8603294460f3da5b50aa7096593fe8fd5f184a88c987fd02ca09e0ddd926eb2522c8e3174f01cccd69ecf4a3d08059d494af33cc613232f32fca342121bf7721aaefcf2d45035d22222192ba9f9b6a4ed4739b8795f9f703e5c46b64544699f31ffa7756837e2b6158f341450a3a23a5f7a3ea1ad40c7cf478ab93197c943e76c0aeac4facf1f9b5d7ce00377738302d7f89f6ae03644573129e77c1d1b0778927004f3855957d1e73364a92cd8bf973b50aa64f1376ce510e01b5271be329e6bde90e7eeacf283e10ab0fc6a8ebc7ee3b92117a1a28e7c0a420ef5149567389e1cc45e17d0330f340eb2dd25de39dfc25393e617a1ba54467e15f0fbfa235772f016ef511abde4471e9820e630695b0be8deeee8abe1842bd5440416016bbed42d9dcf99459c10127e59fe5de64d7fc2d57457c6586c31777c5392e2b054b8114542a0167cd020fe7e30479d67b0e7c301b657ae3dc48676ca3aee455d83746ace4aa0465a0591f20b6ad96610d1d247993ceff1fcff132ecf7074ce3233b8d152098189f904240eacd92ab2bf98dffc0884e440ac385ccc8cda7845fd3d50009c72941e90f133defe1a6c5b4ab5fe11d94224f9ba98dfadd2a243388792d732c11fdffdc4b0d8a19414d8a6ad877878905f86fb7a402ed3dcd76e6a0e12e34ebfe9a613e21579f2a1c7ab6d13ac82bb249ab7dea7fa215a847f91d19f6e9613df519027b24c3749ae3f87ab0047351b3ded8f2cd80b1f2729c3895431e66292736f926be32489f6fc71bb51a312656d5aec6d1b5439969bcac44ea741ff81bf7e30401adee1438a09aa36378cdcb921b7eab6ecd01566bb02b34ae80675e86339b0901366f02d68b755b3021711954a89e7b5a72e338996baa7bfe504259650275034799d95469cb3abb187322a08e64afde42f603755a87f914c7fe9e7aad9c3538501fd6acb6a502318e3d9a6e36dec94aef6146ec8a8dbc58919d4cd5231239ff85793cfcc7bcb521b0c27c526edeb43c6e1c490490f25980abe981cd2968c7e1a037e42a033e8751cb503b2aeef1c3ac8572aec07c5c393eedda76fe574b64b6e0246aaf2ec640e33fdda11cf3af9bbc011463244f00d049b71b1bdff6c5d52b83e56e577bc35e61323d03a8df80ec72c2801878a167b86bc483d044179296c834b4e201e2f9c19e853becbdf3426b0ef561399f435ea23093167c6e4bb9b2c9b3e3adc38a4323dfd1b1ecb4d29d744c3d279d9691a18047d509781d2c04f1c5373774b75fa62101ac95fe1f4d47685a77465e9d89513327164ba57b4c5d3006d5dc9206d8b3d1d466f8367241055dcdde436671023a4dd51165152d59f49a5550e88b939db14293df62782f5560a54e1742c74fbda73ff975d29d293220f1c3ef3a21829c2e88a1212974744913fb440aa3789d2a23194109b9e1339f0520d7930758bfdbca3200191cd04b158e2e3d9367a89fc5f4ff476ac93efb0583d9be4a000b9e9eb69835cb77989e1320a8ff397224da950e8a42cc9cc8f6b3e329cacb09797ff7e707216081f7d965fc41e7744d6b02905b2ab3c46e05491db63718ec05948e79f3fecf2fbceada705432b7ce5ff535a9fe8fb11a528de55db08b2786f675c5336327db675f1f7ce17781381ab3f21912081258c218d29d5f7d42e853c606765881c40d1ea59b044ff5d7962fe2869789fc7edb6394a32a15804302f244ed24df6490ecf5cba0a274fc5f6caf248edf49e2126b3e2894b747dc658d7005a8abf2bb48e57a554ab02857a36fab66af63d8c3d92d2ab3e267b77a9ce67fd08dee65e4a3fe4a27aed06f830dd1035ea2dc46b2d509eddeea95a95f0e1fb75c67e6141766efed6c5f2676be0097961e0b0cd2ffeef50e6f4f27d9b6a93149ef001a84f834125fadb6a2a9f3259c67e8340943bf7dcf508f5cbde6775059d3d9220d9074a849d4ecd3a046ff6650334de5ee93d9a196dd44f448dde209f1db45cbf793ee8304bf6aaa51cefd411a5d133037cb8a5846b305e77bbe1157e8b585ace1de7929838da390cbd5cad2690a8d457771c5df23f894a88fcbc462d895db299f4c503457439ae8fcc2ddc975da0764e34628d45d52e19a758987c8dd936fab83ef18d11c3097c4fb894a23947e3a53ff507462630a71b039f14d0e045daa0d231a6475b59f8adeb8578135b1cbc916abc78cb19c1113bbc93c2e0fc4f9a951b23f0c45322ba61ed7803d0bde3b9278ccf4fd97fe10399ebab1b865c2da6e8f843eeacc0de818d1a4cbf8bd69ebb3ec27e69ab3ff9d7300ca54a2bbd88f189f925d73df638dd00d1c62c5fae2d2d3afa2a58d3decad91e613bb8627d7b9f88f6bc9f30555147c5a5ec9a08c90e586019fab273400a777dbc2b9a8800cb98f8ba3f1b4772d04c530aa8517781125a99c998f21cd68ec5987526c0481e4a4fb7c2c4b6196979987fa009a537e4ef5f777a3acebd11ca08610cfe09b8dc454dcd41c0bed72e3ad0799b617ee71f0e722ab0aefd76614543fb06d6464e5f29250d13b482f10cbd51ff1fb98559abd9b7e0e1401c72cf89ed3752d581d4f6193317bf1b6f99ec3c0119b877f09a4bc9a16922e563c3adbcf2e86f4ecb9adbd697916299658e9e6f34f5c6e3d67924208bb37be2bff5f78526c33c3b6e4ef5b9b33df46fa446a967f2848d1562a6bbff234fe34da0740d2da7f57dd2a47a456baf63f9edfbc5435e80163b1452603e85b2717c1a50b4eff25207e04b457020c94b1625ea2c7ada0a6dd44abfab07f9eba175295847ea23ceaaf3dbd1851f6b4692a6698c059d6f89a2e29f75e3d72408a0bccb2cd40869ac00b6afe495c3df0daa1072db667bb57bb00748434c1ae11eaf49024c13b92fe922cbda12de327e08f56f019b5843c29e494d8cf0017fd36b178c3d25ac8fec1d08dc055c334a9a4737c185e1c2cf8f5a0fb1f3b6c6c20a1f2b38159e384de7f305c9792e725f8f647d74a0ac6c7f867860a32707db1b683eb9ccdb6aaf8961323911a75b389bc26facd21da73755bc932177673ec61d1bf8e9186a578cc2039f46ba9be167cc164c3c074add1ee27698d2724d5e1e2d10a72353a5c9f7fc02fcfbf59ceeb4f25a46c4d8b5c011d70ba6249835f75fc59b341c6200ab5666b3d0277d2ce277a66d238ce8ba4374bfcd1c48a36806d60e021c7a2a20fa659793311641ae1c8b2fc319f499bbd643e7803735e397ff3eddafe699a32320856af74c52e0d59a50c5438f94a9f847ccb3eb8f98120907a5c9737128cce05a34bb5208ea01637e5d50af1a4a12f81b14898db8446b527be133ca4a7602a50bb744ecf88ee299203f2fe28981d04c2bbb35e73ef60bad28bce0699d0a6a4264dbcd87bb3fa0bd09eb06ed3157bae99b222208d0a6189ab2cb77a33260eb107087cbec562e9bee40405b8801c92bbd8778311ada91eea410940458538a68388dfff73ea332027980f7d971dc1729313d9d0fa77218ad42b052e24b8c34d795750e927f2ad54777062babb79e8a7d7c07b94c4a3305adc317001998ac10cdb0c9c3ca80ad7cadfd623757c816a214573a87c1607ef5ab9c5fafab86f65a8f5e8c74d996fe08aef94dd5a1c5382f304c454067eadc221f580027e497b633e17821149b75ffdfb0797ba912188fc5624f86d3d020491cfe83b0497a9a104dd0a837c08aaa707b5fadb36f768bf111dae95da51df0b40222644a026c0cc8e6dc54bd918db254ccce47af95800fecf04ead121ea910de213c403ddccb380c3c64ad05cdc7ed74b7f82e556a9ae1edbeab23adc11155325b317a9cc344d15e2b22c8a7bd873cb4f94af294ee91903eb9f1d49c6ce438b6b62a258779e497fd4795ad8e73b95d72b55b0d1749d7a874c622d43aa58cd5af3da2805155f6720a3c2baff016b52ae09ea6e87f4a6149c67ec0471762305e669cd926b31cd3c8a595dfc24b40706dc498a6ec654cec4c1c37d78471c63eb358e88b1faf2e2ad91bb3a40f1cd3854f040aeea0cf051a007ab074f032bf41bd58f9f77d0766562f9dcdc4e0156d8e4993ab2bbf1e737a616c67f39aaafc46d4bcd6936297c381f401e3e91215ce3ec131ef775e7ecacb0a46b9eb689d0a551adae3bef774247cae80874788edc0758fd5761c0dd90fb86034524a6214297b3420f5b1729539c5742cbbf4d656ae719e3866edd83a095cea8e0263421083edd868ef96cd9a85d4dfefb97689c93dd607073c2086af7ba77079412c9671de79873b3b7d27a18a3e7ca7b4b96e215d3f77ef106063d23f4ffdf9d45c38295253adf05ecf12687b0e38977d280e5d5c673fd6f8eb8c00d809953a5421004dc08dd4cc63067ebd363ac3f9ddc2499db350e14a737ba1f97ea6aff1814d7785f606e94479606d989c6b9bfb85b9376cf947acf0619c998a618238fcff85787e924f0811e18a2f2388d9aa7894b1c2e4095e2874e8d45179229e95cdd994700429b867f439eb3ab6a99380fadedc708d0c01e48687f2806dc55ee8e85a2c7bc46e37e9e50e96c794bd852a65df303a16956c85b6487f47e59b9c3ce5ad168083a3d70ff5da979395bfa8f6faa688391c3be281e8696b746d68fe46e80158b9d00aa21751889651f9e32ce9f1b0213d5a49cc8021a60c2a5452186a3d2f26976da669e07eab9bab4fb4093bfed0eb954f8087b3059edcfb0b04080d8fe95133170ce0dd47d3df09ab97e56f6ed08c97d475b6cf22868677ca8dfbf7dec8642cb410475c916c11692ed57432814d97d0349fafde4886a9448070a4e81f4af8858eb32bcaf7fdc4e00a71851802d8e8c474b7b21625cd48d5db34544f84473350cb3346f55bd59819a4371d456fa0cae015760919ec7915f4c56d0975165c0481ba4de3474dbba64103e4c3ff8d413c02a91625f7fd80cebe0e7cab0d45c868d58bde11b9874297a75e9caf4b71abe2a46b044b1e62b960db083d9ac3f643f409d3e1cdd8c0123e4da59b9bd85a05d8b526484915836856fd32ecbd37ca92491df71c6393f563f4843a1977457d27eb6858eab49e6cfc62f1c3d8ccfa573152058f7877c0a1d8f8469d7a9331e8e5e42f7000ed1aabd17dd3736cbf6ce21bf26902dd6c365d77aa46deb9366fc6639c4cf6c91a727e2ee51ea55fe790eaef82af9ab36abaecd078c4f9950dbd967b4f7e4806386660ef3172aa4477fd48f20b05425b4f245a17d16be39e6ec498e1fd3920aa741a0e7553969b8493faf0e1d8cd374309a3ee3fc5f44b8a0014590cc749dfcba4bd4611bdb4a12576d6d96819923c2f6ca24cce1bbd5c48154c43754d96f7f2128fd4e5033081725b211bf90f63fe0c15a07215ad9e0371d5b6a722926cf80c19622a2bcc99b6534d9f8247b6134da92a38211ac8ffce254b61ed00c2e77742b4b983167b9560901509fc8ac4cc4ff83151b4fce9b6d34e41c19dbe57e72ee99c5d697e60c73eb885b9e0871e8bcf54ffacf4cf10698c3985d7b776aad787dfe8e74a7a458992ac6c6995559c9624595f7c90b8cd8c1c574f30ba1a40493053672259c8f2aee66be28c7bc38419710305218ee6b4eed6b37b1d098ae61beae62647ff10c82187fe79455405d3040e1015eb21a7814f7183df6aaefed6bb7e308ad47550870c3a1ce51a5c5571c98b987557e60b44d74e2b11f87752bd22ec1b9c39f9ce54eb2fc7ee20cac4fa9ba30963572215a82456e0839ceab0f6ae7c8cf5859a67e7d86d16757739aa028774ee62811b8ab683d424e67aaa94f5847208cec8ff4cdbccca09ab4dd2fb43d513280baa9adbd2df112b0499a92110cd517f6fa7f9580133d038c17aab067b3bb880da22565d479068586baa0cf44c6ebf46f3c4211cadd4ff6b7d2bcf2d3c1acf25d1646c982ee9d6e1d08f0bd5d49bbef09198740c2a6136e331658dc6ac17f891b588d60d6dccd19179475d911fea3f4e951440b5ed43e7d652a6efdf796983efb9017e8046e2398579cbd2297a8c4e03cf79accdee6aaaa87d2af3f7a261a8c65387d52d25d7ae631868bf0754036fc154126d168331665232fbf65fe705fd5966925aaee344b0735b02ca67bfb6d18bc7f563c62dc75bc17d83de2f62c0e1898f3270f20ae31159656f692c6eaf4e268ca8fab74a87daac2282dfe88c8fa6c40edc368984f6ebdb2a8f26db2f787140a998e02fd8bd03d5e34f06ff1c6f969808253f054845868375d1aac64fdf28c19aea642b3e9aa743bfa27573f97ed17fb0fc80bee04a781f36b855e23520ca76bfa489dbb48ccdc23ef5945bb3b1881eb8290adf56bce4ef6f956f08ea38ca4a48c2e7a2272e2858157503995ab26731bee2581f4af7a44f7505833b73afc68d26628257f6501e9d640d1bf649d7d813e4fefae72fd8cf09fd8e9c672e44cf381513dd80758bca3109a8d9f6cf035893f4e1f0c983a30f1ce1dc8414f84b0b9ca2b3042befca83448b437a2354b5044b44ee9d4ddcfb972f993c0c07af4ff58ef22dfcbc6b436fecbbf9b977ac616ccef239f5d725c5ed2539578ccc40f9d31964b08afafc190767f6cdf8ab2f440e5afe1529e552e814e9ae59420c8d068ec5a233f4ceccb97bb9382c7604163477005f2fa02eaa11194d99dc15d174e82c83b11254a75b013f6d958aa6b805e1093a0cc5589c7c91fd879e8971f820daa36f9c83b7295f55190b48c7fcbca1fd54b2848e26ced2b75462b9649aa04538a3122ff0a94e4f92eaaea4eb66b9deaeeb3011f8fded724c9892cc67a8f4589c0dea72e6bdd7a61f5a40fc8d1d733fc8d80c6a0ccd1448a7510e2efd714e931d5ccbc6426ece4df5a18193f4a4743759edd79151e77597a08af25f5dee1421a2c5f0b8e885a62eb343e5c95104d94a00e3ee4295b3ee35a48db0341df4392c921e42a9bd446d4a79b6b972af085c0fe1d18eddc1c806a6ae6a688dc40eb3496d93717225b8943e3f038f2247c312f31ec8053dafe923b25d04d72fde82c626f72400ae6ed79d3622fbe8eadf491635993a5e7842c9731ac824f3517f07aa951f031fa1d74ab8f3585a023998fce25c32b7ff4692db7e043f058ac27b492a5a652c973d921094701c37053451f4203d3e0d756db76fe03772bb3426534c7387691c78f3c58eebce43e6cbcd669d78bac8ac46b07de9a9bd42e4dc8e9ab888a1feca2052fa00c36cf07166ff7c03dbc25d0489e75a860309b434281a820bd8b88512359e150e051aa83952f174fca3683285c4e467d04f6ab9521571b74e5ca83c1c00b16b1e088365a61dfcd2cbd58e42a45f3aa6b3aeff27f8461ce682c33d4cea9b6ddac1fbc120c5bcae59a0000a77c03754d1b32cbdd17fbdbf9ac5a1cc806796bb8705069cca3edd072e98bf71f181504d652473aa863d468a5143ffcd0b5c9019bf83d73cbb9072961a34cf9463a137fb1a71a81ec10c0ac22ed92f9aa0dd11ac19835d6b8294e8735f5bb8621fa3f2b449d9c72708d31480547d38a1f66b017ed1eb7e272d8a6f38dc835cb4521195ce227ff48ac83238ecfb548d97c828668ed92d18d574852fc442823a77f9b908146c8df6a50bdcadcfd819a9951e41b875405564383cfdf99008f84f31c28b2c0c4fa70a7ba0b3903bff69b89a1af6bf536fc461b12eb537e3acb7db94b6cf075ce640269e314f82049dfdb971087eedb25e6548d855be85e098b0df406aa0894c54a32358d28708dbcf13a3757a5</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">主页支付宝转账5元，并留言文章标题获取密码！</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> Linux驱动 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux驱动 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>分类</title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>关于</title>
      <link href="/about/index.html"/>
      <url>/about/index.html</url>
      
        <content type="html"><![CDATA[<p>路虽远行则将至，事虽难做则必成！</p>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>link</title>
      <link href="/link/index.html"/>
      <url>/link/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>movies</title>
      <link href="/movies/index.html"/>
      <url>/movies/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>music</title>
      <link href="/music/index.html"/>
      <url>/music/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>tags</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
  
</search>
